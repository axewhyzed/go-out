var DL=Object.create;var ep=Object.defineProperty,CL=Object.defineProperties,ML=Object.getOwnPropertyDescriptor,AL=Object.getOwnPropertyDescriptors,RL=Object.getOwnPropertyNames,qg=Object.getOwnPropertySymbols,PL=Object.getPrototypeOf,U0=Object.prototype.hasOwnProperty,PI=Object.prototype.propertyIsEnumerable;var RI=(i,a,c)=>a in i?ep(i,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):i[a]=c,kt=(i,a)=>{for(var c in a||={})U0.call(a,c)&&RI(i,c,a[c]);if(qg)for(var c of qg(a))PI.call(a,c)&&RI(i,c,a[c]);return i},Sr=(i,a)=>CL(i,AL(a));var tp=(i,a)=>{var c={};for(var m in i)U0.call(i,m)&&a.indexOf(m)<0&&(c[m]=i[m]);if(i!=null&&qg)for(var m of qg(i))a.indexOf(m)<0&&PI.call(i,m)&&(c[m]=i[m]);return c};var OI=(i,a)=>()=>(i&&(a=i(i=0)),a);var $n=(i,a)=>()=>(a||i((a={exports:{}}).exports,a),a.exports),OL=(i,a)=>{for(var c in a)ep(i,c,{get:a[c],enumerable:!0})},LI=(i,a,c,m)=>{if(a&&typeof a=="object"||typeof a=="function")for(let b of RL(a))!U0.call(i,b)&&b!==c&&ep(i,b,{get:()=>a[b],enumerable:!(m=ML(a,b))||m.enumerable});return i};var kI=(i,a,c)=>(c=i!=null?DL(PL(i)):{},LI(a||!i||!i.__esModule?ep(c,"default",{value:i,enumerable:!0}):c,i)),LL=i=>LI(ep({},"__esModule",{value:!0}),i);var qA=$n((X1,Y1)=>{"use strict";(function(i,a){typeof X1=="object"&&typeof Y1<"u"?Y1.exports=a():typeof define=="function"&&define.amd?define(a):(i=typeof globalThis<"u"?globalThis:i||self,i.mapboxgl=a())})(X1,function(){"use strict";var i,a,c;function m(n,P){if(!i)i=P;else if(!a)a=P;else{var U="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",$={};i($),c=P($),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}m(["exports"],function(n){function P(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var U,$={},se={};function Te(){if(U)return se;U=1,Object.defineProperty(se,"__esModule",{value:!0}),se.setMatrixArrayType=function(f){se.ARRAY_TYPE=e=f},se.toRadian=function(f){return f*l},se.equals=function(f,u){return Math.abs(f-u)<=s*Math.max(1,Math.abs(f),Math.abs(u))},se.RANDOM=se.ARRAY_TYPE=se.EPSILON=void 0;var s=1e-6;se.EPSILON=s;var e=typeof Float32Array<"u"?Float32Array:Array;se.ARRAY_TYPE=e;var r=Math.random;se.RANDOM=r;var l=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var f=0,u=arguments.length;u--;)f+=arguments[u]*arguments[u];return Math.sqrt(f)}),se}var Pe,Ye={};function We(){if(Pe)return Ye;function s(u){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},s(u)}Pe=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.create=function(){var u=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},Ye.clone=function(u){var p=new e.ARRAY_TYPE(4);return p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p},Ye.copy=function(u,p){return u[0]=p[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u},Ye.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u},Ye.fromValues=function(u,p,v,T){var D=new e.ARRAY_TYPE(4);return D[0]=u,D[1]=p,D[2]=v,D[3]=T,D},Ye.set=function(u,p,v,T,D){return u[0]=p,u[1]=v,u[2]=T,u[3]=D,u},Ye.transpose=function(u,p){if(u===p){var v=p[1];u[1]=p[2],u[2]=v}else u[0]=p[0],u[1]=p[2],u[2]=p[1],u[3]=p[3];return u},Ye.invert=function(u,p){var v=p[0],T=p[1],D=p[2],_=p[3],E=v*_-D*T;return E?(u[0]=_*(E=1/E),u[1]=-T*E,u[2]=-D*E,u[3]=v*E,u):null},Ye.adjoint=function(u,p){var v=p[0];return u[0]=p[3],u[1]=-p[1],u[2]=-p[2],u[3]=v,u},Ye.determinant=function(u){return u[0]*u[3]-u[2]*u[1]},Ye.multiply=l,Ye.rotate=function(u,p,v){var T=p[0],D=p[1],_=p[2],E=p[3],S=Math.sin(v),w=Math.cos(v);return u[0]=T*w+_*S,u[1]=D*w+E*S,u[2]=T*-S+_*w,u[3]=D*-S+E*w,u},Ye.scale=function(u,p,v){var T=p[1],D=p[2],_=p[3],E=v[0],S=v[1];return u[0]=p[0]*E,u[1]=T*E,u[2]=D*S,u[3]=_*S,u},Ye.fromRotation=function(u,p){var v=Math.sin(p),T=Math.cos(p);return u[0]=T,u[1]=v,u[2]=-v,u[3]=T,u},Ye.fromScaling=function(u,p){return u[0]=p[0],u[1]=0,u[2]=0,u[3]=p[1],u},Ye.str=function(u){return"mat2("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+")"},Ye.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3])},Ye.LDU=function(u,p,v,T){return u[2]=T[2]/T[0],v[0]=T[0],v[1]=T[1],v[3]=T[3]-u[2]*v[1],[u,p,v]},Ye.add=function(u,p,v){return u[0]=p[0]+v[0],u[1]=p[1]+v[1],u[2]=p[2]+v[2],u[3]=p[3]+v[3],u},Ye.subtract=f,Ye.exactEquals=function(u,p){return u[0]===p[0]&&u[1]===p[1]&&u[2]===p[2]&&u[3]===p[3]},Ye.equals=function(u,p){var v=u[0],T=u[1],D=u[2],_=u[3],E=p[0],S=p[1],w=p[2],I=p[3];return Math.abs(v-E)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(T-S)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(S))&&Math.abs(D-w)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(w))&&Math.abs(_-I)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(I))},Ye.multiplyScalar=function(u,p,v){return u[0]=p[0]*v,u[1]=p[1]*v,u[2]=p[2]*v,u[3]=p[3]*v,u},Ye.multiplyScalarAndAdd=function(u,p,v,T){return u[0]=p[0]+v[0]*T,u[1]=p[1]+v[1]*T,u[2]=p[2]+v[2]*T,u[3]=p[3]+v[3]*T,u},Ye.sub=Ye.mul=void 0;var e=function(u,p){if(u&&u.__esModule)return u;if(u===null||s(u)!=="object"&&typeof u!="function")return{default:u};var v=r(void 0);if(v&&v.has(u))return v.get(u);var T={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in u)if(_!=="default"&&Object.prototype.hasOwnProperty.call(u,_)){var E=D?Object.getOwnPropertyDescriptor(u,_):null;E&&(E.get||E.set)?Object.defineProperty(T,_,E):T[_]=u[_]}return T.default=u,v&&v.set(u,T),T}(Te());function r(u){if(typeof WeakMap!="function")return null;var p=new WeakMap,v=new WeakMap;return(r=function(T){return T?v:p})(u)}function l(u,p,v){var T=p[0],D=p[1],_=p[2],E=p[3],S=v[0],w=v[1],I=v[2],M=v[3];return u[0]=T*S+_*w,u[1]=D*S+E*w,u[2]=T*I+_*M,u[3]=D*I+E*M,u}function f(u,p,v){return u[0]=p[0]-v[0],u[1]=p[1]-v[1],u[2]=p[2]-v[2],u[3]=p[3]-v[3],u}return Ye.mul=l,Ye.sub=f,Ye}var pt,_t={};function on(){if(pt)return _t;function s(u){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},s(u)}pt=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.create=function(){var u=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[4]=0,u[5]=0),u[0]=1,u[3]=1,u},_t.clone=function(u){var p=new e.ARRAY_TYPE(6);return p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[4]=u[4],p[5]=u[5],p},_t.copy=function(u,p){return u[0]=p[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u},_t.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=0,u[5]=0,u},_t.fromValues=function(u,p,v,T,D,_){var E=new e.ARRAY_TYPE(6);return E[0]=u,E[1]=p,E[2]=v,E[3]=T,E[4]=D,E[5]=_,E},_t.set=function(u,p,v,T,D,_,E){return u[0]=p,u[1]=v,u[2]=T,u[3]=D,u[4]=_,u[5]=E,u},_t.invert=function(u,p){var v=p[0],T=p[1],D=p[2],_=p[3],E=p[4],S=p[5],w=v*_-T*D;return w?(u[0]=_*(w=1/w),u[1]=-T*w,u[2]=-D*w,u[3]=v*w,u[4]=(D*S-_*E)*w,u[5]=(T*E-v*S)*w,u):null},_t.determinant=function(u){return u[0]*u[3]-u[1]*u[2]},_t.multiply=l,_t.rotate=function(u,p,v){var T=p[0],D=p[1],_=p[2],E=p[3],S=p[4],w=p[5],I=Math.sin(v),M=Math.cos(v);return u[0]=T*M+_*I,u[1]=D*M+E*I,u[2]=T*-I+_*M,u[3]=D*-I+E*M,u[4]=S,u[5]=w,u},_t.scale=function(u,p,v){var T=p[1],D=p[2],_=p[3],E=p[4],S=p[5],w=v[0],I=v[1];return u[0]=p[0]*w,u[1]=T*w,u[2]=D*I,u[3]=_*I,u[4]=E,u[5]=S,u},_t.translate=function(u,p,v){var T=p[0],D=p[1],_=p[2],E=p[3],S=p[4],w=p[5],I=v[0],M=v[1];return u[0]=T,u[1]=D,u[2]=_,u[3]=E,u[4]=T*I+_*M+S,u[5]=D*I+E*M+w,u},_t.fromRotation=function(u,p){var v=Math.sin(p),T=Math.cos(p);return u[0]=T,u[1]=v,u[2]=-v,u[3]=T,u[4]=0,u[5]=0,u},_t.fromScaling=function(u,p){return u[0]=p[0],u[1]=0,u[2]=0,u[3]=p[1],u[4]=0,u[5]=0,u},_t.fromTranslation=function(u,p){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=p[0],u[5]=p[1],u},_t.str=function(u){return"mat2d("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+")"},_t.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],1)},_t.add=function(u,p,v){return u[0]=p[0]+v[0],u[1]=p[1]+v[1],u[2]=p[2]+v[2],u[3]=p[3]+v[3],u[4]=p[4]+v[4],u[5]=p[5]+v[5],u},_t.subtract=f,_t.multiplyScalar=function(u,p,v){return u[0]=p[0]*v,u[1]=p[1]*v,u[2]=p[2]*v,u[3]=p[3]*v,u[4]=p[4]*v,u[5]=p[5]*v,u},_t.multiplyScalarAndAdd=function(u,p,v,T){return u[0]=p[0]+v[0]*T,u[1]=p[1]+v[1]*T,u[2]=p[2]+v[2]*T,u[3]=p[3]+v[3]*T,u[4]=p[4]+v[4]*T,u[5]=p[5]+v[5]*T,u},_t.exactEquals=function(u,p){return u[0]===p[0]&&u[1]===p[1]&&u[2]===p[2]&&u[3]===p[3]&&u[4]===p[4]&&u[5]===p[5]},_t.equals=function(u,p){var v=u[0],T=u[1],D=u[2],_=u[3],E=u[4],S=u[5],w=p[0],I=p[1],M=p[2],L=p[3],k=p[4],B=p[5];return Math.abs(v-w)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(w))&&Math.abs(T-I)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(I))&&Math.abs(D-M)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(M))&&Math.abs(_-L)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(L))&&Math.abs(E-k)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(k))&&Math.abs(S-B)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(B))},_t.sub=_t.mul=void 0;var e=function(u,p){if(u&&u.__esModule)return u;if(u===null||s(u)!=="object"&&typeof u!="function")return{default:u};var v=r(void 0);if(v&&v.has(u))return v.get(u);var T={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in u)if(_!=="default"&&Object.prototype.hasOwnProperty.call(u,_)){var E=D?Object.getOwnPropertyDescriptor(u,_):null;E&&(E.get||E.set)?Object.defineProperty(T,_,E):T[_]=u[_]}return T.default=u,v&&v.set(u,T),T}(Te());function r(u){if(typeof WeakMap!="function")return null;var p=new WeakMap,v=new WeakMap;return(r=function(T){return T?v:p})(u)}function l(u,p,v){var T=p[0],D=p[1],_=p[2],E=p[3],S=p[4],w=p[5],I=v[0],M=v[1],L=v[2],k=v[3],B=v[4],V=v[5];return u[0]=T*I+_*M,u[1]=D*I+E*M,u[2]=T*L+_*k,u[3]=D*L+E*k,u[4]=T*B+_*V+S,u[5]=D*B+E*V+w,u}function f(u,p,v){return u[0]=p[0]-v[0],u[1]=p[1]-v[1],u[2]=p[2]-v[2],u[3]=p[3]-v[3],u[4]=p[4]-v[4],u[5]=p[5]-v[5],u}return _t.mul=l,_t.sub=f,_t}var an,Ft={};function mr(){if(an)return Ft;function s(u){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},s(u)}an=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.create=function(){var u=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u},Ft.fromMat4=function(u,p){return u[0]=p[0],u[1]=p[1],u[2]=p[2],u[3]=p[4],u[4]=p[5],u[5]=p[6],u[6]=p[8],u[7]=p[9],u[8]=p[10],u},Ft.clone=function(u){var p=new e.ARRAY_TYPE(9);return p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[4]=u[4],p[5]=u[5],p[6]=u[6],p[7]=u[7],p[8]=u[8],p},Ft.copy=function(u,p){return u[0]=p[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u},Ft.fromValues=function(u,p,v,T,D,_,E,S,w){var I=new e.ARRAY_TYPE(9);return I[0]=u,I[1]=p,I[2]=v,I[3]=T,I[4]=D,I[5]=_,I[6]=E,I[7]=S,I[8]=w,I},Ft.set=function(u,p,v,T,D,_,E,S,w,I){return u[0]=p,u[1]=v,u[2]=T,u[3]=D,u[4]=_,u[5]=E,u[6]=S,u[7]=w,u[8]=I,u},Ft.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Ft.transpose=function(u,p){if(u===p){var v=p[1],T=p[2],D=p[5];u[1]=p[3],u[2]=p[6],u[3]=v,u[5]=p[7],u[6]=T,u[7]=D}else u[0]=p[0],u[1]=p[3],u[2]=p[6],u[3]=p[1],u[4]=p[4],u[5]=p[7],u[6]=p[2],u[7]=p[5],u[8]=p[8];return u},Ft.invert=function(u,p){var v=p[0],T=p[1],D=p[2],_=p[3],E=p[4],S=p[5],w=p[6],I=p[7],M=p[8],L=M*E-S*I,k=-M*_+S*w,B=I*_-E*w,V=v*L+T*k+D*B;return V?(u[0]=L*(V=1/V),u[1]=(-M*T+D*I)*V,u[2]=(S*T-D*E)*V,u[3]=k*V,u[4]=(M*v-D*w)*V,u[5]=(-S*v+D*_)*V,u[6]=B*V,u[7]=(-I*v+T*w)*V,u[8]=(E*v-T*_)*V,u):null},Ft.adjoint=function(u,p){var v=p[0],T=p[1],D=p[2],_=p[3],E=p[4],S=p[5],w=p[6],I=p[7],M=p[8];return u[0]=E*M-S*I,u[1]=D*I-T*M,u[2]=T*S-D*E,u[3]=S*w-_*M,u[4]=v*M-D*w,u[5]=D*_-v*S,u[6]=_*I-E*w,u[7]=T*w-v*I,u[8]=v*E-T*_,u},Ft.determinant=function(u){var p=u[3],v=u[4],T=u[5],D=u[6],_=u[7],E=u[8];return u[0]*(E*v-T*_)+u[1]*(-E*p+T*D)+u[2]*(_*p-v*D)},Ft.multiply=l,Ft.translate=function(u,p,v){var T=p[0],D=p[1],_=p[2],E=p[3],S=p[4],w=p[5],I=p[6],M=p[7],L=p[8],k=v[0],B=v[1];return u[0]=T,u[1]=D,u[2]=_,u[3]=E,u[4]=S,u[5]=w,u[6]=k*T+B*E+I,u[7]=k*D+B*S+M,u[8]=k*_+B*w+L,u},Ft.rotate=function(u,p,v){var T=p[0],D=p[1],_=p[2],E=p[3],S=p[4],w=p[5],I=p[6],M=p[7],L=p[8],k=Math.sin(v),B=Math.cos(v);return u[0]=B*T+k*E,u[1]=B*D+k*S,u[2]=B*_+k*w,u[3]=B*E-k*T,u[4]=B*S-k*D,u[5]=B*w-k*_,u[6]=I,u[7]=M,u[8]=L,u},Ft.scale=function(u,p,v){var T=v[0],D=v[1];return u[0]=T*p[0],u[1]=T*p[1],u[2]=T*p[2],u[3]=D*p[3],u[4]=D*p[4],u[5]=D*p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u},Ft.fromTranslation=function(u,p){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=p[0],u[7]=p[1],u[8]=1,u},Ft.fromRotation=function(u,p){var v=Math.sin(p),T=Math.cos(p);return u[0]=T,u[1]=v,u[2]=0,u[3]=-v,u[4]=T,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Ft.fromScaling=function(u,p){return u[0]=p[0],u[1]=0,u[2]=0,u[3]=0,u[4]=p[1],u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Ft.fromMat2d=function(u,p){return u[0]=p[0],u[1]=p[1],u[2]=0,u[3]=p[2],u[4]=p[3],u[5]=0,u[6]=p[4],u[7]=p[5],u[8]=1,u},Ft.fromQuat=function(u,p){var v=p[0],T=p[1],D=p[2],_=p[3],E=v+v,S=T+T,w=D+D,I=v*E,M=T*E,L=T*S,k=D*E,B=D*S,V=D*w,N=_*E,G=_*S,H=_*w;return u[0]=1-L-V,u[3]=M-H,u[6]=k+G,u[1]=M+H,u[4]=1-I-V,u[7]=B-N,u[2]=k-G,u[5]=B+N,u[8]=1-I-L,u},Ft.normalFromMat4=function(u,p){var v=p[0],T=p[1],D=p[2],_=p[3],E=p[4],S=p[5],w=p[6],I=p[7],M=p[8],L=p[9],k=p[10],B=p[11],V=p[12],N=p[13],G=p[14],H=p[15],J=v*S-T*E,oe=v*w-D*E,ee=v*I-_*E,ne=T*w-D*S,pe=T*I-_*S,te=D*I-_*w,de=M*N-L*V,ye=M*G-k*V,ve=M*H-B*V,Ee=L*G-k*N,Me=L*H-B*N,Re=k*H-B*G,De=J*Re-oe*Me+ee*Ee+ne*ve-pe*ye+te*de;return De?(u[0]=(S*Re-w*Me+I*Ee)*(De=1/De),u[1]=(w*ve-E*Re-I*ye)*De,u[2]=(E*Me-S*ve+I*de)*De,u[3]=(D*Me-T*Re-_*Ee)*De,u[4]=(v*Re-D*ve+_*ye)*De,u[5]=(T*ve-v*Me-_*de)*De,u[6]=(N*te-G*pe+H*ne)*De,u[7]=(G*ee-V*te-H*oe)*De,u[8]=(V*pe-N*ee+H*J)*De,u):null},Ft.projection=function(u,p,v){return u[0]=2/p,u[1]=0,u[2]=0,u[3]=0,u[4]=-2/v,u[5]=0,u[6]=-1,u[7]=1,u[8]=1,u},Ft.str=function(u){return"mat3("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+", "+u[6]+", "+u[7]+", "+u[8]+")"},Ft.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8])},Ft.add=function(u,p,v){return u[0]=p[0]+v[0],u[1]=p[1]+v[1],u[2]=p[2]+v[2],u[3]=p[3]+v[3],u[4]=p[4]+v[4],u[5]=p[5]+v[5],u[6]=p[6]+v[6],u[7]=p[7]+v[7],u[8]=p[8]+v[8],u},Ft.subtract=f,Ft.multiplyScalar=function(u,p,v){return u[0]=p[0]*v,u[1]=p[1]*v,u[2]=p[2]*v,u[3]=p[3]*v,u[4]=p[4]*v,u[5]=p[5]*v,u[6]=p[6]*v,u[7]=p[7]*v,u[8]=p[8]*v,u},Ft.multiplyScalarAndAdd=function(u,p,v,T){return u[0]=p[0]+v[0]*T,u[1]=p[1]+v[1]*T,u[2]=p[2]+v[2]*T,u[3]=p[3]+v[3]*T,u[4]=p[4]+v[4]*T,u[5]=p[5]+v[5]*T,u[6]=p[6]+v[6]*T,u[7]=p[7]+v[7]*T,u[8]=p[8]+v[8]*T,u},Ft.exactEquals=function(u,p){return u[0]===p[0]&&u[1]===p[1]&&u[2]===p[2]&&u[3]===p[3]&&u[4]===p[4]&&u[5]===p[5]&&u[6]===p[6]&&u[7]===p[7]&&u[8]===p[8]},Ft.equals=function(u,p){var v=u[0],T=u[1],D=u[2],_=u[3],E=u[4],S=u[5],w=u[6],I=u[7],M=u[8],L=p[0],k=p[1],B=p[2],V=p[3],N=p[4],G=p[5],H=p[6],J=p[7],oe=p[8];return Math.abs(v-L)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(T-k)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(k))&&Math.abs(D-B)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(B))&&Math.abs(_-V)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(E-N)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(N))&&Math.abs(S-G)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(G))&&Math.abs(w-H)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(H))&&Math.abs(I-J)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(J))&&Math.abs(M-oe)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(oe))},Ft.sub=Ft.mul=void 0;var e=function(u,p){if(u&&u.__esModule)return u;if(u===null||s(u)!=="object"&&typeof u!="function")return{default:u};var v=r(void 0);if(v&&v.has(u))return v.get(u);var T={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in u)if(_!=="default"&&Object.prototype.hasOwnProperty.call(u,_)){var E=D?Object.getOwnPropertyDescriptor(u,_):null;E&&(E.get||E.set)?Object.defineProperty(T,_,E):T[_]=u[_]}return T.default=u,v&&v.set(u,T),T}(Te());function r(u){if(typeof WeakMap!="function")return null;var p=new WeakMap,v=new WeakMap;return(r=function(T){return T?v:p})(u)}function l(u,p,v){var T=p[0],D=p[1],_=p[2],E=p[3],S=p[4],w=p[5],I=p[6],M=p[7],L=p[8],k=v[0],B=v[1],V=v[2],N=v[3],G=v[4],H=v[5],J=v[6],oe=v[7],ee=v[8];return u[0]=k*T+B*E+V*I,u[1]=k*D+B*S+V*M,u[2]=k*_+B*w+V*L,u[3]=N*T+G*E+H*I,u[4]=N*D+G*S+H*M,u[5]=N*_+G*w+H*L,u[6]=J*T+oe*E+ee*I,u[7]=J*D+oe*S+ee*M,u[8]=J*_+oe*w+ee*L,u}function f(u,p,v){return u[0]=p[0]-v[0],u[1]=p[1]-v[1],u[2]=p[2]-v[2],u[3]=p[3]-v[3],u[4]=p[4]-v[4],u[5]=p[5]-v[5],u[6]=p[6]-v[6],u[7]=p[7]-v[7],u[8]=p[8]-v[8],u}return Ft.mul=l,Ft.sub=f,Ft}var Dn,St={};function xn(){if(Dn)return St;function s(_){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},s(_)}Dn=1,Object.defineProperty(St,"__esModule",{value:!0}),St.create=function(){var _=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},St.clone=function(_){var E=new e.ARRAY_TYPE(16);return E[0]=_[0],E[1]=_[1],E[2]=_[2],E[3]=_[3],E[4]=_[4],E[5]=_[5],E[6]=_[6],E[7]=_[7],E[8]=_[8],E[9]=_[9],E[10]=_[10],E[11]=_[11],E[12]=_[12],E[13]=_[13],E[14]=_[14],E[15]=_[15],E},St.copy=function(_,E){return _[0]=E[0],_[1]=E[1],_[2]=E[2],_[3]=E[3],_[4]=E[4],_[5]=E[5],_[6]=E[6],_[7]=E[7],_[8]=E[8],_[9]=E[9],_[10]=E[10],_[11]=E[11],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15],_},St.fromValues=function(_,E,S,w,I,M,L,k,B,V,N,G,H,J,oe,ee){var ne=new e.ARRAY_TYPE(16);return ne[0]=_,ne[1]=E,ne[2]=S,ne[3]=w,ne[4]=I,ne[5]=M,ne[6]=L,ne[7]=k,ne[8]=B,ne[9]=V,ne[10]=N,ne[11]=G,ne[12]=H,ne[13]=J,ne[14]=oe,ne[15]=ee,ne},St.set=function(_,E,S,w,I,M,L,k,B,V,N,G,H,J,oe,ee,ne){return _[0]=E,_[1]=S,_[2]=w,_[3]=I,_[4]=M,_[5]=L,_[6]=k,_[7]=B,_[8]=V,_[9]=N,_[10]=G,_[11]=H,_[12]=J,_[13]=oe,_[14]=ee,_[15]=ne,_},St.identity=l,St.transpose=function(_,E){if(_===E){var S=E[1],w=E[2],I=E[3],M=E[6],L=E[7],k=E[11];_[1]=E[4],_[2]=E[8],_[3]=E[12],_[4]=S,_[6]=E[9],_[7]=E[13],_[8]=w,_[9]=M,_[11]=E[14],_[12]=I,_[13]=L,_[14]=k}else _[0]=E[0],_[1]=E[4],_[2]=E[8],_[3]=E[12],_[4]=E[1],_[5]=E[5],_[6]=E[9],_[7]=E[13],_[8]=E[2],_[9]=E[6],_[10]=E[10],_[11]=E[14],_[12]=E[3],_[13]=E[7],_[14]=E[11],_[15]=E[15];return _},St.invert=function(_,E){var S=E[0],w=E[1],I=E[2],M=E[3],L=E[4],k=E[5],B=E[6],V=E[7],N=E[8],G=E[9],H=E[10],J=E[11],oe=E[12],ee=E[13],ne=E[14],pe=E[15],te=S*k-w*L,de=S*B-I*L,ye=S*V-M*L,ve=w*B-I*k,Ee=w*V-M*k,Me=I*V-M*B,Re=N*ee-G*oe,De=N*ne-H*oe,Ue=N*pe-J*oe,Je=G*ne-H*ee,ze=G*pe-J*ee,ut=H*pe-J*ne,rt=te*ut-de*ze+ye*Je+ve*Ue-Ee*De+Me*Re;return rt?(_[0]=(k*ut-B*ze+V*Je)*(rt=1/rt),_[1]=(I*ze-w*ut-M*Je)*rt,_[2]=(ee*Me-ne*Ee+pe*ve)*rt,_[3]=(H*Ee-G*Me-J*ve)*rt,_[4]=(B*Ue-L*ut-V*De)*rt,_[5]=(S*ut-I*Ue+M*De)*rt,_[6]=(ne*ye-oe*Me-pe*de)*rt,_[7]=(N*Me-H*ye+J*de)*rt,_[8]=(L*ze-k*Ue+V*Re)*rt,_[9]=(w*Ue-S*ze-M*Re)*rt,_[10]=(oe*Ee-ee*ye+pe*te)*rt,_[11]=(G*ye-N*Ee-J*te)*rt,_[12]=(k*De-L*Je-B*Re)*rt,_[13]=(S*Je-w*De+I*Re)*rt,_[14]=(ee*de-oe*ve-ne*te)*rt,_[15]=(N*ve-G*de+H*te)*rt,_):null},St.adjoint=function(_,E){var S=E[0],w=E[1],I=E[2],M=E[3],L=E[4],k=E[5],B=E[6],V=E[7],N=E[8],G=E[9],H=E[10],J=E[11],oe=E[12],ee=E[13],ne=E[14],pe=E[15];return _[0]=k*(H*pe-J*ne)-G*(B*pe-V*ne)+ee*(B*J-V*H),_[1]=-(w*(H*pe-J*ne)-G*(I*pe-M*ne)+ee*(I*J-M*H)),_[2]=w*(B*pe-V*ne)-k*(I*pe-M*ne)+ee*(I*V-M*B),_[3]=-(w*(B*J-V*H)-k*(I*J-M*H)+G*(I*V-M*B)),_[4]=-(L*(H*pe-J*ne)-N*(B*pe-V*ne)+oe*(B*J-V*H)),_[5]=S*(H*pe-J*ne)-N*(I*pe-M*ne)+oe*(I*J-M*H),_[6]=-(S*(B*pe-V*ne)-L*(I*pe-M*ne)+oe*(I*V-M*B)),_[7]=S*(B*J-V*H)-L*(I*J-M*H)+N*(I*V-M*B),_[8]=L*(G*pe-J*ee)-N*(k*pe-V*ee)+oe*(k*J-V*G),_[9]=-(S*(G*pe-J*ee)-N*(w*pe-M*ee)+oe*(w*J-M*G)),_[10]=S*(k*pe-V*ee)-L*(w*pe-M*ee)+oe*(w*V-M*k),_[11]=-(S*(k*J-V*G)-L*(w*J-M*G)+N*(w*V-M*k)),_[12]=-(L*(G*ne-H*ee)-N*(k*ne-B*ee)+oe*(k*H-B*G)),_[13]=S*(G*ne-H*ee)-N*(w*ne-I*ee)+oe*(w*H-I*G),_[14]=-(S*(k*ne-B*ee)-L*(w*ne-I*ee)+oe*(w*B-I*k)),_[15]=S*(k*H-B*G)-L*(w*H-I*G)+N*(w*B-I*k),_},St.determinant=function(_){var E=_[0],S=_[1],w=_[2],I=_[3],M=_[4],L=_[5],k=_[6],B=_[7],V=_[8],N=_[9],G=_[10],H=_[11],J=_[12],oe=_[13],ee=_[14],ne=_[15];return(E*L-S*M)*(G*ne-H*ee)-(E*k-w*M)*(N*ne-H*oe)+(E*B-I*M)*(N*ee-G*oe)+(S*k-w*L)*(V*ne-H*J)-(S*B-I*L)*(V*ee-G*J)+(w*B-I*k)*(V*oe-N*J)},St.multiply=f,St.translate=function(_,E,S){var w,I,M,L,k,B,V,N,G,H,J,oe,ee=S[0],ne=S[1],pe=S[2];return E===_?(_[12]=E[0]*ee+E[4]*ne+E[8]*pe+E[12],_[13]=E[1]*ee+E[5]*ne+E[9]*pe+E[13],_[14]=E[2]*ee+E[6]*ne+E[10]*pe+E[14],_[15]=E[3]*ee+E[7]*ne+E[11]*pe+E[15]):(I=E[1],M=E[2],L=E[3],k=E[4],B=E[5],V=E[6],N=E[7],G=E[8],H=E[9],J=E[10],oe=E[11],_[0]=w=E[0],_[1]=I,_[2]=M,_[3]=L,_[4]=k,_[5]=B,_[6]=V,_[7]=N,_[8]=G,_[9]=H,_[10]=J,_[11]=oe,_[12]=w*ee+k*ne+G*pe+E[12],_[13]=I*ee+B*ne+H*pe+E[13],_[14]=M*ee+V*ne+J*pe+E[14],_[15]=L*ee+N*ne+oe*pe+E[15]),_},St.scale=function(_,E,S){var w=S[0],I=S[1],M=S[2];return _[0]=E[0]*w,_[1]=E[1]*w,_[2]=E[2]*w,_[3]=E[3]*w,_[4]=E[4]*I,_[5]=E[5]*I,_[6]=E[6]*I,_[7]=E[7]*I,_[8]=E[8]*M,_[9]=E[9]*M,_[10]=E[10]*M,_[11]=E[11]*M,_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15],_},St.rotate=function(_,E,S,w){var I,M,L,k,B,V,N,G,H,J,oe,ee,ne,pe,te,de,ye,ve,Ee,Me,Re,De,Ue,Je,ze=w[0],ut=w[1],rt=w[2],et=Math.hypot(ze,ut,rt);return et<e.EPSILON?null:(ze*=et=1/et,ut*=et,rt*=et,I=Math.sin(S),M=Math.cos(S),B=E[1],V=E[2],N=E[3],H=E[5],J=E[6],oe=E[7],ne=E[9],pe=E[10],te=E[11],de=ze*ze*(L=1-M)+M,Ee=ze*ut*L-rt*I,Me=ut*ut*L+M,Re=rt*ut*L+ze*I,De=ze*rt*L+ut*I,Ue=ut*rt*L-ze*I,Je=rt*rt*L+M,_[0]=(k=E[0])*de+(G=E[4])*(ye=ut*ze*L+rt*I)+(ee=E[8])*(ve=rt*ze*L-ut*I),_[1]=B*de+H*ye+ne*ve,_[2]=V*de+J*ye+pe*ve,_[3]=N*de+oe*ye+te*ve,_[4]=k*Ee+G*Me+ee*Re,_[5]=B*Ee+H*Me+ne*Re,_[6]=V*Ee+J*Me+pe*Re,_[7]=N*Ee+oe*Me+te*Re,_[8]=k*De+G*Ue+ee*Je,_[9]=B*De+H*Ue+ne*Je,_[10]=V*De+J*Ue+pe*Je,_[11]=N*De+oe*Ue+te*Je,E!==_&&(_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_)},St.rotateX=function(_,E,S){var w=Math.sin(S),I=Math.cos(S),M=E[4],L=E[5],k=E[6],B=E[7],V=E[8],N=E[9],G=E[10],H=E[11];return E!==_&&(_[0]=E[0],_[1]=E[1],_[2]=E[2],_[3]=E[3],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[4]=M*I+V*w,_[5]=L*I+N*w,_[6]=k*I+G*w,_[7]=B*I+H*w,_[8]=V*I-M*w,_[9]=N*I-L*w,_[10]=G*I-k*w,_[11]=H*I-B*w,_},St.rotateY=function(_,E,S){var w=Math.sin(S),I=Math.cos(S),M=E[0],L=E[1],k=E[2],B=E[3],V=E[8],N=E[9],G=E[10],H=E[11];return E!==_&&(_[4]=E[4],_[5]=E[5],_[6]=E[6],_[7]=E[7],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[0]=M*I-V*w,_[1]=L*I-N*w,_[2]=k*I-G*w,_[3]=B*I-H*w,_[8]=M*w+V*I,_[9]=L*w+N*I,_[10]=k*w+G*I,_[11]=B*w+H*I,_},St.rotateZ=function(_,E,S){var w=Math.sin(S),I=Math.cos(S),M=E[0],L=E[1],k=E[2],B=E[3],V=E[4],N=E[5],G=E[6],H=E[7];return E!==_&&(_[8]=E[8],_[9]=E[9],_[10]=E[10],_[11]=E[11],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[0]=M*I+V*w,_[1]=L*I+N*w,_[2]=k*I+G*w,_[3]=B*I+H*w,_[4]=V*I-M*w,_[5]=N*I-L*w,_[6]=G*I-k*w,_[7]=H*I-B*w,_},St.fromTranslation=function(_,E){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=E[0],_[13]=E[1],_[14]=E[2],_[15]=1,_},St.fromScaling=function(_,E){return _[0]=E[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=E[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=E[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},St.fromRotation=function(_,E,S){var w,I,M,L=S[0],k=S[1],B=S[2],V=Math.hypot(L,k,B);return V<e.EPSILON?null:(L*=V=1/V,k*=V,B*=V,w=Math.sin(E),I=Math.cos(E),_[0]=L*L*(M=1-I)+I,_[1]=k*L*M+B*w,_[2]=B*L*M-k*w,_[3]=0,_[4]=L*k*M-B*w,_[5]=k*k*M+I,_[6]=B*k*M+L*w,_[7]=0,_[8]=L*B*M+k*w,_[9]=k*B*M-L*w,_[10]=B*B*M+I,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)},St.fromXRotation=function(_,E){var S=Math.sin(E),w=Math.cos(E);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=w,_[6]=S,_[7]=0,_[8]=0,_[9]=-S,_[10]=w,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},St.fromYRotation=function(_,E){var S=Math.sin(E),w=Math.cos(E);return _[0]=w,_[1]=0,_[2]=-S,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=S,_[9]=0,_[10]=w,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},St.fromZRotation=function(_,E){var S=Math.sin(E),w=Math.cos(E);return _[0]=w,_[1]=S,_[2]=0,_[3]=0,_[4]=-S,_[5]=w,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},St.fromRotationTranslation=u,St.fromQuat2=function(_,E){var S=new e.ARRAY_TYPE(3),w=-E[0],I=-E[1],M=-E[2],L=E[3],k=E[4],B=E[5],V=E[6],N=E[7],G=w*w+I*I+M*M+L*L;return G>0?(S[0]=2*(k*L+N*w+B*M-V*I)/G,S[1]=2*(B*L+N*I+V*w-k*M)/G,S[2]=2*(V*L+N*M+k*I-B*w)/G):(S[0]=2*(k*L+N*w+B*M-V*I),S[1]=2*(B*L+N*I+V*w-k*M),S[2]=2*(V*L+N*M+k*I-B*w)),u(_,E,S),_},St.getTranslation=function(_,E){return _[0]=E[12],_[1]=E[13],_[2]=E[14],_},St.getScaling=p,St.getRotation=function(_,E){var S=new e.ARRAY_TYPE(3);p(S,E);var w=1/S[0],I=1/S[1],M=1/S[2],L=E[0]*w,k=E[1]*I,B=E[2]*M,V=E[4]*w,N=E[5]*I,G=E[6]*M,H=E[8]*w,J=E[9]*I,oe=E[10]*M,ee=L+N+oe,ne=0;return ee>0?(ne=2*Math.sqrt(ee+1),_[3]=.25*ne,_[0]=(G-J)/ne,_[1]=(H-B)/ne,_[2]=(k-V)/ne):L>N&&L>oe?(ne=2*Math.sqrt(1+L-N-oe),_[3]=(G-J)/ne,_[0]=.25*ne,_[1]=(k+V)/ne,_[2]=(H+B)/ne):N>oe?(ne=2*Math.sqrt(1+N-L-oe),_[3]=(H-B)/ne,_[0]=(k+V)/ne,_[1]=.25*ne,_[2]=(G+J)/ne):(ne=2*Math.sqrt(1+oe-L-N),_[3]=(k-V)/ne,_[0]=(H+B)/ne,_[1]=(G+J)/ne,_[2]=.25*ne),_},St.fromRotationTranslationScale=function(_,E,S,w){var I=E[0],M=E[1],L=E[2],k=E[3],B=I+I,V=M+M,N=L+L,G=I*B,H=I*V,J=I*N,oe=M*V,ee=M*N,ne=L*N,pe=k*B,te=k*V,de=k*N,ye=w[0],ve=w[1],Ee=w[2];return _[0]=(1-(oe+ne))*ye,_[1]=(H+de)*ye,_[2]=(J-te)*ye,_[3]=0,_[4]=(H-de)*ve,_[5]=(1-(G+ne))*ve,_[6]=(ee+pe)*ve,_[7]=0,_[8]=(J+te)*Ee,_[9]=(ee-pe)*Ee,_[10]=(1-(G+oe))*Ee,_[11]=0,_[12]=S[0],_[13]=S[1],_[14]=S[2],_[15]=1,_},St.fromRotationTranslationScaleOrigin=function(_,E,S,w,I){var M=E[0],L=E[1],k=E[2],B=E[3],V=M+M,N=L+L,G=k+k,H=M*V,J=M*N,oe=M*G,ee=L*N,ne=L*G,pe=k*G,te=B*V,de=B*N,ye=B*G,ve=w[0],Ee=w[1],Me=w[2],Re=I[0],De=I[1],Ue=I[2],Je=(1-(ee+pe))*ve,ze=(J+ye)*ve,ut=(oe-de)*ve,rt=(J-ye)*Ee,et=(1-(H+pe))*Ee,Xe=(ne+te)*Ee,wt=(oe+de)*Me,ct=(ne-te)*Me,ft=(1-(H+ee))*Me;return _[0]=Je,_[1]=ze,_[2]=ut,_[3]=0,_[4]=rt,_[5]=et,_[6]=Xe,_[7]=0,_[8]=wt,_[9]=ct,_[10]=ft,_[11]=0,_[12]=S[0]+Re-(Je*Re+rt*De+wt*Ue),_[13]=S[1]+De-(ze*Re+et*De+ct*Ue),_[14]=S[2]+Ue-(ut*Re+Xe*De+ft*Ue),_[15]=1,_},St.fromQuat=function(_,E){var S=E[0],w=E[1],I=E[2],M=E[3],L=S+S,k=w+w,B=I+I,V=S*L,N=w*L,G=w*k,H=I*L,J=I*k,oe=I*B,ee=M*L,ne=M*k,pe=M*B;return _[0]=1-G-oe,_[1]=N+pe,_[2]=H-ne,_[3]=0,_[4]=N-pe,_[5]=1-V-oe,_[6]=J+ee,_[7]=0,_[8]=H+ne,_[9]=J-ee,_[10]=1-V-G,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},St.frustum=function(_,E,S,w,I,M,L){var k=1/(S-E),B=1/(I-w),V=1/(M-L);return _[0]=2*M*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*M*B,_[6]=0,_[7]=0,_[8]=(S+E)*k,_[9]=(I+w)*B,_[10]=(L+M)*V,_[11]=-1,_[12]=0,_[13]=0,_[14]=L*M*2*V,_[15]=0,_},St.perspectiveNO=v,St.perspectiveZO=function(_,E,S,w,I){var M,L=1/Math.tan(E/2);return _[0]=L/S,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=L,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,I!=null&&I!==1/0?(_[10]=I*(M=1/(w-I)),_[14]=I*w*M):(_[10]=-1,_[14]=-w),_},St.perspectiveFromFieldOfView=function(_,E,S,w){var I=Math.tan(E.upDegrees*Math.PI/180),M=Math.tan(E.downDegrees*Math.PI/180),L=Math.tan(E.leftDegrees*Math.PI/180),k=Math.tan(E.rightDegrees*Math.PI/180),B=2/(L+k),V=2/(I+M);return _[0]=B,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=V,_[6]=0,_[7]=0,_[8]=-(L-k)*B*.5,_[9]=(I-M)*V*.5,_[10]=w/(S-w),_[11]=-1,_[12]=0,_[13]=0,_[14]=w*S/(S-w),_[15]=0,_},St.orthoNO=T,St.orthoZO=function(_,E,S,w,I,M,L){var k=1/(E-S),B=1/(w-I),V=1/(M-L);return _[0]=-2*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=V,_[11]=0,_[12]=(E+S)*k,_[13]=(I+w)*B,_[14]=M*V,_[15]=1,_},St.lookAt=function(_,E,S,w){var I,M,L,k,B,V,N,G,H,J,oe=E[0],ee=E[1],ne=E[2],pe=w[0],te=w[1],de=w[2],ye=S[0],ve=S[1],Ee=S[2];return Math.abs(oe-ye)<e.EPSILON&&Math.abs(ee-ve)<e.EPSILON&&Math.abs(ne-Ee)<e.EPSILON?l(_):(N=oe-ye,G=ee-ve,H=ne-Ee,I=te*(H*=J=1/Math.hypot(N,G,H))-de*(G*=J),M=de*(N*=J)-pe*H,L=pe*G-te*N,(J=Math.hypot(I,M,L))?(I*=J=1/J,M*=J,L*=J):(I=0,M=0,L=0),k=G*L-H*M,B=H*I-N*L,V=N*M-G*I,(J=Math.hypot(k,B,V))?(k*=J=1/J,B*=J,V*=J):(k=0,B=0,V=0),_[0]=I,_[1]=k,_[2]=N,_[3]=0,_[4]=M,_[5]=B,_[6]=G,_[7]=0,_[8]=L,_[9]=V,_[10]=H,_[11]=0,_[12]=-(I*oe+M*ee+L*ne),_[13]=-(k*oe+B*ee+V*ne),_[14]=-(N*oe+G*ee+H*ne),_[15]=1,_)},St.targetTo=function(_,E,S,w){var I=E[0],M=E[1],L=E[2],k=w[0],B=w[1],V=w[2],N=I-S[0],G=M-S[1],H=L-S[2],J=N*N+G*G+H*H;J>0&&(N*=J=1/Math.sqrt(J),G*=J,H*=J);var oe=B*H-V*G,ee=V*N-k*H,ne=k*G-B*N;return(J=oe*oe+ee*ee+ne*ne)>0&&(oe*=J=1/Math.sqrt(J),ee*=J,ne*=J),_[0]=oe,_[1]=ee,_[2]=ne,_[3]=0,_[4]=G*ne-H*ee,_[5]=H*oe-N*ne,_[6]=N*ee-G*oe,_[7]=0,_[8]=N,_[9]=G,_[10]=H,_[11]=0,_[12]=I,_[13]=M,_[14]=L,_[15]=1,_},St.str=function(_){return"mat4("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+", "+_[4]+", "+_[5]+", "+_[6]+", "+_[7]+", "+_[8]+", "+_[9]+", "+_[10]+", "+_[11]+", "+_[12]+", "+_[13]+", "+_[14]+", "+_[15]+")"},St.frob=function(_){return Math.hypot(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])},St.add=function(_,E,S){return _[0]=E[0]+S[0],_[1]=E[1]+S[1],_[2]=E[2]+S[2],_[3]=E[3]+S[3],_[4]=E[4]+S[4],_[5]=E[5]+S[5],_[6]=E[6]+S[6],_[7]=E[7]+S[7],_[8]=E[8]+S[8],_[9]=E[9]+S[9],_[10]=E[10]+S[10],_[11]=E[11]+S[11],_[12]=E[12]+S[12],_[13]=E[13]+S[13],_[14]=E[14]+S[14],_[15]=E[15]+S[15],_},St.subtract=D,St.multiplyScalar=function(_,E,S){return _[0]=E[0]*S,_[1]=E[1]*S,_[2]=E[2]*S,_[3]=E[3]*S,_[4]=E[4]*S,_[5]=E[5]*S,_[6]=E[6]*S,_[7]=E[7]*S,_[8]=E[8]*S,_[9]=E[9]*S,_[10]=E[10]*S,_[11]=E[11]*S,_[12]=E[12]*S,_[13]=E[13]*S,_[14]=E[14]*S,_[15]=E[15]*S,_},St.multiplyScalarAndAdd=function(_,E,S,w){return _[0]=E[0]+S[0]*w,_[1]=E[1]+S[1]*w,_[2]=E[2]+S[2]*w,_[3]=E[3]+S[3]*w,_[4]=E[4]+S[4]*w,_[5]=E[5]+S[5]*w,_[6]=E[6]+S[6]*w,_[7]=E[7]+S[7]*w,_[8]=E[8]+S[8]*w,_[9]=E[9]+S[9]*w,_[10]=E[10]+S[10]*w,_[11]=E[11]+S[11]*w,_[12]=E[12]+S[12]*w,_[13]=E[13]+S[13]*w,_[14]=E[14]+S[14]*w,_[15]=E[15]+S[15]*w,_},St.exactEquals=function(_,E){return _[0]===E[0]&&_[1]===E[1]&&_[2]===E[2]&&_[3]===E[3]&&_[4]===E[4]&&_[5]===E[5]&&_[6]===E[6]&&_[7]===E[7]&&_[8]===E[8]&&_[9]===E[9]&&_[10]===E[10]&&_[11]===E[11]&&_[12]===E[12]&&_[13]===E[13]&&_[14]===E[14]&&_[15]===E[15]},St.equals=function(_,E){var S=_[0],w=_[1],I=_[2],M=_[3],L=_[4],k=_[5],B=_[6],V=_[7],N=_[8],G=_[9],H=_[10],J=_[11],oe=_[12],ee=_[13],ne=_[14],pe=_[15],te=E[0],de=E[1],ye=E[2],ve=E[3],Ee=E[4],Me=E[5],Re=E[6],De=E[7],Ue=E[8],Je=E[9],ze=E[10],ut=E[11],rt=E[12],et=E[13],Xe=E[14],wt=E[15];return Math.abs(S-te)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(te))&&Math.abs(w-de)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(de))&&Math.abs(I-ye)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(ye))&&Math.abs(M-ve)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(ve))&&Math.abs(L-Ee)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(Ee))&&Math.abs(k-Me)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(Me))&&Math.abs(B-Re)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(Re))&&Math.abs(V-De)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(De))&&Math.abs(N-Ue)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(Ue))&&Math.abs(G-Je)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(Je))&&Math.abs(H-ze)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(ze))&&Math.abs(J-ut)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(ut))&&Math.abs(oe-rt)<=e.EPSILON*Math.max(1,Math.abs(oe),Math.abs(rt))&&Math.abs(ee-et)<=e.EPSILON*Math.max(1,Math.abs(ee),Math.abs(et))&&Math.abs(ne-Xe)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Xe))&&Math.abs(pe-wt)<=e.EPSILON*Math.max(1,Math.abs(pe),Math.abs(wt))},St.sub=St.mul=St.ortho=St.perspective=void 0;var e=function(_,E){if(_&&_.__esModule)return _;if(_===null||s(_)!=="object"&&typeof _!="function")return{default:_};var S=r(void 0);if(S&&S.has(_))return S.get(_);var w={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var M in _)if(M!=="default"&&Object.prototype.hasOwnProperty.call(_,M)){var L=I?Object.getOwnPropertyDescriptor(_,M):null;L&&(L.get||L.set)?Object.defineProperty(w,M,L):w[M]=_[M]}return w.default=_,S&&S.set(_,w),w}(Te());function r(_){if(typeof WeakMap!="function")return null;var E=new WeakMap,S=new WeakMap;return(r=function(w){return w?S:E})(_)}function l(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function f(_,E,S){var w=E[0],I=E[1],M=E[2],L=E[3],k=E[4],B=E[5],V=E[6],N=E[7],G=E[8],H=E[9],J=E[10],oe=E[11],ee=E[12],ne=E[13],pe=E[14],te=E[15],de=S[0],ye=S[1],ve=S[2],Ee=S[3];return _[0]=de*w+ye*k+ve*G+Ee*ee,_[1]=de*I+ye*B+ve*H+Ee*ne,_[2]=de*M+ye*V+ve*J+Ee*pe,_[3]=de*L+ye*N+ve*oe+Ee*te,_[4]=(de=S[4])*w+(ye=S[5])*k+(ve=S[6])*G+(Ee=S[7])*ee,_[5]=de*I+ye*B+ve*H+Ee*ne,_[6]=de*M+ye*V+ve*J+Ee*pe,_[7]=de*L+ye*N+ve*oe+Ee*te,_[8]=(de=S[8])*w+(ye=S[9])*k+(ve=S[10])*G+(Ee=S[11])*ee,_[9]=de*I+ye*B+ve*H+Ee*ne,_[10]=de*M+ye*V+ve*J+Ee*pe,_[11]=de*L+ye*N+ve*oe+Ee*te,_[12]=(de=S[12])*w+(ye=S[13])*k+(ve=S[14])*G+(Ee=S[15])*ee,_[13]=de*I+ye*B+ve*H+Ee*ne,_[14]=de*M+ye*V+ve*J+Ee*pe,_[15]=de*L+ye*N+ve*oe+Ee*te,_}function u(_,E,S){var w=E[0],I=E[1],M=E[2],L=E[3],k=w+w,B=I+I,V=M+M,N=w*k,G=w*B,H=w*V,J=I*B,oe=I*V,ee=M*V,ne=L*k,pe=L*B,te=L*V;return _[0]=1-(J+ee),_[1]=G+te,_[2]=H-pe,_[3]=0,_[4]=G-te,_[5]=1-(N+ee),_[6]=oe+ne,_[7]=0,_[8]=H+pe,_[9]=oe-ne,_[10]=1-(N+J),_[11]=0,_[12]=S[0],_[13]=S[1],_[14]=S[2],_[15]=1,_}function p(_,E){var S=E[4],w=E[5],I=E[6],M=E[8],L=E[9],k=E[10];return _[0]=Math.hypot(E[0],E[1],E[2]),_[1]=Math.hypot(S,w,I),_[2]=Math.hypot(M,L,k),_}function v(_,E,S,w,I){var M,L=1/Math.tan(E/2);return _[0]=L/S,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=L,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,I!=null&&I!==1/0?(_[10]=(I+w)*(M=1/(w-I)),_[14]=2*I*w*M):(_[10]=-1,_[14]=-2*w),_}function T(_,E,S,w,I,M,L){var k=1/(E-S),B=1/(w-I),V=1/(M-L);return _[0]=-2*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*V,_[11]=0,_[12]=(E+S)*k,_[13]=(I+w)*B,_[14]=(L+M)*V,_[15]=1,_}function D(_,E,S){return _[0]=E[0]-S[0],_[1]=E[1]-S[1],_[2]=E[2]-S[2],_[3]=E[3]-S[3],_[4]=E[4]-S[4],_[5]=E[5]-S[5],_[6]=E[6]-S[6],_[7]=E[7]-S[7],_[8]=E[8]-S[8],_[9]=E[9]-S[9],_[10]=E[10]-S[10],_[11]=E[11]-S[11],_[12]=E[12]-S[12],_[13]=E[13]-S[13],_[14]=E[14]-S[14],_[15]=E[15]-S[15],_}return St.perspective=v,St.ortho=T,St.mul=f,St.sub=D,St}var xr,Ct={},Rt={};function zs(){if(xr)return Rt;function s(I){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},s(I)}xr=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=l,Rt.clone=function(I){var M=new e.ARRAY_TYPE(3);return M[0]=I[0],M[1]=I[1],M[2]=I[2],M},Rt.length=f,Rt.fromValues=function(I,M,L){var k=new e.ARRAY_TYPE(3);return k[0]=I,k[1]=M,k[2]=L,k},Rt.copy=function(I,M){return I[0]=M[0],I[1]=M[1],I[2]=M[2],I},Rt.set=function(I,M,L,k){return I[0]=M,I[1]=L,I[2]=k,I},Rt.add=function(I,M,L){return I[0]=M[0]+L[0],I[1]=M[1]+L[1],I[2]=M[2]+L[2],I},Rt.subtract=u,Rt.multiply=p,Rt.divide=v,Rt.ceil=function(I,M){return I[0]=Math.ceil(M[0]),I[1]=Math.ceil(M[1]),I[2]=Math.ceil(M[2]),I},Rt.floor=function(I,M){return I[0]=Math.floor(M[0]),I[1]=Math.floor(M[1]),I[2]=Math.floor(M[2]),I},Rt.min=function(I,M,L){return I[0]=Math.min(M[0],L[0]),I[1]=Math.min(M[1],L[1]),I[2]=Math.min(M[2],L[2]),I},Rt.max=function(I,M,L){return I[0]=Math.max(M[0],L[0]),I[1]=Math.max(M[1],L[1]),I[2]=Math.max(M[2],L[2]),I},Rt.round=function(I,M){return I[0]=Math.round(M[0]),I[1]=Math.round(M[1]),I[2]=Math.round(M[2]),I},Rt.scale=function(I,M,L){return I[0]=M[0]*L,I[1]=M[1]*L,I[2]=M[2]*L,I},Rt.scaleAndAdd=function(I,M,L,k){return I[0]=M[0]+L[0]*k,I[1]=M[1]+L[1]*k,I[2]=M[2]+L[2]*k,I},Rt.distance=T,Rt.squaredDistance=D,Rt.squaredLength=_,Rt.negate=function(I,M){return I[0]=-M[0],I[1]=-M[1],I[2]=-M[2],I},Rt.inverse=function(I,M){return I[0]=1/M[0],I[1]=1/M[1],I[2]=1/M[2],I},Rt.normalize=function(I,M){var L=M[0],k=M[1],B=M[2],V=L*L+k*k+B*B;return V>0&&(V=1/Math.sqrt(V)),I[0]=M[0]*V,I[1]=M[1]*V,I[2]=M[2]*V,I},Rt.dot=E,Rt.cross=function(I,M,L){var k=M[0],B=M[1],V=M[2],N=L[0],G=L[1],H=L[2];return I[0]=B*H-V*G,I[1]=V*N-k*H,I[2]=k*G-B*N,I},Rt.lerp=function(I,M,L,k){var B=M[0],V=M[1],N=M[2];return I[0]=B+k*(L[0]-B),I[1]=V+k*(L[1]-V),I[2]=N+k*(L[2]-N),I},Rt.hermite=function(I,M,L,k,B,V){var N=V*V,G=N*(2*V-3)+1,H=N*(V-2)+V,J=N*(V-1),oe=N*(3-2*V);return I[0]=M[0]*G+L[0]*H+k[0]*J+B[0]*oe,I[1]=M[1]*G+L[1]*H+k[1]*J+B[1]*oe,I[2]=M[2]*G+L[2]*H+k[2]*J+B[2]*oe,I},Rt.bezier=function(I,M,L,k,B,V){var N=1-V,G=N*N,H=V*V,J=G*N,oe=3*V*G,ee=3*H*N,ne=H*V;return I[0]=M[0]*J+L[0]*oe+k[0]*ee+B[0]*ne,I[1]=M[1]*J+L[1]*oe+k[1]*ee+B[1]*ne,I[2]=M[2]*J+L[2]*oe+k[2]*ee+B[2]*ne,I},Rt.random=function(I,M){M=M||1;var L=2*e.RANDOM()*Math.PI,k=2*e.RANDOM()-1,B=Math.sqrt(1-k*k)*M;return I[0]=Math.cos(L)*B,I[1]=Math.sin(L)*B,I[2]=k*M,I},Rt.transformMat4=function(I,M,L){var k=M[0],B=M[1],V=M[2],N=L[3]*k+L[7]*B+L[11]*V+L[15];return I[0]=(L[0]*k+L[4]*B+L[8]*V+L[12])/(N=N||1),I[1]=(L[1]*k+L[5]*B+L[9]*V+L[13])/N,I[2]=(L[2]*k+L[6]*B+L[10]*V+L[14])/N,I},Rt.transformMat3=function(I,M,L){var k=M[0],B=M[1],V=M[2];return I[0]=k*L[0]+B*L[3]+V*L[6],I[1]=k*L[1]+B*L[4]+V*L[7],I[2]=k*L[2]+B*L[5]+V*L[8],I},Rt.transformQuat=function(I,M,L){var k=L[0],B=L[1],V=L[2],N=M[0],G=M[1],H=M[2],J=B*H-V*G,oe=V*N-k*H,ee=k*G-B*N,ne=B*ee-V*oe,pe=V*J-k*ee,te=k*oe-B*J,de=2*L[3];return oe*=de,ee*=de,pe*=2,te*=2,I[0]=N+(J*=de)+(ne*=2),I[1]=G+oe+pe,I[2]=H+ee+te,I},Rt.rotateX=function(I,M,L,k){var B=[],V=[];return B[0]=M[0]-L[0],B[1]=M[1]-L[1],B[2]=M[2]-L[2],V[0]=B[0],V[1]=B[1]*Math.cos(k)-B[2]*Math.sin(k),V[2]=B[1]*Math.sin(k)+B[2]*Math.cos(k),I[0]=V[0]+L[0],I[1]=V[1]+L[1],I[2]=V[2]+L[2],I},Rt.rotateY=function(I,M,L,k){var B=[],V=[];return B[0]=M[0]-L[0],B[1]=M[1]-L[1],B[2]=M[2]-L[2],V[0]=B[2]*Math.sin(k)+B[0]*Math.cos(k),V[1]=B[1],V[2]=B[2]*Math.cos(k)-B[0]*Math.sin(k),I[0]=V[0]+L[0],I[1]=V[1]+L[1],I[2]=V[2]+L[2],I},Rt.rotateZ=function(I,M,L,k){var B=[],V=[];return B[0]=M[0]-L[0],B[1]=M[1]-L[1],B[2]=M[2]-L[2],V[0]=B[0]*Math.cos(k)-B[1]*Math.sin(k),V[1]=B[0]*Math.sin(k)+B[1]*Math.cos(k),V[2]=B[2],I[0]=V[0]+L[0],I[1]=V[1]+L[1],I[2]=V[2]+L[2],I},Rt.angle=function(I,M){var L=I[0],k=I[1],B=I[2],V=M[0],N=M[1],G=M[2],H=Math.sqrt(L*L+k*k+B*B)*Math.sqrt(V*V+N*N+G*G),J=H&&E(I,M)/H;return Math.acos(Math.min(Math.max(J,-1),1))},Rt.zero=function(I){return I[0]=0,I[1]=0,I[2]=0,I},Rt.str=function(I){return"vec3("+I[0]+", "+I[1]+", "+I[2]+")"},Rt.exactEquals=function(I,M){return I[0]===M[0]&&I[1]===M[1]&&I[2]===M[2]},Rt.equals=function(I,M){var L=I[0],k=I[1],B=I[2],V=M[0],N=M[1],G=M[2];return Math.abs(L-V)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(V))&&Math.abs(k-N)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(N))&&Math.abs(B-G)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(G))},Rt.forEach=Rt.sqrLen=Rt.len=Rt.sqrDist=Rt.dist=Rt.div=Rt.mul=Rt.sub=void 0;var e=function(I,M){if(I&&I.__esModule)return I;if(I===null||s(I)!=="object"&&typeof I!="function")return{default:I};var L=r(void 0);if(L&&L.has(I))return L.get(I);var k={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in I)if(V!=="default"&&Object.prototype.hasOwnProperty.call(I,V)){var N=B?Object.getOwnPropertyDescriptor(I,V):null;N&&(N.get||N.set)?Object.defineProperty(k,V,N):k[V]=I[V]}return k.default=I,L&&L.set(I,k),k}(Te());function r(I){if(typeof WeakMap!="function")return null;var M=new WeakMap,L=new WeakMap;return(r=function(k){return k?L:M})(I)}function l(){var I=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0),I}function f(I){return Math.hypot(I[0],I[1],I[2])}function u(I,M,L){return I[0]=M[0]-L[0],I[1]=M[1]-L[1],I[2]=M[2]-L[2],I}function p(I,M,L){return I[0]=M[0]*L[0],I[1]=M[1]*L[1],I[2]=M[2]*L[2],I}function v(I,M,L){return I[0]=M[0]/L[0],I[1]=M[1]/L[1],I[2]=M[2]/L[2],I}function T(I,M){return Math.hypot(M[0]-I[0],M[1]-I[1],M[2]-I[2])}function D(I,M){var L=M[0]-I[0],k=M[1]-I[1],B=M[2]-I[2];return L*L+k*k+B*B}function _(I){var M=I[0],L=I[1],k=I[2];return M*M+L*L+k*k}function E(I,M){return I[0]*M[0]+I[1]*M[1]+I[2]*M[2]}Rt.sub=u,Rt.mul=p,Rt.div=v,Rt.dist=T,Rt.sqrDist=D,Rt.len=f,Rt.sqrLen=_;var S,w=(S=l(),function(I,M,L,k,B,V){var N,G;for(M||(M=3),L||(L=0),G=k?Math.min(k*M+L,I.length):I.length,N=L;N<G;N+=M)S[0]=I[N],S[1]=I[N+1],S[2]=I[N+2],B(S,S,V),I[N]=S[0],I[N+1]=S[1],I[N+2]=S[2];return I});return Rt.forEach=w,Rt}var fs,ou,Zt={};function ti(){if(fs)return Zt;function s(w){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},s(w)}fs=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=l,Zt.clone=function(w){var I=new e.ARRAY_TYPE(4);return I[0]=w[0],I[1]=w[1],I[2]=w[2],I[3]=w[3],I},Zt.fromValues=function(w,I,M,L){var k=new e.ARRAY_TYPE(4);return k[0]=w,k[1]=I,k[2]=M,k[3]=L,k},Zt.copy=function(w,I){return w[0]=I[0],w[1]=I[1],w[2]=I[2],w[3]=I[3],w},Zt.set=function(w,I,M,L,k){return w[0]=I,w[1]=M,w[2]=L,w[3]=k,w},Zt.add=function(w,I,M){return w[0]=I[0]+M[0],w[1]=I[1]+M[1],w[2]=I[2]+M[2],w[3]=I[3]+M[3],w},Zt.subtract=f,Zt.multiply=u,Zt.divide=p,Zt.ceil=function(w,I){return w[0]=Math.ceil(I[0]),w[1]=Math.ceil(I[1]),w[2]=Math.ceil(I[2]),w[3]=Math.ceil(I[3]),w},Zt.floor=function(w,I){return w[0]=Math.floor(I[0]),w[1]=Math.floor(I[1]),w[2]=Math.floor(I[2]),w[3]=Math.floor(I[3]),w},Zt.min=function(w,I,M){return w[0]=Math.min(I[0],M[0]),w[1]=Math.min(I[1],M[1]),w[2]=Math.min(I[2],M[2]),w[3]=Math.min(I[3],M[3]),w},Zt.max=function(w,I,M){return w[0]=Math.max(I[0],M[0]),w[1]=Math.max(I[1],M[1]),w[2]=Math.max(I[2],M[2]),w[3]=Math.max(I[3],M[3]),w},Zt.round=function(w,I){return w[0]=Math.round(I[0]),w[1]=Math.round(I[1]),w[2]=Math.round(I[2]),w[3]=Math.round(I[3]),w},Zt.scale=function(w,I,M){return w[0]=I[0]*M,w[1]=I[1]*M,w[2]=I[2]*M,w[3]=I[3]*M,w},Zt.scaleAndAdd=function(w,I,M,L){return w[0]=I[0]+M[0]*L,w[1]=I[1]+M[1]*L,w[2]=I[2]+M[2]*L,w[3]=I[3]+M[3]*L,w},Zt.distance=v,Zt.squaredDistance=T,Zt.length=D,Zt.squaredLength=_,Zt.negate=function(w,I){return w[0]=-I[0],w[1]=-I[1],w[2]=-I[2],w[3]=-I[3],w},Zt.inverse=function(w,I){return w[0]=1/I[0],w[1]=1/I[1],w[2]=1/I[2],w[3]=1/I[3],w},Zt.normalize=function(w,I){var M=I[0],L=I[1],k=I[2],B=I[3],V=M*M+L*L+k*k+B*B;return V>0&&(V=1/Math.sqrt(V)),w[0]=M*V,w[1]=L*V,w[2]=k*V,w[3]=B*V,w},Zt.dot=function(w,I){return w[0]*I[0]+w[1]*I[1]+w[2]*I[2]+w[3]*I[3]},Zt.cross=function(w,I,M,L){var k=M[0]*L[1]-M[1]*L[0],B=M[0]*L[2]-M[2]*L[0],V=M[0]*L[3]-M[3]*L[0],N=M[1]*L[2]-M[2]*L[1],G=M[1]*L[3]-M[3]*L[1],H=M[2]*L[3]-M[3]*L[2],J=I[0],oe=I[1],ee=I[2],ne=I[3];return w[0]=oe*H-ee*G+ne*N,w[1]=-J*H+ee*V-ne*B,w[2]=J*G-oe*V+ne*k,w[3]=-J*N+oe*B-ee*k,w},Zt.lerp=function(w,I,M,L){var k=I[0],B=I[1],V=I[2],N=I[3];return w[0]=k+L*(M[0]-k),w[1]=B+L*(M[1]-B),w[2]=V+L*(M[2]-V),w[3]=N+L*(M[3]-N),w},Zt.random=function(w,I){var M,L,k,B,V,N;I=I||1;do V=(M=2*e.RANDOM()-1)*M+(L=2*e.RANDOM()-1)*L;while(V>=1);do N=(k=2*e.RANDOM()-1)*k+(B=2*e.RANDOM()-1)*B;while(N>=1);var G=Math.sqrt((1-V)/N);return w[0]=I*M,w[1]=I*L,w[2]=I*k*G,w[3]=I*B*G,w},Zt.transformMat4=function(w,I,M){var L=I[0],k=I[1],B=I[2],V=I[3];return w[0]=M[0]*L+M[4]*k+M[8]*B+M[12]*V,w[1]=M[1]*L+M[5]*k+M[9]*B+M[13]*V,w[2]=M[2]*L+M[6]*k+M[10]*B+M[14]*V,w[3]=M[3]*L+M[7]*k+M[11]*B+M[15]*V,w},Zt.transformQuat=function(w,I,M){var L=I[0],k=I[1],B=I[2],V=M[0],N=M[1],G=M[2],H=M[3],J=H*L+N*B-G*k,oe=H*k+G*L-V*B,ee=H*B+V*k-N*L,ne=-V*L-N*k-G*B;return w[0]=J*H+ne*-V+oe*-G-ee*-N,w[1]=oe*H+ne*-N+ee*-V-J*-G,w[2]=ee*H+ne*-G+J*-N-oe*-V,w[3]=I[3],w},Zt.zero=function(w){return w[0]=0,w[1]=0,w[2]=0,w[3]=0,w},Zt.str=function(w){return"vec4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+")"},Zt.exactEquals=function(w,I){return w[0]===I[0]&&w[1]===I[1]&&w[2]===I[2]&&w[3]===I[3]},Zt.equals=function(w,I){var M=w[0],L=w[1],k=w[2],B=w[3],V=I[0],N=I[1],G=I[2],H=I[3];return Math.abs(M-V)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(V))&&Math.abs(L-N)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(N))&&Math.abs(k-G)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(G))&&Math.abs(B-H)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(H))},Zt.forEach=Zt.sqrLen=Zt.len=Zt.sqrDist=Zt.dist=Zt.div=Zt.mul=Zt.sub=void 0;var e=function(w,I){if(w&&w.__esModule)return w;if(w===null||s(w)!=="object"&&typeof w!="function")return{default:w};var M=r(void 0);if(M&&M.has(w))return M.get(w);var L={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in w)if(B!=="default"&&Object.prototype.hasOwnProperty.call(w,B)){var V=k?Object.getOwnPropertyDescriptor(w,B):null;V&&(V.get||V.set)?Object.defineProperty(L,B,V):L[B]=w[B]}return L.default=w,M&&M.set(w,L),L}(Te());function r(w){if(typeof WeakMap!="function")return null;var I=new WeakMap,M=new WeakMap;return(r=function(L){return L?M:I})(w)}function l(){var w=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0,w[3]=0),w}function f(w,I,M){return w[0]=I[0]-M[0],w[1]=I[1]-M[1],w[2]=I[2]-M[2],w[3]=I[3]-M[3],w}function u(w,I,M){return w[0]=I[0]*M[0],w[1]=I[1]*M[1],w[2]=I[2]*M[2],w[3]=I[3]*M[3],w}function p(w,I,M){return w[0]=I[0]/M[0],w[1]=I[1]/M[1],w[2]=I[2]/M[2],w[3]=I[3]/M[3],w}function v(w,I){return Math.hypot(I[0]-w[0],I[1]-w[1],I[2]-w[2],I[3]-w[3])}function T(w,I){var M=I[0]-w[0],L=I[1]-w[1],k=I[2]-w[2],B=I[3]-w[3];return M*M+L*L+k*k+B*B}function D(w){return Math.hypot(w[0],w[1],w[2],w[3])}function _(w){var I=w[0],M=w[1],L=w[2],k=w[3];return I*I+M*M+L*L+k*k}Zt.sub=f,Zt.mul=u,Zt.div=p,Zt.dist=v,Zt.sqrDist=T,Zt.len=D,Zt.sqrLen=_;var E,S=(E=l(),function(w,I,M,L,k,B){var V,N;for(I||(I=4),M||(M=0),N=L?Math.min(L*I+M,w.length):w.length,V=M;V<N;V+=I)E[0]=w[V],E[1]=w[V+1],E[2]=w[V+2],E[3]=w[V+3],k(E,E,B),w[V]=E[0],w[V+1]=E[1],w[V+2]=E[2],w[V+3]=E[3];return w});return Zt.forEach=S,Zt}function ko(){if(ou)return Ct;function s(te){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(de){return typeof de}:function(de){return de&&typeof Symbol=="function"&&de.constructor===Symbol&&de!==Symbol.prototype?"symbol":typeof de},s(te)}ou=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.create=v,Ct.identity=function(te){return te[0]=0,te[1]=0,te[2]=0,te[3]=1,te},Ct.setAxisAngle=T,Ct.getAxisAngle=function(te,de){var ye=2*Math.acos(de[3]),ve=Math.sin(ye/2);return ve>e.EPSILON?(te[0]=de[0]/ve,te[1]=de[1]/ve,te[2]=de[2]/ve):(te[0]=1,te[1]=0,te[2]=0),ye},Ct.getAngle=function(te,de){var ye=M(te,de);return Math.acos(2*ye*ye-1)},Ct.multiply=D,Ct.rotateX=function(te,de,ye){ye*=.5;var ve=de[0],Ee=de[1],Me=de[2],Re=de[3],De=Math.sin(ye),Ue=Math.cos(ye);return te[0]=ve*Ue+Re*De,te[1]=Ee*Ue+Me*De,te[2]=Me*Ue-Ee*De,te[3]=Re*Ue-ve*De,te},Ct.rotateY=function(te,de,ye){ye*=.5;var ve=de[0],Ee=de[1],Me=de[2],Re=de[3],De=Math.sin(ye),Ue=Math.cos(ye);return te[0]=ve*Ue-Me*De,te[1]=Ee*Ue+Re*De,te[2]=Me*Ue+ve*De,te[3]=Re*Ue-Ee*De,te},Ct.rotateZ=function(te,de,ye){ye*=.5;var ve=de[0],Ee=de[1],Me=de[2],Re=de[3],De=Math.sin(ye),Ue=Math.cos(ye);return te[0]=ve*Ue+Ee*De,te[1]=Ee*Ue-ve*De,te[2]=Me*Ue+Re*De,te[3]=Re*Ue-Me*De,te},Ct.calculateW=function(te,de){var ye=de[0],ve=de[1],Ee=de[2];return te[0]=ye,te[1]=ve,te[2]=Ee,te[3]=Math.sqrt(Math.abs(1-ye*ye-ve*ve-Ee*Ee)),te},Ct.exp=_,Ct.ln=E,Ct.pow=function(te,de,ye){return E(te,de),I(te,te,ye),_(te,te),te},Ct.slerp=S,Ct.random=function(te){var de=e.RANDOM(),ye=e.RANDOM(),ve=e.RANDOM(),Ee=Math.sqrt(1-de),Me=Math.sqrt(de);return te[0]=Ee*Math.sin(2*Math.PI*ye),te[1]=Ee*Math.cos(2*Math.PI*ye),te[2]=Me*Math.sin(2*Math.PI*ve),te[3]=Me*Math.cos(2*Math.PI*ve),te},Ct.invert=function(te,de){var ye=de[0],ve=de[1],Ee=de[2],Me=de[3],Re=ye*ye+ve*ve+Ee*Ee+Me*Me,De=Re?1/Re:0;return te[0]=-ye*De,te[1]=-ve*De,te[2]=-Ee*De,te[3]=Me*De,te},Ct.conjugate=function(te,de){return te[0]=-de[0],te[1]=-de[1],te[2]=-de[2],te[3]=de[3],te},Ct.fromMat3=w,Ct.fromEuler=function(te,de,ye,ve){var Ee=.5*Math.PI/180;de*=Ee,ye*=Ee,ve*=Ee;var Me=Math.sin(de),Re=Math.cos(de),De=Math.sin(ye),Ue=Math.cos(ye),Je=Math.sin(ve),ze=Math.cos(ve);return te[0]=Me*Ue*ze-Re*De*Je,te[1]=Re*De*ze+Me*Ue*Je,te[2]=Re*Ue*Je-Me*De*ze,te[3]=Re*Ue*ze+Me*De*Je,te},Ct.str=function(te){return"quat("+te[0]+", "+te[1]+", "+te[2]+", "+te[3]+")"},Ct.setAxes=Ct.sqlerp=Ct.rotationTo=Ct.equals=Ct.exactEquals=Ct.normalize=Ct.sqrLen=Ct.squaredLength=Ct.len=Ct.length=Ct.lerp=Ct.dot=Ct.scale=Ct.mul=Ct.add=Ct.set=Ct.copy=Ct.fromValues=Ct.clone=void 0;var e=p(Te()),r=p(mr()),l=p(zs()),f=p(ti());function u(te){if(typeof WeakMap!="function")return null;var de=new WeakMap,ye=new WeakMap;return(u=function(ve){return ve?ye:de})(te)}function p(te,de){if(te&&te.__esModule)return te;if(te===null||s(te)!=="object"&&typeof te!="function")return{default:te};var ye=u(de);if(ye&&ye.has(te))return ye.get(te);var ve={},Ee=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Me in te)if(Me!=="default"&&Object.prototype.hasOwnProperty.call(te,Me)){var Re=Ee?Object.getOwnPropertyDescriptor(te,Me):null;Re&&(Re.get||Re.set)?Object.defineProperty(ve,Me,Re):ve[Me]=te[Me]}return ve.default=te,ye&&ye.set(te,ve),ve}function v(){var te=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(te[0]=0,te[1]=0,te[2]=0),te[3]=1,te}function T(te,de,ye){ye*=.5;var ve=Math.sin(ye);return te[0]=ve*de[0],te[1]=ve*de[1],te[2]=ve*de[2],te[3]=Math.cos(ye),te}function D(te,de,ye){var ve=de[0],Ee=de[1],Me=de[2],Re=de[3],De=ye[0],Ue=ye[1],Je=ye[2],ze=ye[3];return te[0]=ve*ze+Re*De+Ee*Je-Me*Ue,te[1]=Ee*ze+Re*Ue+Me*De-ve*Je,te[2]=Me*ze+Re*Je+ve*Ue-Ee*De,te[3]=Re*ze-ve*De-Ee*Ue-Me*Je,te}function _(te,de){var ye=de[0],ve=de[1],Ee=de[2],Me=de[3],Re=Math.sqrt(ye*ye+ve*ve+Ee*Ee),De=Math.exp(Me),Ue=Re>0?De*Math.sin(Re)/Re:0;return te[0]=ye*Ue,te[1]=ve*Ue,te[2]=Ee*Ue,te[3]=De*Math.cos(Re),te}function E(te,de){var ye=de[0],ve=de[1],Ee=de[2],Me=de[3],Re=Math.sqrt(ye*ye+ve*ve+Ee*Ee),De=Re>0?Math.atan2(Re,Me)/Re:0;return te[0]=ye*De,te[1]=ve*De,te[2]=Ee*De,te[3]=.5*Math.log(ye*ye+ve*ve+Ee*Ee+Me*Me),te}function S(te,de,ye,ve){var Ee,Me,Re,De,Ue,Je=de[0],ze=de[1],ut=de[2],rt=de[3],et=ye[0],Xe=ye[1],wt=ye[2],ct=ye[3];return(Me=Je*et+ze*Xe+ut*wt+rt*ct)<0&&(Me=-Me,et=-et,Xe=-Xe,wt=-wt,ct=-ct),1-Me>e.EPSILON?(Ee=Math.acos(Me),Re=Math.sin(Ee),De=Math.sin((1-ve)*Ee)/Re,Ue=Math.sin(ve*Ee)/Re):(De=1-ve,Ue=ve),te[0]=De*Je+Ue*et,te[1]=De*ze+Ue*Xe,te[2]=De*ut+Ue*wt,te[3]=De*rt+Ue*ct,te}function w(te,de){var ye,ve=de[0]+de[4]+de[8];if(ve>0)ye=Math.sqrt(ve+1),te[3]=.5*ye,te[0]=(de[5]-de[7])*(ye=.5/ye),te[1]=(de[6]-de[2])*ye,te[2]=(de[1]-de[3])*ye;else{var Ee=0;de[4]>de[0]&&(Ee=1),de[8]>de[3*Ee+Ee]&&(Ee=2);var Me=(Ee+1)%3,Re=(Ee+2)%3;ye=Math.sqrt(de[3*Ee+Ee]-de[3*Me+Me]-de[3*Re+Re]+1),te[Ee]=.5*ye,te[3]=(de[3*Me+Re]-de[3*Re+Me])*(ye=.5/ye),te[Me]=(de[3*Me+Ee]+de[3*Ee+Me])*ye,te[Re]=(de[3*Re+Ee]+de[3*Ee+Re])*ye}return te}Ct.clone=f.clone,Ct.fromValues=f.fromValues,Ct.copy=f.copy,Ct.set=f.set,Ct.add=f.add,Ct.mul=D;var I=f.scale;Ct.scale=I;var M=f.dot;Ct.dot=M,Ct.lerp=f.lerp;var L=f.length;Ct.length=L,Ct.len=L;var k=f.squaredLength;Ct.squaredLength=k,Ct.sqrLen=k;var B=f.normalize;Ct.normalize=B,Ct.exactEquals=f.exactEquals,Ct.equals=f.equals;var V,N,G,H=(V=l.create(),N=l.fromValues(1,0,0),G=l.fromValues(0,1,0),function(te,de,ye){var ve=l.dot(de,ye);return ve<-.999999?(l.cross(V,N,de),l.len(V)<1e-6&&l.cross(V,G,de),l.normalize(V,V),T(te,V,Math.PI),te):ve>.999999?(te[0]=0,te[1]=0,te[2]=0,te[3]=1,te):(l.cross(V,de,ye),te[0]=V[0],te[1]=V[1],te[2]=V[2],te[3]=1+ve,B(te,te))});Ct.rotationTo=H;var J,oe,ee=(J=v(),oe=v(),function(te,de,ye,ve,Ee,Me){return S(J,de,Ee,Me),S(oe,ye,ve,Me),S(te,J,oe,2*Me*(1-Me)),te});Ct.sqlerp=ee;var ne,pe=(ne=r.create(),function(te,de,ye,ve){return ne[0]=ye[0],ne[3]=ye[1],ne[6]=ye[2],ne[1]=ve[0],ne[4]=ve[1],ne[7]=ve[2],ne[2]=-de[0],ne[5]=-de[1],ne[8]=-de[2],B(te,w(te,ne))});return Ct.setAxes=pe,Ct}var ya,qt={};function Bs(){if(ya)return qt;function s(S){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},s(S)}ya=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.create=function(){var S=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(S[0]=0,S[1]=0,S[2]=0,S[4]=0,S[5]=0,S[6]=0,S[7]=0),S[3]=1,S},qt.clone=function(S){var w=new e.ARRAY_TYPE(8);return w[0]=S[0],w[1]=S[1],w[2]=S[2],w[3]=S[3],w[4]=S[4],w[5]=S[5],w[6]=S[6],w[7]=S[7],w},qt.fromValues=function(S,w,I,M,L,k,B,V){var N=new e.ARRAY_TYPE(8);return N[0]=S,N[1]=w,N[2]=I,N[3]=M,N[4]=L,N[5]=k,N[6]=B,N[7]=V,N},qt.fromRotationTranslationValues=function(S,w,I,M,L,k,B){var V=new e.ARRAY_TYPE(8);V[0]=S,V[1]=w,V[2]=I,V[3]=M;var N=.5*L,G=.5*k,H=.5*B;return V[4]=N*M+G*I-H*w,V[5]=G*M+H*S-N*I,V[6]=H*M+N*w-G*S,V[7]=-N*S-G*w-H*I,V},qt.fromRotationTranslation=p,qt.fromTranslation=function(S,w){return S[0]=0,S[1]=0,S[2]=0,S[3]=1,S[4]=.5*w[0],S[5]=.5*w[1],S[6]=.5*w[2],S[7]=0,S},qt.fromRotation=function(S,w){return S[0]=w[0],S[1]=w[1],S[2]=w[2],S[3]=w[3],S[4]=0,S[5]=0,S[6]=0,S[7]=0,S},qt.fromMat4=function(S,w){var I=r.create();l.getRotation(I,w);var M=new e.ARRAY_TYPE(3);return l.getTranslation(M,w),p(S,I,M),S},qt.copy=v,qt.identity=function(S){return S[0]=0,S[1]=0,S[2]=0,S[3]=1,S[4]=0,S[5]=0,S[6]=0,S[7]=0,S},qt.set=function(S,w,I,M,L,k,B,V,N){return S[0]=w,S[1]=I,S[2]=M,S[3]=L,S[4]=k,S[5]=B,S[6]=V,S[7]=N,S},qt.getDual=function(S,w){return S[0]=w[4],S[1]=w[5],S[2]=w[6],S[3]=w[7],S},qt.setDual=function(S,w){return S[4]=w[0],S[5]=w[1],S[6]=w[2],S[7]=w[3],S},qt.getTranslation=function(S,w){var I=w[4],M=w[5],L=w[6],k=w[7],B=-w[0],V=-w[1],N=-w[2],G=w[3];return S[0]=2*(I*G+k*B+M*N-L*V),S[1]=2*(M*G+k*V+L*B-I*N),S[2]=2*(L*G+k*N+I*V-M*B),S},qt.translate=function(S,w,I){var M=w[0],L=w[1],k=w[2],B=w[3],V=.5*I[0],N=.5*I[1],G=.5*I[2],H=w[4],J=w[5],oe=w[6],ee=w[7];return S[0]=M,S[1]=L,S[2]=k,S[3]=B,S[4]=B*V+L*G-k*N+H,S[5]=B*N+k*V-M*G+J,S[6]=B*G+M*N-L*V+oe,S[7]=-M*V-L*N-k*G+ee,S},qt.rotateX=function(S,w,I){var M=-w[0],L=-w[1],k=-w[2],B=w[3],V=w[4],N=w[5],G=w[6],H=w[7],J=V*B+H*M+N*k-G*L,oe=N*B+H*L+G*M-V*k,ee=G*B+H*k+V*L-N*M,ne=H*B-V*M-N*L-G*k;return r.rotateX(S,w,I),S[4]=J*(B=S[3])+ne*(M=S[0])+oe*(k=S[2])-ee*(L=S[1]),S[5]=oe*B+ne*L+ee*M-J*k,S[6]=ee*B+ne*k+J*L-oe*M,S[7]=ne*B-J*M-oe*L-ee*k,S},qt.rotateY=function(S,w,I){var M=-w[0],L=-w[1],k=-w[2],B=w[3],V=w[4],N=w[5],G=w[6],H=w[7],J=V*B+H*M+N*k-G*L,oe=N*B+H*L+G*M-V*k,ee=G*B+H*k+V*L-N*M,ne=H*B-V*M-N*L-G*k;return r.rotateY(S,w,I),S[4]=J*(B=S[3])+ne*(M=S[0])+oe*(k=S[2])-ee*(L=S[1]),S[5]=oe*B+ne*L+ee*M-J*k,S[6]=ee*B+ne*k+J*L-oe*M,S[7]=ne*B-J*M-oe*L-ee*k,S},qt.rotateZ=function(S,w,I){var M=-w[0],L=-w[1],k=-w[2],B=w[3],V=w[4],N=w[5],G=w[6],H=w[7],J=V*B+H*M+N*k-G*L,oe=N*B+H*L+G*M-V*k,ee=G*B+H*k+V*L-N*M,ne=H*B-V*M-N*L-G*k;return r.rotateZ(S,w,I),S[4]=J*(B=S[3])+ne*(M=S[0])+oe*(k=S[2])-ee*(L=S[1]),S[5]=oe*B+ne*L+ee*M-J*k,S[6]=ee*B+ne*k+J*L-oe*M,S[7]=ne*B-J*M-oe*L-ee*k,S},qt.rotateByQuatAppend=function(S,w,I){var M=I[0],L=I[1],k=I[2],B=I[3],V=w[0],N=w[1],G=w[2],H=w[3];return S[0]=V*B+H*M+N*k-G*L,S[1]=N*B+H*L+G*M-V*k,S[2]=G*B+H*k+V*L-N*M,S[3]=H*B-V*M-N*L-G*k,S[4]=(V=w[4])*B+(H=w[7])*M+(N=w[5])*k-(G=w[6])*L,S[5]=N*B+H*L+G*M-V*k,S[6]=G*B+H*k+V*L-N*M,S[7]=H*B-V*M-N*L-G*k,S},qt.rotateByQuatPrepend=function(S,w,I){var M=w[0],L=w[1],k=w[2],B=w[3],V=I[0],N=I[1],G=I[2],H=I[3];return S[0]=M*H+B*V+L*G-k*N,S[1]=L*H+B*N+k*V-M*G,S[2]=k*H+B*G+M*N-L*V,S[3]=B*H-M*V-L*N-k*G,S[4]=M*(H=I[7])+B*(V=I[4])+L*(G=I[6])-k*(N=I[5]),S[5]=L*H+B*N+k*V-M*G,S[6]=k*H+B*G+M*N-L*V,S[7]=B*H-M*V-L*N-k*G,S},qt.rotateAroundAxis=function(S,w,I,M){if(Math.abs(M)<e.EPSILON)return v(S,w);var L=Math.hypot(I[0],I[1],I[2]);M*=.5;var k=Math.sin(M),B=k*I[0]/L,V=k*I[1]/L,N=k*I[2]/L,G=Math.cos(M),H=w[0],J=w[1],oe=w[2],ee=w[3];S[0]=H*G+ee*B+J*N-oe*V,S[1]=J*G+ee*V+oe*B-H*N,S[2]=oe*G+ee*N+H*V-J*B,S[3]=ee*G-H*B-J*V-oe*N;var ne=w[4],pe=w[5],te=w[6],de=w[7];return S[4]=ne*G+de*B+pe*N-te*V,S[5]=pe*G+de*V+te*B-ne*N,S[6]=te*G+de*N+ne*V-pe*B,S[7]=de*G-ne*B-pe*V-te*N,S},qt.add=function(S,w,I){return S[0]=w[0]+I[0],S[1]=w[1]+I[1],S[2]=w[2]+I[2],S[3]=w[3]+I[3],S[4]=w[4]+I[4],S[5]=w[5]+I[5],S[6]=w[6]+I[6],S[7]=w[7]+I[7],S},qt.multiply=T,qt.scale=function(S,w,I){return S[0]=w[0]*I,S[1]=w[1]*I,S[2]=w[2]*I,S[3]=w[3]*I,S[4]=w[4]*I,S[5]=w[5]*I,S[6]=w[6]*I,S[7]=w[7]*I,S},qt.lerp=function(S,w,I,M){var L=1-M;return D(w,I)<0&&(M=-M),S[0]=w[0]*L+I[0]*M,S[1]=w[1]*L+I[1]*M,S[2]=w[2]*L+I[2]*M,S[3]=w[3]*L+I[3]*M,S[4]=w[4]*L+I[4]*M,S[5]=w[5]*L+I[5]*M,S[6]=w[6]*L+I[6]*M,S[7]=w[7]*L+I[7]*M,S},qt.invert=function(S,w){var I=E(w);return S[0]=-w[0]/I,S[1]=-w[1]/I,S[2]=-w[2]/I,S[3]=w[3]/I,S[4]=-w[4]/I,S[5]=-w[5]/I,S[6]=-w[6]/I,S[7]=w[7]/I,S},qt.conjugate=function(S,w){return S[0]=-w[0],S[1]=-w[1],S[2]=-w[2],S[3]=w[3],S[4]=-w[4],S[5]=-w[5],S[6]=-w[6],S[7]=w[7],S},qt.normalize=function(S,w){var I=E(w);if(I>0){I=Math.sqrt(I);var M=w[0]/I,L=w[1]/I,k=w[2]/I,B=w[3]/I,V=w[4],N=w[5],G=w[6],H=w[7],J=M*V+L*N+k*G+B*H;S[0]=M,S[1]=L,S[2]=k,S[3]=B,S[4]=(V-M*J)/I,S[5]=(N-L*J)/I,S[6]=(G-k*J)/I,S[7]=(H-B*J)/I}return S},qt.str=function(S){return"quat2("+S[0]+", "+S[1]+", "+S[2]+", "+S[3]+", "+S[4]+", "+S[5]+", "+S[6]+", "+S[7]+")"},qt.exactEquals=function(S,w){return S[0]===w[0]&&S[1]===w[1]&&S[2]===w[2]&&S[3]===w[3]&&S[4]===w[4]&&S[5]===w[5]&&S[6]===w[6]&&S[7]===w[7]},qt.equals=function(S,w){var I=S[0],M=S[1],L=S[2],k=S[3],B=S[4],V=S[5],N=S[6],G=S[7],H=w[0],J=w[1],oe=w[2],ee=w[3],ne=w[4],pe=w[5],te=w[6],de=w[7];return Math.abs(I-H)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(H))&&Math.abs(M-J)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(J))&&Math.abs(L-oe)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(oe))&&Math.abs(k-ee)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(ee))&&Math.abs(B-ne)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(ne))&&Math.abs(V-pe)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(pe))&&Math.abs(N-te)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(te))&&Math.abs(G-de)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(de))},qt.sqrLen=qt.squaredLength=qt.len=qt.length=qt.dot=qt.mul=qt.setReal=qt.getReal=void 0;var e=u(Te()),r=u(ko()),l=u(xn());function f(S){if(typeof WeakMap!="function")return null;var w=new WeakMap,I=new WeakMap;return(f=function(M){return M?I:w})(S)}function u(S,w){if(S&&S.__esModule)return S;if(S===null||s(S)!=="object"&&typeof S!="function")return{default:S};var I=f(w);if(I&&I.has(S))return I.get(S);var M={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in S)if(k!=="default"&&Object.prototype.hasOwnProperty.call(S,k)){var B=L?Object.getOwnPropertyDescriptor(S,k):null;B&&(B.get||B.set)?Object.defineProperty(M,k,B):M[k]=S[k]}return M.default=S,I&&I.set(S,M),M}function p(S,w,I){var M=.5*I[0],L=.5*I[1],k=.5*I[2],B=w[0],V=w[1],N=w[2],G=w[3];return S[0]=B,S[1]=V,S[2]=N,S[3]=G,S[4]=M*G+L*N-k*V,S[5]=L*G+k*B-M*N,S[6]=k*G+M*V-L*B,S[7]=-M*B-L*V-k*N,S}function v(S,w){return S[0]=w[0],S[1]=w[1],S[2]=w[2],S[3]=w[3],S[4]=w[4],S[5]=w[5],S[6]=w[6],S[7]=w[7],S}function T(S,w,I){var M=w[0],L=w[1],k=w[2],B=w[3],V=I[4],N=I[5],G=I[6],H=I[7],J=w[4],oe=w[5],ee=w[6],ne=w[7],pe=I[0],te=I[1],de=I[2],ye=I[3];return S[0]=M*ye+B*pe+L*de-k*te,S[1]=L*ye+B*te+k*pe-M*de,S[2]=k*ye+B*de+M*te-L*pe,S[3]=B*ye-M*pe-L*te-k*de,S[4]=M*H+B*V+L*G-k*N+J*ye+ne*pe+oe*de-ee*te,S[5]=L*H+B*N+k*V-M*G+oe*ye+ne*te+ee*pe-J*de,S[6]=k*H+B*G+M*N-L*V+ee*ye+ne*de+J*te-oe*pe,S[7]=B*H-M*V-L*N-k*G+ne*ye-J*pe-oe*te-ee*de,S}qt.getReal=r.copy,qt.setReal=r.copy,qt.mul=T;var D=r.dot;qt.dot=D;var _=r.length;qt.length=_,qt.len=_;var E=r.squaredLength;return qt.squaredLength=E,qt.sqrLen=E,qt}var Fl,va,Gt={};function Nl(){if(Fl)return Gt;function s(w){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},s(w)}Fl=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=l,Gt.clone=function(w){var I=new e.ARRAY_TYPE(2);return I[0]=w[0],I[1]=w[1],I},Gt.fromValues=function(w,I){var M=new e.ARRAY_TYPE(2);return M[0]=w,M[1]=I,M},Gt.copy=function(w,I){return w[0]=I[0],w[1]=I[1],w},Gt.set=function(w,I,M){return w[0]=I,w[1]=M,w},Gt.add=function(w,I,M){return w[0]=I[0]+M[0],w[1]=I[1]+M[1],w},Gt.subtract=f,Gt.multiply=u,Gt.divide=p,Gt.ceil=function(w,I){return w[0]=Math.ceil(I[0]),w[1]=Math.ceil(I[1]),w},Gt.floor=function(w,I){return w[0]=Math.floor(I[0]),w[1]=Math.floor(I[1]),w},Gt.min=function(w,I,M){return w[0]=Math.min(I[0],M[0]),w[1]=Math.min(I[1],M[1]),w},Gt.max=function(w,I,M){return w[0]=Math.max(I[0],M[0]),w[1]=Math.max(I[1],M[1]),w},Gt.round=function(w,I){return w[0]=Math.round(I[0]),w[1]=Math.round(I[1]),w},Gt.scale=function(w,I,M){return w[0]=I[0]*M,w[1]=I[1]*M,w},Gt.scaleAndAdd=function(w,I,M,L){return w[0]=I[0]+M[0]*L,w[1]=I[1]+M[1]*L,w},Gt.distance=v,Gt.squaredDistance=T,Gt.length=D,Gt.squaredLength=_,Gt.negate=function(w,I){return w[0]=-I[0],w[1]=-I[1],w},Gt.inverse=function(w,I){return w[0]=1/I[0],w[1]=1/I[1],w},Gt.normalize=function(w,I){var M=I[0],L=I[1],k=M*M+L*L;return k>0&&(k=1/Math.sqrt(k)),w[0]=I[0]*k,w[1]=I[1]*k,w},Gt.dot=function(w,I){return w[0]*I[0]+w[1]*I[1]},Gt.cross=function(w,I,M){var L=I[0]*M[1]-I[1]*M[0];return w[0]=w[1]=0,w[2]=L,w},Gt.lerp=function(w,I,M,L){var k=I[0],B=I[1];return w[0]=k+L*(M[0]-k),w[1]=B+L*(M[1]-B),w},Gt.random=function(w,I){I=I||1;var M=2*e.RANDOM()*Math.PI;return w[0]=Math.cos(M)*I,w[1]=Math.sin(M)*I,w},Gt.transformMat2=function(w,I,M){var L=I[0],k=I[1];return w[0]=M[0]*L+M[2]*k,w[1]=M[1]*L+M[3]*k,w},Gt.transformMat2d=function(w,I,M){var L=I[0],k=I[1];return w[0]=M[0]*L+M[2]*k+M[4],w[1]=M[1]*L+M[3]*k+M[5],w},Gt.transformMat3=function(w,I,M){var L=I[0],k=I[1];return w[0]=M[0]*L+M[3]*k+M[6],w[1]=M[1]*L+M[4]*k+M[7],w},Gt.transformMat4=function(w,I,M){var L=I[0],k=I[1];return w[0]=M[0]*L+M[4]*k+M[12],w[1]=M[1]*L+M[5]*k+M[13],w},Gt.rotate=function(w,I,M,L){var k=I[0]-M[0],B=I[1]-M[1],V=Math.sin(L),N=Math.cos(L);return w[0]=k*N-B*V+M[0],w[1]=k*V+B*N+M[1],w},Gt.angle=function(w,I){var M=w[0],L=w[1],k=I[0],B=I[1],V=Math.sqrt(M*M+L*L)*Math.sqrt(k*k+B*B);return Math.acos(Math.min(Math.max(V&&(M*k+L*B)/V,-1),1))},Gt.zero=function(w){return w[0]=0,w[1]=0,w},Gt.str=function(w){return"vec2("+w[0]+", "+w[1]+")"},Gt.exactEquals=function(w,I){return w[0]===I[0]&&w[1]===I[1]},Gt.equals=function(w,I){var M=w[0],L=w[1],k=I[0],B=I[1];return Math.abs(M-k)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(k))&&Math.abs(L-B)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(B))},Gt.forEach=Gt.sqrLen=Gt.sqrDist=Gt.dist=Gt.div=Gt.mul=Gt.sub=Gt.len=void 0;var e=function(w,I){if(w&&w.__esModule)return w;if(w===null||s(w)!=="object"&&typeof w!="function")return{default:w};var M=r(void 0);if(M&&M.has(w))return M.get(w);var L={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in w)if(B!=="default"&&Object.prototype.hasOwnProperty.call(w,B)){var V=k?Object.getOwnPropertyDescriptor(w,B):null;V&&(V.get||V.set)?Object.defineProperty(L,B,V):L[B]=w[B]}return L.default=w,M&&M.set(w,L),L}(Te());function r(w){if(typeof WeakMap!="function")return null;var I=new WeakMap,M=new WeakMap;return(r=function(L){return L?M:I})(w)}function l(){var w=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(w[0]=0,w[1]=0),w}function f(w,I,M){return w[0]=I[0]-M[0],w[1]=I[1]-M[1],w}function u(w,I,M){return w[0]=I[0]*M[0],w[1]=I[1]*M[1],w}function p(w,I,M){return w[0]=I[0]/M[0],w[1]=I[1]/M[1],w}function v(w,I){return Math.hypot(I[0]-w[0],I[1]-w[1])}function T(w,I){var M=I[0]-w[0],L=I[1]-w[1];return M*M+L*L}function D(w){return Math.hypot(w[0],w[1])}function _(w){var I=w[0],M=w[1];return I*I+M*M}Gt.len=D,Gt.sub=f,Gt.mul=u,Gt.div=p,Gt.dist=v,Gt.sqrDist=T,Gt.sqrLen=_;var E,S=(E=l(),function(w,I,M,L,k,B){var V,N;for(I||(I=2),M||(M=0),N=L?Math.min(L*I+M,w.length):w.length,V=M;V<N;V+=I)E[0]=w[V],E[1]=w[V+1],k(E,E,B),w[V]=E[0],w[V+1]=E[1];return w});return Gt.forEach=S,Gt}function Hi(){if(va)return $;function s(w){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},s(w)}va=1,Object.defineProperty($,"__esModule",{value:!0}),$.vec4=$.vec3=$.vec2=$.quat2=$.quat=$.mat4=$.mat3=$.mat2d=$.mat2=$.glMatrix=void 0;var e=S(Te());$.glMatrix=e;var r=S(We());$.mat2=r;var l=S(on());$.mat2d=l;var f=S(mr());$.mat3=f;var u=S(xn());$.mat4=u;var p=S(ko());$.quat=p;var v=S(Bs());$.quat2=v;var T=S(Nl());$.vec2=T;var D=S(zs());$.vec3=D;var _=S(ti());function E(w){if(typeof WeakMap!="function")return null;var I=new WeakMap,M=new WeakMap;return(E=function(L){return L?M:I})(w)}function S(w,I){if(w&&w.__esModule)return w;if(w===null||s(w)!=="object"&&typeof w!="function")return{default:w};var M=E(I);if(M&&M.has(w))return M.get(w);var L={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in w)if(B!=="default"&&Object.prototype.hasOwnProperty.call(w,B)){var V=k?Object.getOwnPropertyDescriptor(w,B):null;V&&(V.get||V.set)?Object.defineProperty(L,B,V):L[B]=w[B]}return L.default=w,M&&M.set(w,L),L}return $.vec4=_,$}var Li,xa,zl,Vs,we=Hi(),Fo=function(){if(xa)return Li;function s(e,r,l,f){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=l,this.p2y=f}return xa=1,Li=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,f=0;f<8;f++){var u=this.sampleCurveX(l)-e;if(Math.abs(u)<r)return l;var p=this.sampleCurveDerivativeX(l);if(Math.abs(p)<1e-6)break;l-=u/p}var v=0,T=1;for(l=e,f=0;f<20&&(u=this.sampleCurveX(l),!(Math.abs(u-e)<r));f++)e>u?v=l:T=l,l=.5*(T-v)+v;return l},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},Li}(),ps=P(Fo);function Bl(){if(Vs)return zl;function s(e,r){this.x=e,this.y=r}return Vs=1,zl=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,l=e.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),l=Math.sin(e),f=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=f,this},_rotateAround:function(e,r){var l=Math.cos(e),f=Math.sin(e),u=r.y+f*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-f*(this.y-r.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(e){return e instanceof s?e:Array.isArray(e)?new s(e[0],e[1]):e},zl}var it=P(Bl());function js(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let r=0;r<s.length;r++)if(!js(s[r],e[r]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(let r in s)if(!js(s[r],e[r]))return!1;return!0}return s===e}let zr=Math.PI/180,No=180/Math.PI;function en(s){return s*zr}function Fr(s){return s*No}let qi=[[0,0],[1,0],[1,1],[0,1]];function Us(s){if(s<=0)return 0;if(s>=1)return 1;let e=s*s,r=e*s;return 4*(s<.5?r:3*(s-e)+r-.75)}function ms(s,e,r,l){let f=new ps(s,e,r,l);return function(u){return f.solve(u)}}let ba=ms(.25,.1,.25,1);function zt(s,e,r){return Math.min(r,Math.max(e,s))}function wa(s,e,r){return(r=zt((r-s)/(e-s),0,1))*r*(3-2*r)}function zo(s,e,r){let l=r-e,f=((s-e)%l+l)%l+e;return f===e?r:f}function $s(s,e,r){if(!s.length)return r(null,[]);let l=s.length,f=new Array(s.length),u=null;s.forEach((p,v)=>{e(p,(T,D)=>{T&&(u=T),f[v]=D,--l==0&&r(u,f)})})}function Jr(s,...e){for(let r of e)for(let l in r)s[l]=r[l];return s}let xi=1;function Vl(){return xi++}function jl(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Ea(s,e){s.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Bo(s,e){return s.indexOf(e,s.length-e.length)!==-1}function Gs(s,e,r){let l={};for(let f in s)l[f]=e.call(this,s[f],f,s);return l}function Ta(s,e,r){let l={};for(let f in s)e.call(this,s[f],f,s)&&(l[f]=s[f]);return l}function ki(s){return Array.isArray(s)?s.map(ki):typeof s=="object"&&s?Gs(s,ki):s}let Ul={};function ln(s){Ul[s]||(typeof console<"u"&&console.warn(s),Ul[s]=!0)}function fo(s,e,r){return(r.y-s.y)*(e.x-s.x)>(e.y-s.y)*(r.x-s.x)}function su(s){let e=0;for(let r,l,f=0,u=s.length,p=u-1;f<u;p=f++)r=s[f],l=s[p],e+=(l.x-r.x)*(r.y+l.y);return e}function bi([s,e,r]){let l=en(e+90),f=en(r);return{x:s*Math.cos(l)*Math.sin(f),y:s*Math.sin(l)*Math.sin(f),z:s*Math.cos(f),azimuthal:e,polar:r}}function Hs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function $l(s){let e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,l,f,u)=>{let p=f||u;return e[l]=!p||p.toLowerCase(),""}),e["max-age"]){let r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Gl=null;function Ia(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function Hl(s,e,r,l){for(;e<r;){let f=e+r>>1;s[f]<l?e=f+1:r=f}return e}function Ne(s,e,r,l){for(;e<r;){let f=e+r>>1;s[f]<=l?e=f+1:r=f}return e}function Y(s){return s>0?1/(1.001-s):1+s}function K(s){return s>0?1-1/(1.001-s):-s}let ce={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ce.API_URL)return null;try{let s=new URL(ce.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function be(s){return ce.API_URL_REGEX.test(s)}function fe(s){return ce.API_SPRITE_REGEX.test(s)}let Ie,ke,Ce,Fe,Ve,je;function Qe(){return Ie==null&&(Ie=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ie}let at={now:()=>Fe!==void 0?Fe:performance.now(),setNow(s){Fe=s},restoreNow(){Fe=void 0},frame(s){let e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){let{width:r,height:l}=s;Ve||(Ve=document.createElement("canvas"));let f=Ve.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(r>Ve.width||l>Ve.height)&&(Ve.width=r,Ve.height=l),f.clearRect(-e,-e,r+2*e,l+2*e),f.drawImage(s,0,0,r,l),f.getImageData(-e,-e,r+2*e,l+2*e)},resolveURL:s=>(ke||(ke=document.createElement("a")),ke.href=s,ke.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ce==null&&(Ce=window.matchMedia("(prefers-reduced-motion: reduce)")),Ce.matches)},hasCanvasFingerprintNoise(){if(je!==void 0)return je;if(!Qe())return je=!1,!1;let s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0}),r=0;for(let f=0;f<s.width;++f)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(f,0,1,1);let l=e.getImageData(0,0,s.width,s.height);r=0;for(let f=0;f<l.data.length;++f)if(f%4!=3&&r++!==l.data[f])return je=!0,!0;return je=!1,!1}};function gt(s,e){let r=s.indexOf("?");if(r<0)return`${s}?${new URLSearchParams(e).toString()}`;let l=new URLSearchParams(s.slice(r));for(let f in e)l.set(f,e[f]);return`${s.slice(0,r)}?${l.toString()}`}function Pt(s,e={persistentParams:[]}){let r=s.indexOf("?");if(r<0)return s;let l=new URLSearchParams,f=new URLSearchParams(s.slice(r));for(let p of e.persistentParams){let v=f.get(p);v&&l.set(p,v)}let u=l.toString();return`${s.slice(0,r)}${u.length>0?`?${u}`:""}`}let Bt="mapbox-tiles",Vt=500,Ot=50,Cn=["language","worldview","jobid"],pn,Xt;function Ln(){try{return caches}catch{}}function Kn(){let s=Ln();s&&pn==null&&(pn=s.open(Bt))}let Or=1/0,Br={supported:!1,testSupport:function(s){!gs&&Vr&&(po?lu(s):Dr=s)}},Dr,Vr,gs=!1,po=!1,au=typeof self<"u"?self:{};function lu(s){let e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Vr),s.isContextLost())return;Br.supported=!0}catch{}s.deleteTexture(e),gs=!0}au.document&&(Vr=au.document.createElement("img"),Vr.onload=function(){Dr&&lu(Dr),Dr=null,po=!0},Vr.onerror=function(){gs=!0,Dr=null},Vr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let cu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(cu);class od extends Error{constructor(e,r,l){r===401&&be(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let sd=Hs()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Sa=function(s,e){if(!(/^file:/.test(r=s.url)||/^file:/.test(sd())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,f){let u=new AbortController,p=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:sd(),referrerPolicy:l.referrerPolicy,signal:u.signal}),v=!1,T=!1,D=(_=p.url).indexOf("sku=")>0&&be(_);var _;l.type==="json"&&p.headers.set("Accept","application/json");let E=(w,I,M)=>{if(T)return;if(w&&w.message!=="SecurityError"&&ln(w.toString()),I&&M)return S(I);let L=Date.now();fetch(p).then(k=>{if(k.ok){let B=D?k.clone():null;return S(k,B,L)}return f(new od(k.statusText,k.status,l.url))}).catch(k=>{k.name!=="AbortError"&&f(new Error(`${k.message} ${l.url}`))})},S=(w,I,M)=>{(l.type==="arrayBuffer"?w.arrayBuffer():l.type==="json"?w.json():w.text()).then(L=>{T||(I&&M&&function(k,B,V){if(Kn(),pn==null)return;let N=$l(B.headers.get("Cache-Control")||"");if(N["no-store"])return;let G={status:B.status,statusText:B.statusText,headers:new Headers};B.headers.forEach((oe,ee)=>G.headers.set(ee,oe)),N["max-age"]&&G.headers.set("Expires",new Date(V+1e3*N["max-age"]).toUTCString());let H=G.headers.get("Expires");if(!H||new Date(H).getTime()-V<42e4)return;let J=Pt(k.url,{persistentParams:Cn});if(B.status===206){let oe=k.headers.get("Range");if(!oe)return;G.status=200,J=gt(J,{range:oe})}(function(oe,ee){if(Xt===void 0)try{new Response(new ReadableStream),Xt=!0}catch{Xt=!1}Xt?ee(oe.body):oe.blob().then(ee)})(B,oe=>{let ee=new Response((ne=B.status)!==200&&ne!==404&&[101,103,204,205,304].includes(ne)?null:oe,G);var ne;Kn(),pn?.then(pe=>pe.put(J,ee)).catch(pe=>ln(pe.message))})}(p,I,M),v=!0,f(null,L,w.headers.get("Cache-Control"),w.headers.get("Expires")))}).catch(L=>{T||f(new Error(L.message))})};return D?function(w,I){if(Kn(),pn==null)return I(null);pn.then(M=>{let L=Pt(w.url,{persistentParams:Cn}),k=w.headers.get("Range");k&&(L=gt(L,{range:k})),M.match(L).then(B=>{let V=function(N){if(!N)return!1;let G=new Date(N.headers.get("Expires")||0),H=$l(N.headers.get("Cache-Control")||"");return G>Date.now()&&!H["no-cache"]}(B);M.delete(L),V&&M.put(L,B.clone()),I(null,B,V)}).catch(I)}).catch(I)}(p,E):E(null,null),{cancel:()=>{T=!0,v||u.abort()}}}(s,e);if(Hs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var r;return function(l,f){let u=new XMLHttpRequest;u.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let p in l.headers)u.setRequestHeader(p,l.headers[p]);return l.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=l.credentials==="include",u.onerror=()=>{f(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(l.type==="json")try{p=JSON.parse(u.response)}catch(v){return f(v)}f(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else f(new od(u.statusText,u.status,l.url))},u.send(l.body),{cancel:()=>u.abort()}}(s,e)},Da=function(s,e){return Sa(Jr(s,{type:"arrayBuffer"}),e)};function Fi(s){let e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}let Wi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Zi,ui;Zi=[],ui=0;let mo=function(s,e){if(Br.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),ui>=ce.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Zi.push(u),u}ui++;let r=!1,l=()=>{if(!r)for(r=!0,ui--;Zi.length&&ui<ce.MAX_PARALLEL_IMAGE_REQUESTS;){let u=Zi.shift(),{requestParameters:p,callback:v,cancelled:T}=u;T||(u.cancel=mo(p,v).cancel)}},f=Da(s,(u,p,v,T)=>{l(),u?e(u):p&&(self.createImageBitmap?function(D,_){let E=new Blob([new Uint8Array(D)],{type:"image/png"});createImageBitmap(E).then(S=>{_(null,S)}).catch(S=>{_(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(D,_)=>e(D,_,v,T)):function(D,_){let E=new Image;E.onload=()=>{_(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=Wi})},E.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let S=new Blob([new Uint8Array(D)],{type:"image/png"});E.src=D.byteLength?URL.createObjectURL(S):Wi}(p,(D,_)=>e(D,_,v,T)))});return{cancel:()=>{f.cancel(),l()}}};var ql,ad,ld,go={exports:{}},uu={exports:{}},nm={exports:{}},tv=function(){if(ld)return go.exports;ld=1;var s=(ql||(ql=1,uu.exports=function(r,l){var f,u,p,v,T,D,_,E;for(u=r.length-(f=3&r.length),p=l,T=3432918353,D=461845907,E=0;E<u;)_=255&r.charCodeAt(E)|(255&r.charCodeAt(++E))<<8|(255&r.charCodeAt(++E))<<16|(255&r.charCodeAt(++E))<<24,++E,p=27492+(65535&(v=5*(65535&(p=(p^=_=(65535&(_=(_=(65535&_)*T+(((_>>>16)*T&65535)<<16)&4294967295)<<15|_>>>17))*D+(((_>>>16)*D&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(_=0,f){case 3:_^=(255&r.charCodeAt(E+2))<<16;case 2:_^=(255&r.charCodeAt(E+1))<<8;case 1:p^=_=(65535&(_=(_=(65535&(_^=255&r.charCodeAt(E)))*T+(((_>>>16)*T&65535)<<16)&4294967295)<<15|_>>>17))*D+(((_>>>16)*D&65535)<<16)&4294967295}return p^=r.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),uu.exports),e=(ad||(ad=1,nm.exports=function(r,l){for(var f,u=r.length,p=l^u,v=0;u>=4;)f=1540483477*(65535&(f=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(f>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),u-=4,++v;switch(u){case 3:p^=(255&r.charCodeAt(v+2))<<16;case 2:p^=(255&r.charCodeAt(v+1))<<8;case 1:p=1540483477*(65535&(p^=255&r.charCodeAt(v)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),nm.exports);return go.exports=s,go.exports.murmur3=s,go.exports.murmur2=e,go.exports}(),hi=P(tv);class _s{constructor(e,...r){Jr(this,r[0]||{}),this.type=e}}class Wl extends _s{constructor(e,r={}){super("error",Jr({error:e},r))}}function Ca(s,e,r){r[s]&&r[s].indexOf(e)!==-1||(r[s]=r[s]||[],r[s].push(e))}function cd(s,e,r){if(r&&r[s]){let l=r[s].indexOf(e);l!==-1&&r[s].splice(l,1)}}class Ma{on(e,r){return this._listeners=this._listeners||{},Ca(e,r,this._listeners),this}off(e,r){return cd(e,r,this._listeners),cd(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ca(e,r,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,r){let l=typeof e=="string"?new _s(e,r):e,f=l.type;if(this.listens(f)){l.target=this;let u=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(let T of u)T.call(this,l);let p=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(let T of p)cd(f,T,this._oneTimeListeners),T.call(this,l);let v=this._eventedParent;v&&(Jr(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(l))}else l instanceof Wl&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ud,mn={},hd=function(){if(ud)return mn;ud=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(u){return(u=Math.round(u))<0?0:u>255?255:u}function r(u){return e(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function l(u){return(p=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:p>1?1:p;var p}function f(u,p,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?u+(p-u)*v*6:2*v<1?p:3*v<2?u+(p-u)*(2/3-v)*6:u}try{mn.parseCSSColor=function(u){var p,v=u.replace(/ /g,"").toLowerCase();if(v in s)return s[v].slice();if(v[0]==="#")return v.length===4?(p=parseInt(v.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:v.length===7&&(p=parseInt(v.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var T=v.indexOf("("),D=v.indexOf(")");if(T!==-1&&D+1===v.length){var _=v.substr(0,T),E=v.substr(T+1,D-(T+1)).split(","),S=1;switch(_){case"rgba":if(E.length!==4)return null;S=l(E.pop());case"rgb":return E.length!==3?null:[r(E[0]),r(E[1]),r(E[2]),S];case"hsla":if(E.length!==4)return null;S=l(E.pop());case"hsl":if(E.length!==3)return null;var w=(parseFloat(E[0])%360+360)%360/360,I=l(E[1]),M=l(E[2]),L=M<=.5?M*(I+1):M+I-M*I,k=2*M-L;return[e(255*f(k,L,w+1/3)),e(255*f(k,L,w)),e(255*f(k,L,w-1/3)),S];default:return null}}return null}}catch{}return mn}();class Rn{constructor(e,r,l,f=1){this.r=e,this.g=r,this.b=l,this.a=f}static parse(e){if(!e)return;if(e instanceof Rn)return e;if(typeof e!="string")return;let r=hd.parseCSSColor(e);return r?new Rn(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){let[e,r,l,f]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(l)},${f})`}toRenderColor(e){let{r,g:l,b:f,a:u}=this;return new nv(e,r,l,f,u)}}class nv{constructor(e,r,l,f,u){if(e){let p=e.image.height,v=p*p;r=u===0?0:r/u*(p-1),l=u===0?0:l/u*(p-1),f=u===0?0:f/u*(p-1);let T=Math.floor(r),D=Math.floor(l),_=Math.floor(f),E=Math.ceil(r),S=Math.ceil(l),w=Math.ceil(f),I=r-T,M=l-D,L=f-_,k=e.image.data,B=4*(T+D*v+_*p),V=4*(T+D*v+w*p),N=4*(T+S*v+_*p),G=4*(T+S*v+w*p),H=4*(E+D*v+_*p),J=4*(E+D*v+w*p),oe=4*(E+S*v+_*p),ee=4*(E+S*v+w*p);if(B<0||ee>=k.length)throw new Error("out of range");this.r=Mt(Mt(Mt(k[B],k[V],L),Mt(k[N],k[G],L),M),Mt(Mt(k[H],k[J],L),Mt(k[oe],k[ee],L),M),I)/255*u,this.g=Mt(Mt(Mt(k[B+1],k[V+1],L),Mt(k[N+1],k[G+1],L),M),Mt(Mt(k[H+1],k[J+1],L),Mt(k[oe+1],k[ee+1],L),M),I)/255*u,this.b=Mt(Mt(Mt(k[B+2],k[V+2],L),Mt(k[N+2],k[G+2],L),M),Mt(Mt(k[H+2],k[J+2],L),Mt(k[oe+2],k[ee+2],L),M),I)/255*u,this.a=u}else this.r=r,this.g=l,this.b=f,this.a=u}toArray(){let{r:e,g:r,b:l,a:f}=this;return f===0?[0,0,0,0]:[255*e/f,255*r/f,255*l/f,f]}toArray01(){let{r:e,g:r,b:l,a:f}=this;return f===0?[0,0,0,0]:[e/f,r/f,l/f,f]}toArray01Scaled(e){let{r,g:l,b:f,a:u}=this;return u===0?[0,0,0]:[r/u*e,l/u*e,f/u*e]}toArray01PremultipliedAlpha(){let{r:e,g:r,b:l,a:f}=this;return[e,r,l,f]}toArray01Linear(){let{r:e,g:r,b:l,a:f}=this;return f===0?[0,0,0,0]:[Math.pow(e/f,2.2),Math.pow(r/f,2.2),Math.pow(l/f,2.2),f]}}function Mt(s,e,r){return s*(1-r)+e*r}function Zl(s,e,r){return s.map((l,f)=>Mt(l,e[f],r))}Rn.black=new Rn(0,0,0,1),Rn.white=new Rn(1,1,1,1),Rn.transparent=new Rn(0,0,0,0),Rn.red=new Rn(1,0,0,1),Rn.blue=new Rn(0,0,1,1);var qs=Object.freeze({__proto__:null,array:Zl,color:function(s,e,r){return new Rn(Mt(s.r,e.r,r),Mt(s.g,e.g,r),Mt(s.b,e.b,r),Mt(s.a,e.a,r))},number:Mt});function Aa(s,...e){for(let r of e)for(let l in r)s[l]=r[l];return s}class Xi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class hu{constructor(e,r=[]){this.parent=e,this.bindings={};for(let[l,f]of r)this.bindings[l]=f}concat(e){return new hu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Yi={kind:"null"},mt={kind:"number"},cn={kind:"string"},un={kind:"boolean"},di={kind:"color"},Kr={kind:"object"},dn={kind:"value"},du={kind:"collator"},Ra={kind:"formatted"},Pa={kind:"resolvedImage"};function ni(s,e){return{kind:"array",itemType:s,N:e}}function gr(s){if(s.kind==="array"){let e=gr(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}let rm=[Yi,mt,cn,un,di,Ra,Kr,ni(dn),Pa];function Oa(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Oa(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(let r of rm)if(!Oa(r,e))return null}}return`Expected ${gr(s)} but found ${gr(e)} instead.`}function La(s,e){return e.some(r=>r.kind===s.kind)}function _o(s,e){return e.some(r=>r==="null"?s===null:r==="array"?Array.isArray(s):r==="object"?s&&!Array.isArray(s)&&typeof s=="object":r===typeof s)}class fu{constructor(e,r,l){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wi{constructor(e,r,l,f,u){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=l,this.fontStack=f,this.textColor=u}}class Qr{constructor(e){this.sections=e}static fromString(e){return new Qr([new wi(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Qr?e:Qr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let r of this.sections){if(r.image){e.push(["image",r.image.namePrimary]);continue}e.push(r.text);let l={};r.fontStack&&(l["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(l["font-scale"]=r.scale),r.textColor&&(l["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),e.push(l)}return e}}class ri{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,r){return e?new ri({namePrimary:e,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function im(s,e,r,l){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[s,e,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[s,e,r,l]:[s,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ys(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Rn||s instanceof fu||s instanceof Qr||s instanceof ri)return!0;if(Array.isArray(s)){for(let e of s)if(!ys(e))return!1;return!0}if(typeof s=="object"){for(let e in s)if(!ys(s[e]))return!1;return!0}return!1}function Er(s){if(s===null)return Yi;if(typeof s=="string")return cn;if(typeof s=="boolean")return un;if(typeof s=="number")return mt;if(s instanceof Rn)return di;if(s instanceof fu)return du;if(s instanceof Qr)return Ra;if(s instanceof ri)return Pa;if(Array.isArray(s)){let e=s.length,r;for(let l of s){let f=Er(l);if(r){if(r===f)continue;r=dn;break}r=f}return ni(r||dn,e)}return Kr}function ii(s){let e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Rn||s instanceof Qr||s instanceof ri?s.toString():JSON.stringify(s)}class Ji{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ys(e[1]))return r.error("invalid value");let l=e[1],f=Er(l),u=r.expectedType;return f.kind!=="array"||f.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(f=u),new Ji(f,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Rn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Qr?this.value.serialize():this.value}}class Lr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let dd={string:cn,number:mt,boolean:un,object:Kr};class Ki{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l,f=1,u=e[0];if(u==="array"){let v,T;if(e.length>2){let D=e[1];if(typeof D!="string"||!(D in dd)||D==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=dd[D],f++}else v=dn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);T=e[2],f++}l=ni(v,T)}else l=dd[u];let p=[];for(;f<e.length;f++){let v=r.parse(e[f],f,dn);if(!v)return null;p.push(v)}return new Ki(l,p)}evaluate(e){for(let r=0;r<this.args.length;r++){let l=this.args[r].evaluate(e);if(!Oa(this.type,Er(l)))return l;if(r===this.args.length-1)throw new Lr(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${gr(Er(l))} but was expected to be of type ${gr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,r=[e.kind];if(e.kind==="array"){let l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){r.push(l.kind);let f=e.N;(typeof f=="number"||this.args.length>1)&&r.push(f)}}return r.concat(this.args.map(l=>l.serialize()))}}class ka{constructor(e){this.type=Ra,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l=e[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");let f=[],u=!1;for(let p=1;p<=e.length-1;++p){let v=e[p];if(u&&typeof v=="object"&&!Array.isArray(v)){u=!1;let T=null;if(v["font-scale"]&&(T=r.parseObjectValue(v["font-scale"],p,"font-scale",mt),!T))return null;let D=null;if(v["text-font"]&&(D=r.parseObjectValue(v["text-font"],p,"text-font",ni(cn)),!D))return null;let _=null;if(v["text-color"]&&(_=r.parseObjectValue(v["text-color"],p,"text-color",di),!_))return null;let E=f[f.length-1];E.scale=T,E.font=D,E.textColor=_}else{let T=r.parse(e[p],p,dn);if(!T)return null;let D=T.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,f.push({content:T,scale:null,font:null,textColor:null})}}return new ka(f)}evaluate(e){return new Qr(this.sections.map(r=>{let l=r.content.evaluate(e);return Er(l)===Pa?new wi("",l,null,null,null):new wi(ii(l),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(let r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let r of this.sections){e.push(r.content.serialize());let l={};r.scale&&(l["font-scale"]=r.scale.serialize()),r.font&&(l["text-font"]=r.font.serialize()),r.textColor&&(l["text-color"]=r.textColor.serialize()),e.push(l)}return e}}class Ws{constructor(e,r){this.type=Pa,this.inputPrimary=e,this.inputSecondary=r}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let l=r.parse(e[1],1,cn);if(!l)return r.error("No image name provided.");if(e.length===2)return new Ws(l);let f=r.parse(e[2],1,cn);return f?new Ws(l,f):r.error("Secondary image variant is not a string.")}evaluate(e){let r=ri.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&e.availableImages&&(r.available=e.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Zs(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}let pu={"to-boolean":un,"to-color":di,"to-number":mt,"to-string":cn};class Vo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l=e[0],f=[],u=Yi;if(l==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);u=ni(r.expectedType.itemType,p)}else{if(!(p>0&&ys(e[1][0])))return null;u=ni(Er(e[1][0]),p)}for(let v=0;v<p;v++){let T=e[1][v],D;if(Zs(T)==="array")D=r.parse(T,void 0,u.itemType);else{let _=Zs(T);if(_!==u.itemType.kind)return r.error(`Expected ${u.itemType.kind} but found ${_}.`);D=r.registry.literal.parse(["literal",T===void 0?null:T],r)}if(!D)return null;f.push(D)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return r.error("Expected one argument.");u=pu[l];for(let p=1;p<e.length;p++){let v=r.parse(e[p],p,dn);if(!v)return null;f.push(v)}}return new Vo(u,f)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,l;for(let f of this.args){if(r=f.evaluate(e),l=null,r instanceof Rn)return r;if(typeof r=="string"){let u=e.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:im(r[0],r[1],r[2],r[3]),!l))return new Rn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Lr(l||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(let l of this.args){if(r=l.evaluate(e),r===null)return 0;let f=Number(r);if(!isNaN(f))return f}throw new Lr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Qr.fromString(ii(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ri.fromString(ii(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):ii(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ka([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ws(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}let rv=["Unknown","Point","LineString","Polygon"];class om{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-e[0])+this.featureDistanceData.bearing[1]*(f*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Rn.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class fi{constructor(e,r,l,f,u){this.name=e,this.type=r,this._evaluate=l,this.args=f,this._overloadIndex=u}evaluate(e){if(!this._evaluate){let r=fi.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){let l=e[0],f=fi.definitions[l];if(!f)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(f)?f[0]:f.type,p=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,v=[],T=null,D=-1;for(let[_,E]of p){if(Array.isArray(_)&&_.length!==e.length-1)continue;v.push(_),D++,T=new _m(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);let S=[],w=!1;for(let I=1;I<e.length;I++){let M=e[I],L=Array.isArray(_)?_[I-1]:_.type,k=T.parse(M,1+S.length,L);if(!k){w=!0;break}S.push(k)}if(!w)if(Array.isArray(_)&&_.length!==S.length)T.error(`Expected ${_.length} arguments, but found ${S.length} instead.`);else{for(let I=0;I<S.length;I++){let M=Array.isArray(_)?_[I]:_.type,L=S[I];T.concat(I+1).checkSubtype(M,L.type)}if(T.errors.length===0)return new fi(l,u,E,S,D)}}if(v.length===1)r.errors.push(...T.errors);else{let _=(v.length?v:p.map(([S])=>S)).map(iv).join(" | "),E=[];for(let S=1;S<e.length;S++){let w=r.parse(e[S],1+E.length);if(!w)return null;E.push(gr(w.type))}r.error(`Expected arguments of type ${_}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){fi.definitions=r;for(let l in r)e[l]=fi}}function iv(s){return Array.isArray(s)?`(${s.map(gr).join(", ")})`:`(${gr(s.type)}...)`}class mu{constructor(e,r,l){this.type=du,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");let l=e[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");let f=l["case-sensitive"]===void 0?r.parse(!1,1,un):r.parseObjectValue(l["case-sensitive"],1,"case-sensitive",un);if(!f)return null;let u=l["diacritic-sensitive"]===void 0?r.parse(!1,1,un):r.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",un);if(!u)return null;let p=null;return l.locale&&(p=r.parseObjectValue(l.locale,1,"locale",cn),!p)?null:new mu(f,u,p)}evaluate(e){return new fu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function sm(s,e,r=0,l=s.length-1,f=Na){for(;l>r;){if(l-r>600){let T=l-r+1,D=e-r+1,_=Math.log(T),E=.5*Math.exp(2*_/3),S=.5*Math.sqrt(_*E*(T-E)/T)*(D-T/2<0?-1:1);sm(s,e,Math.max(r,Math.floor(e-D*E/T+S)),Math.min(l,Math.floor(e+(T-D)*E/T+S)),f)}let u=s[e],p=r,v=l;for(Fa(s,r,e),f(s[l],u)>0&&Fa(s,r,l);p<v;){for(Fa(s,p,v),p++,v--;f(s[p],u)<0;)p++;for(;f(s[v],u)>0;)v--}f(s[r],u)===0?Fa(s,r,v):(v++,Fa(s,v,l)),v<=e&&(r=v+1),e<=v&&(l=v-1)}}function Fa(s,e,r){let l=s[e];s[e]=s[r],s[r]=l}function Na(s,e){return s<e?-1:s>e?1:0}function ov(s){let e=0;for(let r,l,f=0,u=s.length,p=u-1;f<u;p=f++)r=s[f],l=s[p],e+=(l.x-r.x)*(r.y+l.y);return e}function Xl(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Xs(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function sv(s,e,r){let l=s[0]-e[0],f=s[1]-e[1],u=s[0]-r[0],p=s[1]-r[1];return l*p-u*f==0&&l*u<=0&&f*p<=0}function za(s,e,r=!1){let l=!1;for(let v=0,T=e.length;v<T;v++){let D=e[v];for(let _=0,E=D.length,S=E-1;_<E;S=_++){let w=D[S],I=D[_];if(sv(s,w,I))return r;(u=w)[1]>(f=s)[1]!=(p=I)[1]>f[1]&&f[0]<(p[0]-u[0])*(f[1]-u[1])/(p[1]-u[1])+u[0]&&(l=!l)}}var f,u,p;return l}function am(s,e,r,l){let f=l[0]-r[0],u=l[1]-r[1],p=(s[0]-r[0])*u-f*(s[1]-r[1]),v=(e[0]-r[0])*u-f*(e[1]-r[1]);return p>0&&v<0||p<0&&v>0}function gu(s,e,r,l){return(f=[l[0]-r[0],l[1]-r[1]])[0]*(u=[e[0]-s[0],e[1]-s[1]])[1]-f[1]*u[0]!=0&&!(!am(s,e,r,l)||!am(r,l,s,e));var f,u}let Ei=8192;function Qt(s,e){let r=(180+s[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(r*f*Ei),Math.round(l*f*Ei)]}function It(s,e){for(let r=0;r<e.length;r++)if(za(s,e[r]))return!0;return!1}function fd(s,e,r){for(let l of r)for(let f=0,u=l.length,p=u-1;f<u;p=f++)if(gu(s,e,l[p],l[f]))return!0;return!1}function jt(s,e){for(let r=0;r<s.length;++r)if(!za(s[r],e))return!1;for(let r=0;r<s.length-1;++r)if(fd(s[r],s[r+1],e))return!1;return!0}function pd(s,e){for(let r=0;r<e.length;r++)if(jt(s,e[r]))return!0;return!1}function Yl(s,e,r){let l=[];for(let f=0;f<s.length;f++){let u=[];for(let p=0;p<s[f].length;p++){let v=Qt(s[f][p],r);Xl(e,v),u.push(v)}l.push(u)}return l}function Lt(s,e,r){let l=[];for(let f=0;f<s.length;f++){let u=Yl(s[f],e,r);l.push(u)}return l}function md(s,e,r,l){if(s[0]<r[0]||s[0]>r[2]){let f=.5*l,u=s[0]-r[0]>f?-l:r[0]-s[0]>f?l:0;u===0&&(u=s[0]-r[2]>f?-l:r[2]-s[0]>f?l:0),s[0]+=u}Xl(e,s)}function _u(s,e,r,l){let f=Math.pow(2,l.z)*Ei,u=[l.x*Ei,l.y*Ei],p=[];if(!s)return p;for(let v of s)for(let T of v){let D=[T.x+u[0],T.y+u[1]];md(D,e,r,f),p.push(D)}return p}function gd(s,e,r,l){let f=Math.pow(2,l.z)*Ei,u=[l.x*Ei,l.y*Ei],p=[];if(!s)return p;for(let T of s){let D=[];for(let _ of T){let E=[_.x+u[0],_.y+u[1]];Xl(e,E),D.push(E)}p.push(D)}if(e[2]-e[0]<=f/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let T of p)for(let D of T)md(D,e,r,f)}var v;return p}class vs{constructor(e,r){this.type=un,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ys(e[1])){let l=e[1];if(l.type==="FeatureCollection")for(let f=0;f<l.features.length;++f){let u=l.features[f].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new vs(l,l.features[f].geometry)}else if(l.type==="Feature"){let f=l.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new vs(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new vs(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,l){let f=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(l.type==="Polygon"){let v=Yl(l.coordinates,u,p),T=_u(r.geometry(),f,u,p);if(!Xs(f,u))return!1;for(let D of T)if(!za(D,v))return!1}if(l.type==="MultiPolygon"){let v=Lt(l.coordinates,u,p),T=_u(r.geometry(),f,u,p);if(!Xs(f,u))return!1;for(let D of T)if(!It(D,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,l){let f=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(l.type==="Polygon"){let v=Yl(l.coordinates,u,p),T=gd(r.geometry(),f,u,p);if(!Xs(f,u))return!1;for(let D of T)if(!jt(D,v))return!1}if(l.type==="MultiPolygon"){let v=Lt(l.coordinates,u,p),T=gd(r.geometry(),f,u,p);if(!Xs(f,u))return!1;for(let D of T)if(!pd(D,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Ys={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},$r=1/298.257223563,yu=$r*(2-$r),Ba=Math.PI/180;class Va{static fromTile(e,r,l){let f=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),u=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/Ba;return new Va(u,l)}static get units(){return Ys}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!Ys[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(Ys).join(", ")}`);let l=6378.137*Ba*(r?Ys[r]:1),f=Math.cos(e*Ba),u=1/(1-yu*(1-f*f)),p=Math.sqrt(u);this.kx=l*p*f,this.ky=l*p*u*(1-yu)}distance(e,r){let l=cr(e[0]-r[0])*this.kx,f=(e[1]-r[1])*this.ky;return Math.sqrt(l*l+f*f)}bearing(e,r){let l=cr(r[0]-e[0])*this.kx;return Math.atan2(l,(r[1]-e[1])*this.ky)/Ba}destination(e,r,l){let f=l*Ba;return this.offset(e,Math.sin(f)*r,Math.cos(f)*r)}offset(e,r,l){return[e[0]+r/this.kx,e[1]+l/this.ky]}lineDistance(e){let r=0;for(let l=0;l<e.length-1;l++)r+=this.distance(e[l],e[l+1]);return r}area(e){let r=0;for(let l=0;l<e.length;l++){let f=e[l];for(let u=0,p=f.length,v=p-1;u<p;v=u++)r+=cr(f[u][0]-f[v][0])*(f[u][1]+f[v][1])*(l?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let l=0;if(r<=0)return e[0];for(let f=0;f<e.length-1;f++){let u=e[f],p=e[f+1],v=this.distance(u,p);if(l+=v,l>r)return jo(u,p,(r-(l-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,r,l){let[f,u]=r,p=cr(l[0]-f)*this.kx,v=(l[1]-u)*this.ky;if(p!==0||v!==0){let T=(cr(e[0]-f)*this.kx*p+(e[1]-u)*this.ky*v)/(p*p+v*v);T>1?(f=l[0],u=l[1]):T>0&&(f+=p/this.kx*T,u+=v/this.ky*T)}return p=cr(e[0]-f)*this.kx,v=(e[1]-u)*this.ky,Math.sqrt(p*p+v*v)}pointOnLine(e,r){let l=1/0,f=e[0][0],u=e[0][1],p=0,v=0;for(let T=0;T<e.length-1;T++){let D=e[T][0],_=e[T][1],E=cr(e[T+1][0]-D)*this.kx,S=(e[T+1][1]-_)*this.ky,w=0;E===0&&S===0||(w=(cr(r[0]-D)*this.kx*E+(r[1]-_)*this.ky*S)/(E*E+S*S),w>1?(D=e[T+1][0],_=e[T+1][1]):w>0&&(D+=E/this.kx*w,_+=S/this.ky*w)),E=cr(r[0]-D)*this.kx,S=(r[1]-_)*this.ky;let I=E*E+S*S;I<l&&(l=I,f=D,u=_,p=T,v=w)}return{point:[f,u],index:p,t:Math.max(0,Math.min(1,v))}}lineSlice(e,r,l){let f=this.pointOnLine(l,e),u=this.pointOnLine(l,r);if(f.index>u.index||f.index===u.index&&f.t>u.t){let D=f;f=u,u=D}let p=[f.point],v=f.index+1,T=u.index;!vu(l[v],p[0])&&v<=T&&p.push(l[v]);for(let D=v+1;D<=T;D++)p.push(l[D]);return vu(l[T],u.point)||p.push(u.point),p}lineSliceAlong(e,r,l){let f=0,u=[];for(let p=0;p<l.length-1;p++){let v=l[p],T=l[p+1],D=this.distance(v,T);if(f+=D,f>e&&u.length===0&&u.push(jo(v,T,(e-(f-D))/D)),f>=r)return u.push(jo(v,T,(r-(f-D))/D)),u;f>e&&u.push(T)}return u}bufferPoint(e,r){let l=r/this.ky,f=r/this.kx;return[e[0]-f,e[1]-l,e[0]+f,e[1]+l]}bufferBBox(e,r){let l=r/this.ky,f=r/this.kx;return[e[0]-f,e[1]-l,e[2]+f,e[3]+l]}insideBBox(e,r){return cr(e[0]-r[0])>=0&&cr(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function vu(s,e){return s[0]===e[0]&&s[1]===e[1]}function jo(s,e,r){let l=cr(e[0]-s[0]);return[s[0]+l*r,s[1]+(e[1]-s[1])*r]}function cr(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class _d{constructor(e=[],r=(l,f)=>l<f?-1:l>f?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:r,compare:l}=this,f=r[e];for(;e>0;){let u=e-1>>1,p=r[u];if(l(f,p)>=0)break;r[e]=p,e=u}r[e]=f}_down(e){let{data:r,compare:l}=this,f=this.length>>1,u=r[e];for(;e<f;){let p=1+(e<<1),v=p+1;if(v<this.length&&l(r[v],r[p])<0&&(p=v),l(r[p],u)>=0)break;r[e]=r[p],e=p}r[e]=u}}var ot=8192;function lm(s,e){return e.dist-s.dist}let ja=100,xu=50;function bu(s){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==s[r])return!1;return!0}function wu(s){return s[1]-s[0]+1}function Uo(s,e){let r=s[1]>=s[0]&&s[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function yd(s,e){if(s[0]>s[1])return[null,null];let r=wu(s);if(e){if(r===2)return[s,null];let l=Math.floor(r/2);return[[s[0],s[0]+l],[s[0]+l,s[1]]]}{if(r===1)return[s,null];let l=Math.floor(r/2)-1;return[[s[0],s[0]+l],[s[0]+l+1,s[1]]]}}function Ti(s,e){let r=[1/0,1/0,-1/0,-1/0];if(!Uo(e,s.length))return r;for(let l=e[0];l<=e[1];++l)Xl(r,s[l]);return r}function Eu(s){let e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<s.length;++r)for(let l=0;l<s[r].length;++l)Xl(e,s[r][l]);return e}function Ua(s,e,r){if(bu(s)||bu(e))return NaN;let l=0,f=0;return s[2]<e[0]&&(l=e[0]-s[2]),s[0]>e[2]&&(l=s[0]-e[2]),s[1]>e[3]&&(f=s[1]-e[3]),s[3]<e[1]&&(f=e[1]-s[3]),r.distance([0,0],[l,f])}function cm(s){return 360*s-180}function um(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Ii(s,e){let r=Math.pow(2,e.z),l=(s.y/ot+e.y)/r;return[cm((s.x/ot+e.x)/r),um(l)]}function hm(s,e){let r=[];for(let l=0;l<s.length;++l)r.push(Ii(s[l],e));return r}function vd(s,e,r){let l=r.pointOnLine(e,s).point;return r.distance(s,l)}function xd(s,e,r,l,f){let u=r.slice(l[0],l[1]+1),p=1/0;for(let v=e[0];v<=e[1];++v)if((p=Math.min(p,vd(s[v],u,f)))===0)return 0;return p}function Tu(s,e,r,l,f){let u=Math.min(f.pointToSegmentDistance(s,r,l),f.pointToSegmentDistance(e,r,l)),p=Math.min(f.pointToSegmentDistance(r,s,e),f.pointToSegmentDistance(l,s,e));return Math.min(u,p)}function dm(s,e,r,l,f){if(!Uo(e,s.length)||!Uo(l,r.length))return NaN;let u=1/0;for(let p=e[0];p<e[1];++p)for(let v=l[0];v<l[1];++v){if(gu(s[p],s[p+1],r[v],r[v+1]))return 0;u=Math.min(u,Tu(s[p],s[p+1],r[v],r[v+1],f))}return u}function fm(s,e,r,l,f){if(!Uo(e,s.length)||!Uo(l,r.length))return NaN;let u=1/0;for(let p=e[0];p<=e[1];++p)for(let v=l[0];v<=l[1];++v)if((u=Math.min(u,f.distance(s[p],r[v])))===0)return u;return u}function pm(s,e,r){if(za(s,e,!0))return 0;let l=1/0;for(let f of e){let u=f.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[u-1]&&(l=Math.min(l,r.pointToSegmentDistance(s,f[u-1],f[0])))===0||(l=Math.min(l,vd(s,f,r)))===0)return l}return l}function mm(s,e,r,l){if(!Uo(e,s.length))return NaN;for(let u=e[0];u<=e[1];++u)if(za(s[u],r,!0))return 0;let f=1/0;for(let u=e[0];u<e[1];++u)for(let p of r)for(let v=0,T=p.length,D=T-1;v<T;D=v++){if(gu(s[u],s[u+1],p[D],p[v]))return 0;f=Math.min(f,Tu(s[u],s[u+1],p[D],p[v],l))}return f}function bd(s,e){for(let r of s)for(let l=0;l<=r.length-1;++l)if(za(r[l],e,!0))return!0;return!1}function gm(s,e,r,l=1/0){let f=Eu(s),u=Eu(e);if(l!==1/0&&Ua(f,u,r)>=l)return l;if(Xs(f,u)){if(bd(s,e))return 0}else if(bd(e,s))return 0;let p=l;for(let v of s)for(let T=0,D=v.length,_=D-1;T<D;_=T++)for(let E of e)for(let S=0,w=E.length,I=w-1;S<w;I=S++){if(gu(v[_],v[T],E[I],E[S]))return 0;p=Math.min(p,Tu(v[_],v[T],E[I],E[S],r))}return p}function Jl(s,e,r,l,f,u,p){if(u===null||p===null)return;let v=Ua(Ti(l,u),Ti(f,p),r);v<e&&s.push({dist:v,range1:u,range2:p})}function Iu(s,e,r,l,f=1/0){let u=Math.min(l.distance(s[0],r[0][0]),f);if(u===0)return u;let p=new _d([{dist:0,range1:[0,s.length-1],range2:[0,0]}],lm),v=e?xu:ja,T=Eu(r);for(;p.length;){let D=p.pop();if(D.dist>=u)continue;let _=D.range1;if(wu(_)<=v){if(!Uo(_,s.length))return NaN;if(e){let E=mm(s,_,r,l);if((u=Math.min(u,E))===0)return u}else for(let E=_[0];E<=_[1];++E){let S=pm(s[E],r,l);if((u=Math.min(u,S))===0)return u}}else{let E=yd(_,e);if(E[0]!==null){let S=Ua(Ti(s,E[0]),T,l);S<u&&p.push({dist:S,range1:E[0],range2:[0,0]})}if(E[1]!==null){let S=Ua(Ti(s,E[1]),T,l);S<u&&p.push({dist:S,range1:E[1],range2:[0,0]})}}}return u}function Kl(s,e,r,l,f,u=1/0){let p=Math.min(u,f.distance(s[0],r[0]));if(p===0)return p;let v=new _d([{dist:0,range1:[0,s.length-1],range2:[0,r.length-1]}],lm),T=e?xu:ja,D=l?xu:ja;for(;v.length;){let _=v.pop();if(_.dist>=p)continue;let E=_.range1,S=_.range2;if(wu(E)<=T&&wu(S)<=D){if(!Uo(E,s.length)||!Uo(S,r.length))return NaN;if(e&&l?p=Math.min(p,dm(s,E,r,S,f)):e||l?e&&!l?p=Math.min(p,xd(r,S,s,E,f)):!e&&l&&(p=Math.min(p,xd(s,E,r,S,f))):p=Math.min(p,fm(s,E,r,S,f)),p===0)return p}else{let w=yd(E,e),I=yd(S,l);Jl(v,p,f,s,r,w[0],I[0]),Jl(v,p,f,s,r,w[0],I[1]),Jl(v,p,f,s,r,w[1],I[0]),Jl(v,p,f,s,r,w[1],I[1])}}return p}function $a(s,e,r,l,f=1/0){let u=f,p=Ti(s,[0,s.length-1]);for(let v of r)if(!(u!==1/0&&Ua(p,Ti(v,[0,v.length-1]),l)>=u)&&(u=Math.min(u,Kl(s,e,v,!0,l,u)),u===0))return u;return u}function Ql(s,e,r,l,f=1/0){let u=f,p=Ti(s,[0,s.length-1]);for(let v of r){if(u!==1/0&&Ua(p,Eu(v),l)>=u)continue;let T=Iu(s,e,v,l,u);if(isNaN(T))return T;if((u=Math.min(u,T))===0)return u}return u}function Su(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class xs{constructor(e,r){this.type=mt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ys(e[1])){let l=e[1];if(l.type==="FeatureCollection"){for(let f=0;f<l.features.length;++f)if(Su(l.features[f].geometry.type))return new xs(l,l.features[f].geometry)}else if(l.type==="Feature"){if(Su(l.geometry.type))return new xs(l,l.geometry)}else if(Su(l.type))return new xs(l,l)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let r=e.geometry(),l=e.canonicalID();if(r!=null&&l!=null){if(e.geometryType()==="Point")return function(f,u,p){let v=[];for(let D of f)for(let _ of D)v.push(Ii(_,u));let T=new Va(v[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Kl(v,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",T):p.type==="MultiLineString"?$a(v,!1,p.coordinates,T):p.type==="Polygon"||p.type==="MultiPolygon"?Ql(v,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,T):null}(r,l,this.geometries);if(e.geometryType()==="LineString")return function(f,u,p){let v=[];for(let D of f){let _=[];for(let E of D)_.push(Ii(E,u));v.push(_)}let T=new Va(v[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return $a(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v,T);if(p.type==="MultiLineString"){let D=1/0;for(let _=0;_<p.coordinates.length;_++){let E=$a(p.coordinates[_],!0,v,T,D);if(isNaN(E))return E;if((D=Math.min(D,E))===0)return D}return D}if(p.type==="Polygon"||p.type==="MultiPolygon"){let D=1/0;for(let _=0;_<v.length;_++){let E=Ql(v[_],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,T,D);if(isNaN(E))return E;if((D=Math.min(D,E))===0)return D}return D}return null}(r,l,this.geometries);if(e.geometryType()==="Polygon")return function(f,u,p){let v=[];for(let D of function(_,E){let S=_.length;if(S<=1)return[_];let w=[],I,M;for(let L=0;L<S;L++){let k=ov(_[L]);k!==0&&(_[L].area=Math.abs(k),M===void 0&&(M=k<0),M===k<0?(I&&w.push(I),I=[_[L]]):I.push(_[L]))}return I&&w.push(I),w}(f)){let _=[];for(let E=0;E<D.length;++E)_.push(hm(D[E],u));v.push(_)}let T=new Va(v[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Ql(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v,T);if(p.type==="MultiLineString"){let D=1/0;for(let _=0;_<p.coordinates.length;_++){let E=Ql(p.coordinates[_],!0,v,T,D);if(isNaN(E))return E;if((D=Math.min(D,E))===0)return D}return D}return p.type==="Polygon"||p.type==="MultiPolygon"?function(D,_,E){let S=1/0;for(let w of D)for(let I of _){let M=gm(w,I,E,S);if(isNaN(M))return M;if((S=Math.min(S,M))===0)return S}return S}(p.type==="Polygon"?[p.coordinates]:p.coordinates,v,T):null}(r,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function bs(s,e){switch(s){case"string":return ii(e);case"number":return+e;case"boolean":return!!e;case"color":return Rn.parse(e);case"formatted":return Qr.fromString(ii(e));case"resolvedImage":return ri.fromString(ii(e))}return e}function sn(s,e,r,l){return l!==void 0&&(s=l*Math.round(s/l)),e!==void 0&&s<e&&(s=e),r!==void 0&&s>r&&(s=r),s}class Ga{constructor(e,r,l){this.type=e,this.key=r,this.scope=l}static parse(e,r){let l=r.expectedType;if(l==null&&(l=dn),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");let f=r.parse(e[1],1);if(!(f instanceof Ji))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let u=r.parse(e[2],2);return u instanceof Ji?new Ga(l,ii(f.value),ii(u.value)):r.error("Scope of 'config' expression must be a string literal.")}return new Ga(l,ii(f.value))}evaluate(e){let r=[this.key,this.scope,e.scope].filter(Boolean).join(""),l=e.getConfig(r);if(!l)return null;let{type:f,value:u,values:p,minValue:v,maxValue:T,stepValue:D}=l,_=l.default.evaluate(e),E=_;if(u){let S=e.scope;e.scope=(S||"").split("").slice(1).join(""),E=u.evaluate(e),e.scope=S}return f&&(E=bs(f,E)),E===void 0||v===void 0&&T===void 0&&D===void 0||(typeof E=="number"?E=sn(E,v,T,D):Array.isArray(E)&&(E=E.map(S=>typeof S=="number"?sn(S,v,T,D):S))),u!==void 0&&E!==void 0&&p&&!p.includes(E)&&(E=_,f&&(E=bs(f,E))),(f&&f!==this.type||E!==void 0&&Er(E)!==this.type)&&(E=bs(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function ec(s){if(s instanceof fi&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof vs||s instanceof xs)return!1;let e=!0;return s.eachChild(r=>{e&&!ec(r)&&(e=!1)}),e}function Du(s){if(s instanceof fi&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(r=>{e&&!Du(r)&&(e=!1)}),e}function tc(s){if(s instanceof Ga)return new Set([s.key]);let e=new Set;return s.eachChild(r=>{e=new Set([...e,...tc(r)])}),e}function Ha(s,e){if(s instanceof fi&&e.indexOf(s.name)>=0)return!1;let r=!0;return s.eachChild(l=>{r&&!Ha(l,e)&&(r=!1)}),r}class Vn{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let l=e[1];return r.scope.has(l)?new Vn(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class wd{constructor(e,r=[],l,f=new hu,u=[],p,v){this.registry=e,this.path=r,this.key=r.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=f,this.errors=u,this.expectedType=l,this._scope=p,this.options=v}parse(e,r,l,f,u={}){return r||l?this.concat(r,null,l,f)._parse(e,u):this._parse(e,u)}parseObjectValue(e,r,l,f,u,p={}){return this.concat(r,l,f,u)._parse(e,p)}_parse(e,r){function l(f,u,p){return p==="assert"?new Ki(u,[f]):p==="coerce"?new Vo(u,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let f=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(f){let u=f.parse(e,this);if(!u)return null;if(this.expectedType){let p=this.expectedType,v=u.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||v.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(p,v))return null}else u=l(u,p,r.typeAnnotation||"coerce");else u=l(u,p,r.typeAnnotation||"assert")}if(!(u instanceof Ji)&&u.type.kind!=="resolvedImage"&&Ed(u)){let p=new om(this._scope,this.options);try{u=new Ji(u.type,u.evaluate(p))}catch(v){return this.error(v.message),null}}return u}return Vo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,l,f){let u=typeof e=="number"?this.path.concat(e):this.path;u=typeof r=="string"?u.concat(r):u;let p=f?this.scope.concat(f):this.scope;return new wd(this.registry,u,l||null,p,this.errors,this._scope,this.options)}error(e,...r){let l=`${this.key}${r.map(f=>`[${f}]`).join("")}`;this.errors.push(new Xi(l,e))}checkSubtype(e,r){let l=Oa(e,r);return l&&this.error(l),l}}var _m=wd;function Ed(s){if(s instanceof Vn)return Ed(s.boundExpression);if(s instanceof fi&&s.name==="error"||s instanceof mu||s instanceof vs||s instanceof xs||s instanceof Ga)return!1;let e=s instanceof Vo||s instanceof Ki,r=!0;return s.eachChild(l=>{r=e?r&&Ed(l):r&&l instanceof Ji}),!!r&&ec(s)&&Ha(s,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Cu(s,e){let r=s.length-1,l,f,u=0,p=r,v=0;for(;u<=p;)if(v=Math.floor((u+p)/2),l=s[v],f=s[v+1],l<=e){if(v===r||e<f)return v;u=v+1}else{if(!(l>e))throw new Lr("Input is not a number.");p=v-1}return 0}class nc{constructor(e,r,l){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(let[f,u]of l)this.labels.push(f),this.outputs.push(u)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");let l=r.parse(e[1],1,mt);if(!l)return null;let f=[],u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let p=1;p<e.length;p+=2){let v=p===1?-1/0:e[p],T=e[p+1],D=p,_=p+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);let E=r.parse(T,_,u);if(!E)return null;u=u||E.type,f.push([v,E])}return new nc(u,l,f)}evaluate(e){let r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);let f=this.input.evaluate(e);if(f<=r[0])return l[0].evaluate(e);let u=r.length;return f>=r[u-1]?l[u-1].evaluate(e):l[Cu(r,f)].evaluate(e)}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}let ym=.95047,vm=1.08883,xm=4/29,qa=6/29,bm=3*qa*qa,av=qa*qa*qa,lv=Math.PI/180,cv=180/Math.PI;function Td(s){return s>av?Math.pow(s,1/3):s/bm+xm}function Id(s){return s>qa?s*s*s:bm*(s-xm)}function Sd(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Dd(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function wm(s){let e=Dd(s.r),r=Dd(s.g),l=Dd(s.b),f=Td((.4124564*e+.3575761*r+.1804375*l)/ym),u=Td((.2126729*e+.7151522*r+.072175*l)/1);return{l:116*u-16,a:500*(f-u),b:200*(u-Td((.0193339*e+.119192*r+.9503041*l)/vm)),alpha:s.a}}function Em(s){let e=(s.l+16)/116,r=isNaN(s.a)?e:e+s.a/500,l=isNaN(s.b)?e:e-s.b/200;return e=1*Id(e),r=ym*Id(r),l=vm*Id(l),new Rn(Sd(3.2404542*r-1.5371385*e-.4985314*l),Sd(-.969266*r+1.8760108*e+.041556*l),Sd(.0556434*r-.2040259*e+1.0572252*l),s.alpha)}function uv(s,e,r){let l=e-s;return s+r*(l>180||l<-180?l-360*Math.round(l/360):l)}let rc={forward:wm,reverse:Em,interpolate:function(s,e,r){return{l:Mt(s.l,e.l,r),a:Mt(s.a,e.a,r),b:Mt(s.b,e.b,r),alpha:Mt(s.alpha,e.alpha,r)}}},ic={forward:function(s){let{l:e,a:r,b:l}=wm(s),f=Math.atan2(l,r)*cv;return{h:f<0?f+360:f,c:Math.sqrt(r*r+l*l),l:e,alpha:s.a}},reverse:function(s){let e=s.h*lv,r=s.c;return Em({l:s.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:s.alpha})},interpolate:function(s,e,r){return{h:uv(s.h,e.h,r),c:Mt(s.c,e.c,r),l:Mt(s.l,e.l,r),alpha:Mt(s.alpha,e.alpha,r)}}};var Tm=Object.freeze({__proto__:null,hcl:ic,lab:rc});class Si{constructor(e,r,l,f,u){this.type=e,this.operator=r,this.interpolation=l,this.input=f,this.labels=[],this.outputs=[];for(let[p,v]of u)this.labels.push(p),this.outputs.push(v)}static interpolationFactor(e,r,l,f){let u=0;if(e.name==="exponential")u=Cd(r,e.base,l,f);else if(e.name==="linear")u=Cd(r,1,l,f);else if(e.name==="cubic-bezier"){let p=e.controlPoints;u=new ps(p[0],p[1],p[2],p[3]).solve(Cd(r,1,l,f))}return u}static parse(e,r){let[l,f,u,...p]=e;if(!Array.isArray(f)||f.length===0)return r.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){let D=f[1];if(typeof D!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:D}}else{if(f[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(f[0])}`,1,0);{let D=f.slice(1);if(D.length!==4||D.some(_=>typeof _!="number"||_<0||_>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,mt),!u)return null;let v=[],T=null;l==="interpolate-hcl"||l==="interpolate-lab"?T=di:r.expectedType&&r.expectedType.kind!=="value"&&(T=r.expectedType);for(let D=0;D<p.length;D+=2){let _=p[D],E=p[D+1],S=D+3,w=D+4;if(typeof _!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(v.length&&v[v.length-1][0]>=_)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);let I=r.parse(E,w,T);if(!I)return null;T=T||I.type,v.push([_,I])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new Si(T,l,f,u,v):r.error(`Type ${gr(T)} is not interpolatable.`)}evaluate(e){let r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);let f=this.input.evaluate(e);if(f<=r[0])return l[0].evaluate(e);let u=r.length;if(f>=r[u-1])return l[u-1].evaluate(e);let p=Cu(r,f),v=Si.interpolationFactor(this.interpolation,f,r[p],r[p+1]),T=l[p].evaluate(e),D=l[p+1].evaluate(e);return this.operator==="interpolate"?qs[this.type.kind.toLowerCase()](T,D,v):this.operator==="interpolate-hcl"?ic.reverse(ic.interpolate(ic.forward(T),ic.forward(D),v)):rc.reverse(rc.interpolate(rc.forward(T),rc.forward(D),v))}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let r=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)r.push(this.labels[l],this.outputs[l].serialize());return r}}function Cd(s,e,r,l){let f=l-r,u=s-r;return f===0?0:e===1?u/f:(Math.pow(e,u)-1)/(Math.pow(e,f)-1)}class Mu{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let l=null,f=r.expectedType;f&&f.kind!=="value"&&(l=f);let u=[];for(let v of e.slice(1)){let T=r.parse(v,1+u.length,l,void 0,{typeAnnotation:"omit"});if(!T)return null;l=l||T.type,u.push(T)}let p=f&&u.some(v=>Oa(f,v.type));return new Mu(p?dn:l,u)}evaluate(e){let r,l=null,f=0;for(let u of this.args){if(f++,l=u.evaluate(e),l&&l instanceof ri&&!l.available&&(r||(r=l),l=null,f===this.args.length))return r;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Au{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let l=[];for(let u=1;u<e.length-1;u+=2){let p=e[u];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);let v=r.parse(e[u+1],u+1);if(!v)return null;l.push([p,v])}let f=r.parse(e[e.length-1],e.length-1,r.expectedType,l);return f?new Au(l,f):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[r,l]of this.bindings)e.push(r,l.serialize());return e.push(this.result.serialize()),e}}class Md{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let l=r.parse(e[1],1,mt),f=r.parse(e[2],2,ni(r.expectedType||dn));return l&&f?new Md(f.type.itemType,l,f):null}evaluate(e){let r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new Lr(`Array index out of bounds: ${r} < 0.`);if(r>l.length-1)throw new Lr(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r===Math.floor(r))return l[r];let f=Math.floor(r),u=Math.ceil(r),p=l[f],v=l[u];if(typeof p!="number"||typeof v!="number")throw new Lr(`Cannot interpolate between non-number values at index ${r}.`);let T=r-f;return p*(1-T)+v*T}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ad{constructor(e,r){this.type=un,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let l=r.parse(e[1],1,dn),f=r.parse(e[2],2,dn);return l&&f?La(l.type,[un,cn,mt,Yi,dn])?new Ad(l,f):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${gr(l.type)} instead`):null}evaluate(e){let r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!_o(r,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${gr(Er(r))} instead.`);if(!_o(l,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${gr(Er(l))} instead.`);return l.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ru{constructor(e,r,l){this.type=mt,this.needle=e,this.haystack=r,this.fromIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let l=r.parse(e[1],1,dn),f=r.parse(e[2],2,dn);if(!l||!f)return null;if(!La(l.type,[un,cn,mt,Yi,dn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${gr(l.type)} instead`);if(e.length===4){let u=r.parse(e[3],3,mt);return u?new Ru(l,f,u):null}return new Ru(l,f)}evaluate(e){let r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!_o(r,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${gr(Er(r))} instead.`);if(!_o(l,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${gr(Er(l))} instead.`);if(this.fromIndex){let f=this.fromIndex.evaluate(e);return l.indexOf(r,f)}return l.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Rd{constructor(e,r,l,f,u,p){this.inputType=e,this.type=r,this.input=l,this.cases=f,this.outputs=u,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let l,f;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);let u={},p=[];for(let D=2;D<e.length-1;D+=2){let _=e[D],E=e[D+1];Array.isArray(_)||(_=[_]);let S=r.concat(D);if(_.length===0)return S.error("Expected at least one branch label.");for(let I of _){if(typeof I!="number"&&typeof I!="string")return S.error("Branch labels must be numbers or strings.");if(typeof I=="number"&&Math.abs(I)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof I=="number"&&Math.floor(I)!==I)return S.error("Numeric branch labels must be integer values.");if(l){if(S.checkSubtype(l,Er(I)))return null}else l=Er(I);if(u[String(I)]!==void 0)return S.error("Branch labels must be unique.");u[String(I)]=p.length}let w=r.parse(E,D,f);if(!w)return null;f=f||w.type,p.push(w)}let v=r.parse(e[1],1,dn);if(!v)return null;let T=r.parse(e[e.length-1],e.length-1,f);return T?v.type.kind!=="value"&&r.concat(1).checkSubtype(l,v.type)?null:new Rd(l,f,v,u,p,T):null}evaluate(e){let r=this.input.evaluate(e);return(Er(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),l=[],f={};for(let p of r){let v=f[this.cases[p]];v===void 0?(f[this.cases[p]]=l.length,l.push([this.cases[p],[p]])):l[v][1].push(p)}let u=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,v]of l)e.push(v.length===1?u(v[0]):v.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class oc{constructor(e,r,l){this.type=e,this.branches=r,this.otherwise=l}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);let f=[];for(let p=1;p<e.length-1;p+=2){let v=r.parse(e[p],p,un);if(!v)return null;let T=r.parse(e[p+1],p+1,l);if(!T)return null;f.push([v,T]),l=l||T.type}let u=r.parse(e[e.length-1],e.length-1,l);return u?new oc(l,f,u):null}evaluate(e){for(let[r,l]of this.branches)if(r.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[r,l]of this.branches)e(r),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Pu{constructor(e,r,l,f){this.type=e,this.input=r,this.beginIndex=l,this.endIndex=f}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let l=r.parse(e[1],1,dn),f=r.parse(e[2],2,mt);if(!l||!f)return null;if(!La(l.type,[ni(dn),cn,dn]))return r.error(`Expected first argument to be of type array or string, but found ${gr(l.type)} instead`);if(e.length===4){let u=r.parse(e[3],3,mt);return u?new Pu(l.type,l,f,u):null}return new Pu(l.type,l,f)}evaluate(e){let r=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!_o(r,["string","array"]))throw new Lr(`Expected first argument to be of type array or string, but found ${gr(Er(r))} instead.`);if(this.endIndex){let f=this.endIndex.evaluate(e);return r.slice(l,f)}return r.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Pd(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Im(s,e,r,l){return l.compare(e,r)===0}function Wa(s,e,r){let l=s!=="=="&&s!=="!=";return class HA{constructor(u,p,v){this.type=un,this.lhs=u,this.rhs=p,this.collator=v,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");let v=u[0],T=p.parse(u[1],1,dn);if(!T)return null;if(!Pd(v,T.type))return p.concat(1).error(`"${v}" comparisons are not supported for type '${gr(T.type)}'.`);let D=p.parse(u[2],2,dn);if(!D)return null;if(!Pd(v,D.type))return p.concat(2).error(`"${v}" comparisons are not supported for type '${gr(D.type)}'.`);if(T.type.kind!==D.type.kind&&T.type.kind!=="value"&&D.type.kind!=="value")return p.error(`Cannot compare types '${gr(T.type)}' and '${gr(D.type)}'.`);l&&(T.type.kind==="value"&&D.type.kind!=="value"?T=new Ki(D.type,[T]):T.type.kind!=="value"&&D.type.kind==="value"&&(D=new Ki(T.type,[D])));let _=null;if(u.length===4){if(T.type.kind!=="string"&&D.type.kind!=="string"&&T.type.kind!=="value"&&D.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(_=p.parse(u[3],3,du),!_)return null}return new HA(T,D,_)}evaluate(u){let p=this.lhs.evaluate(u),v=this.rhs.evaluate(u);if(l&&this.hasUntypedArgument){let T=Er(p),D=Er(v);if(T.kind!==D.kind||T.kind!=="string"&&T.kind!=="number")throw new Lr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${T.kind}, ${D.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){let T=Er(p),D=Er(v);if(T.kind!=="string"||D.kind!=="string")return e(u,p,v)}return this.collator?r(u,p,v,this.collator.evaluate(u)):e(u,p,v)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[s];return this.eachChild(p=>{u.push(p.serialize())}),u}}}let hv=Wa("==",function(s,e,r){return e===r},Im),Sm=Wa("!=",function(s,e,r){return e!==r},function(s,e,r,l){return!Im(0,e,r,l)}),Dm=Wa("<",function(s,e,r){return e<r},function(s,e,r,l){return l.compare(e,r)<0}),Za=Wa(">",function(s,e,r){return e>r},function(s,e,r,l){return l.compare(e,r)>0}),Cm=Wa("<=",function(s,e,r){return e<=r},function(s,e,r,l){return l.compare(e,r)<=0}),Mm=Wa(">=",function(s,e,r){return e>=r},function(s,e,r,l){return l.compare(e,r)>=0});class Od{constructor(e,r,l,f,u,p){this.type=cn,this.number=e,this.locale=r,this.currency=l,this.unit=f,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");let l=r.parse(e[1],1,mt);if(!l)return null;let f=e[2];if(typeof f!="object"||Array.isArray(f))return r.error("NumberFormat options argument must be an object.");let u=null;if(f.locale&&(u=r.parseObjectValue(f.locale,2,"locale",cn),!u))return null;let p=null;if(f.currency&&(p=r.parseObjectValue(f.currency,2,"currency",cn),!p))return null;let v=null;if(f.unit&&(v=r.parseObjectValue(f.unit,2,"unit",cn),!v))return null;let T=null;if(f["min-fraction-digits"]&&(T=r.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",mt),!T))return null;let D=null;return f["max-fraction-digits"]&&(D=r.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",mt),!D)?null:new Od(l,u,p,v,T,D)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class sc{constructor(e){this.type=mt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);let l=r.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${gr(l.type)} instead.`):new sc(l):null}evaluate(e){let r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Lr(`Expected value to be of type string or array, but found ${gr(Er(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function Ou(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Xa={"==":hv,"!=":Sm,">":Za,"<":Dm,">=":Mm,"<=":Cm,array:Ki,at:Md,boolean:Ki,case:oc,coalesce:Mu,collator:mu,format:ka,image:Ws,in:Ad,"index-of":Ru,interpolate:Si,"interpolate-hcl":Si,"interpolate-lab":Si,length:sc,let:Au,literal:Ji,match:Rd,number:Ki,"number-format":Od,object:Ki,slice:Pu,step:nc,string:Ki,"to-boolean":Vo,"to-color":Vo,"to-number":Vo,"to-string":Vo,var:Vn,within:vs,distance:xs,config:Ga};function Am(s,[e,r,l,f]){e=e.evaluate(s),r=r.evaluate(s),l=l.evaluate(s);let u=f?f.evaluate(s):1,p=im(e,r,l,u);if(p)throw new Lr(p);return new Rn(e/255*u,r/255*u,l/255*u,u)}function Ld(s,[e,r,l,f]){e=e.evaluate(s),r=r.evaluate(s),l=l.evaluate(s);let u=f?f.evaluate(s):1,p=function(D,_,E,S){return typeof D=="number"&&D>=0&&D<=360?typeof _=="number"&&_>=0&&_<=100&&typeof E=="number"&&E>=0&&E<=100?S===void 0||typeof S=="number"&&S>=0&&S<=1?null:`Invalid hsla value [${[D,_,E,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof S=="number"?[D,_,E,S]:[D,_,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof S=="number"?[D,_,E,S]:[D,_,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,l,u);if(p)throw new Lr(p);let v=`hsla(${e}, ${r}%, ${l}%, ${u})`,T=Rn.parse(v);if(!T)throw new Lr(`Failed to parse HSLA color: ${v}`);return T}function kd(s,e){return s in e}function Fd(s,e){let r=e[s];return r===void 0?null:r}function Js(s){return{type:s}}function Rm(s){return{result:"success",value:s}}function $o(s){return{result:"error",value:s}}function Lu(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function Ks(s){return s["property-type"]==="data-driven"}function Pm(s){return Lu(s.expression,"measure-light")}function Nd(s){return Lu(s.expression,"zoom")}function zd(s){return!!s.expression&&s.expression.interpolated}function Bd(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Om(s){return s}function Vd(s,e){let r=e.type==="color",l=s.stops&&typeof s.stops[0][0]=="object",f=l||!(l||s.property!==void 0),u=s.type||(zd(e)?"exponential":"interval");if(r&&((s=Aa({},s)).stops&&(s.stops=s.stops.map(D=>[D[0],Rn.parse(D[1])])),s.default=Rn.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!Tm[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let p,v,T;if(u==="exponential")p=jd;else if(u==="interval")p=fv;else if(u==="categorical"){p=dv,v=Object.create(null);for(let D of s.stops)v[D[0]]=D[1];T=typeof s.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=pv}if(l){let D={},_=[];for(let w=0;w<s.stops.length;w++){let I=s.stops[w],M=I[0].zoom;D[M]===void 0&&(D[M]={zoom:M,type:s.type,property:s.property,default:s.default,stops:[]},_.push(M)),D[M].stops.push([I[0].value,I[1]])}let E=[];for(let w of _)E.push([D[w].zoom,Vd(D[w],e)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:Si.interpolationFactor.bind(void 0,S),zoomStops:E.map(w=>w[0]),evaluate:({zoom:w},I)=>jd({stops:E,base:s.base},e,w).evaluate(w,I)}}if(f){let D=u==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Si.interpolationFactor.bind(void 0,D),zoomStops:s.stops.map(_=>_[0]),evaluate:({zoom:_})=>p(s,e,_,v,T)}}return{kind:"source",evaluate(D,_){let E=_&&_.properties?_.properties[s.property]:void 0;return E===void 0?ac(s.default,e.default):p(s,e,E,v,T)}}}function ac(s,e,r){return s!==void 0?s:e!==void 0?e:r!==void 0?r:void 0}function dv(s,e,r,l,f){return ac(typeof r===f?l[r]:void 0,s.default,e.default)}function fv(s,e,r){if(Zs(r)!=="number")return ac(s.default,e.default);let l=s.stops.length;if(l===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[l-1][0])return s.stops[l-1][1];let f=Cu(s.stops.map(u=>u[0]),r);return s.stops[f][1]}function jd(s,e,r){let l=s.base!==void 0?s.base:1;if(Zs(r)!=="number")return ac(s.default,e.default);let f=s.stops.length;if(f===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[f-1][0])return s.stops[f-1][1];let u=Cu(s.stops.map(_=>_[0]),r),p=function(_,E,S,w){let I=w-S,M=_-S;return I===0?0:E===1?M/I:(Math.pow(E,M)-1)/(Math.pow(E,I)-1)}(r,l,s.stops[u][0],s.stops[u+1][0]),v=s.stops[u][1],T=s.stops[u+1][1],D=qs[e.type]||Om;if(s.colorSpace&&s.colorSpace!=="rgb"){let _=Tm[s.colorSpace];D=(E,S)=>_.reverse(_.interpolate(_.forward(E),_.forward(S),p))}return typeof v.evaluate=="function"?{evaluate(..._){let E=v.evaluate.apply(void 0,_),S=T.evaluate.apply(void 0,_);if(E!==void 0&&S!==void 0)return D(E,S,p)}}:D(v,T,p)}function pv(s,e,r){return e.type==="color"?r=Rn.parse(r):e.type==="formatted"?r=Qr.fromString(r.toString()):e.type==="resolvedImage"?r=ri.fromString(r.toString()):Zs(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),ac(r,s.default,e.default)}fi.register(Xa,{error:[{kind:"error"},[cn],(s,[e])=>{throw new Lr(e.evaluate(s))}],typeof:[cn,[dn],(s,[e])=>gr(Er(e.evaluate(s)))],"to-rgba":[ni(mt,4),[di],(s,[e])=>e.evaluate(s).toRenderColor(null).toArray()],rgb:[di,[mt,mt,mt],Am],rgba:[di,[mt,mt,mt,mt],Am],hsl:[di,[mt,mt,mt],Ld],hsla:[di,[mt,mt,mt,mt],Ld],has:{type:un,overloads:[[[cn],(s,[e])=>kd(e.evaluate(s),s.properties())],[[cn,Kr],(s,[e,r])=>kd(e.evaluate(s),r.evaluate(s))]]},get:{type:dn,overloads:[[[cn],(s,[e])=>Fd(e.evaluate(s),s.properties())],[[cn,Kr],(s,[e,r])=>Fd(e.evaluate(s),r.evaluate(s))]]},"feature-state":[dn,[cn],(s,[e])=>Fd(e.evaluate(s),s.featureState||{})],properties:[Kr,[],s=>s.properties()],"geometry-type":[cn,[],s=>s.geometryType()],id:[dn,[],s=>s.id()],zoom:[mt,[],s=>s.globals.zoom],pitch:[mt,[],s=>s.globals.pitch||0],"distance-from-center":[mt,[],s=>s.distanceFromCenter()],"measure-light":[mt,[cn],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[mt,[],s=>s.globals.heatmapDensity||0],"line-progress":[mt,[],s=>s.globals.lineProgress||0],"raster-value":[mt,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[mt,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[mt,[],s=>s.globals.skyRadialProgress||0],accumulated:[dn,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[mt,Js(mt),(s,e)=>{let r=0;for(let l of e)r+=l.evaluate(s);return r}],"*":[mt,Js(mt),(s,e)=>{let r=1;for(let l of e)r*=l.evaluate(s);return r}],"-":{type:mt,overloads:[[[mt,mt],(s,[e,r])=>e.evaluate(s)-r.evaluate(s)],[[mt],(s,[e])=>-e.evaluate(s)]]},"/":[mt,[mt,mt],(s,[e,r])=>e.evaluate(s)/r.evaluate(s)],"%":[mt,[mt,mt],(s,[e,r])=>e.evaluate(s)%r.evaluate(s)],ln2:[mt,[],()=>Math.LN2],pi:[mt,[],()=>Math.PI],e:[mt,[],()=>Math.E],"^":[mt,[mt,mt],(s,[e,r])=>Math.pow(e.evaluate(s),r.evaluate(s))],sqrt:[mt,[mt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[mt,[mt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[mt,[mt],(s,[e])=>Math.log(e.evaluate(s))],log2:[mt,[mt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[mt,[mt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[mt,[mt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[mt,[mt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[mt,[mt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[mt,[mt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[mt,[mt],(s,[e])=>Math.atan(e.evaluate(s))],min:[mt,Js(mt),(s,e)=>Math.min(...e.map(r=>r.evaluate(s)))],max:[mt,Js(mt),(s,e)=>Math.max(...e.map(r=>r.evaluate(s)))],abs:[mt,[mt],(s,[e])=>Math.abs(e.evaluate(s))],round:[mt,[mt],(s,[e])=>{let r=e.evaluate(s);return r<0?-Math.round(-r):Math.round(r)}],floor:[mt,[mt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[mt,[mt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[un,[cn,dn],(s,[e,r])=>s.properties()[e.value]===r.value],"filter-id-==":[un,[dn],(s,[e])=>s.id()===e.value],"filter-type-==":[un,[cn],(s,[e])=>s.geometryType()===e.value],"filter-<":[un,[cn,dn],(s,[e,r])=>{let l=s.properties()[e.value],f=r.value;return typeof l==typeof f&&l<f}],"filter-id-<":[un,[dn],(s,[e])=>{let r=s.id(),l=e.value;return typeof r==typeof l&&r<l}],"filter->":[un,[cn,dn],(s,[e,r])=>{let l=s.properties()[e.value],f=r.value;return typeof l==typeof f&&l>f}],"filter-id->":[un,[dn],(s,[e])=>{let r=s.id(),l=e.value;return typeof r==typeof l&&r>l}],"filter-<=":[un,[cn,dn],(s,[e,r])=>{let l=s.properties()[e.value],f=r.value;return typeof l==typeof f&&l<=f}],"filter-id-<=":[un,[dn],(s,[e])=>{let r=s.id(),l=e.value;return typeof r==typeof l&&r<=l}],"filter->=":[un,[cn,dn],(s,[e,r])=>{let l=s.properties()[e.value],f=r.value;return typeof l==typeof f&&l>=f}],"filter-id->=":[un,[dn],(s,[e])=>{let r=s.id(),l=e.value;return typeof r==typeof l&&r>=l}],"filter-has":[un,[dn],(s,[e])=>e.value in s.properties()],"filter-has-id":[un,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[un,[ni(cn)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[un,[ni(dn)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[un,[cn,ni(dn)],(s,[e,r])=>r.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[un,[cn,ni(dn)],(s,[e,r])=>function(l,f,u,p){for(;u<=p;){let v=u+p>>1;if(f[v]===l)return!0;f[v]>l?p=v-1:u=v+1}return!1}(s.properties()[e.value],r.value,0,r.value.length-1)],all:{type:un,overloads:[[[un,un],(s,[e,r])=>e.evaluate(s)&&r.evaluate(s)],[Js(un),(s,e)=>{for(let r of e)if(!r.evaluate(s))return!1;return!0}]]},any:{type:un,overloads:[[[un,un],(s,[e,r])=>e.evaluate(s)||r.evaluate(s)],[Js(un),(s,e)=>{for(let r of e)if(r.evaluate(s))return!0;return!1}]]},"!":[un,[un],(s,[e])=>!e.evaluate(s)],"is-supported-script":[un,[cn],(s,[e])=>{let r=s.globals&&s.globals.isSupportedScript;return!r||r(e.evaluate(s))}],upcase:[cn,[cn],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[cn,[cn],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[cn,Js(dn),(s,e)=>e.map(r=>ii(r.evaluate(s))).join("")],"resolved-locale":[cn,[du],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[mt,[mt,mt,dn],(s,e)=>{let[r,l,f]=e.map(p=>p.evaluate(s));if(r>l||r===l)return r;let u;if(typeof f=="string")u=function(p){let v=0;if(p.length===0)return v;for(let T=0;T<p.length;T++)v=(v<<5)-v+p.charCodeAt(T),v|=0;return v}(f);else{if(typeof f!="number")throw new Lr(`Invalid seed input: ${f}`);u=f}return r+Ou(u)()*(l-r)}]});class Ud{constructor(e,r,l,f){this.expression=e,this._warningHistory={},this._evaluator=new om(l,f),this._defaultValue=r?function(u){return u.type==="color"&&(Bd(u.default)||Array.isArray(u.default))?new Rn(0,0,0,0):u.type==="color"?Rn.parse(u.default)||null:u.default===void 0?null:u.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=tc(e)}evaluateWithoutErrorHandling(e,r,l,f,u,p,v,T){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=f||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,l,f,u,p,v,T){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=T||null;try{let D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Lr(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${D.message}`)),this._defaultValue}}}function ku(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Xa}function Ya(s,e,r,l){let f=new _m(Xa,[],e?function(p){let v={color:di,string:cn,number:mt,enum:cn,boolean:un,formatted:Ra,resolvedImage:Pa};return p.type==="array"?ni(v[p.value]||dn,p.length):v[p.type]}(e):void 0,void 0,void 0,r,l),u=f.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Rm(new Ud(u,e,r,l)):$o(f.errors)}class Fu{constructor(e,r,l){this.kind=e,this._styleExpression=r,this.isLightConstant=l,this.isStateDependent=e!=="constant"&&!Du(r.expression),this.configDependencies=tc(r.expression)}evaluateWithoutErrorHandling(e,r,l,f,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,f,u,p)}evaluate(e,r,l,f,u,p){return this._styleExpression.evaluate(e,r,l,f,u,p)}}class lc{constructor(e,r,l,f,u){this.kind=e,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Du(r.expression),this.isLightConstant=u,this.configDependencies=tc(r.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,r,l,f,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,f,u,p)}evaluate(e,r,l,f,u,p){return this._styleExpression.evaluate(e,r,l,f,u,p)}interpolationFactor(e,r,l){return this.interpolationType?Si.interpolationFactor(this.interpolationType,e,r,l):0}}function Qs(s,e,r,l){if((s=Ya(s,e,r,l)).result==="error")return s;let f=s.value.expression,u=ec(f);if(!u&&!Ks(e))return $o([new Xi("","data expressions not supported")]);let p=Ha(f,["zoom","pitch","distance-from-center"]);if(!p&&!Nd(e))return $o([new Xi("","zoom expressions not supported")]);let v=Ha(f,["measure-light"]);if(!v&&!Pm(e))return $o([new Xi("","measure-light expression not supported")]);let T=Ha(f,["line-progress"]);if(!T&&!function(E){return Lu(E.expression,"line-progress")}(e))return $o([new Xi("","line-progress expression not supported")]);let D=e.expression&&e.expression.relaxZoomRestriction,_=zu(f);return _||p||D?_ instanceof Xi?$o([_]):_ instanceof Si&&!zd(e)?$o([new Xi("",'"interpolate" expressions cannot be used with this property')]):Rm(_?new lc(u&&T?"camera":"composite",s.value,_.labels,_ instanceof Si?_.interpolation:void 0,v):new Fu(u&&T?"constant":"source",s.value,v)):$o([new Xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Nu{constructor(e,r){this._parameters=e,this._specification=r,Aa(this,Vd(this._parameters,this._specification))}static deserialize(e){return new Nu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function zu(s){let e=null;if(s instanceof Au)e=zu(s.result);else if(s instanceof Mu){for(let r of s.args)if(e=zu(r),e)break}else(s instanceof nc||s instanceof Si)&&s.input instanceof fi&&s.input.name==="zoom"&&(e=s);return e instanceof Xi||s.eachChild(r=>{let l=zu(r);l instanceof Xi?e=l:e&&l&&e!==l&&(e=new Xi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var $d,Gd,Lm=function(){if(Gd)return $d;Gd=1,$d=e;var s=3;function e(r,l,f){var u=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var p=new Int32Array(this.arrayBuffer);r=p[0],this.d=(l=p[1])+2*(f=p[2]);for(var v=0;v<this.d*this.d;v++){var T=p[s+v],D=p[s+v+1];u.push(T===D?null:p.subarray(T,D))}var _=p[s+u.length+1];this.keys=p.subarray(p[s+u.length],_),this.bboxes=p.subarray(_),this.insert=this._insertReadonly}else{this.d=l+2*f;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=r,this.padding=f,this.scale=l/r,this.uid=0;var S=f/l*r;this.min=-S,this.max=r+S}return e.prototype.insert=function(r,l,f,u,p){this._forEachCell(l,f,u,p,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(u),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,l,f,u,p,v){this.cells[p].push(v)},e.prototype.query=function(r,l,f,u,p){var v=this.min,T=this.max;if(r<=v&&l<=v&&T<=f&&T<=u&&!p)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(r,l,f,u,this._queryCell,D,{},p),D},e.prototype._queryCell=function(r,l,f,u,p,v,T,D){var _=this.cells[p];if(_!==null)for(var E=this.keys,S=this.bboxes,w=0;w<_.length;w++){var I=_[w];if(T[I]===void 0){var M=4*I;(D?D(S[M+0],S[M+1],S[M+2],S[M+3]):r<=S[M+2]&&l<=S[M+3]&&f>=S[M+0]&&u>=S[M+1])?(T[I]=!0,v.push(E[I])):T[I]=!1}}},e.prototype._forEachCell=function(r,l,f,u,p,v,T,D){for(var _=this._convertToCellCoord(r),E=this._convertToCellCoord(l),S=this._convertToCellCoord(f),w=this._convertToCellCoord(u),I=_;I<=S;I++)for(var M=E;M<=w;M++){var L=this.d*M+I;if((!D||D(this._convertFromCellCoord(I),this._convertFromCellCoord(M),this._convertFromCellCoord(I+1),this._convertFromCellCoord(M+1)))&&p.call(this,r,l,f,u,L,v,T,D))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,l=s+this.cells.length+1+1,f=0,u=0;u<this.cells.length;u++)f+=this.cells[u].length;var p=new Int32Array(l+f+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var v=l,T=0;T<r.length;T++){var D=r[T];p[s+T]=v,p.set(D,v),v+=D.length}return p[s+r.length]=v,p.set(this.keys,v),p[s+r.length+1]=v+=this.keys.length,p.set(this.bboxes,v),v+=this.bboxes.length,p.buffer},$d}(),ea=P(Lm);let cc={};function ht(s,e,r={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),cc[e]={klass:s,omit:r.omit||[]}}ht(Object,"Object"),ea.serialize=function(s,e){let r=s.toArrayBuffer();return e&&e.add(r),{buffer:r}},ea.deserialize=function(s){return new ea(s.buffer)},Object.defineProperty(ea,"name",{value:"Grid"}),ht(ea,"Grid"),ht(Rn,"Color"),ht(Error,"Error"),ht(Qr,"Formatted"),ht(wi,"FormattedSection"),ht(od,"AJAXError"),ht(ri,"ResolvedImage"),ht(Nu,"StylePropertyFunction"),ht(Ud,"StyleExpression",{omit:["_evaluator"]}),ht(lc,"ZoomDependentExpression"),ht(Fu,"ZoomConstantExpression"),ht(fi,"CompoundExpression",{omit:["_evaluate"]});for(let s in Xa)cc[Xa[s]._classRegistryKey]||ht(Xa[s],`Expression${s}`);function Bu(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Hd(s){return self.ImageBitmap&&s instanceof ImageBitmap}function ta(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Bu(s)||Hd(s))return e&&e.add(s),s;if(ArrayBuffer.isView(s)){let r=s;return e&&e.add(r.buffer),r}if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){let r=[];for(let l of s)r.push(ta(l,e));return r}if(s instanceof Map){let r={$name:"Map"};for(let[l,f]of s.entries())r[l]=ta(f);return r}if(s instanceof Set){let r={$name:"Set"},l=0;for(let f of s.values())r[++l]=ta(f);return r}if(typeof s=="object"){let r=s.constructor,l=r._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);let f=r.serialize?r.serialize(s,e):{};if(!r.serialize){for(let u in s)s.hasOwnProperty(u)&&(cc[l].omit.indexOf(u)>=0||(f[u]=ta(s[u],e)));s instanceof Error&&(f.message=s.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(f.$name=l),f}throw new Error("can't serialize object of type "+typeof s)}function ws(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Bu(s)||Hd(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(ws);if(typeof s=="object"){let e=s.$name||"Object";if(e==="Map"){let f=new Map;for(let u of Object.keys(s))u!=="$name"&&f.set(u,ws(s[u]));return f}if(e==="Set"){let f=new Set;for(let u of Object.keys(s))u!=="$name"&&f.add(ws(s[u]));return f}let{klass:r}=cc[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(s);let l=Object.create(r.prototype);for(let f of Object.keys(s))f!=="$name"&&(l[f]=ws(s[f]));return l}throw new Error("can't deserialize object of type "+typeof s)}let vt={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function qd(s){for(let e of s)if(Ja(e.charCodeAt(0)))return!0;return!1}function km(s){for(let e of s)if(!mv(e.charCodeAt(0)))return!1;return!0}function mv(s){return!(vt.Arabic(s)||vt["Arabic Supplement"](s)||vt["Arabic Extended-A"](s)||vt["Arabic Presentation Forms-A"](s)||vt["Arabic Presentation Forms-B"](s))}function Ja(s){return!(s!==746&&s!==747&&(s<4352||!(vt["Bopomofo Extended"](s)||vt.Bopomofo(s)||vt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||vt["CJK Compatibility Ideographs"](s)||vt["CJK Compatibility"](s)||vt["CJK Radicals Supplement"](s)||vt["CJK Strokes"](s)||!(!vt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||vt["CJK Unified Ideographs Extension A"](s)||vt["CJK Unified Ideographs"](s)||vt["Enclosed CJK Letters and Months"](s)||vt["Hangul Compatibility Jamo"](s)||vt["Hangul Jamo Extended-A"](s)||vt["Hangul Jamo Extended-B"](s)||vt["Hangul Jamo"](s)||vt["Hangul Syllables"](s)||vt.Hiragana(s)||vt["Ideographic Description Characters"](s)||vt.Kanbun(s)||vt["Kangxi Radicals"](s)||vt["Katakana Phonetic Extensions"](s)||vt.Katakana(s)&&s!==12540||!(!vt["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!vt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||vt["Unified Canadian Aboriginal Syllabics"](s)||vt["Unified Canadian Aboriginal Syllabics Extended"](s)||vt["Vertical Forms"](s)||vt["Yijing Hexagram Symbols"](s)||vt["Yi Syllables"](s)||vt["Yi Radicals"](s))))}function Wd(s){return!(Ja(s)||function(e){return!!(vt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||vt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||vt["Letterlike Symbols"](e)||vt["Number Forms"](e)||vt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||vt["Control Pictures"](e)&&e!==9251||vt["Optical Character Recognition"](e)||vt["Enclosed Alphanumerics"](e)||vt["Geometric Shapes"](e)||vt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||vt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||vt["CJK Symbols and Punctuation"](e)||vt.Katakana(e)||vt["Private Use Area"](e)||vt["CJK Compatibility Forms"](e)||vt["Small Form Variants"](e)||vt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function uc(s){return s>=1424&&s<=2303||vt["Arabic Presentation Forms-A"](s)||vt["Arabic Presentation Forms-B"](s)}function Fm(s,e){return!(!e&&uc(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||vt.Khmer(s))}function gv(s){for(let e of s)if(uc(e.charCodeAt(0)))return!0;return!1}let Zd="deferred",hc="loading",dc="loaded",Vu=null,Gr="unavailable",Di=null,Nm=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(Gr="error"),Vu&&Vu(s)};function Xd(){Yd.fire(new _s("pluginStateChange",{pluginStatus:Gr,pluginURL:Di}))}let Yd=new Ma,Jd=function(){return Gr},zm=function(){if(Gr!==Zd||!Di)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gr=hc,Xd(),Di&&Da({url:Di},s=>{s?Nm(s):(Gr=dc,Xd())})},Ci={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gr===dc||Ci.applyArabicShaping!=null,isLoading:()=>Gr===hc,setState(s){Gr=s.pluginStatus,Di=s.pluginURL},isParsed:()=>Ci.applyArabicShaping!=null&&Ci.processBidirectionalText!=null&&Ci.processStyledBidirectionalText!=null,getPluginURL:()=>Di};class ar{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,l){for(let f of r)if(!Fm(f.charCodeAt(0),l))return!1;return!0}(e,Ci.isLoaded())}}class ju{constructor(e,r,l,f){this.property=e,this.value=r,this.expression=function(u,p,v,T){if(Bd(u))return new Nu(u,p);if(ku(u)||Array.isArray(u)&&u.length>0){let D=Qs(u,p,v,T);if(D.result==="error")throw new Error(D.value.map(_=>`${_.key}: ${_.message}`).join(", "));return D.value}{let D=u;return typeof u=="string"&&p.type==="color"&&(D=Rn.parse(u)),{kind:"constant",configDependencies:new Set,evaluate:()=>D}}}(r===void 0?e.specification.default:r,e.specification,l,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,l){return this.property.possiblyEvaluate(this,e,r,l)}}class Kd{constructor(e,r,l){this.property=e,this.value=new ju(e,void 0,r,l)}transitioned(e,r){return new Vm(this.property,this.value,r,Jr({},e.transition,this.transition),e.now)}untransitioned(){return new Vm(this.property,this.value,null,{},0)}}class Bm{constructor(e,r,l){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=l,this.configDependencies=new Set}getValue(e){return ki(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Kd(this._values[e].property,this._scope,this._options)),this._values[e].value=new ju(this._values[e].property,r===null?void 0:ki(r),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);let l=this._properties.properties;if(e)for(let f in e){let u=e[f];if(Bo(f,"-transition")){let p=f.slice(0,-11);l[p]&&this.setTransition(p,u)}else l.hasOwnProperty(f)&&this.setValue(f,u)}}getTransition(e){return ki(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Kd(this._values[e].property)),this._values[e].transition=ki(r)||void 0}serialize(){let e={};for(let r of Object.keys(this._values)){let l=this.getValue(r);l!==void 0&&(e[r]=l);let f=this.getTransition(r);f!==void 0&&(e[`${r}-transition`]=f)}return e}transitioned(e,r){let l=new jm(this._properties);for(let f of Object.keys(this._values))l._values[f]=this._values[f].transitioned(e,r._values[f]);return l}untransitioned(){let e=new jm(this._properties);for(let r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Vm{constructor(e,r,l,f,u){let p=f.delay||0,v=f.duration||0;u=u||0,this.property=e,this.value=r,this.begin=u+p,this.end=this.begin+v,e.specification.transition&&(f.delay||f.duration)&&(this.prior=l)}possiblyEvaluate(e,r,l){let f=e.now||0,u=this.value.possiblyEvaluate(e,r,l),p=this.prior;if(p){if(f>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(f<this.begin)return p.possiblyEvaluate(e,r,l);{let v=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,l),u,Us(v))}}return u}}class jm{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,l){let f=new Qa(this._properties);for(let u of Object.keys(this._values))f._values[u]=this._values[u].possiblyEvaluate(e,r,l);return f}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class _v{constructor(e,r,l){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=l,this.configDependencies=new Set}getValue(e){return ki(this._values[e].value)}setValue(e,r){this._values[e]=new ju(this._values[e].property,r===null?void 0:ki(r),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){let e={};for(let r of Object.keys(this._values)){let l=this.getValue(r);l!==void 0&&(e[r]=l)}return e}possiblyEvaluate(e,r,l){let f=new Qa(this._properties);for(let u of Object.keys(this._values))f._values[u]=this._values[u].possiblyEvaluate(e,r,l);return f}}class Ka{constructor(e,r,l){this.property=e,this.value=r,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,l,f){return this.property.evaluate(this.value,this.parameters,e,r,l,f)}}class Qa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class tt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,l){let f=qs[this.specification.type];return f?f(e,r,l):e}}class xt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,l,f){return new Ka(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},l,f)}:e.expression,r)}interpolate(e,r,l){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Ka(this,{kind:"constant",value:void 0},e.parameters);let f=qs[this.specification.type];return f?new Ka(this,{kind:"constant",value:f(e.value.value,r.value.value,l)},e.parameters):e}evaluate(e,r,l,f,u,p){return e.kind==="constant"?e.value:e.evaluate(r,l,f,u,p)}}class el{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,f){return!!e.expression.evaluate(r,null,{},l,f)}interpolate(){return!1}}class Zn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let r=new ar(0,{});for(let l in e){let f=e[l];f.specification.overridable&&this.overridableProperties.push(l);let u=this.defaultPropertyValues[l]=new ju(f,void 0),p=this.defaultTransitionablePropertyValues[l]=new Kd(f);this.defaultTransitioningPropertyValues[l]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=u.possiblyEvaluate(r)}}}ht(xt,"DataDrivenProperty"),ht(tt,"DataConstantProperty"),ht(el,"ColorRampProperty");var Ae=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,90],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"rain":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Qd(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function na(s){if(Array.isArray(s))return s.map(na);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){let e={};for(let r in s)e[r]=na(s[r]);return e}return Qd(s)}function ef(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(let e of s.slice(1))if(!ef(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Uu(s,e="",r=null,l="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ef(s)||(s=$u(s));let f=s,u=!0;try{u=function(_){if(!Qi(_))return _;let E=na(_);return tf(E),E=Go(E),E}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let p=null,v=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){v=Ae[`filter_${l}`];let _=Ya(u,v,e,r);if(_.result==="error")throw new Error(_.value.map(E=>`${E.key}: ${E.message}`).join(", "));p=(E,S,w)=>_.value.evaluate(E,S,{},w)}let T=null,D=null;if(u!==f){let _=Ya(f,v,e,r);if(_.result==="error")throw new Error(_.value.map(E=>`${E.key}: ${E.message}`).join(", "));T=(E,S,w,I,M)=>_.value.evaluate(E,S,{},w,void 0,void 0,I,M),D=!ec(_.value.expression)}return{filter:p,dynamicFilter:T||void 0,needGeometry:Um(u),needFeature:!!D}}function Go(s){if(!Array.isArray(s))return s;let e=function(r){if(yv.has(r[0])){for(let l=1;l<r.length;l++)if(Qi(r[l]))return!0}return r}(s);return e===!0?e:e.map(r=>Go(r))}function tf(s){let e=!1,r=[];if(s[0]==="case"){for(let l=1;l<s.length-1;l+=2)e=e||Qi(s[l]),r.push(s[l+1]);r.push(s[s.length-1])}else if(s[0]==="match"){e=e||Qi(s[1]);for(let l=2;l<s.length-1;l+=2)r.push(s[l+1]);r.push(s[s.length-1])}else if(s[0]==="step"){e=e||Qi(s[1]);for(let l=1;l<s.length-1;l+=2)r.push(s[l+1])}e&&(s.length=0,s.push("any",...r));for(let l=1;l<s.length;l++)tf(s[l])}function Qi(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<s.length;r++)if(Qi(s[r]))return!0;return!1}let yv=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function vv(s,e){return s<e?-1:s>e?1:0}function Um(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(Um(s[e]))return!0;return!1}function $u(s){if(!s)return!0;let e=s[0];return s.length<=1?e!=="any":e==="=="?nf(s[1],s[2],"=="):e==="!="?ra(nf(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?nf(s[1],s[2],e):e==="any"?(r=s.slice(1),["any"].concat(r.map($u))):e==="all"?["all"].concat(s.slice(1).map($u)):e==="none"?["all"].concat(s.slice(1).map($u).map(ra)):e==="in"?rf(s[1],s.slice(2)):e==="!in"?ra(rf(s[1],s.slice(2))):e==="has"?Gu(s[1]):e!=="!has"||ra(Gu(s[1]));var r}function nf(s,e,r){switch(s){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,s,e]}}function rf(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",s,["literal",e.sort(vv)]]:["filter-in-small",s,["literal",e]]}}function Gu(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function ra(s){return["!",s]}let fc="";function Hu(s,e){return e?`${s}${fc}${e}`:s}let $m="-transition",yo=new Set(["fill","line","background","hillshade","raster"]);class oi extends Ma{constructor(e,r,l,f,u){if(super(),this.id=e.id,this.fqid=Hu(this.id,l),this.type=e.type,this.scope=l,this.lut=f,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;let p=Ya(this.filter,Ae[`filter_${e.type}`]);p.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...p.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new _v(r.layout,this.scope,u),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new Bm(r.paint,this.scope,u);for(let p in e.paint)this.setPaintProperty(p,e.paint[p]);for(let p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qa(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&yo.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);let l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return Bo(e,$m)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){let l=this._transitionablePaint,f=l._properties.properties;if(Bo(e,$m)){let E=e.slice(0,-11);return f[E]&&l.setTransition(E,r||void 0),!1}if(!f[e])return!1;let u=l._values[e],p=u.value.isDataDriven(),v=u.value;l.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);let T=l._values[e].value,D=T.isDataDriven(),_=Bo(e,"pattern")||e==="line-dasharray";return D||p||_||this._handleOverridablePaintPropertyUpdate(e,v,T)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,l){return null}_handleOverridablePaintPropertyUpdate(e,r,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return Ta({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let r=this.paint.get(e);if(r instanceof Ka&&Ks(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Uu(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,l,f,u,p,v,T,D){}queryIntersectsMatchingFeature(e,r,l,f){}}let Gm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class pc{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function gn(s,e=1){let r=0,l=0;return{members:s.map(f=>{let u=Gm[f.type].BYTES_PER_ELEMENT,p=r=Hm(r,Math.max(e,u)),v=f.components||1;return l=Math.max(l,u),r+=u*v,{name:f.name,type:f.type,components:v,offset:p}}),size:Hm(r,Math.max(l,e)),alignment:e}}function Hm(s,e){return Math.ceil(s/e)*e}class Es extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){let l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){let f=2*e;return this.int16[f+0]=r,this.int16[f+1]=l,e}}Es.prototype.bytesPerElement=4,ht(Es,"StructArrayLayout2i4");class qu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){let f=this.length;return this.resize(f+1),this.emplace(f,e,r,l)}emplace(e,r,l,f){let u=3*e;return this.int16[u+0]=r,this.int16[u+1]=l,this.int16[u+2]=f,e}}qu.prototype.bytesPerElement=6,ht(qu,"StructArrayLayout3i6");class tl extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,f){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,l,f)}emplace(e,r,l,f,u){let p=4*e;return this.int16[p+0]=r,this.int16[p+1]=l,this.int16[p+2]=f,this.int16[p+3]=u,e}}tl.prototype.bytesPerElement=8,ht(tl,"StructArrayLayout4i8");class of extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,f,u)}emplace(e,r,l,f,u,p){let v=5*e;return this.int16[v+0]=r,this.int16[v+1]=l,this.int16[v+2]=f,this.int16[v+3]=u,this.int16[v+4]=p,e}}of.prototype.bytesPerElement=10,ht(of,"StructArrayLayout5i10");class mc extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v){let T=this.length;return this.resize(T+1),this.emplace(T,e,r,l,f,u,p,v)}emplace(e,r,l,f,u,p,v,T){let D=6*e,_=12*e,E=3*e;return this.int16[D+0]=r,this.int16[D+1]=l,this.uint8[_+4]=f,this.uint8[_+5]=u,this.uint8[_+6]=p,this.uint8[_+7]=v,this.float32[E+2]=T,e}}mc.prototype.bytesPerElement=12,ht(mc,"StructArrayLayout2i4ub1f12");class Ho extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,l,f)}emplace(e,r,l,f,u){let p=4*e;return this.float32[p+0]=r,this.float32[p+1]=l,this.float32[p+2]=f,this.float32[p+3]=u,e}}Ho.prototype.bytesPerElement=16,ht(Ho,"StructArrayLayout4f16");class Ts extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){let f=this.length;return this.resize(f+1),this.emplace(f,e,r,l)}emplace(e,r,l,f){let u=3*e;return this.float32[u+0]=r,this.float32[u+1]=l,this.float32[u+2]=f,e}}Ts.prototype.bytesPerElement=12,ht(Ts,"StructArrayLayout3f12");class qo extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,f,u)}emplace(e,r,l,f,u,p){let v=6*e,T=3*e;return this.uint16[v+0]=r,this.uint16[v+1]=l,this.uint16[v+2]=f,this.uint16[v+3]=u,this.float32[T+2]=p,e}}qo.prototype.bytesPerElement=12,ht(qo,"StructArrayLayout4ui1f12");class Wu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,f){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,l,f)}emplace(e,r,l,f,u){let p=4*e;return this.uint16[p+0]=r,this.uint16[p+1]=l,this.uint16[p+2]=f,this.uint16[p+3]=u,e}}Wu.prototype.bytesPerElement=8,ht(Wu,"StructArrayLayout4ui8");class gc extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p){let v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,f,u,p)}emplace(e,r,l,f,u,p,v){let T=6*e;return this.int16[T+0]=r,this.int16[T+1]=l,this.int16[T+2]=f,this.int16[T+3]=u,this.int16[T+4]=p,this.int16[T+5]=v,e}}gc.prototype.bytesPerElement=12,ht(gc,"StructArrayLayout6i12");class nl extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v,T,D,_,E,S){let w=this.length;return this.resize(w+1),this.emplace(w,e,r,l,f,u,p,v,T,D,_,E,S)}emplace(e,r,l,f,u,p,v,T,D,_,E,S,w){let I=12*e;return this.int16[I+0]=r,this.int16[I+1]=l,this.int16[I+2]=f,this.int16[I+3]=u,this.uint16[I+4]=p,this.uint16[I+5]=v,this.uint16[I+6]=T,this.uint16[I+7]=D,this.int16[I+8]=_,this.int16[I+9]=E,this.int16[I+10]=S,this.int16[I+11]=w,e}}nl.prototype.bytesPerElement=24,ht(nl,"StructArrayLayout4i4ui4i24");class sf extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p){let v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,f,u,p)}emplace(e,r,l,f,u,p,v){let T=10*e,D=5*e;return this.int16[T+0]=r,this.int16[T+1]=l,this.int16[T+2]=f,this.float32[D+2]=u,this.float32[D+3]=p,this.float32[D+4]=v,e}}sf.prototype.bytesPerElement=20,ht(sf,"StructArrayLayout3i3f20");class af extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}af.prototype.bytesPerElement=4,ht(af,"StructArrayLayout1ul4");class Is extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){let l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){let f=2*e;return this.uint16[f+0]=r,this.uint16[f+1]=l,e}}Is.prototype.bytesPerElement=4,ht(Is,"StructArrayLayout2ui4");class lf extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v,T,D,_,E,S,w){let I=this.length;return this.resize(I+1),this.emplace(I,e,r,l,f,u,p,v,T,D,_,E,S,w)}emplace(e,r,l,f,u,p,v,T,D,_,E,S,w,I){let M=20*e,L=10*e;return this.int16[M+0]=r,this.int16[M+1]=l,this.int16[M+2]=f,this.int16[M+3]=u,this.int16[M+4]=p,this.float32[L+3]=v,this.float32[L+4]=T,this.float32[L+5]=D,this.float32[L+6]=_,this.int16[M+14]=E,this.uint32[L+8]=S,this.uint16[M+18]=w,this.uint16[M+19]=I,e}}lf.prototype.bytesPerElement=40,ht(lf,"StructArrayLayout5i4f1i1ul2ui40");class Zu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v){let T=this.length;return this.resize(T+1),this.emplace(T,e,r,l,f,u,p,v)}emplace(e,r,l,f,u,p,v,T){let D=8*e;return this.int16[D+0]=r,this.int16[D+1]=l,this.int16[D+2]=f,this.int16[D+4]=u,this.int16[D+5]=p,this.int16[D+6]=v,this.int16[D+7]=T,e}}Zu.prototype.bytesPerElement=16,ht(Zu,"StructArrayLayout3i2i2i16");class rl extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,f,u)}emplace(e,r,l,f,u,p){let v=4*e,T=8*e;return this.float32[v+0]=r,this.float32[v+1]=l,this.float32[v+2]=f,this.int16[T+6]=u,this.int16[T+7]=p,e}}rl.prototype.bytesPerElement=16,ht(rl,"StructArrayLayout2f1f2i16");class il extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p){let v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,f,u,p)}emplace(e,r,l,f,u,p,v){let T=20*e,D=5*e;return this.uint8[T+0]=r,this.uint8[T+1]=l,this.float32[D+1]=f,this.float32[D+2]=u,this.float32[D+3]=p,this.float32[D+4]=v,e}}il.prototype.bytesPerElement=20,ht(il,"StructArrayLayout2ub4f20");class ir extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){let f=this.length;return this.resize(f+1),this.emplace(f,e,r,l)}emplace(e,r,l,f){let u=3*e;return this.uint16[u+0]=r,this.uint16[u+1]=l,this.uint16[u+2]=f,e}}ir.prototype.bytesPerElement=6,ht(ir,"StructArrayLayout3ui6");class ol extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L,k,B,V,N,G){let H=this.length;return this.resize(H+1),this.emplace(H,e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L,k,B,V,N,G)}emplace(e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L,k,B,V,N,G,H){let J=30*e,oe=15*e,ee=60*e;return this.int16[J+0]=r,this.int16[J+1]=l,this.int16[J+2]=f,this.float32[oe+2]=u,this.float32[oe+3]=p,this.uint16[J+8]=v,this.uint16[J+9]=T,this.uint32[oe+5]=D,this.uint32[oe+6]=_,this.uint32[oe+7]=E,this.uint16[J+16]=S,this.uint16[J+17]=w,this.uint16[J+18]=I,this.float32[oe+10]=M,this.float32[oe+11]=L,this.uint8[ee+48]=k,this.uint8[ee+49]=B,this.uint8[ee+50]=V,this.uint32[oe+13]=N,this.int16[J+28]=G,this.uint8[ee+58]=H,e}}ol.prototype.bytesPerElement=60,ht(ol,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class cf extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L,k,B,V,N,G,H,J,oe,ee,ne,pe,te,de,ye,ve,Ee){let Me=this.length;return this.resize(Me+1),this.emplace(Me,e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L,k,B,V,N,G,H,J,oe,ee,ne,pe,te,de,ye,ve,Ee)}emplace(e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L,k,B,V,N,G,H,J,oe,ee,ne,pe,te,de,ye,ve,Ee,Me){let Re=20*e,De=40*e,Ue=80*e;return this.float32[Re+0]=r,this.float32[Re+1]=l,this.int16[De+4]=f,this.int16[De+5]=u,this.int16[De+6]=p,this.int16[De+7]=v,this.int16[De+8]=T,this.int16[De+9]=D,this.int16[De+10]=_,this.int16[De+11]=E,this.int16[De+12]=S,this.uint16[De+13]=w,this.uint16[De+14]=I,this.uint16[De+15]=M,this.uint16[De+16]=L,this.uint16[De+17]=k,this.uint16[De+18]=B,this.uint16[De+19]=V,this.uint16[De+20]=N,this.uint16[De+21]=G,this.uint16[De+22]=H,this.uint16[De+23]=J,this.uint16[De+24]=oe,this.uint16[De+25]=ee,this.uint16[De+26]=ne,this.uint16[De+27]=pe,this.uint32[Re+14]=te,this.float32[Re+15]=de,this.float32[Re+16]=ye,this.float32[Re+17]=ve,this.float32[Re+18]=Ee,this.uint8[Ue+76]=Me,e}}cf.prototype.bytesPerElement=80,ht(cf,"StructArrayLayout2f9i15ui1ul4f1ub80");class sl extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}sl.prototype.bytesPerElement=4,ht(sl,"StructArrayLayout1f4");class ia extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,f,u)}emplace(e,r,l,f,u,p){let v=5*e;return this.float32[v+0]=r,this.float32[v+1]=l,this.float32[v+2]=f,this.float32[v+3]=u,this.float32[v+4]=p,e}}ia.prototype.bytesPerElement=20,ht(ia,"StructArrayLayout5f20");class uf extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v){let T=this.length;return this.resize(T+1),this.emplace(T,e,r,l,f,u,p,v)}emplace(e,r,l,f,u,p,v,T){let D=7*e;return this.float32[D+0]=r,this.float32[D+1]=l,this.float32[D+2]=f,this.float32[D+3]=u,this.float32[D+4]=p,this.float32[D+5]=v,this.float32[D+6]=T,e}}uf.prototype.bytesPerElement=28,ht(uf,"StructArrayLayout7f28");class Xu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v,T,D,_,E){let S=this.length;return this.resize(S+1),this.emplace(S,e,r,l,f,u,p,v,T,D,_,E)}emplace(e,r,l,f,u,p,v,T,D,_,E,S){let w=11*e;return this.float32[w+0]=r,this.float32[w+1]=l,this.float32[w+2]=f,this.float32[w+3]=u,this.float32[w+4]=p,this.float32[w+5]=v,this.float32[w+6]=T,this.float32[w+7]=D,this.float32[w+8]=_,this.float32[w+9]=E,this.float32[w+10]=S,e}}Xu.prototype.bytesPerElement=44,ht(Xu,"StructArrayLayout11f44");class qm extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v,T,D){let _=this.length;return this.resize(_+1),this.emplace(_,e,r,l,f,u,p,v,T,D)}emplace(e,r,l,f,u,p,v,T,D,_){let E=9*e;return this.float32[E+0]=r,this.float32[E+1]=l,this.float32[E+2]=f,this.float32[E+3]=u,this.float32[E+4]=p,this.float32[E+5]=v,this.float32[E+6]=T,this.float32[E+7]=D,this.float32[E+8]=_,e}}qm.prototype.bytesPerElement=36,ht(qm,"StructArrayLayout9f36");class _c extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,f){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,l,f)}emplace(e,r,l,f,u){let p=6*e;return this.uint32[3*e+0]=r,this.uint16[p+2]=l,this.uint16[p+3]=f,this.uint16[p+4]=u,e}}_c.prototype.bytesPerElement=12,ht(_c,"StructArrayLayout1ul3ui12");class hf extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}hf.prototype.bytesPerElement=2,ht(hf,"StructArrayLayout1ui2");class yc extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){let l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){let f=2*e;return this.float32[f+0]=r,this.float32[f+1]=l,e}}yc.prototype.bytesPerElement=8,ht(yc,"StructArrayLayout2f8");class vc extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L){let k=this.length;return this.resize(k+1),this.emplace(k,e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L)}emplace(e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L,k){let B=16*e;return this.float32[B+0]=r,this.float32[B+1]=l,this.float32[B+2]=f,this.float32[B+3]=u,this.float32[B+4]=p,this.float32[B+5]=v,this.float32[B+6]=T,this.float32[B+7]=D,this.float32[B+8]=_,this.float32[B+9]=E,this.float32[B+10]=S,this.float32[B+11]=w,this.float32[B+12]=I,this.float32[B+13]=M,this.float32[B+14]=L,this.float32[B+15]=k,e}}vc.prototype.bytesPerElement=64,ht(vc,"StructArrayLayout16f64");class Yu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,f,u,p,v){let T=this.length;return this.resize(T+1),this.emplace(T,e,r,l,f,u,p,v)}emplace(e,r,l,f,u,p,v,T){let D=10*e,_=5*e;return this.uint16[D+0]=r,this.uint16[D+1]=l,this.uint16[D+2]=f,this.uint16[D+3]=u,this.float32[_+2]=p,this.float32[_+3]=v,this.float32[_+4]=T,e}}Yu.prototype.bytesPerElement=20,ht(Yu,"StructArrayLayout4ui3f20");class Ju extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}Ju.prototype.bytesPerElement=2,ht(Ju,"StructArrayLayout1i2");class Ku extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Ku.prototype.bytesPerElement=1,ht(Ku,"StructArrayLayout1ub1");class Wm extends pc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Wm.prototype.size=40;class Qu extends lf{get(e){return new Wm(this,e)}}ht(Qu,"CollisionBoxArray");class xc extends pc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}xc.prototype.size=60;class df extends ol{get(e){return new xc(this,e)}}ht(df,"PlacedSymbolArray");class Zm extends pc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Zm.prototype.size=80;class ff extends cf{get(e){return new Zm(this,e)}}ht(ff,"SymbolInstanceArray");class Xm extends sl{getoffsetX(e){return this.float32[1*e+0]}}ht(Xm,"GlyphOffsetArray");class eh extends Es{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ht(eh,"SymbolLineVertexArray");class Ym extends pc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ym.prototype.size=12;class Jm extends _c{get(e){return new Ym(this,e)}}ht(Jm,"FeatureIndexArray");class Km extends Is{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ht(Km,"FillExtrusionCentroidArray");class Qm extends pc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Qm.prototype.size=6;class pf extends qu{get(e){return new Qm(this,e)}}ht(pf,"FillExtrusionWallArray");let xv=gn([{name:"a_pos",components:2,type:"Int16"}],4),bv=gn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class dr{constructor(e=[]){this.segments=e}_prepareSegment(e,r,l,f){let u=this.segments[this.segments.length-1];return e>dr.MAX_VERTEX_ARRAY_LENGTH&&ln(`Max vertices per segment is ${dr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>dr.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==f)&&(u={vertexOffset:r,primitiveOffset:l,vertexLength:0,primitiveLength:0},f!==void 0&&(u.sortKey=f),this.segments.push(u)),u}prepareSegment(e,r,l,f){return this._prepareSegment(e,r.length,l.length,f)}get(){return this.segments}destroy(){for(let e of this.segments)for(let r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,l,f){return new dr([{vertexOffset:e,primitiveOffset:r,vertexLength:l,primitiveLength:f,vaos:{},sortKey:0}])}}function eg(s,e){return 256*(s=zt(Math.floor(s),0,255))+zt(Math.floor(e),0,255)}dr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ht(dr,"SegmentVector");let wv=gn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ev=gn([{name:"a_dash",components:4,type:"Uint16"}]);class bc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,l,f){this.ids.push(tg(e)),this.positions.push(r,l,f)}eachPosition(e,r){let l=tg(e),f=0,u=this.ids.length-1;for(;f<u;){let p=f+u>>1;this.ids[p]>=l?u=p:f=p+1}for(;this.ids[f]===l;)r(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(e,r){let l=new Float64Array(e.ids),f=new Uint32Array(e.positions);return al(l,f,0,l.length-1),r&&(r.add(l.buffer),r.add(f.buffer)),{ids:l,positions:f}}static deserialize(e){let r=new bc,l;r.ids=e.ids,r.positions=e.positions;for(let f of r.ids)f!==l&&r.uniqueIds.push(f),l=f;return r.indexed=!0,r}}function tg(s){let e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:hi(String(s))}function al(s,e,r,l){for(;r<l;){let f=s[r+l>>1],u=r-1,p=l+1;for(;;){do u++;while(s[u]<f);do p--;while(s[p]>f);if(u>=p)break;th(s,u,p),th(e,3*u,3*p),th(e,3*u+1,3*p+1),th(e,3*u+2,3*p+2)}p-r<l-p?(al(s,e,r,p),r=p+1):(al(s,e,p+1,l),l=p)}}function th(s,e,r){let l=s[e];s[e]=s[r],s[r]=l}ht(bc,"FeaturePositionMap");class Wo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class oa extends Wo{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Ar extends Wo{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class vo extends Wo{constructor(e){super(e),this.current=[0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class mf extends Wo{constructor(e){super(e),this.current=[0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class nh extends Wo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class gf extends Wo{constructor(e){super(e),this.current=Rn.transparent.toRenderColor(null)}set(e,r,l){this.fetchUniformLocation(e,r)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}let ng=new Float32Array(16);class wc extends Wo{constructor(e){super(e),this.current=ng}set(e,r,l){if(this.fetchUniformLocation(e,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let f=1;f<16;f++)if(l[f]!==this.current[f]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}let Tv=new Float32Array(9),rg=new Float32Array(4);class rh extends Wo{constructor(e){super(e),this.current=rg}set(e,r,l){if(this.fetchUniformLocation(e,r)){for(let f=0;f<4;f++)if(l[f]!==this.current[f]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function _f(s){return[eg(255*s.r,255*s.g),eg(255*s.b,255*s.a)]}class Ec{constructor(e,r,l,f){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=l,this.context=f}setUniform(e,r,l,f,u){let p=f.constantOr(this.value);r.set(e,u,p instanceof Rn?p.toRenderColor(this.context.lut):p)}getBinding(e,r){return this.type==="color"?new gf(e):new Ar(e)}}class ll{constructor(e,r){this.uniformNames=r.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,l,f,u){let p=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;p&&r.set(e,u,p)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new nh(e):new Ar(e)}}class Zo{constructor(e,r,l,f){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,l,f,u,p,v){let T=this.paintVertexArray.length,D=this.expression.evaluate(new ar(0,{brightness:p}),r,{},u,f,v);this.paintVertexArray.resize(e),this._setPaintValue(T,e,D,this.context)}updatePaintArray(e,r,l,f,u,p,v){let T=this.expression.evaluate({zoom:0,brightness:v},l,f,void 0,u);this._setPaintValue(e,r,T,this.context)}_setPaintValue(e,r,l,f){if(this.type==="color"){let u=_f(l.toRenderColor(f.lut));for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class eo{constructor(e,r,l,f,u,p){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=f,this.context=u,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,l,f,u,p,v){let T=this.expression.evaluate(new ar(this.context.zoom,{brightness:p}),r,{},u,f,v),D=this.expression.evaluate(new ar(this.context.zoom+1,{brightness:p}),r,{},u,f,v),_=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(_,e,T,D,this.context)}updatePaintArray(e,r,l,f,u,p,v){let T=this.expression.evaluate({zoom:this.context.zoom,brightness:v},l,f,void 0,u),D=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},l,f,void 0,u);this._setPaintValue(e,r,T,D,this.context)}_setPaintValue(e,r,l,f,u){if(this.type==="color"){let p=_f(l.toRenderColor(u.lut)),v=_f(l.toRenderColor(u.lut));for(let T=e;T<r;T++)this.paintVertexArray.emplace(T,p[0],p[1],v[0],v[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,l,f);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,l,f,u){let p=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,v=zt(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);r.set(e,u,v)}getBinding(e,r){return new Ar(e)}}class Xo{constructor(e,r,l,f,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(l==="array"?Ev:wv).members;for(let p=0;p<r.length;++p);this.paintVertexArray=new f}populatePaintArray(e,r,l,f){let u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],l)}updatePaintArray(e,r,l,f,u,p,v){this._setPaintValues(e,r,l.patterns&&l.patterns[this.layerId],p)}_setPaintValues(e,r,l,f){if(!f||!l)return;let u=f[l];if(!u)return;let{tl:p,br:v,pixelRatio:T}=u;for(let D=e;D<r;D++)this.paintVertexArray.emplace(D,p[0],p[1],v[0],v[1],T)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yo{constructor(e,r,l=()=>!0){this.binders={},this._buffers=[],this.context=r;let f=[];for(let u in e.paint._values){let p=e.paint.get(u);if(!l(u)||!(p instanceof Ka&&Ks(p.property.specification)))continue;let v=Sv(u,e.type),T=p.value,D=p.property.specification.type,_=!!p.property.useIntegerZoom,E=u==="line-dasharray"||u.endsWith("pattern"),S=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(T.kind!=="constant"||S)if(T.kind==="source"||S||E){let w=ig(u,D,"source");this.binders[u]=E?new Xo(T,v,D,w,e.id):new Zo(T,v,D,w),f.push(`/a_${u}`)}else{let w=ig(u,D,"composite");this.binders[u]=new eo(T,v,D,_,r,w),f.push(`/z_${u}`)}else this.binders[u]=E?new ll(T.value,v):new Ec(T.value,v,D,r),f.push(`/u_${u}`)}this.cacheKey=f.sort().join("")}getMaxValue(e){let r=this.binders[e];return r instanceof Zo||r instanceof eo?r.maxValue:0}populatePaintArrays(e,r,l,f,u,p,v){for(let T in this.binders){let D=this.binders[T];D.context=this.context,(D instanceof Zo||D instanceof eo||D instanceof Xo)&&D.populatePaintArray(e,r,l,f,u,p,v)}}setConstantPatternPositions(e){for(let r in this.binders){let l=this.binders[r];l instanceof ll&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,r,l,f,u,p,v,T){let D=!1,_=Object.keys(e),E=_.length!==0,S=E?_:r.uniqueIds;this.context.lut=u.lut;for(let w in this.binders){let I=this.binders[w];if(I.context=this.context,(I instanceof Zo||I instanceof eo||I instanceof Xo)&&(I.expression.isStateDependent===!0||I.expression.isLightConstant===!1)){let M=u.paint.get(w);I.expression=M.value;for(let L of S){let k=e[L.toString()];r.eachPosition(L,(B,V,N)=>{let G=f.feature(B);I.updatePaintArray(V,N,G,k,p,v,T)})}if(!E)for(let L of l.uniqueIds){let k=e[L.toString()];l.eachPosition(L,(B,V,N)=>{let G=f.feature(B);I.updatePaintArray(V,N,G,k,p,v,T)})}D=!0}}return D}defines(){let e=[];for(let r in this.binders){let l=this.binders[r];(l instanceof Ec||l instanceof ll)&&e.push(...l.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){let e=[];for(let r in this.binders){let l=this.binders[r];if(l instanceof Zo||l instanceof eo||l instanceof Xo)for(let f=0;f<l.paintVertexAttributes.length;f++)e.push(l.paintVertexAttributes[f].name)}return e}getBinderUniforms(){let e=[];for(let r in this.binders){let l=this.binders[r];if(l instanceof Ec||l instanceof ll||l instanceof eo)for(let f of l.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let r=[];for(let l in this.binders){let f=this.binders[l];if(f instanceof Ec||f instanceof ll||f instanceof eo)for(let u of f.uniformNames)r.push({name:u,property:l,binding:f.getBinding(e,u)})}return r}setUniforms(e,r,l,f,u){for(let{name:p,property:v,binding:T}of l)this.binders[v].setUniform(e,T,u,f.get(v),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let r=this.binders[e];(r instanceof Zo||r instanceof eo||r instanceof Xo)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(let r in this.binders){let l=this.binders[r];(l instanceof Zo||l instanceof eo||l instanceof Xo)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let r=this.binders[e];(r instanceof Zo||r instanceof eo||r instanceof Xo)&&r.destroy()}}}class xo{constructor(e,r,l=()=>!0){this.programConfigurations={};for(let f of e)this.programConfigurations[f.id]=new Yo(f,r,l);this.needsUpload=!1,this._featureMap=new bc,this._featureMapWithoutIds=new bc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,l,f,u,p,v,T){for(let D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(e,r,f,u,p,v,T);r.id!==void 0?this._featureMap.add(r.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,l,f,u,p){for(let v of l)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,v,f,u,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let Iv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Sv(s,e){return Iv[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}let Dv={"line-pattern":{source:qo,composite:qo},"fill-pattern":{source:qo,composite:qo},"fill-extrusion-pattern":{source:qo,composite:qo},"line-dasharray":{source:Wu,composite:Wu}},Cv={color:{source:yc,composite:Ho},number:{source:sl,composite:yc}};function ig(s,e,r){let l=Dv[s];return l&&l[r]||Cv[e][r]}ht(Ec,"ConstantBinder"),ht(ll,"PatternConstantBinder"),ht(Zo,"SourceExpressionBinder"),ht(Xo,"PatternCompositeBinder"),ht(eo,"CompositeExpressionBinder"),ht(Yo,"ProgramConfiguration",{omit:["_buffers"]}),ht(xo,"ProgramConfigurationSet");let Hr=ot/Math.PI/2,og=5,h=6,t=16383,o=64,d=[o,32,16],g=-Hr,y=Hr;function x(s,e,r,l=Hr){return r=en(r),[s*Math.sin(r)*l,-e*l,s*Math.cos(r)*l]}function C(s,e,r){return x(Math.cos(en(s)),Math.sin(en(s)),e,r)}let A=63710088e-1,O=2*Math.PI*A;class R{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new R(zo(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let r=Math.PI/180,l=this.lat*r,f=e.lat*r,u=Math.sin(l)*Math.sin(f)+Math.cos(l)*Math.cos(f)*Math.cos((e.lng-this.lng)*r);return A*Math.acos(Math.min(u,1))}toBounds(e=0){let r=360*e/40075017,l=r/Math.cos(Math.PI/180*this.lat);return new F({lng:this.lng-l,lat:this.lat-r},{lng:this.lng+l,lat:this.lat+r})}toEcef(e){return C(this.lat,this.lng,Hr+e*Hr/A)}static convert(e){if(e instanceof R)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new R(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new R(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class F{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){let l=e;this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]])}else{let l=e;this.setSouthWest(l[0]).setNorthEast(l[1])}}setNorthEast(e){return this._ne=e instanceof R?new R(e.lng,e.lat):R.convert(e),this}setSouthWest(e){return this._sw=e instanceof R?new R(e.lng,e.lat):R.convert(e),this}extend(e){let r=this._sw,l=this._ne,f,u;if(e instanceof R)f=e,u=e;else{if(!(e instanceof F))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(F.convert(e)):this.extend(R.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(R.convert(e)):this;if(f=e._sw,u=e._ne,!f||!u)return this}return r||l?(r.lng=Math.min(f.lng,r.lng),r.lat=Math.min(f.lat,r.lat),l.lng=Math.max(u.lng,l.lng),l.lat=Math.max(u.lat,l.lat)):(this._sw=new R(f.lng,f.lat),this._ne=new R(u.lng,u.lat)),this}getCenter(){return new R((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new R(this.getWest(),this.getNorth())}getSouthEast(){return new R(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:r,lat:l}=R.convert(e),f=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&f}static convert(e){if(e)return e instanceof F?e:new F(e)}}let z=0,j=25.5;function W(s){return O*Math.cos(s*Math.PI/180)}function q(s){return(180+s)/360}function X(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Z(s,e){return s/W(e)}function Q(s){return 360*s-180}function re(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function ie(s,e){return s*W(re(e))}let ae=85.051129;function ue(s){return Math.cos(en(zt(s,-ae,ae)))}function le(s,e){let r=zt(e,z,j),l=Math.pow(2,r);return ue(s)*O/(512*l)}function he(s){return 1/Math.cos(s*Math.PI/180)}function me(s,e=0){let r=Math.exp(Math.PI*(1-(s.y+e/ot)/(1<<s.z)*2));return 80150034*r/(r*r+1)/ot/(1<<s.z)}class xe{constructor(e,r,l=0){this.x=+e,this.y=+r,this.z=+l}static fromLngLat(e,r=0){let l=R.convert(e);return new xe(q(l.lng),X(l.lat),Z(r,l.lat))}toLngLat(){return new R(Q(this.x),re(this.y))}toAltitude(){return ie(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/O*he(re(this.y))}}function _e(s,e,r,l,f,u,p,v,T){let D=(e+l)/2,_=(r+f)/2,E=new it(D,_);v(E),function(S,w,I,M,L,k){let B=I-L,V=M-k;return Math.abs((M-w)*B-(I-S)*V)/Math.hypot(B,V)}(E.x,E.y,u.x,u.y,p.x,p.y)>=T?(_e(s,e,r,D,_,u,E,v,T),_e(s,D,_,l,f,E,p,v,T)):s.push(p)}function ge(s,e,r){let l=s[0],f=l.x,u=l.y;e(l);let p=[l];for(let v=1;v<s.length;v++){let T=s[v],{x:D,y:_}=T;e(T),_e(p,f,u,D,_,l,T,e,r),f=D,u=_,l=T}return p}function Oe(s,e,r,l){if(l(e,r)){let f=e.add(r)._mult(.5);Oe(s,e,f,l),Oe(s,f,r,l)}else s.push(r)}function Be(s,e){let r=s[0],l=[r];for(let f=1;f<s.length;f++){let u=s[f];Oe(l,r,u,e),r=u}return l}let qe=Math.pow(2,14)-1,Ke=-qe-1;function nt(s,e){let r=Math.round(s.x*e),l=Math.round(s.y*e);return s.x=zt(r,Ke,qe),s.y=zt(l,Ke,qe),(r<s.x||r>s.x+1||l<s.y||l>s.y+1)&&ln("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function Se(s,e,r){let l=s.loadGeometry(),f=s.extent,u=ot/f;if(e&&r&&r.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:v,x:T,y:D,projection:_}=r,E=S=>{let w=Q((e.x+S.x/f)/p),I=re((e.y+S.y/f)/p),M=_.project(w,I);S.x=(M.x*v-T)*f,S.y=(M.y*v-D)*f};for(let S=0;S<l.length;S++)if(s.type!==1)l[S]=ge(l[S],E,1);else{let w=[];for(let I of l[S])I.x<0||I.x>=f||I.y<0||I.y>=f||(E(I),w.push(I));l[S]=w}}for(let p of l)for(let v of p)nt(v,u);return l}function Ge(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?Se(s):[]}}function Le(s,e,r,l,f){s.emplaceBack(2*e+(l+1)/2,2*r+(f+1)/2)}function He(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Ze{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Es,this.indexArray=new ir,this.segments=new dr,this.programConfigurations=new xo(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(e,r){}populate(e,r,l,f){let u=this.layers[0],p=[],v=null;u.type==="circle"&&(v=u.layout.get("circle-sort-key"));for(let{feature:D,id:_,index:E,sourceLayerIndex:S}of e){let w=this.layers[0]._featureFilter.needGeometry,I=Ge(D,w);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),I,l))continue;let M=v?v.evaluate(I,{},l):void 0,L={id:_,properties:D.properties,type:D.type,sourceLayerIndex:S,index:E,geometry:w?I.geometry:Se(D,l,f),patterns:{},sortKey:M};p.push(L)}v&&p.sort((D,_)=>D.sortKey-_.sortKey);let T=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new gc,T=f.projection);for(let D of p){let{geometry:_,index:E,sourceLayerIndex:S}=D,w=e[E].feature;this.addFeature(D,_,E,r.availableImages,l,T,r.brightness),r.featureIndex.insert(w,_,E,S,this.index)}}update(e,r,l,f,u){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,p?this.stateDependentLayers:this.layers,l,f,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,bv.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,l,f,u,p,v){for(let T of r)for(let D of T){let _=D.x,E=D.y;if(_<0||_>=ot||E<0||E>=ot)continue;if(p){let I=p.projectTilePoint(_,E,u),M=p.upVector(u,_,E),L=this.globeExtVertexArray;He(L,I,M),He(L,I,M),He(L,I,M),He(L,I,M)}let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),w=S.vertexLength;Le(this.layoutVertexArray,_,E,-1,-1),Le(this.layoutVertexArray,_,E,1,-1),Le(this.layoutVertexArray,_,E,1,1),Le(this.layoutVertexArray,_,E,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+2,w+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},f,u,v)}}function $e(s,e){for(let r=0;r<s.length;r++)if(tn(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(tn(s,e[r]))return!0;return!!dt(s,e)}function st(s,e,r){return!!tn(s,e)||!!lt(e,s,r)}function yt(s,e){if(s.length===1)return Ut(e,s[0]);for(let r=0;r<e.length;r++){let l=e[r];for(let f=0;f<l.length;f++)if(tn(s,l[f]))return!0}for(let r=0;r<s.length;r++)if(Ut(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(dt(s,e[r]))return!0;return!1}function bt(s,e,r){if(s.length>1){if(dt(s,e))return!0;for(let l=0;l<e.length;l++)if(lt(e[l],s,r))return!0}for(let l=0;l<s.length;l++)if(lt(s[l],e,r))return!0;return!1}function dt(s,e){if(s.length===0||e.length===0)return!1;for(let r=0;r<s.length-1;r++){let l=s[r],f=s[r+1];for(let u=0;u<e.length-1;u++)if(Tt(l,f,e[u],e[u+1]))return!0}return!1}function Tt(s,e,r,l){return fo(s,r,l)!==fo(e,r,l)&&fo(s,e,r)!==fo(s,e,l)}function lt(s,e,r){let l=r*r;if(e.length===1)return s.distSqr(e[0])<l;for(let f=1;f<e.length;f++)if(Dt(s,e[f-1],e[f])<l)return!0;return!1}function Dt(s,e,r){let l=e.distSqr(r);if(l===0)return s.distSqr(e);let f=((s.x-e.x)*(r.x-e.x)+(s.y-e.y)*(r.y-e.y))/l;return s.distSqr(f<0?e:f>1?r:r.sub(e)._mult(f)._add(e))}function Ut(s,e){let r,l,f,u=!1;for(let p=0;p<s.length;p++){r=s[p];for(let v=0,T=r.length-1;v<r.length;T=v++)l=r[v],f=r[T],l.y>e.y!=f.y>e.y&&e.x<(f.x-l.x)*(e.y-l.y)/(f.y-l.y)+l.x&&(u=!u)}return u}function tn(s,e){let r=!1;for(let l=0,f=s.length-1;l<s.length;f=l++){let u=s[l],p=s[f];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(r=!r)}return r}function zn(s,e,r,l,f){for(let p of s)if(e<=p.x&&r<=p.y&&l>=p.x&&f>=p.y)return!0;let u=[new it(e,r),new it(e,f),new it(l,f),new it(l,r)];if(s.length>2){for(let p of u)if(tn(s,p))return!0}for(let p=0;p<s.length-1;p++)if(fn(s[p],s[p+1],u))return!0;return!1}function fn(s,e,r){let l=r[0],f=r[2];if(s.x<l.x&&e.x<l.x||s.x>f.x&&e.x>f.x||s.y<l.y&&e.y<l.y||s.y>f.y&&e.y>f.y)return!1;let u=fo(s,e,r[0]);return u!==fo(s,e,r[1])||u!==fo(s,e,r[2])||u!==fo(s,e,r[3])}function qn(s,e,r,l,f,u){let p=e.y-s.y,v=s.x-e.x;if(u=u||0){let T=p*p+v*v;if(T===0)return!0;let D=Math.sqrt(T);p/=D,v/=D}return!((r.x-s.x)*p+(r.y-s.y)*v-u<0||(l.x-s.x)*p+(l.y-s.y)*v-u<0||(f.x-s.x)*p+(f.y-s.y)*v-u<0)}function bn(s,e,r,l,f,u,p){return!(qn(s,e,l,f,u,p)||qn(e,r,l,f,u,p)||qn(r,s,l,f,u,p)||qn(l,f,s,e,r,p)||qn(f,u,s,e,r,p)||qn(u,l,s,e,r,p))}function Bn(s,e,r){let l=e.paint.get(s).value;return l.kind==="constant"?l.value:r.programConfigurations.get(e.id).getMaxValue(s)}function Jt(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function kn(s,e,r,l,f){if(!e[0]&&!e[1])return s;let u=it.convert(e)._mult(f);r==="viewport"&&u._rotate(-l);let p=[];for(let v=0;v<s.length;v++)p.push(s[v].sub(u));return p}function On(s,e,r,l){let f=it.convert(s)._mult(l);return e==="viewport"&&f._rotate(-r),f}let Tn,Qn;ht(Ze,"CircleBucket",{omit:["layers"]});var Cr,Mi={exports:{}},Ni=(Cr||(Cr=1,function(s,e){(function(r){function l(u,p,v){var T=f(256*u,256*(p=Math.pow(2,v)-p-1),v),D=f(256*(u+1),256*(p+1),v);return T[0]+","+T[1]+","+D[0]+","+D[1]}function f(u,p,v){var T=2*Math.PI*6378137/256/Math.pow(2,v);return[u*T-2*Math.PI*6378137/2,p*T-2*Math.PI*6378137/2]}r.getURL=function(u,p,v,T,D,_){return _=_||{},u+"?"+["bbox="+l(v,T,D),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+p].join("&")},r.getTileBBox=l,r.getMercCoords=f,Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,Mi.exports)),Mi.exports);class Rr{constructor(e,r,l){this.z=e,this.x=r,this.y=l,this.key=wn(0,e,e,r,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){let l=Ni.getTileBBox(this.x,this.y,this.z),f=function(u,p,v){let T,D="";for(let _=u;_>0;_--)T=1<<_-1,D+=(p&T?1:0)+(v&T?2:0);return D}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class hn{constructor(e,r){this.wrap=e,this.canonical=r,this.key=wn(e,r.z,r.z,r.x,r.y)}}class nn{constructor(e,r,l,f,u){this.overscaledZ=e,this.wrap=r,this.canonical=new Rr(l,+f,+u),this.key=r===0&&e===l?this.canonical.key:wn(r,e,l,f,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let r=this.canonical.z-e;return e>this.canonical.z?new nn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nn(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return wn(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{let l=this.canonical.z-e;return wn(this.wrap*+r,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new nn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,l=2*this.canonical.x,f=2*this.canonical.y;return[new nn(r,this.wrap,r,l,f),new nn(r,this.wrap,r,l+1,f),new nn(r,this.wrap,r,l,f+1),new nn(r,this.wrap,r,l+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new nn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new nn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new hn(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function wn(s,e,r,l,f){let u=1<<Math.min(r,22),p=u*(f%u)+l%u;return s&&r<22&&(p+=u*u*((s<0?-2*s-1:2*s)%(1<<2*(22-r)))),16*(32*p+r)+(e-r)}let jn=[s=>{let e=s.canonical.x-1,r=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,r--),new nn(s.overscaledZ,r,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,r=s.wrap;return e===1<<s.canonical.z&&(e=0,r++),new nn(s.overscaledZ,r,s.canonical.z,e,s.canonical.y)},s=>new nn(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new nn(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];ht(Rr,"CanonicalTileID"),ht(nn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let fr=gn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:er}=fr,kr=gn([{name:"a_pos_3",components:3,type:"Int16"}]);var bo=gn([{name:"a_pos",type:"Int16",components:2}]);class pi{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){let f=we.vec3.dot(r,this.dir);if(Math.abs(f)<1e-6)return!1;let u=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/f;return l[0]=this.pos[0]+this.dir[0]*u,l[1]=this.pos[1]+this.dir[1]*u,l[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,r,l){if(we.vec3.equals(this.pos,e)||r===0)return l[0]=l[1]=l[2]=0,!1;let[f,u,p]=this.dir,v=this.pos[0]-e[0],T=this.pos[1]-e[1],D=this.pos[2]-e[2],_=f*f+u*u+p*p,E=2*(v*f+T*u+D*p),S=E*E-4*_*(v*v+T*T+D*D-r*r);if(S<0){let w=Math.max(-E/2,0),I=v+f*w,M=T+u*w,L=D+p*w,k=Math.hypot(I,M,L);return l[0]=I*r/k,l[1]=M*r/k,l[2]=L*r/k,!1}{let w=(-E-Math.sqrt(S))/(2*_);if(w<0){let I=Math.hypot(v,T,D);return l[0]=v*r/I,l[1]=T*r/I,l[2]=D*r/I,!1}return l[0]=v+f*w,l[1]=T+u*w,l[2]=D+p*w,!0}}}class mi{constructor(e,r,l,f,u){this.TL=e,this.TR=r,this.BR=l,this.BL=f,this.horizon=u}static fromInvProjectionMatrix(e,r,l){let f=[-1,1,1],u=[1,1,1],p=[1,-1,1],v=[-1,-1,1],T=we.vec3.transformMat4(f,f,e),D=we.vec3.transformMat4(u,u,e),_=we.vec3.transformMat4(p,p,e),E=we.vec3.transformMat4(v,v,e);return new mi(T,D,_,E,r/l)}}function zi(s,e,r){let l=1/0,f=-1/0,u=[];for(let p of s){we.vec3.sub(u,p,e);let v=we.vec3.dot(u,r);l=Math.min(l,v),f=Math.max(f,v)}return[l,f]}function to(s,e){let r=!0;for(let l=0;l<s.planes.length;l++){let f=s.planes[l],u=0;for(let p=0;p<e.length;p++)u+=we.vec3.dot(f,e[p])+f[3]>=0;if(u===0)return 0;u!==e.length&&(r=!1)}return r?2:1}function gi(s,e){for(let r of s.projections){let l=zi(e,s.points[0],r.axis);if(r.projection[1]<l[0]||r.projection[0]>l[1])return 0}return 1}function Jo(s,e){let r=0,l=[0,0,0,0];for(let f=0;f<s.length;f++)l[0]=s[f][0],l[1]=s[f][1],l[2]=s[f][2],l[3]=1,we.vec4.dot(l,e)>=0&&r++;return r}class Bi{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=Mn.fromPoints(this.points),this.projections=[],this.frustumEdges=[we.vec3.sub([],this.points[2],this.points[3]),we.vec3.sub([],this.points[0],this.points[3]),we.vec3.sub([],this.points[4],this.points[0]),we.vec3.sub([],this.points[5],this.points[1]),we.vec3.sub([],this.points[6],this.points[2]),we.vec3.sub([],this.points[7],this.points[3])];for(let l of this.frustumEdges){let f=[0,-l[2],l[1]],u=[l[2],0,-l[0]];this.projections.push({axis:f,projection:zi(this.points,this.points[0],f)}),this.projections.push({axis:u,projection:zi(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,r,l,f){let u=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{let _=we.vec4.transformMat4([],D,e),E=1/_[3]/r*u;return we.vec4.mul(_,_,[E,E,f?1/_[3]:E,E])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{let _=we.vec3.sub([],p[D[0]],p[D[1]]),E=we.vec3.sub([],p[D[2]],p[D[1]]),S=we.vec3.normalize([],we.vec3.cross([],_,E)),w=-we.vec3.dot(S,p[D[1]]);return S.concat(w)}),T=[];for(let D=0;D<p.length;D++)T.push([p[D][0],p[D][1],p[D][2]]);return new Bi(T,v)}intersectsPrecise(e,r,l){for(let f=0;f<r.length;f++)if(!Jo(e,r[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!Jo(e,this.planes[f]))return 0;for(let f of l)for(let u of this.frustumEdges){let p=we.vec3.cross([],f,u),v=we.vec3.length(p);if(v===0)continue;we.vec3.scale(p,p,1/v);let T=zi(this.points,this.points[0],p),D=zi(e,this.points[0],p);if(T[0]>D[1]||D[0]>T[1])return 0}return 1}containsPoint(e){for(let r of this.planes){let l=r[3];if(we.vec3.dot([r[0],r[1],r[2]],e)+l<0)return!1}return!0}}class Mn{static fromPoints(e){let r=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(let f of e)we.vec3.min(r,r,f),we.vec3.max(l,l,f);return new Mn(r,l)}static fromTileIdAndHeight(e,r,l){let f=1<<e.canonical.z,u=e.canonical.x,p=e.canonical.y;return new Mn([u/f,p/f,r],[(u+1)/f,(p+1)/f,l])}static applyTransform(e,r){let l=e.getCorners();for(let f=0;f<l.length;++f)we.vec3.transformMat4(l[f],l[f],r);return Mn.fromPoints(l)}static applyTransformFast(e,r){let l=[r[12],r[13],r[14]],f=[...l];for(let u=0;u<3;u++)for(let p=0;p<3;p++){let v=r[4*p+u],T=v*e.min[p],D=v*e.max[p];l[u]+=Math.min(T,D),f[u]+=Math.max(T,D)}return new Mn(l,f)}static projectAabbCorners(e,r){let l=e.getCorners();for(let f=0;f<l.length;++f)we.vec3.transformMat4(l[f],l[f],r);return l}constructor(e,r){this.min=e,this.max=r,this.center=we.vec3.scale([],we.vec3.add([],this.min,this.max),.5)}quadrant(e){let r=[e%2==0,e<2],l=we.vec3.clone(this.min),f=we.vec3.clone(this.max);for(let u=0;u<r.length;u++)l[u]=r[u]?this.min[u]:this.center[u],f[u]=r[u]?this.center[u]:this.max[u];return f[2]=this.max[2],new Mn(l,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?to(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?to(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?gi(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?gi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function cl(s){return s*Hr/A}ht(Mn,"Aabb");let yf=[new Mn([g,g,g],[y,y,y]),new Mn([g,g,g],[0,0,y]),new Mn([0,g,g],[y,0,y]),new Mn([g,0,g],[0,y,y]),new Mn([0,0,g],[y,y,y])];function ul(s,e,r,l=!0){let f=we.vec3.scale([],s._camera.position,s.worldSize),u=[e,r,1,1];we.vec4.transformMat4(u,u,s.pixelMatrixInverse),we.vec4.scale(u,u,1/u[3]);let p=we.vec3.sub([],u,f),v=we.vec3.normalize([],p),T=s.globeMatrix,D=[T[12],T[13],T[14]],_=we.vec3.sub([],D,f),E=we.vec3.length(_),S=we.vec3.normalize([],_),w=s.worldSize/(2*Math.PI),I=we.vec3.dot(S,v),M=Math.asin(w/E);if(M<Math.acos(I)){if(!l)return null;let pe=[],te=[];we.vec3.scale(pe,v,E/I),we.vec3.normalize(te,we.vec3.sub(te,pe,_)),we.vec3.normalize(v,we.vec3.add(v,_,we.vec3.scale(v,te,Math.tan(M)*E)))}let L=[];new pi(f,v).closestPointOnSphere(D,w,L);let k=we.vec3.normalize([],Ia(T,0)),B=we.vec3.normalize([],Ia(T,1)),V=we.vec3.normalize([],Ia(T,2)),N=we.vec3.dot(k,L),G=we.vec3.dot(B,L),H=we.vec3.dot(V,L),J=Fr(Math.asin(-G/w)),oe=Fr(Math.atan2(N,H));oe=s.center.lng+function(pe,te){let de=(te-pe+180)%360-180;return de<-180?de+360:de}(s.center.lng,oe);let ee=q(oe),ne=zt(X(J),0,1);return new xe(ee,ne)}class vf{constructor(e,r,l){this.a=we.vec3.sub([],e,l),this.b=we.vec3.sub([],r,l),this.center=l;let f=we.vec3.normalize([],this.a),u=we.vec3.normalize([],this.b);this.angle=Math.acos(we.vec3.dot(f,u))}}function Tc(s,e){if(s.angle===0)return null;let r;return r=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),r<0||r>1?null:function(l,f,u,p){let v=Math.sin(u);return l*(Math.sin((1-p)*u)/v)+f*(Math.sin(p*u)/v)}(s.a[e],s.b[e],s.angle,zt(r,0,1))+s.center[e]}function Ss(s){if(s.z<=1)return yf[s.z+2*s.y+s.x];let e=Mv(sg(s));return Mn.fromPoints(e)}function sa(s,e,r){return we.vec3.scale(s,s,1-r),we.vec3.scaleAndAdd(s,s,e,r)}function fw(s,e,r){for(let l of s)we.vec3.transformMat4(l,l,e),we.vec3.scale(l,l,r)}function pw(s,e,r,l){let f=e/s.worldSize,u=s.globeMatrix;if(r.z<=1){let ee=Ss(r).getCorners();return fw(ee,u,f),Mn.fromPoints(ee)}let p=sg(r,l),v=Mv(p,Hr+cl(s._tileCoverLift));fw(v,u,f);let T=Number.MAX_VALUE,D=[-T,-T,-T],_=[T,T,T];if(p.contains(s.center)){for(let pe of v)we.vec3.min(_,_,pe),we.vec3.max(D,D,pe);D[2]=0;let ee=s.point,ne=[ee.x*f,ee.y*f,0];return we.vec3.min(_,_,ne),we.vec3.max(D,D,ne),new Mn(_,D)}if(s._tileCoverLift>0){for(let ee of v)we.vec3.min(_,_,ee),we.vec3.max(D,D,ee);return new Mn(_,D)}let E=[u[12]*f,u[13]*f,u[14]*f],S=p.getCenter(),w=zt(s.center.lat,-ae,ae),I=zt(S.lat,-ae,ae),M=q(s.center.lng),L=X(w),k=M-q(S.lng),B=L-X(I);k>.5?k-=1:k<-.5&&(k+=1);let V=0;if(Math.abs(k)>Math.abs(B))V=k>=0?1:3;else{V=B>=0?0:2;let ee=[u[4]*f,u[5]*f,u[6]*f],ne=-Math.sin(en(B>=0?p.getSouth():p.getNorth()))*Hr;we.vec3.scaleAndAdd(E,E,ee,ne)}let N=v[V],G=v[(V+1)%4],H=new vf(N,G,E),J=[Tc(H,0)||N[0],Tc(H,1)||N[1],Tc(H,2)||N[2]],oe=hl(s.zoom);if(oe>0){let ee=function({x:pe,y:te,z:de},ye,ve,Ee,Me){let Re=1/(1<<de),De=pe*Re,Ue=De+Re,Je=te*Re,ze=Je+Re,ut=0,rt=(De+Ue)/2-Ee;return rt>.5?ut=-1:rt<-.5&&(ut=1),De=((De+ut)*ye-(Ee*=ye))*ve+Ee,Ue=((Ue+ut)*ye-Ee)*ve+Ee,Je=(Je*ye-(Me*=ye))*ve+Me,ze=(ze*ye-Me)*ve+Me,[[De,ze,0],[Ue,ze,0],[Ue,Je,0],[De,Je,0]]}(r,e,s._pixelsPerMercatorPixel,M,L);for(let pe=0;pe<v.length;pe++)sa(v[pe],ee[pe],oe);let ne=we.vec3.add([],ee[V],ee[(V+1)%4]);we.vec3.scale(ne,ne,.5),sa(J,ne,oe)}for(let ee of v)we.vec3.min(_,_,ee),we.vec3.max(D,D,ee);return _[2]=Math.min(N[2],G[2]),we.vec3.min(_,_,J),we.vec3.max(D,D,J),new Mn(_,D)}function sg({x:s,y:e,z:r},l=!1){let f=1/(1<<r),u=new R(Q(s*f),e===(1<<r)-1&&l?-90:re((e+1)*f)),p=new R(Q((s+1)*f),e===0&&l?90:re(e*f));return new F(u,p)}function Mv(s,e=Hr){let r=en(s.getNorth()),l=en(s.getSouth()),f=Math.cos(r),u=Math.cos(l),p=Math.sin(r),v=Math.sin(l),T=s.getWest(),D=s.getEast();return[x(u,v,T,e),x(u,v,D,e),x(f,p,D,e),x(f,p,T,e)]}function xf(s,e,r,l){let f=1<<r.z,u=(s/ot+r.x)/f;return C(re((e/ot+r.y)/f),Q(u),l)}function ag({min:s,max:e}){return t/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}let mw=new Float64Array(16);function lg(s){let e=ag(s),r=we.mat4.fromScaling(mw,[e,e,e]);return we.mat4.translate(r,r,we.vec3.negate([],s.min))}function Av(s){let e=we.mat4.fromTranslation(mw,s.min),r=1/ag(s);return we.mat4.scale(e,e,[r,r,r])}function Rv(s){let e=ot/(2*Math.PI);return s/(2*Math.PI)/e}function gw(s,e){return ot/(512*Math.pow(2,s))*ag(Ss(e))}function _w(s,e,r,l,f){let u=Rv(r),p=[s,e,-r/(2*Math.PI)],v=we.mat4.identity(new Float64Array(16));return we.mat4.translate(v,v,p),we.mat4.scale(v,v,[u,u,u]),we.mat4.rotateX(v,v,en(-f)),we.mat4.rotateY(v,v,en(-l)),v}function hl(s){return wa(og,h,s)}function yw(s,e){let r=C(e.lat,e.lng),l=function(u){let p=C(u._center.lat,u._center.lng),v=we.vec3.fromValues(0,1,0),T=we.vec3.cross([],v,p),D=we.mat4.fromRotation([],-u.angle,p);T=we.vec3.transformMat4(T,T,D),we.mat4.fromRotation(D,-u._pitch,T);let _=we.vec3.normalize([],p);return we.vec3.scale(_,_,cl(u.cameraToCenterDistance/u.pixelsPerMeter)),we.vec3.transformMat4(_,_,D),we.vec3.add([],p,_)}(s),f=we.vec3.subtract([],l,r);return we.vec3.angle(f,r)}function Pv(s,e){return yw(s,e)>Math.PI/2*1.01}let vw=en(85),XR=Math.cos(vw),YR=Math.sin(vw),JR=we.mat4.create(),xw=s=>{let e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function bw(s,e,r,l,f,u,p,v,T){if(u&&s.queryGeometry.isAboveHorizon)return!1;u&&(T*=s.pixelToTileUnitsFactor);let D=s.tileID.canonical,_=r.projection.upVectorScale(D,r.center.lat,r.worldSize).metersToTile;for(let E of e)for(let S of E){let w=S.add(v),I=f&&r.elevation?r.elevation.exaggeration()*f.getElevationAt(w.x,w.y,!0):0,M=r.projection.projectTilePoint(w.x,w.y,D);if(I>0){let V=r.projection.upVector(D,w.x,w.y);M.x+=V[0]*_*I,M.y+=V[1]*_*I,M.z+=V[2]*_*I}let L=u?w:KR(M.x,M.y,M.z,l),k=u?s.tilespaceRays.map(V=>eP(V,I)):s.queryGeometry.screenGeometry,B=we.vec4.transformMat4([],[M.x,M.y,M.z,1],l);if(!p&&u?T*=B[3]/r.cameraToCenterDistance:p&&!u&&(T*=r.cameraToCenterDistance/B[3]),u){let V=re((S.y/ot+D.y)/(1<<D.z));T/=r.projection.pixelsPerMeter(V,1)/Z(1,V)}if(st(k,L,T))return!0}return!1}function KR(s,e,r,l){let f=we.vec4.transformMat4([],[s,e,r,1],l);return new it(f[0]/f[3],f[1]/f[3])}let ww=we.vec3.fromValues(0,0,0),QR=we.vec3.fromValues(0,0,1);function eP(s,e){let r=we.vec3.create();return ww[2]=e,s.intersectsPlane(ww,QR,r),new it(r[0],r[1])}class Ew extends Ze{}let Tw,Iw,Sw,Dw;function Cw(s,{width:e,height:r},l,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*r*l)throw new RangeError("mismatched image size")}else f=new Uint8Array(e*r*l);return s.width=e,s.height=r,s.data=f,s}function Mw(s,e,r){let{width:l,height:f}=e;l===s.width&&f===s.height||(Ov(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,l),height:Math.min(s.height,f)},r,null),s.width=l,s.height=f,s.data=e.data)}function Ov(s,e,r,l,f,u,p,v){if(f.width===0||f.height===0)return e;if(f.width>s.width||f.height>s.height||r.x>s.width-f.width||r.y>s.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||l.x>e.width-f.width||l.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");let T=s.data,D=e.data,_=u===4&&v;for(let E=0;E<f.height;E++){let S=((r.y+E)*s.width+r.x)*u,w=((l.y+E)*e.width+l.x)*u;if(_)for(let I=0;I<f.width;I++){let M=S+I*u+3,L=w+I*u;D[L+0]=255,D[L+1]=255,D[L+2]=255,D[L+3]=T[M]}else if(p)for(let I=0;I<f.width;I++){let M=S+I*u,L=w+I*u,k=T[M+3],B=new Rn(T[M+0]/255*k,T[M+1]/255*k,T[M+2]/255*k,k).toRenderColor(p).toArray();D[L+0]=B[0],D[L+1]=B[1],D[L+2]=B[2],D[L+3]=B[3]}else for(let I=0;I<f.width*u;I++)D[w+I]=T[S+I]}return e}ht(Ew,"HeatmapBucket",{omit:["layers"]});class dl{constructor(e,r){Cw(this,e,1,r)}resize(e){Mw(this,new dl(e),1)}clone(){return new dl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,f,u){Ov(e,r,l,f,u,1,null)}}class si{constructor(e,r){Cw(this,e,4,r)}resize(e){Mw(this,new si(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new si({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,f,u,p,v){Ov(e,r,l,f,u,4,p,v)}}class Aw{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function bf(s){let e={},r=s.resolution||256,l=s.clips?s.clips.length:1,f=s.image||new si({width:r,height:l}),u=(p,v,T)=>{e[s.evaluationKey]=T;let D=s.expression.evaluate(e);D&&(f.data[p+v+0]=Math.floor(255*D.r/D.a),f.data[p+v+1]=Math.floor(255*D.g/D.a),f.data[p+v+2]=Math.floor(255*D.b/D.a),f.data[p+v+3]=Math.floor(255*D.a))};if(s.clips)for(let p=0,v=0;p<l;++p,v+=4*r)for(let T=0,D=0;T<r;T++,D+=4){let _=T/(r-1),{start:E,end:S}=s.clips[p];u(v,D,E*(1-_)+S*_)}else for(let p=0,v=0;p<r;p++,v+=4)u(0,v,p/(r-1));return f}ht(dl,"AlphaImage"),ht(si,"RGBAImage");let tP=gn([{name:"a_pos",components:2,type:"Int16"}],4),{members:nP}=tP;function wf(s,e,r=2){let l=e&&e.length,f=l?e[0]*r:s.length,u=Rw(s,0,f,r,!0),p=[];if(!u||u.next===u.prev)return p;let v,T,D;if(l&&(u=function(_,E,S,w){let I=[];for(let M=0,L=E.length;M<L;M++){let k=Rw(_,E[M]*w,M<L-1?E[M+1]*w:_.length,w,!1);k===k.next&&(k.steiner=!0),I.push(uP(k))}I.sort(aP);for(let M=0;M<I.length;M++)S=lP(I[M],S);return S}(s,e,u,r)),s.length>80*r){v=1/0,T=1/0;let _=-1/0,E=-1/0;for(let S=r;S<f;S+=r){let w=s[S],I=s[S+1];w<v&&(v=w),I<T&&(T=I),w>_&&(_=w),I>E&&(E=I)}D=Math.max(_-v,E-T),D=D!==0?32767/D:0}return Ef(u,p,r,v,T,D,0),p}function Rw(s,e,r,l,f){let u;if(f===function(p,v,T,D){let _=0;for(let E=v,S=T-D;E<T;E+=D)_+=(p[S]-p[E])*(p[E+1]+p[S+1]),S=E;return _}(s,e,r,l)>0)for(let p=e;p<r;p+=l)u=Lw(p/l|0,s[p],s[p+1],u);else for(let p=r-l;p>=e;p-=l)u=Lw(p/l|0,s[p],s[p+1],u);return u&&cg(u,u.next)&&(If(u),u=u.next),u}function Ic(s,e){if(!s)return s;e||(e=s);let r,l=s;do if(r=!1,l.steiner||!cg(l,l.next)&&Pr(l.prev,l,l.next)!==0)l=l.next;else{if(If(l),l=e=l.prev,l===l.next)break;r=!0}while(r||l!==e);return e}function Ef(s,e,r,l,f,u,p){if(!s)return;!p&&u&&function(T,D,_,E){let S=T;do S.z===0&&(S.z=Lv(S.x,S.y,D,_,E)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next;while(S!==T);S.prevZ.nextZ=null,S.prevZ=null,function(w){let I,M=1;do{let L,k=w;w=null;let B=null;for(I=0;k;){I++;let V=k,N=0;for(let H=0;H<M&&(N++,V=V.nextZ,V);H++);let G=M;for(;N>0||G>0&&V;)N!==0&&(G===0||!V||k.z<=V.z)?(L=k,k=k.nextZ,N--):(L=V,V=V.nextZ,G--),B?B.nextZ=L:w=L,L.prevZ=B,B=L;k=V}B.nextZ=null,M*=2}while(I>1)}(S)}(s,l,f,u);let v=s;for(;s.prev!==s.next;){let T=s.prev,D=s.next;if(u?iP(s,l,f,u):rP(s))e.push(T.i,s.i,D.i),If(s),s=D.next,v=D.next;else if((s=D)===v){p?p===1?Ef(s=oP(Ic(s),e),e,r,l,f,u,2):p===2&&sP(s,e,r,l,f,u):Ef(Ic(s),e,r,l,f,u,1);break}}}function rP(s){let e=s.prev,r=s,l=s.next;if(Pr(e,r,l)>=0)return!1;let f=e.x,u=r.x,p=l.x,v=e.y,T=r.y,D=l.y,_=f<u?f<p?f:p:u<p?u:p,E=v<T?v<D?v:D:T<D?T:D,S=f>u?f>p?f:p:u>p?u:p,w=v>T?v>D?v:D:T>D?T:D,I=l.next;for(;I!==e;){if(I.x>=_&&I.x<=S&&I.y>=E&&I.y<=w&&ih(f,v,u,T,p,D,I.x,I.y)&&Pr(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function iP(s,e,r,l){let f=s.prev,u=s,p=s.next;if(Pr(f,u,p)>=0)return!1;let v=f.x,T=u.x,D=p.x,_=f.y,E=u.y,S=p.y,w=v<T?v<D?v:D:T<D?T:D,I=_<E?_<S?_:S:E<S?E:S,M=v>T?v>D?v:D:T>D?T:D,L=_>E?_>S?_:S:E>S?E:S,k=Lv(w,I,e,r,l),B=Lv(M,L,e,r,l),V=s.prevZ,N=s.nextZ;for(;V&&V.z>=k&&N&&N.z<=B;){if(V.x>=w&&V.x<=M&&V.y>=I&&V.y<=L&&V!==f&&V!==p&&ih(v,_,T,E,D,S,V.x,V.y)&&Pr(V.prev,V,V.next)>=0||(V=V.prevZ,N.x>=w&&N.x<=M&&N.y>=I&&N.y<=L&&N!==f&&N!==p&&ih(v,_,T,E,D,S,N.x,N.y)&&Pr(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;V&&V.z>=k;){if(V.x>=w&&V.x<=M&&V.y>=I&&V.y<=L&&V!==f&&V!==p&&ih(v,_,T,E,D,S,V.x,V.y)&&Pr(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;N&&N.z<=B;){if(N.x>=w&&N.x<=M&&N.y>=I&&N.y<=L&&N!==f&&N!==p&&ih(v,_,T,E,D,S,N.x,N.y)&&Pr(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function oP(s,e){let r=s;do{let l=r.prev,f=r.next.next;!cg(l,f)&&Pw(l,r,r.next,f)&&Tf(l,f)&&Tf(f,l)&&(e.push(l.i,r.i,f.i),If(r),If(r.next),r=s=f),r=r.next}while(r!==s);return Ic(r)}function sP(s,e,r,l,f,u){let p=s;do{let v=p.next.next;for(;v!==p.prev;){if(p.i!==v.i&&hP(p,v)){let T=Ow(p,v);return p=Ic(p,p.next),T=Ic(T,T.next),Ef(p,e,r,l,f,u,0),void Ef(T,e,r,l,f,u,0)}v=v.next}p=p.next}while(p!==s)}function aP(s,e){return s.x-e.x}function lP(s,e){let r=function(f,u){let p=u,v=f.x,T=f.y,D,_=-1/0;do{if(T<=p.y&&T>=p.next.y&&p.next.y!==p.y){let M=p.x+(T-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(M<=v&&M>_&&(_=M,D=p.x<p.next.x?p:p.next,M===v))return D}p=p.next}while(p!==u);if(!D)return null;let E=D,S=D.x,w=D.y,I=1/0;p=D;do{if(v>=p.x&&p.x>=S&&v!==p.x&&ih(T<w?v:_,T,S,w,T<w?_:v,T,p.x,p.y)){let M=Math.abs(T-p.y)/(v-p.x);Tf(p,f)&&(M<I||M===I&&(p.x>D.x||p.x===D.x&&cP(D,p)))&&(D=p,I=M)}p=p.next}while(p!==E);return D}(s,e);if(!r)return e;let l=Ow(r,s);return Ic(l,l.next),Ic(r,r.next)}function cP(s,e){return Pr(s.prev,s,e.prev)<0&&Pr(e.next,s,s.next)<0}function Lv(s,e,r,l,f){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-r)*f|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function uP(s){let e=s,r=s;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==s);return r}function ih(s,e,r,l,f,u,p,v){return(f-p)*(e-v)>=(s-p)*(u-v)&&(s-p)*(l-v)>=(r-p)*(e-v)&&(r-p)*(u-v)>=(f-p)*(l-v)}function hP(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(r,l){let f=r;do{if(f.i!==r.i&&f.next.i!==r.i&&f.i!==l.i&&f.next.i!==l.i&&Pw(f,f.next,r,l))return!0;f=f.next}while(f!==r);return!1}(s,e)&&(Tf(s,e)&&Tf(e,s)&&function(r,l){let f=r,u=!1,p=(r.x+l.x)/2,v=(r.y+l.y)/2;do f.y>v!=f.next.y>v&&f.next.y!==f.y&&p<(f.next.x-f.x)*(v-f.y)/(f.next.y-f.y)+f.x&&(u=!u),f=f.next;while(f!==r);return u}(s,e)&&(Pr(s.prev,s,e.prev)||Pr(s,e.prev,e))||cg(s,e)&&Pr(s.prev,s,s.next)>0&&Pr(e.prev,e,e.next)>0)}function Pr(s,e,r){return(e.y-s.y)*(r.x-e.x)-(e.x-s.x)*(r.y-e.y)}function cg(s,e){return s.x===e.x&&s.y===e.y}function Pw(s,e,r,l){let f=hg(Pr(s,e,r)),u=hg(Pr(s,e,l)),p=hg(Pr(r,l,s)),v=hg(Pr(r,l,e));return f!==u&&p!==v||!(f!==0||!ug(s,r,e))||!(u!==0||!ug(s,l,e))||!(p!==0||!ug(r,s,l))||!(v!==0||!ug(r,e,l))}function ug(s,e,r){return e.x<=Math.max(s.x,r.x)&&e.x>=Math.min(s.x,r.x)&&e.y<=Math.max(s.y,r.y)&&e.y>=Math.min(s.y,r.y)}function hg(s){return s>0?1:s<0?-1:0}function Tf(s,e){return Pr(s.prev,s,s.next)<0?Pr(s,e,s.next)>=0&&Pr(s,s.prev,e)>=0:Pr(s,e,s.prev)<0||Pr(s,s.next,e)<0}function Ow(s,e){let r=kv(s.i,s.x,s.y),l=kv(e.i,e.x,e.y),f=s.next,u=e.prev;return s.next=e,e.prev=s,r.next=f,f.prev=r,l.next=r,r.prev=l,u.next=l,l.prev=u,l}function Lw(s,e,r,l){let f=kv(s,e,r);return l?(f.next=l.next,f.prev=l,l.next.prev=f,l.next=f):(f.prev=f,f.next=f),f}function If(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function kv(s,e,r){return{i:s,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function dg(s,e){let r=s.length;if(r<=1)return[s];let l=[],f,u;for(let p=0;p<r;p++){let v=su(s[p]);v!==0&&(s[p].area=Math.abs(v),u===void 0&&(u=v<0),u===v<0?(f&&l.push(f),f=[s[p]]):f.push(s[p]))}if(f&&l.push(f),e>1)for(let p=0;p<l.length;p++)l[p].length<=e||(sm(l[p],e,1,l[p].length-1,dP),l[p]=l[p].slice(0,e));return l}function dP(s,e){return e.area-s.area}function Fv(s,e,r){let l=r.patternDependencies,f=!1;for(let u of e){let p=u.paint.get(`${s}-pattern`);p.isConstant()||(f=!0);let v=p.constantOr(null);v&&(f=!0,l[v]=!0)}return f}function Nv(s,e,r,l,f){let u=f.patternDependencies;for(let p of e){let v=p.paint.get(`${s}-pattern`).value;if(v.kind!=="constant"){let T=v.evaluate({zoom:l},r,{},f.availableImages);T=T&&T.name?T.name:T,u[T]=!0,r.patterns[p.id]=T}}return r}class zv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Es,this.indexArray=new ir,this.indexArray2=new Is,this.programConfigurations=new xo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new dr,this.segments2=new dr,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}updateFootprints(e,r){}populate(e,r,l,f){this.hasPattern=Fv("fill",this.layers,r);let u=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:v,id:T,index:D,sourceLayerIndex:_}of e){let E=this.layers[0]._featureFilter.needGeometry,S=Ge(v,E);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),S,l))continue;let w=u?u.evaluate(S,{},l,r.availableImages):void 0,I={id:T,properties:v.properties,type:v.type,sourceLayerIndex:_,index:D,geometry:E?S.geometry:Se(v,l,f),patterns:{},sortKey:w};p.push(I)}u&&p.sort((v,T)=>v.sortKey-T.sortKey);for(let v of p){let{geometry:T,index:D,sourceLayerIndex:_}=v;if(this.hasPattern){let E=Nv("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(v,T,D,l,{},r.availableImages,r.brightness);r.featureIndex.insert(e[D].feature,T,D,_,this.index)}}update(e,r,l,f,u){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,p?this.stateDependentLayers:this.layers,l,f,u)}addFeatures(e,r,l,f,u,p){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,l,f,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,l,f,u,p=[],v){for(let T of dg(r,500)){let D=0;for(let M of T)D+=M.length;let _=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),E=_.vertexLength,S=[],w=[];for(let M of T){if(M.length===0)continue;M!==T[0]&&w.push(S.length/2);let L=this.segments2.prepareSegment(M.length,this.layoutVertexArray,this.indexArray2),k=L.vertexLength;this.layoutVertexArray.emplaceBack(M[0].x,M[0].y),this.indexArray2.emplaceBack(k+M.length-1,k),S.push(M[0].x),S.push(M[0].y);for(let B=1;B<M.length;B++)this.layoutVertexArray.emplaceBack(M[B].x,M[B].y),this.indexArray2.emplaceBack(k+B-1,k+B),S.push(M[B].x),S.push(M[B].y);L.vertexLength+=M.length,L.primitiveLength+=M.length}let I=wf(S,w);for(let M=0;M<I.length;M+=3)this.indexArray.emplaceBack(E+I[M],E+I[M+1],E+I[M+2]);_.vertexLength+=D,_.primitiveLength+=I.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,u,p,f,v)}}let kw,Fw,Nw,zw;ht(zv,"FillBucket",{omit:["layers","patternFeatures"]});class Bv{constructor(e,r,l,f){if(this.triangleCount=r.length/3,this.min=new it(0,0),this.max=new it(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[u,p]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){let S=e[E];u.x=Math.min(u.x,S.x),u.y=Math.min(u.y,S.y),p.x=Math.max(p.x,S.x),p.y=Math.max(p.y,S.y)}if(f){let E=Math.ceil(Math.max(p.x-u.x,p.y-u.y)/f);l=Math.max(l,E)}if(l===0)return;this.min=u,this.max=p;let v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);let T=Math.max(v.x,v.y)/l;this.cellsX=Math.max(1,Math.ceil(v.x/T)),this.cellsY=Math.max(1,Math.ceil(v.y/T)),this.xScale=1/T,this.yScale=1/T;let D=[];for(let E=0;E<this.triangleCount;E++){let S=e[r[3*E+0]].sub(this.min),w=e[r[3*E+1]].sub(this.min),I=e[r[3*E+2]].sub(this.min),M=Ds(Math.floor(Math.min(S.x,w.x,I.x)),this.xScale,this.cellsX),L=Ds(Math.floor(Math.max(S.x,w.x,I.x)),this.xScale,this.cellsX),k=Ds(Math.floor(Math.min(S.y,w.y,I.y)),this.yScale,this.cellsY),B=Ds(Math.floor(Math.max(S.y,w.y,I.y)),this.yScale,this.cellsY),V=new it(0,0),N=new it(0,0),G=new it(0,0),H=new it(0,0);for(let J=k;J<=B;++J){V.y=N.y=J*T,G.y=H.y=(J+1)*T;for(let oe=M;oe<=L;++oe)V.x=G.x=oe*T,N.x=H.x=(oe+1)*T,(bn(S,w,I,V,N,H)||bn(S,w,I,V,H,G))&&D.push({cellIdx:J*this.cellsX+oe,triIdx:E})}}if(D.length===0)return;D.sort((E,S)=>E.cellIdx-S.cellIdx||E.triIdx-S.triIdx);let _=0;for(;_<D.length;){let E=D[_].cellIdx,S={start:this.payload.length,len:0};for(;_<D.length&&D[_].cellIdx===E;)++S.len,this.payload.push(D[_++].triIdx);this.cells[E]=S}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let l=Ds(e.x-this.min.x,this.xScale,this.cellsX),f=Ds(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[f*this.cellsX+l];if(u){this._lazyInitLookup();for(let p=0;p<u.len;p++){let v=this.payload[u.start+p],T=Math.floor(v/8),D=1<<v%8;if(!(this.lookup[T]&D)&&(this.lookup[T]|=D,r.push(v),r.length===this.triangleCount))return}}}query(e,r,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();let f=Ds(e.x-this.min.x,this.xScale,this.cellsX),u=Ds(r.x-this.min.x,this.xScale,this.cellsX),p=Ds(e.y-this.min.y,this.yScale,this.cellsY),v=Ds(r.y-this.min.y,this.yScale,this.cellsY);for(let T=p;T<=v;T++)for(let D=f;D<=u;D++){let _=this.cells[T*this.cellsX+D];if(_)for(let E=0;E<_.len;E++){let S=this.payload[_.start+E],w=Math.floor(S/8),I=1<<S%8;if(!(this.lookup[w]&I)&&(this.lookup[w]|=I,l.push(S),l.length===this.triangleCount))return}}}}function Ds(s,e,r){return Math.max(0,Math.min(r-1,Math.floor(s*e)))}ht(Bv,"TriangleGridIndex");class Bw{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(e,r){for(let l of this.footprints)r.push({footprint:l,id:e})}populate(e,r,l,f){let u=[];for(let{feature:p,id:v,index:T,sourceLayerIndex:D}of e){let _=this.layers[0]._featureFilter.needGeometry,E=Ge(p,_);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),E,l))continue;let S={id:v,properties:p.properties,type:p.type,sourceLayerIndex:D,index:T,geometry:_?E.geometry:Se(p,l,f),patterns:{}};u.push(S)}for(let p of u){let{geometry:v,index:T,sourceLayerIndex:D}=p;this.addFeature(p,v,T,l,{},r.availableImages,r.brightness),r.featureIndex.insert(e[T].feature,v,T,D,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,l,f,u){}destroy(){}addFeature(e,r,l,f,u,p=[],v){for(let T of dg(r,2)){let D=[],_=[],E=[],S=new it(1/0,1/0),w=new it(-1/0,-1/0);for(let L of T)if(L.length!==0){L!==T[0]&&E.push(_.length/2);for(let k=0;k<L.length;k++)_.push(L[k].x),_.push(L[k].y),D.push(L[k]),S.x=Math.min(S.x,L[k].x),S.y=Math.min(S.y,L[k].y),w.x=Math.max(w.x,L[k].x),w.y=Math.max(w.y,L[k].y)}let I=wf(_,E),M=new Bv(D,I,8,256);this.footprints.push({vertices:D,indices:I,grid:M,min:S,max:w})}}}ht(Bw,"ClipBucket",{omit:["layers"]});let fP=gn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pP=gn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),mP=gn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),gP=gn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),_P=gn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),yP=gn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:vP}=fP;var Vv,Vw,jv,jw,Uv,Uw,$w,fg={};function Gw(){if(Vw)return Vv;Vw=1;var s=Bl();function e(f,u,p,v,T){this.properties={},this.extent=p,this.type=0,this._pbf=f,this._geometry=-1,this._keys=v,this._values=T,f.readFields(r,this,u)}function r(f,u,p){f==1?u.id=p.readVarint():f==2?function(v,T){for(var D=v.readVarint()+v.pos;v.pos<D;){var _=T._keys[v.readVarint()],E=T._values[v.readVarint()];T.properties[_]=E}}(p,u):f==3?u.type=p.readVarint():f==4&&(u._geometry=p.pos)}function l(f){for(var u,p,v=0,T=0,D=f.length,_=D-1;T<D;_=T++)v+=((p=f[_]).x-(u=f[T]).x)*(u.y+p.y);return v}return Vv=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var u,p=f.readVarint()+f.pos,v=1,T=0,D=0,_=0,E=[];f.pos<p;){if(T<=0){var S=f.readVarint();v=7&S,T=S>>3}if(T--,v===1||v===2)D+=f.readSVarint(),_+=f.readSVarint(),v===1&&(u&&E.push(u),u=[]),u.push(new s(D,_));else{if(v!==7)throw new Error("unknown command "+v);u&&u.push(u[0].clone())}}return u&&E.push(u),E},e.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var u=f.readVarint()+f.pos,p=1,v=0,T=0,D=0,_=1/0,E=-1/0,S=1/0,w=-1/0;f.pos<u;){if(v<=0){var I=f.readVarint();p=7&I,v=I>>3}if(v--,p===1||p===2)(T+=f.readSVarint())<_&&(_=T),T>E&&(E=T),(D+=f.readSVarint())<S&&(S=D),D>w&&(w=D);else if(p!==7)throw new Error("unknown command "+p)}return[_,S,E,w]},e.prototype.toGeoJSON=function(f,u,p){var v,T,D=this.extent*Math.pow(2,p),_=this.extent*f,E=this.extent*u,S=this.loadGeometry(),w=e.types[this.type];function I(k){for(var B=0;B<k.length;B++){var V=k[B];k[B]=[360*(V.x+_)/D-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+E)/D)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(v=0;v<S.length;v++)M[v]=S[v][0];I(S=M);break;case 2:for(v=0;v<S.length;v++)I(S[v]);break;case 3:for(S=function(k){var B=k.length;if(B<=1)return[k];for(var V,N,G=[],H=0;H<B;H++){var J=l(k[H]);J!==0&&(N===void 0&&(N=J<0),N===J<0?(V&&G.push(V),V=[k[H]]):V.push(k[H]))}return V&&G.push(V),G}(S),v=0;v<S.length;v++)for(T=0;T<S[v].length;T++)I(S[v][T])}S.length===1?S=S[0]:w="Multi"+w;var L={type:"Feature",geometry:{type:w,coordinates:S},properties:this.properties};return"id"in this&&(L.id=this.id),L},Vv}function Hw(){if(jw)return jv;jw=1;var s=Gw();function e(l,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(r,this,f),this.length=this._features.length}function r(l,f,u){l===15?f.version=u.readVarint():l===1?f.name=u.readString():l===5?f.extent=u.readVarint():l===2?f._features.push(u.pos):l===3?f._keys.push(u.readString()):l===4&&f._values.push(function(p){for(var v=null,T=p.readVarint()+p.pos;p.pos<T;){var D=p.readVarint()>>3;v=D===1?p.readString():D===2?p.readFloat():D===3?p.readDouble():D===4?p.readVarint64():D===5?p.readVarint():D===6?p.readSVarint():D===7?p.readBoolean():null}return v}(u))}return jv=e,e.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var f=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,f,this.extent,this._keys,this._values)},jv}function qw(){return $w||($w=1,fg.VectorTile=function(){if(Uw)return Uv;Uw=1;var s=Hw();function e(r,l,f){if(r===3){var u=new s(f,f.readVarint()+f.pos);u.length&&(l[u.name]=u)}}return Uv=function(r,l){this.layers=r.readFields(e,{},l)},Uv}(),fg.VectorTileFeature=Gw(),fg.VectorTileLayer=Hw()),fg}var oh=qw();class Sc extends it{constructor(e,r,l){super(e,r),this.z=l}}class Ww extends Sc{constructor(e,r,l,f){super(e,r,l),this.w=f}}function pg(s,e,r,l){let f=[],u=l===0?(p,v,T,D,_,E)=>{p.push(new it(E,T+(E-v)/(D-v)*(_-T)))}:(p,v,T,D,_,E)=>{p.push(new it(v+(E-T)/(_-T)*(D-v),E))};for(let p of s){let v=[];for(let T of p){if(T.length<=2)continue;let D=[];for(let S=0;S<T.length-1;S++){let w=T[S].x,I=T[S].y,M=T[S+1].x,L=T[S+1].y,k=l===0?w:I,B=l===0?M:L;k<e?B>e&&u(D,w,I,M,L,e):k>r?B<r&&u(D,w,I,M,L,r):D.push(T[S]),B<e&&k>=e&&u(D,w,I,M,L,e),B>r&&k<=r&&u(D,w,I,M,L,r)}let _=T[T.length-1],E=l===0?_.x:_.y;E>=e&&E<=r&&D.push(_),D.length&&(_=D[D.length-1],D[0].x===_.x&&D[0].y===_.y||D.push(D[0]),v.push(D))}v.length&&f.push(v)}return f}function Zw(s,e,r,l){let f=r==="x"?"y":"x",u=(l-s[r])/(e[r]-s[r]);s[f]=s[f]+(e[f]-s[f])*u,s[r]=l,s.hasOwnProperty("z")&&(s.z=Mt(s.z,e.z,u)),s.hasOwnProperty("w")&&(s.w=Mt(s.w,e.w,u))}function Xw(s,e,r,l){let f=r,u=l;for(let p of["x","y"]){let v=s,T=e;v[p]>=T[p]&&(v=e,T=s),v[p]<f&&T[p]>f&&Zw(v,T,p,f),v[p]<u&&T[p]>u&&Zw(T,v,p,u)}}let mg=Number.MAX_SAFE_INTEGER;function Yw(s,e,r,l){return s.order<e||s.order===mg||!(s.clipMask&r)||function(f,u){return u.length!==0&&u.find(p=>p===f)===void 0}(l,s.clipScope)}function gg(s,e){return s.x-e.x||s.y-e.y}function Jw(s,e){return gg(s.min,e.min)===0&&gg(s.max,e.max)===0}function $v(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function Gv(s,e){if(s.length!==e.length)return!1;for(let r=0;r<s.length;r++)if(s[r].sourceId!==e[r].sourceId||!Jw(s[r],e[r])||s[r].order!==e[r].order||s[r].clipMask!==e[r].clipMask||!js(s[r].clipScope,e[r].clipScope))return!1;return!0}function Kw(s,e,r){let l=1/ot,f=1/(1<<r.canonical.z),u=(e.x*l+r.canonical.x)*f+r.wrap,p=(e.y*l+r.canonical.y)*f;return{min:new it((s.x*l+r.canonical.x)*f+r.wrap,(s.y*l+r.canonical.y)*f),max:new it(u,p)}}function xP(s,e,r){let l=1<<r.canonical.z,f=((e.x-r.wrap)*l-r.canonical.x)*ot,u=(e.y*l-r.canonical.y)*ot;return{min:new it(((s.x-r.wrap)*l-r.canonical.x)*ot,(s.y*l-r.canonical.y)*ot),max:new it(f,u)}}function Qw(s,e,r,l,f,u,p){let v=s.indices,T=s.vertices,D=[];for(let _=l;_<l+f;_+=3){let E=e[r[_+0]+u],S=e[r[_+1]+u],w=e[r[_+2]+u],I=Math.min(E.x,S.x,w.x),M=Math.max(E.x,S.x,w.x),L=Math.min(E.y,S.y,w.y),k=Math.max(E.y,S.y,w.y);D.length=0,s.grid.query(new it(I,L),new it(M,k),D);for(let B=0;B<D.length;B++){let V=D[B];if(bn(T[v[3*V+0]],T[v[3*V+1]],T[v[3*V+2]],E,S,w,p))return!0}}return!1}function eE(s,e,r,l){if(!s||!r)return!1;let f=s.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(r.vertices.length<s.vertices.length)return eE(r,l,s,e);let u=e.canonical,p=l.canonical,v=Math.pow(2,p.z-u.z);f=s.vertices.map(T=>new it((T.x+u.x*ot)*v-p.x*ot,(T.y+u.y*ot)*v-p.y*ot))}return Qw(r,f,s.indices,0,s.indices.length,0,0)}function tE(s,e,r,l){let f=Math.pow(2,l.z-r.z);return new it((s+r.x*ot)*f-l.x*ot,(e+r.y*ot)*f-l.y*ot)}function nE(s,e){let r=[];e.grid.queryPoint(s,r);let l=e.indices,f=e.vertices;for(let u=0;u<r.length;u++){let p=r[u];if(tn([f[l[3*p+0]],f[l[3*p+1]],f[l[3*p+2]]],s))return!0}return!1}let Hv=[new it(0,0),new it(ot,0),new it(ot,ot),new it(0,ot)];function rE(s,e){let r=[],l=[];if(!e||s.length<2)return[s];if(s.length===2)return fn(s[0],s[1],Hv)?[s]:[];for(let f=0;f<s.length+2;f++){let u=s[f%s.length],p=s[(f+1)%s.length],v=fn(f===0?s[s.length-1]:s[(f-1)%s.length],u,Hv),T=fn(u,p,Hv),D=v||T;D&&l.push(u),D&&T||l.length>0&&(l.length>1&&r.push(l),l=[])}return l.length>1&&r.push(l),r}let qv=oh.VectorTileFeature.types,bP=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],wP=["fill-extrusion-flood-light-ground-radius"],EP=Math.pow(2,13),TP=Math.pow(2,15)-1,iE=new it(0,1),fl=2147483648;function Sf(s,e,r,l,f,u,p,v){s.emplaceBack((e<<1)+p,(r<<1)+u,(Math.floor(l*EP)<<1)+f,Math.round(v))}function Df(s,e,r){s.emplaceBack(e.x*ot,e.y*ot,r?1:0)}function _g(s,e,r,l,f,u){s.emplaceBack(e.x,e.y,(r.x<<1)+l,(r.y<<1)+f,u)}function Cf(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class oE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class sE{constructor(){this.centroidXY=new it(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new it(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new it(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new it(this.max.x-this.min.x,this.max.y-this.min.y)}}class aE{constructor(){this.acc=new it(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,l){this.accCount++,this.acc._add(r);let f=!!this.borders;r.x<e.min.x?(e.min.x=r.x,f=!0):r.x>e.max.x&&(e.max.x=r.x,f=!0),r.y<e.min.y?(e.min.y=r.y,f=!0):r.y>e.max.y&&(e.max.y=r.y,f=!0),((r.x===0||r.x===ot)&&r.x===l.x)!=((r.y===0||r.y===ot)&&r.y===l.y)&&this.processBorderOverlap(r,l),f&&this.checkBorderIntersection(r,l)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Mt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>ot!=e.x>ot&&this.addBorderIntersection(1,Mt(r.y,e.y,(ot-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Mt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>ot!=e.y>ot&&this.addBorderIntersection(3,Mt(r.x,e.x,(ot-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let l=this.borders[e];r<l[0]&&(l[0]=r),r>l[1]&&(l[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;let l=e.x===0?0:1;this.addBorderIntersection(l,r.y),this.addBorderIntersection(l,e.y)}else{let l=e.y===0?2:3;this.addBorderIntersection(l,r.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new it(0,0):new it(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function lE(s,e){let r=s.add(e)._unit(),l=zt(s.x*r.x+s.y*r.y,-1,1);var f,u,p;return p=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(p)))/4*TP*((f=s).x*(u=e).y-f.y*u.x<0?-1:1)}let IP=[s=>s.x<0,s=>s.x>ot,s=>s.y<0,s=>s.y>ot];function SP(s,e,r,l){let f=[4];if(l===0)return f;r._mult(l);let u=s.sub(r),p=e.sub(r),v=[s,e,u,p];for(let T=0;T<4;T++)for(let D of v)if(IP[T](D)){f.push(T);break}return f}class cE{constructor(e){this.vertexArray=new of,this.indexArray=new ir,this.programConfigurations=new xo(e.layers,{zoom:e.zoom,lut:e.lut},r=>wP.includes(r)),this._segments=new dr,this.hiddenByLandmarkVertexArray=new Ku,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new dr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,l,f=!1){let u=e.length;if(u>2){let p=Math.max(0,this._segments.get().length-1),v=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),T;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let D=e[0],_=e[1];T=lE(D.sub(e[u-1])._perp()._unit(),_.sub(D)._perp()._unit())}for(let D=0;D<u;D++){let _=D===u-1?0:D+1,E=e[D],S=e[_],w=e[_===u-1?0:_+1],I=S.sub(E)._perp()._unit(),M=lE(I,w.sub(S)._perp()._unit()),L=T,k=M;if(Wv(E,S,r)||f&&dE(E,r)&&dE(S,r)){T=M;continue}let B=v.vertexLength;_g(this.vertexArray,E,S,1,1,L),_g(this.vertexArray,E,S,1,0,L),_g(this.vertexArray,E,S,0,1,k),_g(this.vertexArray,E,S,0,0,k),v.vertexLength+=4;let V=SP(E,S,I,l);for(let N of V)this._segmentToGroundQuads[p].push({id:B,region:N}),this._segmentToRegionTriCounts[p][N]+=2,v.primitiveLength+=2;T=M}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),r=e.length;for(let l=0;l<r;l++)this._segmentToGroundQuads[l].sort((f,u)=>f.region-u.region);for(let l=0;l<r;l++){let f=this._segmentToGroundQuads[l],u=e[l],p=this._segmentToRegionTriCounts[l];p.reduce((T,D)=>T+D,0);let v=0;for(let T=0;T<=4;T++){let D=p[T];if(D!==0){let _=this.regionSegments[T];_||(_=this.regionSegments[T]=new dr);let E={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+v,vertexLength:u.vertexLength,primitiveLength:D};_.get().push(E)}v+=D}for(let T=0;T<f.length;T++){let D=f[T].id;this.indexArray.emplaceBack(D,D+1,D+3),this.indexArray.emplaceBack(D,D+3,D+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,l,f,u,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,l,f,u,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,pP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,l,f,u,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,l,f,u,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let l=e.flags&fl?1:0;for(let f=e.groundVertexArrayOffset;f<r;++f)this.hiddenByLandmarkVertexArray.emplace(f,l);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,_P.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let r=this.regionSegments[e];r&&r.destroy()}}}}class yg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ir,this.footprintVertices=new Es,this.footprintSegments=[],this.layoutVertexArray=new tl,this.centroidVertexArray=new Km,this.wallVertexArray=new pf,this.indexArray=new ir,this.programConfigurations=new xo(e.layers,{zoom:e.zoom,lut:e.lut},r=>bP.includes(r)),this.segments=new dr,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new cE(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,r){}populate(e,r,l,f){this.features=[],this.hasPattern=Fv("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=me(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:u,id:p,index:v,sourceLayerIndex:T}of e){let D=this.layers[0]._featureFilter.needGeometry,_=Ge(u,D);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),_,l))continue;let E={id:p,sourceLayerIndex:T,index:v,geometry:D?_.geometry:Se(u,l,f),properties:u.properties,type:u.type,patterns:{}},S=this.layoutVertexArray.length,w=qv[E.type]==="Polygon";if(this.hasPattern)this.features.push(Nv("fill-extrusion",this.layers,E,this.zoom,r));else if(this.wallMode)for(let I of E.geometry)for(let M of rE(I,w))this.addFeature(E,[M],v,l,{},r.availableImages,f,r.brightness);else this.addFeature(E,E.geometry,v,l,{},r.availableImages,f,r.brightness);r.featureIndex.insert(u,E.geometry,v,T,this.index,S)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,l,f,u,p){for(let v of this.features){let T=qv[v.type]==="Polygon",{geometry:D}=v;if(this.wallMode)for(let _ of D)for(let E of rE(_,T))this.addFeature(v,[E],v.index,r,l,f,u,p);else this.addFeature(v,D,v.index,r,l,f,u,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,l,f,u){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let v=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,r,v,l,f,u),this.groundEffect.update(e,r,v,l,f,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,gP.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,yP.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,mP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,l,f,u,p,v,T){let D=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,_=[new it(0,0),new it(ot,ot)],E=v.projection,S=E.name==="globe",w=this.wallMode||qv[e.type]==="Polygon",I=new aE;I.centroidDataIndex=this.centroidData.length;let M=new sE,L=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},f)<=0,k=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},f),B;if(M.height=k,M.vertexArrayOffset=this.layoutVertexArray.length,M.groundVertexArrayOffset=this.groundEffect.vertexArray.length,S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new gc),this.wallMode){if(S)return void ln("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;B=function(ne){let pe=ne[0].x===ne[ne.length-1].x&&ne[0].y===ne[ne.length-1].y;(function(et){let Xe=0,wt=et.length;for(let ct=0;ct<wt;ct++)Xe+=(et[(ct+1)%wt].x-et[ct].x)*(et[(ct+1)%wt].y+et[ct].y);return Xe>=0})(ne)||(ne=ne.reverse());let de={geometry:[],joinNormals:[],indices:[]},ye=[],ve=[],Ee=[],Me=ne.length;if(Me<(pe?3:2))return de;for(;Me>=2&&ne[Me-1].equals(ne[Me-2]);)Me--;let Re,De,Ue,Je,ze,ut=0;for(;ut<Me-1&&ne[ut].equals(ne[ut+1]);)ut++;pe&&(Re=ne[Me-2],ze=ne[ut].sub(Re)._unit()._perp());for(let et=ut;et<Me;et++){if(Ue=et===Me-1?pe?ne[ut+1]:void 0:ne[et+1],Ue&&ne[et].equals(Ue))continue;ze&&(Je=ze),Re&&(De=Re),Re=ne[et],ze=Ue?Ue.sub(Re)._unit()._perp():Je,Je=Je||ze;let Xe=Je.add(ze);Xe.x===0&&Xe.y===0||Xe._unit();let wt=Xe.x*ze.x+Xe.y*ze.y,ct=wt!==0?1/wt:1/0,ft=Je.x*ze.y-Je.y*ze.x>0,Nt="miter",Ht=2;Nt==="miter"&&ct>Ht&&(Nt="bevel"),Nt==="bevel"&&(ct>100&&(Nt="flipbevel"),ct<Ht&&(Nt="miter"));let Wt=($t,Kt,Yt,Un)=>{let Fn=new it($t.x,$t.y),At=new it($t.x,$t.y);Fn.x+=Kt.x*Un,Fn.y+=Kt.y*Un,At.x-=Kt.x*Math.max(Yt,1),At.y-=Kt.y*Math.max(Yt,1),Ee.push(Kt),ye.push(Fn),ve.push(At)};if(Nt==="miter")Xe._mult(ct),Wt(Re,Xe,0,0);else if(Nt==="flipbevel")Xe=ze.mult(-1),Wt(Re,Xe,0,0),Wt(Re,Xe.mult(-1),0,0);else{let $t=-Math.sqrt(ct*ct-1),Kt=ft?$t:0,Yt=ft?0:$t;De&&Wt(Re,Je,Kt,Yt),Ue&&Wt(Re,ze,Kt,Yt)}}de.geometry=[...ye,...ve.reverse(),ye[0]],de.joinNormals=[...Ee,...Ee.reverse(),Ee[Ee.length-1]];let rt=de.geometry.length-1;for(let et=0;et<rt/2;et++)if(et+1<rt/2){let Xe=et,wt=et+1,ct=rt-1-et,ft=rt-2-et;Xe=Xe===0?rt-1:Xe-1,wt=wt===0?rt-1:wt-1,ct=ct===0?rt-1:ct-1,ft=ft===0?rt-1:ft-1,de.indices.push(ct),de.indices.push(wt),de.indices.push(Xe),de.indices.push(ct),de.indices.push(ft),de.indices.push(wt)}return de}(r[0]),r=[B.geometry]}let V=(ne,pe)=>ne<(pe.length-1)/2||ne===pe.length-1,N=this.wallMode?[r]:dg(r,500);for(let ne=N.length-1;ne>=0;ne--){let pe=N[ne];(pe.length===0||(G=pe[0]).every(te=>te.x<=0)||G.every(te=>te.x>=ot)||G.every(te=>te.y<=0)||G.every(te=>te.y>=ot))&&N.splice(ne,1)}var G;let H;if(S)H=gE(N,_,f);else{H=[];for(let ne of N)H.push({polygon:ne,bounds:_})}let J=w?this.edgeRadius:0,oe=J>0&&this.zoom<17,ee=(ne,pe)=>{if(ne.length===0)return!1;let te=ne[ne.length-1];return pe.x===te.x&&pe.y===te.y};for(let{polygon:ne,bounds:pe}of H){let te=0,de=0;for(let Me of ne)w&&!Me[0].equals(Me[Me.length-1])&&Me.push(Me[0]),de+=w?Me.length-1:Me.length;let ye=this.segments.prepareSegment((w?5:4)*de,this.layoutVertexArray,this.indexArray);M.footprintSegIdx<0&&(M.footprintSegIdx=this.footprintSegments.length),M.polygonSegIdx<0&&(M.polygonSegIdx=this.polygonSegments.length);let ve={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ee=new oE;if(Ee.vertexOffset=this.footprintVertices.length,Ee.indexOffset=3*this.footprintIndices.length,Ee.ringIndices=[],w){let Me=[],Re=[];te=ye.vertexLength;for(let Ue=0;Ue<ne.length;Ue++){let Je=ne[Ue];Je.length&&Ue!==0&&Re.push(Me.length/2);let ze=[],ut,rt;ut=Je[1].sub(Je[0])._perp()._unit(),Ee.ringIndices.push(Je.length-1);for(let et=1;et<Je.length;et++){let Xe=Je[et],wt=Je[et===Je.length-1?1:et+1],ct=Xe.clone();if(J){rt=wt.sub(Xe)._perp()._unit();let ft=ut.add(rt)._unit(),Nt=J*Math.min(4,1/(ut.x*ft.x+ut.y*ft.y));ct.x+=Nt*ft.x,ct.y+=Nt*ft.y,ct.x=Math.round(ct.x),ct.y=Math.round(ct.y),ut=rt}if(!L||J!==0&&!oe||ee(ze,ct)||ze.push(ct),Sf(this.layoutVertexArray,ct.x,ct.y,0,0,1,1,0),this.wallMode){let ft=V(et,Je);Df(this.wallVertexArray,B.joinNormals[et],!ft)}ye.vertexLength++,this.footprintVertices.emplaceBack(Xe.x,Xe.y),Me.push(Xe.x,Xe.y),S&&Cf(this.layoutVertexExtArray,E.projectTilePoint(ct.x,ct.y,f),E.upVector(f,ct.x,ct.y))}L&&(J===0||oe)&&(ze.length!==0&&ee(ze,ze[0])&&ze.pop(),this.groundEffect.addData(ze,pe,D))}let De=this.wallMode?B.indices:wf(Me,Re);for(let Ue=0;Ue<De.length;Ue+=3)this.footprintIndices.emplaceBack(Ee.vertexOffset+De[Ue+0],Ee.vertexOffset+De[Ue+1],Ee.vertexOffset+De[Ue+2]),this.indexArray.emplaceBack(te+De[Ue],te+De[Ue+2],te+De[Ue+1]),ye.primitiveLength++;Ee.indexCount+=De.length,Ee.vertexCount+=this.footprintVertices.length-Ee.vertexOffset}for(let Me=0;Me<ne.length;Me++){let Re=ne[Me];I.startRing(M,Re[0]);let De=Re.length>4&&fE(Re[Re.length-2],Re[0],Re[1]),Ue=J?DP(Re[Re.length-2],Re[0],Re[1],J):0,Je=[],ze,ut,rt;ut=Re[1].sub(Re[0])._perp()._unit();let et=!0;for(let Xe=1,wt=0;Xe<Re.length;Xe++){let ct=Re[Xe-1],ft=Re[Xe],Nt=Re[Xe===Re.length-1?1:Xe+1];if(I.appendEdge(M,ft,ct),Wv(ft,ct,pe)){J&&(ut=Nt.sub(ft)._perp()._unit(),et=!et);continue}let Ht=ft.sub(ct)._perp(),Wt=Ht.x/(Math.abs(Ht.x)+Math.abs(Ht.y)),$t=Ht.y>0?1:0,Kt=ct.dist(ft);if(wt+Kt>32768&&(wt=0),J){rt=Nt.sub(ft)._perp()._unit();let At=hE(ct,ft,Nt,uE(ut,rt),J);isNaN(At)&&(At=0);let In=ft.sub(ct)._unit();ct=ct.add(In.mult(Ue))._round(),ft=ft.add(In.mult(-At))._round(),Ue=At,ut=rt,L&&this.zoom>=17&&(ee(Je,ct)||Je.push(ct),ee(Je,ft)||Je.push(ft))}let Yt=ye.vertexLength,Un=Re.length>4&&fE(ct,ft,Nt),Fn=pE(wt,De,et);if(Sf(this.layoutVertexArray,ct.x,ct.y,Wt,$t,0,0,Fn),Sf(this.layoutVertexArray,ct.x,ct.y,Wt,$t,0,1,Fn),this.wallMode){let At=V(Xe-1,Re),In=B.joinNormals[Xe-1];Df(this.wallVertexArray,In,At),Df(this.wallVertexArray,In,At)}if(wt+=Kt,Fn=pE(wt,Un,!et),De=Un,Sf(this.layoutVertexArray,ft.x,ft.y,Wt,$t,0,0,Fn),Sf(this.layoutVertexArray,ft.x,ft.y,Wt,$t,0,1,Fn),this.wallMode){let At=V(Xe,Re),In=B.joinNormals[Xe];Df(this.wallVertexArray,In,At),Df(this.wallVertexArray,In,At)}if(ye.vertexLength+=4,this.indexArray.emplaceBack(Yt+0,Yt+1,Yt+2),this.indexArray.emplaceBack(Yt+1,Yt+3,Yt+2),ye.primitiveLength+=2,J){let At=te+(Xe===1?Re.length-2:Xe-2),In=Xe===1?te:At+1;if(this.indexArray.emplaceBack(Yt+1,At,Yt+3),this.indexArray.emplaceBack(At,In,Yt+3),ye.primitiveLength+=2,ze===void 0&&(ze=Yt),!Wv(Nt,Re[Xe],pe)){let An=Xe===Re.length-1?ze:ye.vertexLength;this.indexArray.emplaceBack(Yt+2,Yt+3,An),this.indexArray.emplaceBack(Yt+3,An+1,An),this.indexArray.emplaceBack(Yt+3,In,An+1),ye.primitiveLength+=3}et=!et}if(S){let At=this.layoutVertexExtArray,In=E.projectTilePoint(ct.x,ct.y,f),An=E.projectTilePoint(ft.x,ft.y,f),tr=E.upVector(f,ct.x,ct.y),_r=E.upVector(f,ft.x,ft.y);Cf(At,In,tr),Cf(At,In,tr),Cf(At,An,_r),Cf(At,An,_r)}}w&&(te+=Re.length-1),L&&J&&this.zoom>=17&&(Je.length!==0&&ee(Je,Je[0])&&Je.pop(),this.groundEffect.addData(Je,pe,D,J>0))}this.footprintSegments.push(Ee),ve.triangleCount=this.indexArray.length-ve.triangleArrayOffset,this.polygonSegments.push(ve),++M.footprintSegLen,++M.polygonSegLen}if(M.vertexCount=this.layoutVertexArray.length-M.vertexArrayOffset,M.groundVertexCount=this.groundEffect.vertexArray.length-M.groundVertexArrayOffset,M.vertexCount!==0){if(M.centroidXY=I.borders?iE:this.encodeCentroid(I,M),this.centroidData.push(M),I.borders){this.featuresOnBorder.push(I);let ne=this.featuresOnBorder.length-1;for(let pe=0;pe<I.borders.length;pe++)I.borders[pe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[pe].push(ne)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,u,p,f,T),this.groundEffect.addPaintPropertiesData(e,l,u,p,f,T),this.maxHeight=Math.max(this.maxHeight,k)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,l)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){let e=[];for(let v=0;v<this.centroidData.length;v++){let T=this.centroidData[v],D=+(T.min.y+T.max.y>ot),_=2*D+(+(T.min.x+T.max.x>ot)^D);for(let E=0;E<T.polygonSegLen;E++){let S=T.polygonSegIdx+E;e.push({centroidIdx:v,subtile:_,polygonSegmentIdx:S,triangleSegmentIdx:this.polygonSegments[S].triangleSegIdx})}}let r=new ir;e.sort((v,T)=>v.triangleSegmentIdx===T.triangleSegmentIdx?v.subtile-T.subtile:v.triangleSegmentIdx-T.triangleSegmentIdx);let l=0,f=0,u=0;for(let v of e){if(v.triangleSegmentIdx!==l)break;u++}let p=e.length;for(;f!==e.length;){l=e[f].triangleSegmentIdx;let v=0,T=f,D=f;for(let _=T;_<u&&e[_].subtile===v;_++)D++;for(;T!==u;){let _=e[T];v=_.subtile;let E=this.centroidData[_.centroidIdx].min.clone(),S=this.centroidData[_.centroidIdx].max.clone(),w={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let I=T;I<D;I++){let M=e[I],L=this.polygonSegments[M.polygonSegmentIdx],k=this.centroidData[M.centroidIdx].min,B=this.centroidData[M.centroidIdx].max,V=this.indexArray.uint16;for(let N=L.triangleArrayOffset;N<L.triangleArrayOffset+L.triangleCount;N++)r.emplaceBack(V[3*N],V[3*N+1],V[3*N+2]);w.primitiveLength+=L.triangleCount,E.x=Math.min(E.x,k.x),E.y=Math.min(E.y,k.y),S.x=Math.max(S.x,B.x),S.y=Math.max(S.y,B.y)}w.primitiveLength>0&&this.triangleSubSegments.push({segment:w,min:E,max:S}),T=D;for(let I=T;I<u&&e[I].subtile===e[T].subtile;I++)D++}f=u;for(let _=f;_<p&&e[_].triangleSegmentIdx===e[f].triangleSegmentIdx;_++)u++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,l){let f=new dr;if(this.wallMode){for(let M of this.triangleSubSegments)f.segments.push(M.segment);return f}let u=0,p=0,v=1<<e.canonical.z;if(r){let M=r.getMinMaxForTile(e);M&&(u=M.min,p=M.max)}p+=this.maxHeight;let T=e.toUnwrapped(),D,_=[T.canonical.x/v+T.wrap,T.canonical.y/v],E=[(T.canonical.x+1)/v+T.wrap,(T.canonical.y+1)/v],S=(M,L,k)=>[M[0]*(1-k[0])+L[0]*k[0],M[1]*(1-k[1])+L[1]*k[1]],w=[],I=[];for(let M of this.triangleSubSegments){w[0]=M.min.x/ot,w[1]=M.min.y/ot,I[0]=M.max.x/ot,I[1]=M.max.y/ot;let L=S(_,E,w),k=S(_,E,I);if(new Mn([L[0],L[1],u],[k[0],k[1],p]).intersectsPrecise(l)===0){D&&(f.segments.push(D),D=void 0);continue}let B=M.segment;D&&D.vertexOffset!==B.vertexOffset&&(f.segments.push(D),D=void 0),D?(D.vertexLength+=B.vertexLength,D.primitiveLength+=B.primitiveLength):D={vertexOffset:B.vertexOffset,primitiveLength:B.primitiveLength,vertexLength:B.vertexLength,primitiveOffset:B.primitiveOffset,sortKey:void 0,vaos:{}}}return D&&f.segments.push(D),f}encodeCentroid(e,r){let l=e.centroid(),f=r.span(),u=Math.min(7,Math.round(f.x*this.tileToMeter/10)),p=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new it(zt(l.x,1,ot-1)<<3|u,zt(l.y,1,ot-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new it(0,0);let r=e.borders,l=Number.MAX_VALUE;if(r[0][0]!==l||r[1][0]!==l){let f=r[0][0]!==l?0:1;return new it(6|(r[0][0]!==l?0:65528),(r[f][0]+r[f][1])/2<<3|6)}{let f=r[2][0]!==l?2:3;return new it((r[f][0]+r[f][1])/2<<3|6,6|(r[2][0]!==l?0:65528))}}showCentroid(e){let r=this.centroidData[e.centroidDataIndex];r.flags&=fl,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let r=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,f=e.flags&fl?iE:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==f.y||u!==f.x){for(let p=r;p<l;++p)this.centroidVertexArray.emplace(p,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,l){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;let f=r.getReplacementRegionsForTile(e.toUnwrapped());if(Gv(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let u=[];for(let p of this.activeReplacements){if(p.order<l)continue;let v=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(let T of this.centroidData)if(!(T.flags&fl||p.min.x>T.max.x||T.min.x>p.max.x||p.min.y>T.max.y||T.min.y>p.max.y))for(let D=0;D<T.footprintSegLen;D++){let _=this.footprintSegments[T.footprintSegIdx+D];if(u.length=0,CP(this.footprintVertices,_.vertexOffset,_.vertexCount,p.footprintTileId.canonical,e.canonical,u),Qw(p.footprint,u,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-v)){T.flags|=fl;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,l){let f=!1;for(let u=0;u<l.footprintSegLen;u++){let p=this.footprintSegments[l.footprintSegIdx+u],v=0;for(let T of p.ringIndices){for(let D=v,_=T+v-1;D<T+v;_=D++){let E=this.footprintVertices.int16[2*(D+p.vertexOffset)+0],S=this.footprintVertices.int16[2*(D+p.vertexOffset)+1],w=this.footprintVertices.int16[2*(_+p.vertexOffset)+1];S>r!=w>r&&e<(this.footprintVertices.int16[2*(_+p.vertexOffset)+0]-E)*(r-S)/(w-S)+E&&(f=!f)}v=T}}return f}getHeightAtTileCoord(e,r){let l=Number.NEGATIVE_INFINITY,f=!0,u=4*(e+ot)*ot+(r+ot);if(this.partLookup.hasOwnProperty(u)){let p=this.partLookup[u];return p?{height:p.height,hidden:!!(p.flags&fl)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||r>p.max.y||p.min.y>r||this.footprintContainsPoint(e,r,p)&&p&&p.height>l&&(l=p.height,this.partLookup[u]=p,f=!!(p.flags&fl));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:f};this.partLookup[u]=void 0}}function uE(s,e){let r=s.add(e)._unit();return s.x*r.x+s.y*r.y}function DP(s,e,r,l){let f=e.sub(s)._perp()._unit(),u=r.sub(e)._perp()._unit();return hE(s,e,r,uE(f,u),l)}function hE(s,e,r,l,f){let u=Math.sqrt(1-l*l);return Math.min(s.dist(e)/3,e.dist(r)/3,f*u/l)}function Wv(s,e,r){return s.x<r[0].x&&e.x<r[0].x||s.x>r[1].x&&e.x>r[1].x||s.y<r[0].y&&e.y<r[0].y||s.y>r[1].y&&e.y>r[1].y}function dE(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function fE(s,e,r){if(s.x<0||s.x>=ot||e.x<0||e.x>=ot||r.x<0||r.x>=ot)return!1;let l=r.sub(e),f=l.perp(),u=s.sub(e);return(l.x*u.x+l.y*u.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(u.x*u.x+u.y*u.y))>-.866&&f.x*u.x+f.y*u.y<0}function pE(s,e,r){let l=e?2|s:-3&s;return r?1|l:-2&l}function mE(){let s=Math.PI/32,e=Math.tan(s),r=A;return r*Math.sqrt(1+2*e*e)-r}function gE(s,e,r){let l=1<<r.z,f=Q(r.x/l),u=Q((r.x+1)/l),p=re(r.y/l),v=re((r.y+1)/l);return function(T,D,_,E,S=0,w){let I=[];if(!T.length||!_||!E)return I;let M=(H,J)=>{for(let oe of H)I.push({polygon:oe,bounds:J})},L=Math.ceil(Math.log2(_)),k=Math.ceil(Math.log2(E)),B=L-k,V=[];for(let H=0;H<Math.abs(B);H++)V.push(B>0?0:1);for(let H=0;H<Math.min(L,k);H++)V.push(0),V.push(1);let N=T;if(N=pg(N,D[0].y-S,D[1].y+S,1),N=pg(N,D[0].x-S,D[1].x+S,0),!N.length)return I;let G=[];for(V.length?G.push({polygons:N,bounds:D,depth:0}):M(N,D);G.length;){let H=G.pop(),J=H.depth,oe=V[J],ee=H.bounds[0],ne=H.bounds[1],pe=oe===0?ee.x:ee.y,te=oe===0?ne.x:ne.y,de=w?w(oe,pe,te):.5*(pe+te),ye=pg(H.polygons,pe-S,de+S,oe),ve=pg(H.polygons,de-S,te+S,oe);if(ye.length){let Ee=[ee,new it(oe===0?de:ne.x,oe===1?de:ne.y)];V.length>J+1?G.push({polygons:ye,bounds:Ee,depth:J+1}):M(ye,Ee)}if(ve.length){let Ee=[new it(oe===0?de:ee.x,oe===1?de:ee.y),ne];V.length>J+1?G.push({polygons:ve,bounds:Ee,depth:J+1}):M(ve,Ee)}}return I}(s,e,Math.ceil((u-f)/11.25),Math.ceil((p-v)/11.25),1,(T,D,_)=>{if(T===0)return .5*(D+_);{let E=re((r.y+D/ot)/l);return(X(.5*(re((r.y+_/ot)/l)+E))*l-r.y)*ot}})}function CP(s,e,r,l,f,u){let p=Math.pow(2,l.z-f.z);for(let v=0;v<r;v++){let T=s.int16[2*(v+e)+0],D=s.int16[2*(v+e)+1];T=(T+f.x*ot)*p-l.x*ot,D=(D+f.y*ot)*p-l.y*ot,u.push(new it(T,D))}}let _E,yE;function Mf(s,e){return s.x*e.x+s.y*e.y}function vE(s,e){if(s.length===1){let r=0,l=e[r++],f;for(;!f||l.equals(f);)if(f=e[r++],!f)return 1/0;for(;r<e.length;r++){let u=e[r],p=s[0],v=f.sub(l),T=u.sub(l),D=p.sub(l),_=Mf(v,v),E=Mf(v,T),S=Mf(T,T),w=Mf(D,v),I=Mf(D,T),M=_*S-E*E,L=(S*w-E*I)/M,k=(_*I-E*w)/M,B=l.z*(1-L-k)+f.z*L+u.z*k;if(isFinite(B))return B}return 1/0}{let r=1/0;for(let l of e)r=Math.min(r,l.z);return r}}function xE(s,e,r,l,f,u,p,v){let T=p*f.getElevationAt(s,e,!0,!0),D=u[0]!==0,_=D?u[1]===0?p*(u[0]/7-450):p*function(E,S,w){let I=Math.floor(S[0]/8),M=Math.floor(S[1]/8),L=10*(S[0]-8*I),k=10*(S[1]-8*M),B=E.getElevationAt(I,M,!0,!0),V=E.getMeterToDEM(w),N=Math.floor(.5*(L*V-1)),G=Math.floor(.5*(k*V-1)),H=E.tileCoordToPixel(I,M),J=2*N+1,oe=2*G+1,ee=function(ve,Ee,Me,Re,De){return[ve.getElevationAtPixel(Ee,Me,!0),ve.getElevationAtPixel(Ee+De,Me,!0),ve.getElevationAtPixel(Ee,Me+De,!0),ve.getElevationAtPixel(Ee+Re,Me+De,!0)]}(E,H.x-N,H.y-G,J,oe),ne=Math.abs(ee[0]-ee[1]),pe=Math.abs(ee[2]-ee[3]),te=Math.abs(ee[0]-ee[2])+Math.abs(ee[1]-ee[3]),de=Math.min(.25,.5*V*(ne+pe)/J),ye=Math.min(.25,.5*V*te/oe);return B+Math.max(de*L,ye*k)}(f,u,v):T;return{base:T+(r===0?-1:r),top:D?Math.max(_+l,T+r+2):T+l}}ht(yg,"FillExtrusionBucket",{omit:["layers","features"]}),ht(sE,"PartData"),ht(oE,"FootprintSegment"),ht(aE,"BorderCentroidData"),ht(cE,"GroundEffect");let MP=gn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),AP=gn([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:RP}=MP,PP=gn([{name:"a_packed",components:4,type:"Float32"}]),{members:OP}=PP,LP=gn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:kP}=LP;class bE{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new dl({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){let l=this.getKey(e,r);return this.positions[l]}trim(){let e=this.width,r=this.height=jl(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,l){let f=[],u=e.length%2==1?-e[e.length-1]*l:0,p=e[0]*l,v=!0;f.push({left:u,right:p,isDash:v,zeroLength:e[0]===0});let T=e[0];for(let D=1;D<e.length;D++){v=!v;let _=e[D];u=T*l,T+=_,p=T*l,f.push({left:u,right:p,isDash:v,zeroLength:_===0})}return f}addRoundDash(e,r,l){let f=r/2;for(let u=-l;u<=l;u++){let p=this.width*(this.nextRow+l+u),v=0,T=e[v];for(let D=0;D<this.width;D++){D/T.right>1&&(T=e[++v]);let _=Math.abs(D-T.left),E=Math.abs(D-T.right),S=Math.min(_,E),w,I=u/l*(f+1);if(T.isDash){let M=f-Math.abs(I);w=Math.sqrt(S*S+M*M)}else w=f-Math.sqrt(S*S+I*I);this.image.data[p+D]=Math.max(0,Math.min(255,w+128))}}}addRegularDash(e,r){for(let T=e.length-1;T>=0;--T){let D=e[T],_=e[T+1];D.zeroLength?e.splice(T,1):_&&_.isDash===D.isDash&&(_.left=D.left,e.splice(T,1))}let l=e[0],f=e[e.length-1];l.isDash===f.isDash&&(l.left=f.left-this.width,f.right=l.right+this.width);let u=this.width*this.nextRow,p=0,v=e[p];for(let T=0;T<this.width;T++){T/v.right>1&&(v=e[++p]);let D=Math.abs(T-v.left),_=Math.abs(T-v.right),E=Math.min(D,_);this.image.data[u+T]=Math.max(0,Math.min(255,(v.isDash?E:-E)+r+128))}}addDash(e,r){let l=this.getKey(e,r);if(this.positions[l])return this.positions[l];let f=r==="round",u=f?7:0,p=2*u+1;if(this.nextRow+p>this.height)return ln("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let _=0;_<e.length;_++)e[_]<0&&(ln("Negative value is found in line dasharray, replacing values with 0"),e[_]=0),v+=e[_];if(v!==0){let _=this.width/v,E=this.getDashRanges(e,this.width,_);f?this.addRoundDash(E,_,u):this.addRegularDash(E,r==="square"?.5*_:0)}let T=this.nextRow+u;this.nextRow+=p;let D={tl:[T,u],br:[v,0]};return this.positions[l]=D,D}}ht(bE,"LineAtlas");let FP=oh.VectorTileFeature.types,NP=Math.cos(Math.PI/180*37.5),zP=Math.cos(Math.PI/180*5);class Zv{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new mc,this.layoutVertexArray2=new Ho,this.patternVertexArray=new Ts,this.indexArray=new ir,this.programConfigurations=new xo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new dr,this.maxLineLength=0,this.zOffsetVertexArray=new sl,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:ot/64}updateFootprints(e,r){}populate(e,r,l,f){this.hasPattern=Fv("line",this.layers,r);let u=this.layers[0].layout.get("line-sort-key");this.hasZOffset=!this.layers[0].isDraped();let p=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&p==="none"&&ln(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);let v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&v!==void 0;let T=[];for(let{feature:S,id:w,index:I,sourceLayerIndex:M}of e){let L=this.layers[0]._featureFilter.needGeometry,k=Ge(S,L);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),k,l))continue;let B=u?u.evaluate(k,{},l):void 0,V={id:w,properties:S.properties,type:S.type,sourceLayerIndex:M,index:I,geometry:L?k.geometry:Se(S,l,f),patterns:{},sortKey:B};T.push(V)}u&&T.sort((S,w)=>S.sortKey-w.sortKey);let{lineAtlas:D,featureIndex:_}=r,E=this.addConstantDashes(D);for(let S of T){let{geometry:w,index:I,sourceLayerIndex:M}=S;if(E&&this.addFeatureDashes(S,D),this.hasPattern){let L=Nv("line",this.layers,S,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(S,w,I,l,D.positions,r.availableImages,r.brightness);_.insert(e[I].feature,w,I,M,this.index)}}addConstantDashes(e){let r=!1;for(let l of this.layers){let f=l.paint.get("line-dasharray").value,u=l.layout.get("line-cap").value;if(f.kind!=="constant"||u.kind!=="constant")r=!0;else{let p=u.value,v=f.value;if(!v)continue;e.addDash(v,p)}}return r}addFeatureDashes(e,r){let l=this.zoom;for(let f of this.layers){let u=f.paint.get("line-dasharray").value,p=f.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let v,T;if(u.kind==="constant"){if(v=u.value,!v)continue}else v=u.evaluate({zoom:l},e);T=p.kind==="constant"?p.value:p.evaluate({zoom:l},e),r.addDash(v,T),e.patterns[f.id]=r.getKey(v,T)}}update(e,r,l,f,u){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,p?this.stateDependentLayers:this.layers,l,f,u)}addFeatures(e,r,l,f,u,p){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,l,f,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,OP)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,kP)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,AP.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,RP),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,l,f,u,p,v){let T=this.layers[0].layout,D=T.get("line-join").evaluate(e,{}),_=T.get("line-cap").evaluate(e,{}),E=T.get("line-miter-limit"),S=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=T.get("line-z-offset").value;for(let w of r)this.addLine(w,e,f,D,_,E,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,u,p,f,v)}addLine(e,r,l,f,u,p,v){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;let T=f==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let V=0;V<e.length-1;V++)this.totalDistance+=e[V].dist(e[V+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let D=FP[r.type]==="Polygon",_=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let E=0;for(;E<_-1&&e[E].equals(e[E+1]);)E++;if(_<(D?3:2))return;f==="bevel"&&(p=1.05);let S=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray),w,I,M,L,k,B;this.e1=this.e2=-1,D&&(w=e[_-2],k=e[E].sub(w)._unit()._perp());for(let V=E;V<_;V++){if(M=V===_-1?D?e[E+1]:void 0:e[V+1],M&&e[V].equals(M))continue;k&&(L=k),w&&(I=w),w=e[V],B=this.hasZOffset?this.evaluateElevationValue(I?I.dist(w):0):null,k=M?M.sub(w)._unit()._perp():L,L=L||k;let N=I&&M,G=N?f:D||T?"butt":u,H=L.x*k.x+L.y*k.y;if(T){let ye=function(ve){if(ve.patternJoinNone){let Ee=ve.segmentPoints.length/2,Me=ve.lineSoFar-ve.segmentStart;for(let Re=0;Re<Ee;++Re){let De=ve.segmentPoints[2*Re+1],Ue=Math.round(ve.segmentPoints[2*Re])+.5+.25*De;ve.patternVertexArray.emplaceBack(Ue,Me,ve.segmentStart),ve.patternVertexArray.emplaceBack(Ue,Me,ve.segmentStart)}ve.segmentPoints.length=0}ve.e1=ve.e2=-1};if(N&&H<zP){this.updateDistance(I,w),this.addCurrentVertex(w,L,1,1,S,B),ye(this),this.addCurrentVertex(w,k,-1,-1,S,B);continue}if(I){if(!M){this.updateDistance(I,w),this.addCurrentVertex(w,L,1,1,S,B),ye(this);continue}G="miter"}}let J=L.add(k);J.x===0&&J.y===0||J._unit();let oe=J.x*k.x+J.y*k.y,ee=oe!==0?1/oe:1/0,ne=2*Math.sqrt(2-2*oe),pe=oe<NP&&I&&M,te=L.x*k.y-L.y*k.x>0,de=this.overscaling<=16?15*ot/(512*this.overscaling):0;if(N&&G==="round"){if(ee<v)G="miter";else if(ee<=2){let ye=Xv(w,-10,ot+10);G=this.hasZOffset&&(ye||this.hasCrossSlope)?"miter":"fakeround"}}if(G==="miter"&&ee>p&&(G="bevel"),G==="bevel"&&(ee>2&&(G="flipbevel"),ee<p&&(G="miter")),I&&!(G==="miter"&&pe)&&this.updateDistance(I,w),G==="miter")if(pe){let ye=w.dist(I);if(ye>2*de){let Ee=w.sub(w.sub(I)._mult(de/ye)._round());this.updateDistance(I,Ee),this.addCurrentVertex(Ee,L,0,0,S,B),I=Ee}this.updateDistance(I,w),J._mult(ee),this.addCurrentVertex(w,J,0,0,S,B);let ve=w.dist(M);if(ve>2*de){let Ee=w.add(M.sub(w)._mult(de/ve)._round());this.updateDistance(w,Ee),this.addCurrentVertex(Ee,k,0,0,S,B),w=Ee}}else J._mult(ee),this.addCurrentVertex(w,J,0,0,S,B);else if(G==="flipbevel"){if(ee>100)J=k.mult(-1);else{let ye=ee*L.add(k).mag()/L.sub(k).mag();J._perp()._mult(ye*(te?-1:1))}this.addCurrentVertex(w,J,0,0,S,B),this.addCurrentVertex(w,J.mult(-1),0,0,S,B)}else if(G==="bevel"||G==="fakeround"){B!=null&&I&&this.addCurrentVertex(w,L,-1,-1,S,B);let ye=w.dist(I)<=2*de&&G!=="bevel",ve=J.mult(te?1:-1);ve._mult(ee);let Ee=k.mult(te?-1:1),Me=L.mult(te?-1:1),Re=this.evaluateElevationValue(this.distance);if(B==null&&(this.addHalfVertex(w,ve.x,ve.y,!1,!te,0,S,Re),ye||this.addHalfVertex(w,ve.x+2*Me.x,ve.y+2*Me.y,!1,te,0,S,Re)),G==="fakeround"){let De=Math.round(180*ne/Math.PI/20);this.addHalfVertex(w,Me.x,Me.y,!1,te,0,S,Re);for(let Ue=0;Ue<De;Ue++){let Je=Ue/De;if(Je!==.5){let ut=Je-.5;Je+=Je*ut*(Je-1)*((1.0904+H*(H*(3.55645-1.43519*H)-3.2452))*ut*ut+(.848013+H*(.215638*H-1.06021)))}let ze=Ee.sub(Me)._mult(Je)._add(Me)._unit();this.addHalfVertex(w,ze.x,ze.y,!1,te,0,S,Re)}this.addHalfVertex(w,Ee.x,Ee.y,!1,te,0,S,Re)}ye||B!=null||this.addHalfVertex(w,ve.x+2*Ee.x,ve.y+2*Ee.y,!1,te,0,S,Re),B!=null&&M&&this.addCurrentVertex(w,k,1,1,S,B)}else G==="butt"?this.addCurrentVertex(w,J,0,0,S,B):G==="square"?(I||this.addCurrentVertex(w,J,-1,-1,S,B),this.addCurrentVertex(w,J,0,0,S,B),I&&this.addCurrentVertex(w,J,1,1,S,B)):G==="round"&&(I&&(this.addCurrentVertex(w,L,0,0,S,B),this.addCurrentVertex(w,L,1,1,S,B,!0)),M&&(this.addCurrentVertex(w,k,-1,-1,S,B,!0),this.addCurrentVertex(w,k,0,0,S,B)))}}addVerticesTo(e,r,l,f,u,p,v,T,D,_){let E=(r.w-e.w)/this.tessellationStep|0,S=0,w=this.scaledDistance;if(E>1){this.lineSoFar=e.w;let M=(r.x-e.x)/E,L=(r.y-e.y)/E,k=(r.z-e.z)/E,B=(r.w-e.w)/E;for(let V=1;V<E;++V){e.x+=M,e.y+=L,e.z+=k,this.lineSoFar+=B,S+=B;let N=this.evaluateElevationValue(this.prevDistance+S);this.scaledDistance=(this.prevDistance+S)/this.totalDistance,this.addHalfVertex(e,l,f,_,!1,v,D,N),this.addHalfVertex(e,u,p,_,!0,-T,D,N)}}this.lineSoFar=r.w,this.scaledDistance=w;let I=this.evaluateElevationValue(this.distance);this.addHalfVertex(r,l,f,_,!1,v,D,I),this.addHalfVertex(r,u,p,_,!0,-T,D,I)}evaluateElevationValue(e){return this.hasZOffset?this.zOffsetValue.kind==="constant"?this.zOffsetValue.value:(this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):ln(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0):void 0}addCurrentVertex(e,r,l,f,u,p,v=!1){let T=r.x+r.y*l,D=r.y-r.x*l,_=r.y*f-r.x,E=-r.y-r.x*f;if(p!=null){let w=ot+10,I=p,M=new Ww(e.x,e.y,I,this.lineSoFar),L=Xv(e,-10,w),k=this.lineSoFar,B=this.distance;if(this.currentVertex)if(L){let V=this.currentVertexIsOutside,N=this.currentVertex,G=new Ww(e.x,e.y,I,this.lineSoFar);if(Xw(N,G,-10,w),!Xv(G,-10,w)){if(V){this.e1=this.e2=-1,this.distance-=N.dist(M),this.lineSoFar=N.w;let H=this.evaluateElevationValue(N.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(N,T,D,v,!1,l,u,H),this.addHalfVertex(N,_,E,v,!0,-f,u,H),this.prevDistance=this.distance}this.distance=this.prevDistance+N.dist(G),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(N,G,T,D,_,E,l,f,u,v),this.distance=B,this.scaledDistance=this.distance/this.totalDistance}}else{let V=this.currentVertex;if(this.currentVertexIsOutside){Xw(V,M,-10,w),this.e1=this.e2=-1,this.distance-=V.dist(M),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=V.w;let N=this.evaluateElevationValue(V.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(V,T,D,v,!1,l,u,N),this.addHalfVertex(V,_,E,v,!0,-f,u,N),this.prevDistance=this.distance,this.distance=B,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(V,M,T,D,_,E,l,f,u,v)}else L||(this.addHalfVertex(e,T,D,v,!1,l,u,p),this.addHalfVertex(e,_,E,v,!0,-f,u,p));this.currentVertex=M,this.currentVertexIsOutside=L,this.lineSoFar=k}else this.addHalfVertex(e,T,D,v,!1,l,u,p),this.addHalfVertex(e,_,E,v,!0,-f,u,p)}addHalfVertex({x:e,y:r},l,f,u,p,v,T,D){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(r<<1)+(p?1:0),Math.round(63*l)+128,Math.round(63*f)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let _=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),T.primitiveLength++),p?this.e2=_:this.e1=_,D!=null&&this.zOffsetVertexArray.emplaceBack(D)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function Xv(s,e,r){return s.x<e||s.x>r||s.y<e||s.y>r}let wE,EE;function TE(s,e,r){return e*(ot/(s.tileSize*Math.pow(2,r-s.tileID.overscaledZ)))}ht(Zv,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let IE=(s,e,r)=>(1-r)*s+r*e;function SE(s,e){return 1/TE(s,1,e.tileZoom)}function DE(s,e,r,l){return s.translatePosMatrix(l||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}let CE=s=>{let e=[];ME(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let r=s.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let l=s.layout.get("line-join").constantOr("miter")==="none",f=!!s.paint.get("line-pattern").constantOr(1);return l&&f&&e.push("LINE_JOIN_NONE"),e};function ME(s){let e=s.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Yv,AE=()=>Yv||(Yv={layout:wE||(wE=new Zn({"line-cap":new xt(Ae.layout_line["line-cap"]),"line-join":new xt(Ae.layout_line["line-join"]),"line-miter-limit":new tt(Ae.layout_line["line-miter-limit"]),"line-round-limit":new tt(Ae.layout_line["line-round-limit"]),"line-sort-key":new xt(Ae.layout_line["line-sort-key"]),"line-z-offset":new xt(Ae.layout_line["line-z-offset"]),"line-elevation-reference":new tt(Ae.layout_line["line-elevation-reference"]),"line-cross-slope":new tt(Ae.layout_line["line-cross-slope"]),visibility:new tt(Ae.layout_line.visibility)})),paint:EE||(EE=new Zn({"line-opacity":new xt(Ae.paint_line["line-opacity"]),"line-color":new xt(Ae.paint_line["line-color"]),"line-translate":new tt(Ae.paint_line["line-translate"]),"line-translate-anchor":new tt(Ae.paint_line["line-translate-anchor"]),"line-width":new xt(Ae.paint_line["line-width"]),"line-gap-width":new xt(Ae.paint_line["line-gap-width"]),"line-offset":new xt(Ae.paint_line["line-offset"]),"line-blur":new xt(Ae.paint_line["line-blur"]),"line-dasharray":new xt(Ae.paint_line["line-dasharray"]),"line-pattern":new xt(Ae.paint_line["line-pattern"]),"line-gradient":new el(Ae.paint_line["line-gradient"]),"line-trim-offset":new tt(Ae.paint_line["line-trim-offset"]),"line-trim-fade-range":new tt(Ae.paint_line["line-trim-fade-range"]),"line-trim-color":new tt(Ae.paint_line["line-trim-color"]),"line-emissive-strength":new tt(Ae.paint_line["line-emissive-strength"]),"line-border-width":new xt(Ae.paint_line["line-border-width"]),"line-border-color":new xt(Ae.paint_line["line-border-color"]),"line-occlusion-opacity":new tt(Ae.paint_line["line-occlusion-opacity"])}))},Yv);class BP extends xt{possiblyEvaluate(e,r){return r=new ar(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,l,f){return r=Jr({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,l,f)}}let Af;function RE(s,e){return e>0?e+2*s:s}let VP=gn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jP=gn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),UP=gn([{name:"a_projected_pos",components:4,type:"Float32"}],4);gn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let $P=gn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),GP=gn([{name:"a_texb",components:2,type:"Uint16"}]),HP=gn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),qP=gn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);gn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let PE=gn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),WP=gn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);gn([{name:"triangle",components:3,type:"Uint16"}]),gn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),gn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),gn([{type:"Float32",name:"offsetX"}]),gn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var qr=24;let Ko=128;function Jv(s,e){let{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ar(s+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:l,interpolationType:f}=r,u=0;for(;u<l.length&&l[u]<=s;)u++;u=Math.max(0,u-1);let p=u;for(;p<l.length&&l[p]<s+1;)p++;p=Math.min(l.length-1,p);let v=l[u],T=l[p];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:v,maxZoom:T,minSize:r.evaluate(new ar(v)),maxSize:r.evaluate(new ar(T)),interpolationType:f}}}function vg(s,{uSize:e,uSizeT:r},{lowerSize:l,upperSize:f}){return s.kind==="source"?l/Ko:s.kind==="composite"?Mt(l/Ko,f/Ko,r):e}function sh(s,e,r=1){let l=0,f=0;if(s.kind==="constant")f=s.layoutSize*r;else if(s.kind!=="source"){let{interpolationType:u,minZoom:p,maxZoom:v}=s,T=u?zt(Si.interpolationFactor(u,e,p,v),0,1):0;s.kind==="camera"?f=Mt(s.minSize,s.maxSize,T)*r:l=T*r}return{uSizeT:l,uSize:f}}var ZP=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ko,evaluateSizeForFeature:vg,evaluateSizeForZoom:sh,getSizeData:Jv});function XP(s,e,r){return s.sections.forEach(l=>{l.text=function(f,u,p){let v=u.layout.get("text-transform").evaluate(p,{});return v==="uppercase"?f=f.toLocaleUpperCase():v==="lowercase"&&(f=f.toLocaleLowerCase()),Ci.applyArabicShaping&&(f=Ci.applyArabicShaping(f)),f}(l.text,e,r)}),s}let Rf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function YP(s){return s==="\uFE36"||s==="\uFE48"||s==="\uFE38"||s==="\uFE44"||s==="\uFE42"||s==="\uFE3E"||s==="\uFE3C"||s==="\uFE3A"||s==="\uFE18"||s==="\uFE40"||s==="\uFE10"||s==="\uFE13"||s==="\uFE14"||s==="\uFF40"||s==="\uFFE3"||s==="\uFE11"||s==="\uFE12"}function JP(s){return s==="\uFE35"||s==="\uFE47"||s==="\uFE37"||s==="\uFE43"||s==="\uFE41"||s==="\uFE3D"||s==="\uFE3B"||s==="\uFE39"||s==="\uFE17"||s==="\uFE3F"}var OE,Kv,LE,Qv={};function KP(){return OE||(OE=1,Qv.read=function(s,e,r,l,f){var u,p,v=8*f-l-1,T=(1<<v)-1,D=T>>1,_=-7,E=r?f-1:0,S=r?-1:1,w=s[e+E];for(E+=S,u=w&(1<<-_)-1,w>>=-_,_+=v;_>0;u=256*u+s[e+E],E+=S,_-=8);for(p=u&(1<<-_)-1,u>>=-_,_+=l;_>0;p=256*p+s[e+E],E+=S,_-=8);if(u===0)u=1-D;else{if(u===T)return p?NaN:1/0*(w?-1:1);p+=Math.pow(2,l),u-=D}return(w?-1:1)*p*Math.pow(2,u-l)},Qv.write=function(s,e,r,l,f,u){var p,v,T,D=8*u-f-1,_=(1<<D)-1,E=_>>1,S=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=l?0:u-1,I=l?1:-1,M=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,p=_):(p=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-p))<1&&(p--,T*=2),(e+=p+E>=1?S/T:S*Math.pow(2,1-E))*T>=2&&(p++,T/=2),p+E>=_?(v=0,p=_):p+E>=1?(v=(e*T-1)*Math.pow(2,f),p+=E):(v=e*Math.pow(2,E-1)*Math.pow(2,f),p=0));f>=8;s[r+w]=255&v,w+=I,v/=256,f-=8);for(p=p<<f|v,D+=f;D>0;s[r+w]=255&p,w+=I,p/=256,D-=8);s[r+w-I]|=128*M}),Qv}function kE(){if(LE)return Kv;LE=1,Kv=e;var s=KP();function e(N){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(N)?N:new Uint8Array(N||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,l=1/r,f=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function u(N){return N.type===e.Bytes?N.readVarint()+N.pos:N.pos+1}function p(N,G,H){return H?4294967296*G+(N>>>0):4294967296*(G>>>0)+(N>>>0)}function v(N,G,H){var J=G<=16383?1:G<=2097151?2:G<=268435455?3:Math.floor(Math.log(G)/(7*Math.LN2));H.realloc(J);for(var oe=H.pos-1;oe>=N;oe--)H.buf[oe+J]=H.buf[oe]}function T(N,G){for(var H=0;H<N.length;H++)G.writeVarint(N[H])}function D(N,G){for(var H=0;H<N.length;H++)G.writeSVarint(N[H])}function _(N,G){for(var H=0;H<N.length;H++)G.writeFloat(N[H])}function E(N,G){for(var H=0;H<N.length;H++)G.writeDouble(N[H])}function S(N,G){for(var H=0;H<N.length;H++)G.writeBoolean(N[H])}function w(N,G){for(var H=0;H<N.length;H++)G.writeFixed32(N[H])}function I(N,G){for(var H=0;H<N.length;H++)G.writeSFixed32(N[H])}function M(N,G){for(var H=0;H<N.length;H++)G.writeFixed64(N[H])}function L(N,G){for(var H=0;H<N.length;H++)G.writeSFixed64(N[H])}function k(N,G){return(N[G]|N[G+1]<<8|N[G+2]<<16)+16777216*N[G+3]}function B(N,G,H){N[H]=G,N[H+1]=G>>>8,N[H+2]=G>>>16,N[H+3]=G>>>24}function V(N,G){return(N[G]|N[G+1]<<8|N[G+2]<<16)+(N[G+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(N,G,H){for(H=H||this.length;this.pos<H;){var J=this.readVarint(),oe=J>>3,ee=this.pos;this.type=7&J,N(oe,G,this),this.pos===ee&&this.skip(J)}return G},readMessage:function(N,G){return this.readFields(N,G,this.readVarint()+this.pos)},readFixed32:function(){var N=k(this.buf,this.pos);return this.pos+=4,N},readSFixed32:function(){var N=V(this.buf,this.pos);return this.pos+=4,N},readFixed64:function(){var N=k(this.buf,this.pos)+k(this.buf,this.pos+4)*r;return this.pos+=8,N},readSFixed64:function(){var N=k(this.buf,this.pos)+V(this.buf,this.pos+4)*r;return this.pos+=8,N},readFloat:function(){var N=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,N},readDouble:function(){var N=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,N},readVarint:function(N){var G,H,J=this.buf;return G=127&(H=J[this.pos++]),H<128?G:(G|=(127&(H=J[this.pos++]))<<7,H<128?G:(G|=(127&(H=J[this.pos++]))<<14,H<128?G:(G|=(127&(H=J[this.pos++]))<<21,H<128?G:function(oe,ee,ne){var pe,te,de=ne.buf;if(pe=(112&(te=de[ne.pos++]))>>4,te<128||(pe|=(127&(te=de[ne.pos++]))<<3,te<128)||(pe|=(127&(te=de[ne.pos++]))<<10,te<128)||(pe|=(127&(te=de[ne.pos++]))<<17,te<128)||(pe|=(127&(te=de[ne.pos++]))<<24,te<128)||(pe|=(1&(te=de[ne.pos++]))<<31,te<128))return p(oe,pe,ee);throw new Error("Expected varint not more than 10 bytes")}(G|=(15&(H=J[this.pos]))<<28,N,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var N=this.readVarint();return N%2==1?(N+1)/-2:N/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var N=this.readVarint()+this.pos,G=this.pos;return this.pos=N,N-G>=12&&f?function(H,J,oe){return f.decode(H.subarray(J,oe))}(this.buf,G,N):function(H,J,oe){for(var ee="",ne=J;ne<oe;){var pe,te,de,ye=H[ne],ve=null,Ee=ye>239?4:ye>223?3:ye>191?2:1;if(ne+Ee>oe)break;Ee===1?ye<128&&(ve=ye):Ee===2?(192&(pe=H[ne+1]))==128&&(ve=(31&ye)<<6|63&pe)<=127&&(ve=null):Ee===3?(te=H[ne+2],(192&(pe=H[ne+1]))==128&&(192&te)==128&&((ve=(15&ye)<<12|(63&pe)<<6|63&te)<=2047||ve>=55296&&ve<=57343)&&(ve=null)):Ee===4&&(te=H[ne+2],de=H[ne+3],(192&(pe=H[ne+1]))==128&&(192&te)==128&&(192&de)==128&&((ve=(15&ye)<<18|(63&pe)<<12|(63&te)<<6|63&de)<=65535||ve>=1114112)&&(ve=null)),ve===null?(ve=65533,Ee=1):ve>65535&&(ve-=65536,ee+=String.fromCharCode(ve>>>10&1023|55296),ve=56320|1023&ve),ee+=String.fromCharCode(ve),ne+=Ee}return ee}(this.buf,G,N)},readBytes:function(){var N=this.readVarint()+this.pos,G=this.buf.subarray(this.pos,N);return this.pos=N,G},readPackedVarint:function(N,G){if(this.type!==e.Bytes)return N.push(this.readVarint(G));var H=u(this);for(N=N||[];this.pos<H;)N.push(this.readVarint(G));return N},readPackedSVarint:function(N){if(this.type!==e.Bytes)return N.push(this.readSVarint());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readSVarint());return N},readPackedBoolean:function(N){if(this.type!==e.Bytes)return N.push(this.readBoolean());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readBoolean());return N},readPackedFloat:function(N){if(this.type!==e.Bytes)return N.push(this.readFloat());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readFloat());return N},readPackedDouble:function(N){if(this.type!==e.Bytes)return N.push(this.readDouble());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readDouble());return N},readPackedFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed32());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readFixed32());return N},readPackedSFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed32());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readSFixed32());return N},readPackedFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed64());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readFixed64());return N},readPackedSFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed64());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readSFixed64());return N},skip:function(N){var G=7&N;if(G===e.Varint)for(;this.buf[this.pos++]>127;);else if(G===e.Bytes)this.pos=this.readVarint()+this.pos;else if(G===e.Fixed32)this.pos+=4;else{if(G!==e.Fixed64)throw new Error("Unimplemented type: "+G);this.pos+=8}},writeTag:function(N,G){this.writeVarint(N<<3|G)},realloc:function(N){for(var G=this.length||16;G<this.pos+N;)G*=2;if(G!==this.length){var H=new Uint8Array(G);H.set(this.buf),this.buf=H,this.length=G}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(N){this.realloc(4),B(this.buf,N,this.pos),this.pos+=4},writeSFixed32:function(N){this.realloc(4),B(this.buf,N,this.pos),this.pos+=4},writeFixed64:function(N){this.realloc(8),B(this.buf,-1&N,this.pos),B(this.buf,Math.floor(N*l),this.pos+4),this.pos+=8},writeSFixed64:function(N){this.realloc(8),B(this.buf,-1&N,this.pos),B(this.buf,Math.floor(N*l),this.pos+4),this.pos+=8},writeVarint:function(N){(N=+N||0)>268435455||N<0?function(G,H){var J,oe;if(G>=0?(J=G%4294967296|0,oe=G/4294967296|0):(oe=~(-G/4294967296),4294967295^(J=~(-G%4294967296))?J=J+1|0:(J=0,oe=oe+1|0)),G>=18446744073709552e3||G<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");H.realloc(10),function(ee,ne,pe){pe.buf[pe.pos++]=127&ee|128,ee>>>=7,pe.buf[pe.pos++]=127&ee|128,ee>>>=7,pe.buf[pe.pos++]=127&ee|128,ee>>>=7,pe.buf[pe.pos++]=127&ee|128,pe.buf[pe.pos]=127&(ee>>>=7)}(J,0,H),function(ee,ne){var pe=(7&ee)<<4;ne.buf[ne.pos++]|=pe|((ee>>>=3)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee)))))}(oe,H)}(N,this):(this.realloc(4),this.buf[this.pos++]=127&N|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=N>>>7&127))))},writeSVarint:function(N){this.writeVarint(N<0?2*-N-1:2*N)},writeBoolean:function(N){this.writeVarint(!!N)},writeString:function(N){N=String(N),this.realloc(4*N.length),this.pos++;var G=this.pos;this.pos=function(J,oe,ee){for(var ne,pe,te=0;te<oe.length;te++){if((ne=oe.charCodeAt(te))>55295&&ne<57344){if(!pe){ne>56319||te+1===oe.length?(J[ee++]=239,J[ee++]=191,J[ee++]=189):pe=ne;continue}if(ne<56320){J[ee++]=239,J[ee++]=191,J[ee++]=189,pe=ne;continue}ne=pe-55296<<10|ne-56320|65536,pe=null}else pe&&(J[ee++]=239,J[ee++]=191,J[ee++]=189,pe=null);ne<128?J[ee++]=ne:(ne<2048?J[ee++]=ne>>6|192:(ne<65536?J[ee++]=ne>>12|224:(J[ee++]=ne>>18|240,J[ee++]=ne>>12&63|128),J[ee++]=ne>>6&63|128),J[ee++]=63&ne|128)}return ee}(this.buf,N,this.pos);var H=this.pos-G;H>=128&&v(G,H,this),this.pos=G-1,this.writeVarint(H),this.pos+=H},writeFloat:function(N){this.realloc(4),s.write(this.buf,N,this.pos,!0,23,4),this.pos+=4},writeDouble:function(N){this.realloc(8),s.write(this.buf,N,this.pos,!0,52,8),this.pos+=8},writeBytes:function(N){var G=N.length;this.writeVarint(G),this.realloc(G);for(var H=0;H<G;H++)this.buf[this.pos++]=N[H]},writeRawMessage:function(N,G){this.pos++;var H=this.pos;N(G,this);var J=this.pos-H;J>=128&&v(H,J,this),this.pos=H-1,this.writeVarint(J),this.pos+=J},writeMessage:function(N,G,H){this.writeTag(N,e.Bytes),this.writeRawMessage(G,H)},writePackedVarint:function(N,G){G.length&&this.writeMessage(N,T,G)},writePackedSVarint:function(N,G){G.length&&this.writeMessage(N,D,G)},writePackedBoolean:function(N,G){G.length&&this.writeMessage(N,S,G)},writePackedFloat:function(N,G){G.length&&this.writeMessage(N,_,G)},writePackedDouble:function(N,G){G.length&&this.writeMessage(N,E,G)},writePackedFixed32:function(N,G){G.length&&this.writeMessage(N,w,G)},writePackedSFixed32:function(N,G){G.length&&this.writeMessage(N,I,G)},writePackedFixed64:function(N,G){G.length&&this.writeMessage(N,M,G)},writePackedSFixed64:function(N,G){G.length&&this.writeMessage(N,L,G)},writeBytesField:function(N,G){this.writeTag(N,e.Bytes),this.writeBytes(G)},writeFixed32Field:function(N,G){this.writeTag(N,e.Fixed32),this.writeFixed32(G)},writeSFixed32Field:function(N,G){this.writeTag(N,e.Fixed32),this.writeSFixed32(G)},writeFixed64Field:function(N,G){this.writeTag(N,e.Fixed64),this.writeFixed64(G)},writeSFixed64Field:function(N,G){this.writeTag(N,e.Fixed64),this.writeSFixed64(G)},writeVarintField:function(N,G){this.writeTag(N,e.Varint),this.writeVarint(G)},writeSVarintField:function(N,G){this.writeTag(N,e.Varint),this.writeSVarint(G)},writeStringField:function(N,G){this.writeTag(N,e.Bytes),this.writeString(G)},writeFloatField:function(N,G){this.writeTag(N,e.Fixed32),this.writeFloat(G)},writeDoubleField:function(N,G){this.writeTag(N,e.Fixed64),this.writeDouble(G)},writeBooleanField:function(N,G){this.writeVarintField(N,!!G)}},Kv}var xg=P(kE());let e0=3;function QP(s,e,r){e.glyphs=[],s===1&&r.readMessage(eO,e)}function eO(s,e,r){if(s===3){let{id:l,bitmap:f,width:u,height:p,left:v,top:T,advance:D}=r.readMessage(tO,{});e.glyphs.push({id:l,bitmap:new dl({width:u+2*e0,height:p+2*e0},f),metrics:{width:u,height:p,left:v,top:T,advance:D}})}else s===4?e.ascender=r.readSVarint():s===5&&(e.descender=r.readSVarint())}function tO(s,e,r){s===1?e.id=r.readVarint():s===2?e.bitmap=r.readBytes():s===3?e.width=r.readVarint():s===4?e.height=r.readVarint():s===5?e.left=r.readSVarint():s===6?e.top=r.readSVarint():s===7&&(e.advance=r.readVarint())}let FE=e0,no={horizontal:1,vertical:2,horizontalOnly:3};class Pf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){let l=new Pf;return l.scale=e||1,l.fontStack=r,l}static forImage(e){let r=new Pf;return r.imageName=e,r}}class ah{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){let l=new ah;for(let f=0;f<e.sections.length;f++){let u=e.sections[f];u.image?l.addImageSection(u):l.addTextSection(u,r)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,l){let f="";for(let u=0;u<r.length;u++){let p=r.charCodeAt(u+1)||null,v=r.charCodeAt(u-1)||null;f+=!l&&(p&&Wd(p)&&!Rf[r[u+1]]||v&&Wd(v)&&!Rf[r[u-1]])||!Rf[r[u]]?r[u]:Rf[r[u]]}return f}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&bg[this.text.charCodeAt(l)];l++)e++;let r=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&bg[this.text.charCodeAt(l)];l--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){let l=new ah;return l.text=this.text.substring(e,r),l.sectionIndex=this.sectionIndex.slice(e,r),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Pf.forText(e.scale,e.fontStack||r));let l=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(l)}addImageSection(e){let r=e.image?e.image.namePrimary:"";if(r.length===0)return void ln("Can't add FormattedSection with an empty image.");let l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(Pf.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ln("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function t0(s,e,r,l,f,u,p,v,T,D,_,E,S,w,I){let M=ah.fromFeature(s,f);E===no.vertical&&M.verticalizePunctuation(S);let L=[],k=function(H,J,oe,ee,ne,pe){if(!H)return[];let te=[],de=function(Me,Re,De,Ue,Je,ze){let ut=0;for(let rt=0;rt<Me.length();rt++){let et=Me.getSection(rt);ut+=NE(Me.getCodePoint(rt),et,Ue,Je,Re,ze)}return ut/Math.max(1,Math.ceil(ut/De))}(H,J,oe,ee,ne,pe),ye=H.text.indexOf("\u200B")>=0,ve=0;for(let Me=0;Me<H.length();Me++){let Re=H.getSection(Me),De=H.getCodePoint(Me);if(bg[De]||(ve+=NE(De,Re,ee,ne,J,pe)),Me<H.length()-1){let Ue=!((Ee=De)<11904||!(vt["Bopomofo Extended"](Ee)||vt.Bopomofo(Ee)||vt["CJK Compatibility Forms"](Ee)||vt["CJK Compatibility Ideographs"](Ee)||vt["CJK Compatibility"](Ee)||vt["CJK Radicals Supplement"](Ee)||vt["CJK Strokes"](Ee)||vt["CJK Symbols and Punctuation"](Ee)||vt["CJK Unified Ideographs Extension A"](Ee)||vt["CJK Unified Ideographs"](Ee)||vt["Enclosed CJK Letters and Months"](Ee)||vt["Halfwidth and Fullwidth Forms"](Ee)||vt.Hiragana(Ee)||vt["Ideographic Description Characters"](Ee)||vt["Kangxi Radicals"](Ee)||vt["Katakana Phonetic Extensions"](Ee)||vt.Katakana(Ee)||vt["Vertical Forms"](Ee)||vt["Yi Radicals"](Ee)||vt["Yi Syllables"](Ee)));(nO[De]||Ue||Re.imageName)&&te.push(BE(Me+1,ve,de,te,rO(De,H.getCodePoint(Me+1),Ue&&ye),!1))}}var Ee;return VE(BE(H.length(),ve,de,te,0,!0))}(M,D,u,e,l,w),{processBidirectionalText:B,processStyledBidirectionalText:V}=Ci;if(B&&M.sections.length===1){let H=B(M.toString(),k);for(let J of H){let oe=new ah;oe.text=J,oe.sections=M.sections;for(let ee=0;ee<J.length;ee++)oe.sectionIndex.push(0);L.push(oe)}}else if(V){let H=V(M.text,M.sectionIndex,k);for(let J of H){let oe=new ah;oe.text=J[0],oe.sectionIndex=J[1],oe.sections=M.sections,L.push(oe)}}else L=function(H,J){let oe=[],ee=H.text,ne=0;for(let pe of J)oe.push(H.substring(ne,pe)),ne=pe;return ne<ee.length&&oe.push(H.substring(ne,ee.length)),oe}(M,k);let N=[],G={positionedLines:N,text:M.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(H,J,oe,ee,ne,pe,te,de,ye,ve,Ee,Me){let Re=0,De=0,Ue=0,Je=de==="right"?1:de==="left"?0:.5,ze=!1;for(let ct of ne){let ft=ct.getSections();for(let Nt of ft){if(Nt.imageName)continue;let Ht=J[Nt.fontStack];if(Ht&&(ze=Ht.ascender!==void 0&&Ht.descender!==void 0,!ze))break}if(!ze)break}let ut=0;for(let ct of ne){ct.trim();let ft=ct.getMaxScale(),Nt=(ft-1)*qr,Ht={positionedGlyphs:[],lineOffset:0};H.positionedLines[ut]=Ht;let Wt=Ht.positionedGlyphs,$t=0;if(!ct.length()){De+=pe,++ut;continue}let Kt=0,Yt=0;for(let Fn=0;Fn<ct.length();Fn++){let At=ct.getSection(Fn),In=ct.getSectionIndex(Fn),An=ct.getCodePoint(Fn),tr=At.scale,_r=null,Ir=null,yr=null,ur=qr,br=0,Mr=!(ye===no.horizontal||!Ee&&!Ja(An)||Ee&&(bg[An]||(rt=An,vt.Arabic(rt)||vt["Arabic Supplement"](rt)||vt["Arabic Extended-A"](rt)||vt["Arabic Presentation Forms-A"](rt)||vt["Arabic Presentation Forms-B"](rt))));if(At.imageName){let Wr=ee[At.imageName];if(!Wr)continue;yr=At.imageName,H.iconsInText=H.iconsInText||!0,Ir=Wr.paddedRect;let Yn=Wr.displaySize;tr=tr*qr/Me,_r={width:Yn[0],height:Yn[1],left:0,top:-FE,advance:Mr?Yn[1]:Yn[0],localGlyph:!1},br=ze?-_r.height*tr:ft*qr-17-Yn[1]*tr,ur=_r.advance;let Ai=(Mr?Yn[0]:Yn[1])*tr-qr*ft;Ai>0&&Ai>$t&&($t=Ai)}else{let Wr=oe[At.fontStack];if(!Wr)continue;Wr[An]&&(Ir=Wr[An]);let Yn=J[At.fontStack];if(!Yn)continue;let Ai=Yn.glyphs[An];if(!Ai)continue;if(_r=Ai.metrics,ur=An!==8203?qr:0,ze){let rs=Yn.ascender!==void 0?Math.abs(Yn.ascender):0,Eo=Yn.descender!==void 0?Math.abs(Yn.descender):0,To=(rs+Eo)*tr;Kt<To&&(Kt=To,Yt=(rs-Eo)/2*tr),br=-rs*tr}else br=(ft-tr)*qr-17}Mr?(H.verticalizable=!0,Wt.push({glyph:An,imageName:yr,x:Re,y:De+br,vertical:Mr,scale:tr,localGlyph:_r.localGlyph,fontStack:At.fontStack,sectionIndex:In,metrics:_r,rect:Ir}),Re+=ur*tr+ve):(Wt.push({glyph:An,imageName:yr,x:Re,y:De+br,vertical:Mr,scale:tr,localGlyph:_r.localGlyph,fontStack:At.fontStack,sectionIndex:In,metrics:_r,rect:Ir}),Re+=_r.advance*tr+ve)}Wt.length!==0&&(Ue=Math.max(Re-ve,Ue),ze?jE(Wt,Je,$t,Yt,pe*ft/2):jE(Wt,Je,$t,0,pe/2)),Re=0;let Un=pe*ft+$t;Ht.lineOffset=Math.max($t,Nt),De+=Un,++ut}var rt;let et=De,{horizontalAlign:Xe,verticalAlign:wt}=n0(te);(function(ct,ft,Nt,Ht,Wt,$t){let Kt=(ft-Nt)*Wt,Yt=-$t*Ht;for(let Un of ct)for(let Fn of Un.positionedGlyphs)Fn.x+=Kt,Fn.y+=Yt})(H.positionedLines,Je,Xe,wt,Ue,et),H.top+=-wt*et,H.bottom=H.top+et,H.left+=-Xe*Ue,H.right=H.left+Ue,H.hasBaseline=ze}(G,e,r,l,L,p,v,T,E,D,S,I),!function(H){for(let J of H)if(J.positionedGlyphs.length!==0)return!1;return!0}(N)&&G}let bg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},nO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function NE(s,e,r,l,f,u){if(e.imageName){let p=l[e.imageName];return p?p.displaySize[0]*e.scale*qr/u+f:0}{let p=r[e.fontStack],v=p&&p.glyphs[s];return v?v.metrics.advance*e.scale+f:0}}function zE(s,e,r,l){let f=Math.pow(s-e,2);return l?s<e?f/2:2*f:f+Math.abs(r)*r}function rO(s,e,r){let l=0;return s===10&&(l-=1e4),r&&(l+=150),s!==40&&s!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function BE(s,e,r,l,f,u){let p=null,v=zE(e,r,f,u);for(let T of l){let D=zE(e-T.x,r,f,u)+T.badness;D<=v&&(p=T,v=D)}return{index:s,x:e,priorBreak:p,badness:v}}function VE(s){return s?VE(s.priorBreak).concat(s.index):[]}function n0(s){let e=.5,r=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function jE(s,e,r,l,f){if(!(e||r||l||f))return;let u=s.length-1,p=s[u],v=(p.x+p.metrics.advance*p.scale)*e;for(let T=0;T<=u;T++)s[T].x-=v,s[T].y+=r+l+f}function iO(s,e,r,l){let{horizontalAlign:f,verticalAlign:u}=n0(l),p=r[0]-s.displaySize[0]*f,v=r[1]-s.displaySize[1]*u;return{imagePrimary:s,imageSecondary:e,top:v,bottom:v+s.displaySize[1],left:p,right:p+s.displaySize[0]}}function UE(s,e,r,l,f,u){let p=s.imagePrimary,v;if(p.content){let L=p.content,k=p.pixelRatio||1;v=[L[0]/k,L[1]/k,p.displaySize[0]-L[2]/k,p.displaySize[1]-L[3]/k]}let T=e.left*u,D=e.right*u,_,E,S,w;r==="width"||r==="both"?(w=f[0]+T-l[3],E=f[0]+D+l[1]):(w=f[0]+(T+D-p.displaySize[0])/2,E=w+p.displaySize[0]);let I=e.top*u,M=e.bottom*u;return r==="height"||r==="both"?(_=f[1]+I-l[0],S=f[1]+M+l[2]):(_=f[1]+(I+M-p.displaySize[1])/2,S=_+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:_,right:E,bottom:S,left:w,collisionPadding:v}}class aa extends it{constructor(e,r,l,f,u){super(e,r),this.angle=f,this.z=l,u!==void 0&&(this.segment=u)}clone(){return new aa(this.x,this.y,this.z,this.angle,this.segment)}}function $E(s,e,r,l,f){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,v=0;for(;v>-r/2;){if(p--,p<0)return!1;v-=s[p].dist(u),u=s[p]}v+=s[p].dist(s[p+1]),p++;let T=[],D=0;for(;v<r/2;){let _=s[p],E=s[p+1];if(!E)return!1;let S=s[p-1].angleTo(_)-_.angleTo(E);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:S}),D+=S;v-T[0].distance>l;)D-=T.shift().angleDelta;if(D>f)return!1;p++,v+=_.dist(E)}return!0}function GE(s){let e=0;for(let r=0;r<s.length-1;r++)e+=s[r].dist(s[r+1]);return e}function HE(s,e,r){return s?.6*e*r:0}function qE(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function oO(s,e,r,l,f,u){let p=HE(r,f,u),v=qE(r,l)*u,T=0,D=GE(s)/2;for(let _=0;_<s.length-1;_++){let E=s[_],S=s[_+1],w=E.dist(S);if(T+w>D){let I=(D-T)/w,M=Mt(E.x,S.x,I),L=Mt(E.y,S.y,I),k=new aa(M,L,0,S.angleTo(E),_);return!p||$E(s,k,v,p,e)?k:void 0}T+=w}}function sO(s,e,r,l,f,u,p,v,T){let D=HE(l,u,p),_=qE(l,f),E=_*p,S=s[0].x===0||s[0].x===T||s[0].y===0||s[0].y===T;return e-E<e/4&&(e=E+e/4),WE(s,S?e/2*v%e:(_/2+2*u)*p*v%e,e,D,r,E,S,!1,T)}function WE(s,e,r,l,f,u,p,v,T){let D=u/2,_=GE(s),E=0,S=e-r,w=[];for(let I=0;I<s.length-1;I++){let M=s[I],L=s[I+1],k=M.dist(L),B=L.angleTo(M);for(;S+r<E+k;){S+=r;let V=(S-E)/k,N=Mt(M.x,L.x,V),G=Mt(M.y,L.y,V);if(N>=0&&N<T&&G>=0&&G<T&&S-D>=0&&S+D<=_){let H=new aa(N,G,0,B,I);l&&!$E(s,H,u,l,f)||w.push(H)}}E+=k}return v||w.length||p||(w=WE(s,E/2,r,l,f,u,p,!0,T)),w}function ZE(s,e,r,l,f){let u=[];for(let p=0;p<s.length;p++){let v=s[p],T;for(let D=0;D<v.length-1;D++){let _=v[D],E=v[D+1];_.x<e&&E.x<e||(_.x<e?_=new it(e,_.y+(e-_.x)/(E.x-_.x)*(E.y-_.y))._round():E.x<e&&(E=new it(e,_.y+(e-_.x)/(E.x-_.x)*(E.y-_.y))._round()),_.y<r&&E.y<r||(_.y<r?_=new it(_.x+(r-_.y)/(E.y-_.y)*(E.x-_.x),r)._round():E.y<r&&(E=new it(_.x+(r-_.y)/(E.y-_.y)*(E.x-_.x),r)._round()),_.x>=l&&E.x>=l||(_.x>=l?_=new it(l,_.y+(l-_.x)/(E.x-_.x)*(E.y-_.y))._round():E.x>=l&&(E=new it(l,_.y+(l-_.x)/(E.x-_.x)*(E.y-_.y))._round()),_.y>=f&&E.y>=f||(_.y>=f?_=new it(_.x+(f-_.y)/(E.y-_.y)*(E.x-_.x),f)._round():E.y>=f&&(E=new it(_.x+(f-_.y)/(E.y-_.y)*(E.x-_.x),f)._round()),T&&_.equals(T[T.length-1])||(T=[_],u.push(T)),T.push(E)))))}}return u}function XE(s){let e=0,r=0;for(let p of s)e+=p.w*p.h,r=Math.max(r,p.w);s.sort((p,v)=>v.h-p.h);let l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],f=0,u=0;for(let p of s)for(let v=l.length-1;v>=0;v--){let T=l[v];if(!(p.w>T.w||p.h>T.h)){if(p.x=T.x,p.y=T.y,u=Math.max(u,p.y+p.h),f=Math.max(f,p.x+p.w),p.w===T.w&&p.h===T.h){let D=l.pop();v<l.length&&(l[v]=D)}else p.h===T.h?(T.x+=p.w,T.w-=p.w):p.w===T.w?(T.y+=p.h,T.h-=p.h):(l.push({x:T.x+p.w,y:T.y,w:T.w-p.w,h:p.h}),T.y+=p.h,T.h-=p.h);break}}return{w:f,h:u,fill:e/(f*u)||0}}ht(aa,"Anchor");let Of=1;class r0{constructor(e,{pixelRatio:r,version:l,stretchX:f,stretchY:u,content:p},v){this.paddedRect=e,this.pixelRatio=r,this.stretchX=f,this.stretchY=u,this.content=p,this.version=l,this.padding=v}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class YE{constructor(e,r,l){let f={},u={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,f,Of,p),this.addImages(r,u,2,p);let{w:v,h:T}=XE(p),D=new si({width:v||1,height:T||1});for(let _ in e){let E=e[_],S=f[_].paddedRect;si.copy(E.data,D,{x:0,y:0},{x:S.x+Of,y:S.y+Of},E.data,l,E.sdf)}for(let _ in r){let E=r[_],S=u[_].paddedRect,w=u[_].padding,I=S.x+w,M=S.y+w,L=E.data.width,k=E.data.height;w=w>1?w-1:w,si.copy(E.data,D,{x:0,y:0},{x:I,y:M},E.data,l),si.copy(E.data,D,{x:0,y:k-w},{x:I,y:M-w},{width:L,height:w},l),si.copy(E.data,D,{x:0,y:0},{x:I,y:M+k},{width:L,height:w},l),si.copy(E.data,D,{x:L-w,y:0},{x:I-w,y:M},{width:w,height:k},l),si.copy(E.data,D,{x:0,y:0},{x:I+L,y:M},{width:w,height:k},l),si.copy(E.data,D,{x:L-w,y:k-w},{x:I-w,y:M-w},{width:w,height:w},l),si.copy(E.data,D,{x:0,y:k-w},{x:I+L,y:M-w},{width:w,height:w},l),si.copy(E.data,D,{x:0,y:0},{x:I+L,y:M+k},{width:w,height:w},l),si.copy(E.data,D,{x:L-w,y:0},{x:I-w,y:M+k},{width:w,height:w},l)}this.image=D,this.iconPositions=f,this.patternPositions=u}addImages(e,r,l,f){for(let u in e){let p=e[u],v={x:0,y:0,w:p.data.width+2*l,h:p.data.height+2*l};f.push(v),r[u]=new r0(v,p,l),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>e.hasImage(f,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(let f in e.getUpdatedImages(l))this.patchUpdatedImage(this.iconPositions[f],e.getImage(f,l),r),this.patchUpdatedImage(this.patternPositions[f],e.getImage(f,l),r)}patchUpdatedImage(e,r,l){if(!e||!r||e.version===r.version)return;e.version=r.version;let[f,u]=e.tl;l.update(r.data,{position:{x:f,y:u}})}}ht(r0,"ImagePosition"),ht(YE,"ImageAtlas");let Lf=1e20;function JE(s,e,r,l,f,u,p,v,T){for(let D=e;D<e+l;D++)KE(s,r*u+D,u,f,p,v,T);for(let D=r;D<r+f;D++)KE(s,D*u+e,1,l,p,v,T)}function KE(s,e,r,l,f,u,p){u[0]=0,p[0]=-Lf,p[1]=Lf,f[0]=s[e];for(let v=1,T=0,D=0;v<l;v++){f[v]=s[e+v*r];let _=v*v;do{let E=u[T];D=(f[v]-f[E]+_-E*E)/(v-E)/2}while(D<=p[T]&&--T>-1);T++,u[T]=v,p[T]=D,p[T+1]=Lf}for(let v=0,T=0;v<l;v++){for(;p[T+1]<v;)T++;let D=u[T],_=v-D;s[e+v*r]=f[D]+_*_}}let Qo=2,i0={none:0,ideographs:1,all:2};class lh{constructor(e,r,l){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=l,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,l){let f=[],u=this.urls[r]||ce.GLYPHS_URL;for(let p in e)for(let v of e[p])f.push({stack:p,id:v});$s(f,({stack:p,id:v},T)=>{let D=this.entries[p];D||(D=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=D.glyphs[v];if(_!==void 0)return void T(null,{stack:p,id:v,glyph:_});if(_=this._tinySDF(D,p,v),_)return D.glyphs[v]=_,void T(null,{stack:p,id:v,glyph:_});let E=Math.floor(v/256);if(256*E>65535)return ln("glyphs > 65535 not supported"),void T(null,{stack:p,id:v,glyph:_});if(D.ranges[E])return void T(null,{stack:p,id:v,glyph:_});let S=D.requests[E];S||(S=D.requests[E]=[],lh.loadGlyphRange(p,E,u,this.requestManager,(w,I)=>{if(I){D.ascender=I.ascender,D.descender=I.descender;for(let M in I.glyphs)this._doesCharSupportLocalGlyph(+M)||(D.glyphs[+M]=I.glyphs[+M]);D.ranges[E]=!0}for(let M of S)M(w,I);delete D.requests[E]})),S.push((w,I)=>{w?T(w):I&&T(null,{stack:p,id:v,glyph:I.glyphs[v]||null})})},(p,v)=>{if(p)l(p);else if(v){let T={};for(let{stack:D,id:_,glyph:E}of v)T[D]===void 0&&(T[D]={}),T[D].glyphs===void 0&&(T[D].glyphs={}),T[D].glyphs[_]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},T[D].ascender=this.entries[D].ascender,T[D].descender=this.entries[D].descender;l(null,T)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==i0.none&&(this.localGlyphMode===i0.all?!!this.localFontFamily:!!this.localFontFamily&&(vt["CJK Unified Ideographs"](e)||vt["Hangul Syllables"](e)||vt.Hiragana(e)||vt.Katakana(e)||vt["CJK Symbols and Punctuation"](e)||vt["CJK Unified Ideographs Extension A"](e)||vt["CJK Unified Ideographs Extension B"](e)||vt.Osage(e)))}_tinySDF(e,r,l){let f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(l))return;let u=e.tinySDF;if(!u){let M="400";/bold/i.test(r)?M="900":/medium/i.test(r)?M="500":/light/i.test(r)&&(M="200"),u=e.tinySDF=new lh.TinySDF({fontFamily:f,fontWeight:M,fontSize:24*Qo,buffer:3*Qo,radius:8*Qo}),u.fontWeight=M}if(this.localGlyphs[u.fontWeight][l])return this.localGlyphs[u.fontWeight][l];let p=String.fromCodePoint(l),{data:v,width:T,height:D,glyphWidth:_,glyphHeight:E,glyphLeft:S,glyphTop:w,glyphAdvance:I}=u.draw(p);return this.localGlyphs[u.fontWeight][l]={id:l,bitmap:new dl({width:T,height:D},v),metrics:{width:_/Qo,height:E/Qo,left:S/Qo,top:w/Qo-27,advance:I/Qo,localGlyph:!0}}}}lh.loadGlyphRange=function(s,e,r,l,f){let u=256*e,p=u+255,v=l.transformRequest(l.normalizeGlyphsURL(r).replace("{fontstack}",s).replace("{range}",`${u}-${p}`),cu.Glyphs);Da(v,(T,D)=>{if(T)f(T);else if(D){let _={},E=function(S){return new xg(S).readFields(QP,{})}(D);for(let S of E.glyphs)_[S.id]=S;f(null,{glyphs:_,ascender:E.ascender,descender:E.descender})}})},lh.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:f="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=r;let v=this.size=s+4*e,T=this._createCanvas(v),D=this.ctx=T.getContext("2d",{willReadFrequently:!0});D.font=`${p} ${u} ${s}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(s){let e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){let{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:f,actualBoundingBoxRight:u}=this.ctx.measureText(s),p=Math.ceil(r),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-f))),T=Math.min(this.size-this.buffer,p+Math.ceil(l)),D=v+2*this.buffer,_=T+2*this.buffer,E=Math.max(D*_,0),S=new Uint8ClampedArray(E),w={data:S,width:D,height:_,glyphWidth:v,glyphHeight:T,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(v===0||T===0)return w;let{ctx:I,buffer:M,gridInner:L,gridOuter:k}=this;I.clearRect(M,M,v,T),I.fillText(s,M,M+p);let B=I.getImageData(M,M,v,T);k.fill(Lf,0,E),L.fill(0,0,E);for(let V=0;V<T;V++)for(let N=0;N<v;N++){let G=B.data[4*(V*v+N)+3]/255;if(G===0)continue;let H=(V+M)*D+N+M;if(G===1)k[H]=0,L[H]=Lf;else{let J=.5-G;k[H]=J>0?J*J:0,L[H]=J<0?J*J:0}}JE(k,0,0,D,_,D,this.f,this.v,this.z),JE(L,M,M,v,T,D,this.f,this.v,this.z);for(let V=0;V<E;V++){let N=Math.sqrt(k[V])-Math.sqrt(L[V]);S[V]=Math.round(255-255*(N/this.radius+this.cutoff))}return w}};let pl=Of;function QE(s,e,r,l,f=1){let u=[],p=s.imagePrimary,v=p.pixelRatio,T=p.paddedRect.w-2*pl,D=p.paddedRect.h-2*pl,_=(s.right-s.left)*f,E=(s.bottom-s.top)*f,S=p.stretchX||[[0,T]],w=p.stretchY||[[0,D]],I=(te,de)=>te+de[1]-de[0],M=S.reduce(I,0),L=w.reduce(I,0),k=T-M,B=D-L,V=0,N=M,G=0,H=L,J=0,oe=k,ee=0,ne=B;if(p.content&&l){let te=p.content;V=wg(S,0,te[0]),G=wg(w,0,te[1]),N=wg(S,te[0],te[2]),H=wg(w,te[1],te[3]),J=te[0]-V,ee=te[1]-G,oe=te[2]-te[0]-N,ne=te[3]-te[1]-H}let pe=(te,de,ye,ve)=>{let Ee=Eg(te.stretch-V,N,_,s.left*f),Me=Tg(te.fixed-J,oe,te.stretch,M),Re=Eg(de.stretch-G,H,E,s.top*f),De=Tg(de.fixed-ee,ne,de.stretch,L),Ue=Eg(ye.stretch-V,N,_,s.left*f),Je=Tg(ye.fixed-J,oe,ye.stretch,M),ze=Eg(ve.stretch-G,H,E,s.top*f),ut=Tg(ve.fixed-ee,ne,ve.stretch,L),rt=new it(Ee,Re),et=new it(Ue,Re),Xe=new it(Ue,ze),wt=new it(Ee,ze),ct=new it(Me/v,De/v),ft=new it(Je/v,ut/v),Nt=e*Math.PI/180;if(Nt){let Un=Math.sin(Nt),Fn=Math.cos(Nt),At=[Fn,-Un,Un,Fn];rt._matMult(At),et._matMult(At),wt._matMult(At),Xe._matMult(At)}let Ht=te.stretch+te.fixed,Wt=ye.stretch+ye.fixed,$t=de.stretch+de.fixed,Kt=ve.stretch+ve.fixed,Yt=s.imageSecondary;return{tl:rt,tr:et,bl:wt,br:Xe,texPrimary:{x:p.paddedRect.x+pl+Ht,y:p.paddedRect.y+pl+$t,w:Wt-Ht,h:Kt-$t},texSecondary:Yt?{x:Yt.paddedRect.x+pl+Ht,y:Yt.paddedRect.y+pl+$t,w:Wt-Ht,h:Kt-$t}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ct,pixelOffsetBR:ft,minFontScaleX:oe/v/_,minFontScaleY:ne/v/E,isSDF:r}};if(l&&(p.stretchX||p.stretchY)){let te=eT(S,k,M),de=eT(w,B,L);for(let ye=0;ye<te.length-1;ye++){let ve=te[ye],Ee=te[ye+1];for(let Me=0;Me<de.length-1;Me++)u.push(pe(ve,de[Me],Ee,de[Me+1]))}}else u.push(pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:D+1}));return u}function wg(s,e,r){let l=0;for(let f of s)l+=Math.max(e,Math.min(r,f[1]))-Math.max(e,Math.min(r,f[0]));return l}function eT(s,e,r){let l=[{fixed:-pl,stretch:0}];for(let[f,u]of s){let p=l[l.length-1];l.push({fixed:f-p.stretch,stretch:p.stretch}),l.push({fixed:f-p.stretch,stretch:p.stretch+(u-f)})}return l.push({fixed:e+pl,stretch:r}),l}function Eg(s,e,r,l){return s/e*r+l}function Tg(s,e,r,l){return s-e*r/l}function aO(s,e,r,l){let f=e+s.positionedLines[l].lineOffset;return l===0?r+f/2:r+(f+(e+s.positionedLines[l-1].lineOffset))/2}function lO(s,e=1,r=!1){let l=1/0,f=1/0,u=-1/0,p=-1/0,v=s[0];for(let w=0;w<v.length;w++){let I=v[w];(!w||I.x<l)&&(l=I.x),(!w||I.y<f)&&(f=I.y),(!w||I.x>u)&&(u=I.x),(!w||I.y>p)&&(p=I.y)}let T=Math.min(u-l,p-f),D=T/2,_=new _d([],cO);if(T===0)return new it(l,f);for(let w=l;w<u;w+=T)for(let I=f;I<p;I+=T)_.push(new ch(w+D,I+D,D,s));let E=function(w){let I=0,M=0,L=0,k=w[0];for(let B=0,V=k.length,N=V-1;B<V;N=B++){let G=k[B],H=k[N],J=G.x*H.y-H.x*G.y;M+=(G.x+H.x)*J,L+=(G.y+H.y)*J,I+=3*J}return new ch(M/I,L/I,0,w)}(s),S=_.length;for(;_.length;){let w=_.pop();(w.d>E.d||!E.d)&&(E=w,r&&console.log("found best %d after %d probes",Math.round(1e4*w.d)/1e4,S)),w.max-E.d<=e||(D=w.h/2,_.push(new ch(w.p.x-D,w.p.y-D,D,s)),_.push(new ch(w.p.x+D,w.p.y-D,D,s)),_.push(new ch(w.p.x-D,w.p.y+D,D,s)),_.push(new ch(w.p.x+D,w.p.y+D,D,s)),S+=4)}return r&&(console.log(`num probes: ${S}`),console.log(`best distance: ${E.d}`)),E.p}function cO(s,e){return e.max-s.max}class ch{constructor(e,r,l,f){this.p=new it(e,r),this.h=l,this.d=function(u,p){let v=!1,T=1/0;for(let D=0;D<p.length;D++){let _=p[D];for(let E=0,S=_.length,w=S-1;E<S;w=E++){let I=_[E],M=_[w];I.y>u.y!=M.y>u.y&&u.x<(M.x-I.x)*(u.y-I.y)/(M.y-I.y)+I.x&&(v=!v),T=Math.min(T,Dt(u,I,M))}}return(v?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}let o0=Number.POSITIVE_INFINITY,uO=Math.sqrt(2);function tT(s,[e,r]){let l=0,f=0;if(r===o0){e<0&&(e=0);let u=e/uO;switch(s){case"top-right":case"top-left":f=u-7;break;case"bottom-right":case"bottom-left":f=7-u;break;case"bottom":f=7-e;break;case"top":f=e-7}switch(s){case"top-right":case"bottom-right":l=-u;break;case"top-left":case"bottom-left":l=u;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),s){case"top-right":case"top-left":case"top":f=r-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-r}switch(s){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,f]}function s0(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function hO(s,e,r,l,f,u,p,v,T,D,_,E,S,w,I){let M=u.textMaxSize.evaluate(e,{},E);M===void 0?M=p*u.textScaleFactor:M*=u.textScaleFactor;let L=s.layers[0].layout,k=L.get("icon-offset").evaluate(e,{},E),B=rT(r.horizontal)||r.vertical,V=S.name==="globe",N=qr,G=p*u.textScaleFactor/N,H=s.tilePixelRatio*M/N,J=(ve=s.overscaling,s.zoom>18&&ve>2&&(ve>>=1),Math.max(ot/(512*ve),1)*L.get("symbol-spacing")),oe=L.get("text-padding")*s.tilePixelRatio,ee=L.get("icon-padding")*s.tilePixelRatio,ne=en(L.get("text-max-angle")),pe=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",te=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",de=L.get("symbol-placement"),ye=J/2;var ve;let Ee=L.get("icon-text-fit").evaluate(e,{},E),Me=L.get("icon-text-fit-padding").evaluate(e,{},E),Re=Ee!=="none",De;s.hasAnyIconTextFit===!1&&Re&&(s.hasAnyIconTextFit=!0),l&&Re&&(s.allowVerticalPlacement&&r.vertical&&(De=UE(l,r.vertical,Ee,Me,k,G)),B&&(l=UE(l,B,Ee,Me,k,G)));let Ue=(Je,ze,ut)=>{if(ze.x<0||ze.x>=ot||ze.y<0||ze.y>=ot)return;let rt=null;if(V){let{x:et,y:Xe,z:wt}=S.projectTilePoint(ze.x,ze.y,ut);rt={anchor:new aa(et,Xe,wt,0,void 0),up:S.upVector(ut,ze.x,ze.y)}}(function(et,Xe,wt,ct,ft,Nt,Ht,Wt,$t,Kt,Yt,Un,Fn,At,In,An,tr,_r,Ir,yr,ur,br,Mr,Wr,Yn,Ai,rs){let Eo=et.addToLineVertexArray(Xe,ct),To,Ac,vl,Rc,Qf,EI,TI,II=0,SI=0,DI=0,CI=0,F0=-1,N0=-1,Cs={},MI=hi(""),Pc=wt?wt.anchor:Xe,z0=$t.layout.get("icon-text-fit").evaluate(ur,{},Yn)!=="none",B0=0,V0=0;if($t._unevaluatedLayout.getValue("text-radial-offset")===void 0?[B0,V0]=$t.layout.get("text-offset").evaluate(ur,{},Yn).map(Vi=>Vi*qr):(B0=$t.layout.get("text-radial-offset").evaluate(ur,{},Yn)*qr,V0=o0),et.allowVerticalPlacement&&ft.vertical){let Vi=ft.vertical;if(In)EI=a0(Vi),Wt&&(TI=a0(Wt));else{let ji=$t.layout.get("text-rotate").evaluate(ur,{},Yn)+90;vl=Ig(Kt,Pc,Xe,Yt,Un,Fn,Vi,At,ji,An),Wt&&(Rc=Ig(Kt,Pc,Xe,Yt,Un,Fn,Wt,_r,ji))}}if(Nt){let Vi=$t.layout.get("icon-rotate").evaluate(ur,{},Yn),ji=QE(Nt,Vi,Mr,z0,br.iconScaleFactor),gh=Wt?QE(Wt,Vi,Mr,z0,br.iconScaleFactor):void 0;Ac=Ig(Kt,Pc,Xe,Yt,Un,Fn,Nt,_r,Vi),II=4*ji.length;let AI=et.iconSizeData,Oc=null;AI.kind==="source"?(Oc=[Ko*$t.layout.get("icon-size").evaluate(ur,{},Yn)*br.iconScaleFactor],Oc[0]>ml&&ln(`${et.layerIds[0]}: Value for "icon-size" is >= ${kf}. Reduce your "icon-size".`)):AI.kind==="composite"&&(Oc=[Ko*br.compositeIconSizes[0].evaluate(ur,{},Yn)*br.iconScaleFactor,Ko*br.compositeIconSizes[1].evaluate(ur,{},Yn)*br.iconScaleFactor],(Oc[0]>ml||Oc[1]>ml)&&ln(`${et.layerIds[0]}: Value for "icon-size" is >= ${kf}. Reduce your "icon-size".`)),et.addSymbols(et.icon,ji,Oc,yr,Ir,ur,!1,wt,Xe,Eo.lineStartIndex,Eo.lineLength,-1,Wr,Yn,Ai,rs),F0=et.icon.placedSymbolArray.length-1,gh&&(SI=4*gh.length,et.addSymbols(et.icon,gh,Oc,yr,Ir,ur,no.vertical,wt,Xe,Eo.lineStartIndex,Eo.lineLength,-1,Wr,Yn,Ai,rs),N0=et.icon.placedSymbolArray.length-1)}for(let Vi in ft.horizontal){let ji=ft.horizontal[Vi];To||(MI=hi(ji.text),In?Qf=a0(ji):To=Ig(Kt,Pc,Xe,Yt,Un,Fn,ji,At,$t.layout.get("text-rotate").evaluate(ur,{},Yn),An));let gh=ji.positionedLines.length===1;if(DI+=nT(et,wt,Xe,ji,Ht,$t,In,ur,An,Eo,ft.vertical?no.horizontal:no.horizontalOnly,gh?Object.keys(ft.horizontal):[Vi],Cs,F0,br,Wr,Yn,Ai),gh)break}ft.vertical&&(CI+=nT(et,wt,Xe,ft.vertical,Ht,$t,In,ur,An,Eo,no.vertical,["vertical"],Cs,N0,br,Wr,Yn,Ai));let xl=-1,j0=(Vi,ji)=>Vi?Math.max(Vi,ji):ji;xl=j0(Qf,xl),xl=j0(EI,xl),xl=j0(TI,xl);let SL=xl>-1?1:0;et.glyphOffsetArray.length>=65535&&ln("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ur.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,ur.sortKey),et.symbolInstances.emplaceBack(Xe.x,Xe.y,Pc.x,Pc.y,Pc.z,Cs.right>=0?Cs.right:-1,Cs.center>=0?Cs.center:-1,Cs.left>=0?Cs.left:-1,Cs.vertical>=0?Cs.vertical:-1,F0,N0,MI,To!==void 0?To:et.collisionBoxArray.length,To!==void 0?To+1:et.collisionBoxArray.length,vl!==void 0?vl:et.collisionBoxArray.length,vl!==void 0?vl+1:et.collisionBoxArray.length,Ac!==void 0?Ac:et.collisionBoxArray.length,Ac!==void 0?Ac+1:et.collisionBoxArray.length,Rc||et.collisionBoxArray.length,Rc?Rc+1:et.collisionBoxArray.length,Yt,DI,CI,II,SI,SL,0,B0,V0,xl,0,z0?1:0)})(s,ze,rt,Je,r,l,f,De,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,oe,pe,T,0,ee,te,k,e,u,D,_,E,w,I)};if(de==="line")for(let Je of ZE(e.geometry,0,0,ot,ot)){let ze=sO(Je,J,ne,r.vertical||B,l,N,H,s.overscaling,ot);for(let ut of ze)B&&dO(s,B.text,ye,ut)||Ue(Je,ut,E)}else if(de==="line-center"){for(let Je of e.geometry)if(Je.length>1){let ze=oO(Je,ne,r.vertical||B,l,N,H);ze&&Ue(Je,ze,E)}}else if(e.type==="Polygon")for(let Je of dg(e.geometry,0)){let ze=lO(Je,16);Ue(Je[0],new aa(ze.x,ze.y,0,0,void 0),E)}else if(e.type==="LineString")for(let Je of e.geometry)Ue(Je,new aa(Je[0].x,Je[0].y,0,0,void 0),E);else if(e.type==="Point")for(let Je of e.geometry)for(let ze of Je)Ue([ze],new aa(ze.x,ze.y,0,0,void 0),E)}let kf=255,ml=kf*Ko;function nT(s,e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L,k){let B=function(G,H,J,oe,ee,ne,pe,te){let de=[];if(H.positionedLines.length===0)return de;let ye=oe.layout.get("text-rotate").evaluate(ne,{})*Math.PI/180,ve=function(Ue){let Je=Ue[0],ze=Ue[1],ut=Je*ze;return ut>0?[Je,-ze]:ut<0?[-Je,ze]:Je===0?[ze,Je]:[ze,-Je]}(J),Ee=Math.abs(H.top-H.bottom);for(let Ue of H.positionedLines)Ee-=Ue.lineOffset;let Me=H.positionedLines.length,Re=Ee/Me,De=H.top-J[1];for(let Ue=0;Ue<Me;++Ue){let Je=H.positionedLines[Ue];De=aO(H,Re,De,Ue);for(let ze of Je.positionedGlyphs){if(!ze.rect)continue;let ut=ze.rect||{},rt=FE+1,et=!0,Xe=1,wt=0;if(ze.imageName){let yr=pe[ze.imageName];if(!yr)continue;if(yr.sdf){ln("SDF images are not supported in formatted text and will be ignored.");continue}et=!1,Xe=yr.pixelRatio,rt=Of/Xe}let ct=(ee||te)&&ze.vertical,ft=ze.metrics.advance*ze.scale/2,Nt=ze.metrics,Ht=ze.rect;if(Ht===null)continue;te&&H.verticalizable&&(wt=ze.imageName?ft-ze.metrics.width*ze.scale/2:0);let Wt=ee?[ze.x+ft,ze.y]:[0,0],$t=[0,0],Kt=[0,0],Yt=!1;ee||(ct?(Kt=[ze.x+ft+ve[0],ze.y+ve[1]-wt],Yt=!0):$t=[ze.x+ft+J[0],ze.y+J[1]-wt]);let Un=Ht.w*ze.scale/(Xe*(ze.localGlyph?Qo:1)),Fn=Ht.h*ze.scale/(Xe*(ze.localGlyph?Qo:1)),At,In,An,tr;if(ct){let yr=ze.y-De,ur=new it(-ft,ft-yr),br=-Math.PI/2,Mr=new it(...Kt);At=new it(-ft+$t[0],$t[1]),At._rotateAround(br,ur)._add(Mr),At.x+=-yr+ft,At.y-=(Nt.left-rt)*ze.scale;let Wr=ze.imageName?Nt.advance*ze.scale:qr*ze.scale,Yn=String.fromCodePoint(ze.glyph);YP(Yn)?At.x+=(1-rt)*ze.scale:JP(Yn)?At.x+=Wr-Nt.height*ze.scale+(-rt-1)*ze.scale:At.x+=ze.imageName||Nt.width+2*rt===Ht.w&&Nt.height+2*rt===Ht.h?(Wr-Fn)/2:(Wr-(Nt.height+2*rt)*ze.scale)/2,In=new it(At.x,At.y-Un),An=new it(At.x+Fn,At.y),tr=new it(At.x+Fn,At.y-Un)}else{let yr=(Nt.left-rt)*ze.scale-ft+$t[0],ur=(-Nt.top-rt)*ze.scale+$t[1],br=yr+Un,Mr=ur+Fn;At=new it(yr,ur),In=new it(br,ur),An=new it(yr,Mr),tr=new it(br,Mr)}if(ye){let yr;yr=ee?new it(0,0):Yt?new it(ve[0],ve[1]):new it(J[0],J[1]),At._rotateAround(ye,yr),In._rotateAround(ye,yr),An._rotateAround(ye,yr),tr._rotateAround(ye,yr)}let _r=new it(0,0),Ir=new it(0,0);de.push({tl:At,tr:In,bl:An,br:tr,texPrimary:ut,texSecondary:void 0,writingMode:H.writingMode,glyphOffset:Wt,sectionIndex:ze.sectionIndex,isSDF:et,pixelOffsetTL:_r,pixelOffsetBR:Ir,minFontScaleX:0,minFontScaleY:0})}}return de}(0,l,T,u,p,v,f,s.allowVerticalPlacement),V=s.textSizeData,N=null;V.kind==="source"?(N=[Ko*u.layout.get("text-size").evaluate(v,{},L)*I.textScaleFactor],N[0]>ml&&ln(`${s.layerIds[0]}: Value for "text-size" is >= ${kf}. Reduce your "text-size".`)):V.kind==="composite"&&(N=[Ko*I.compositeTextSizes[0].evaluate(v,{},L)*I.textScaleFactor,Ko*I.compositeTextSizes[1].evaluate(v,{},L)*I.textScaleFactor],(N[0]>ml||N[1]>ml)&&ln(`${s.layerIds[0]}: Value for "text-size" is >= ${kf}. Reduce your "text-size".`)),s.addSymbols(s.text,B,N,T,p,v,_,e,r,D.lineStartIndex,D.lineLength,w,M,L,k,!1);for(let G of E)S[G]=s.text.placedSymbolArray.length-1;return 4*B.length}function rT(s){for(let e in s)return s[e];return null}function Ig(s,e,r,l,f,u,p,v,T,D){let _=p.top,E=p.bottom,S=p.left,w=p.right,I=p.collisionPadding;if(I&&(S-=I[0],_-=I[1],w+=I[2],E+=I[3]),T){let M=new it(S,_),L=new it(w,_),k=new it(S,E),B=new it(w,E),V=en(T),N=new it(0,0);D&&(N=new it(D[0],D[1])),M._rotateAround(V,N),L._rotateAround(V,N),k._rotateAround(V,N),B._rotateAround(V,N),S=Math.min(M.x,L.x,k.x,B.x),w=Math.max(M.x,L.x,k.x,B.x),_=Math.min(M.y,L.y,k.y,B.y),E=Math.max(M.y,L.y,k.y,B.y)}return s.emplaceBack(e.x,e.y,e.z,r.x,r.y,S,_,w,E,v,l,f,u),s.length-1}function a0(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);let e=s.bottom-s.top;return e>0?Math.max(10,e):null}function dO(s,e,r,l){let f=s.compareText;if(e in f){let u=f[e];for(let p=u.length-1;p>=0;p--)if(l.dist(u[p])<r)return!0}else f[e]=[];return f[e].push(l),!1}function iT(s,e){let r=s.fovAboveCenter,l=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,f=(s._camera.position[2]*s.worldSize-l)/Math.cos(s._pitch),u=Math.sin(r)*f/Math.sin(Math.max(Math.PI/2-s._pitch-r,.01)),p=Math.sin(s._pitch)*u+f,v=f*(1/s._horizonShift);return s.elevation&&s.elevation.exaggeration()!==0||(p*=1+Math.max(s.zoom-17,0)),Math.min(1.01*p,v)}function Ff(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};let r=Math.pow(2,-s.z),l=s.x*r,f=(s.x+1)*r,u=s.y*r,p=(s.y+1)*r,v=Q(l),T=Q(f),D=re(u),_=re(p),E=e.project(v,D),S=e.project(T,D),w=e.project(T,_),I=e.project(v,_),M=Math.min(E.x,S.x,w.x,I.x),L=Math.min(E.y,S.y,w.y,I.y),k=Math.max(E.x,S.x,w.x,I.x),B=Math.max(E.y,S.y,w.y,I.y),V=r/16;function N(H,J,oe,ee,ne,pe){let te=(oe+ne)/2,de=(ee+pe)/2,ye=e.project(Q(te),re(de)),ve=Math.max(0,M-ye.x,L-ye.y,ye.x-k,ye.y-B);M=Math.min(M,ye.x),k=Math.max(k,ye.x),L=Math.min(L,ye.y),B=Math.max(B,ye.y),ve>V&&(N(H,ye,oe,ee,te,de),N(ye,J,te,de,ne,pe))}N(E,S,l,u,f,u),N(S,w,f,u,f,p),N(w,I,f,p,l,p),N(I,E,l,p,l,u),M-=V,L-=V,k+=V,B+=V;let G=1/Math.max(k-M,B-L);return{scale:G,x:M*G,y:L*G,x2:k*G,y2:B*G,projection:e}}function oT(s,{x:e,y:r},l=0){return new it(((e-l)*s.scale-s.x)*ot,(r*s.scale-s.y)*ot)}let fO=we.mat4.identity(new Float32Array(16));class gl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new R(0,0)}projectTilePoint(e,r,l){return{x:e,y:r,z:0}}locationPoint(e,r,l=!0){return e._coordinatePoint(e.locationCoordinate(r),l)}pixelsPerMeter(e,r){return Z(1,e)*r}pixelSpaceConversion(e,r,l){return 1}farthestPixelDistance(e){return iT(e,e.pixelsPerMeter)}pointCoordinate(e,r,l,f){let u=e.horizonLineFromTop(!1),p=new it(r,Math.max(u,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,f))}pointCoordinate3D(e,r,l){let f=new it(r,l);if(e.elevation)return e.elevation.pointCoordinate(f);{let u=this.pointCoordinate(e,f.x,f.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);let l=e.horizonLineFromTop();return r.y<l}createInversionMatrix(e,r){return fO}createTileMatrix(e,r,l){let f,u,p,v=l.canonical,T=we.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let D=Ff(v,this);f=1,u=D.x+l.wrap*D.scale,p=D.y,we.mat4.scale(T,T,[f/D.scale,f/D.scale,e.pixelsPerMeter/r])}else f=r/e.zoomScale(v.z),u=(v.x+Math.pow(2,v.z)*l.wrap)*f,p=v.y*f;return we.mat4.translate(T,T,[u,p,0]),we.mat4.scale(T,T,[f/ot,f/ot,1]),T}upVector(e,r,l){return[0,0,1]}upVectorScale(e,r,l){return{metersToTile:1}}}class pO extends gl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[r,l]=this.parallels=e.parallels||[29.5,45.5],f=Math.sin(en(r));this.n=(f+Math.sin(en(l)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(e,r){let{n:l,c:f,r0:u}=this,p=en(e-this.center[0]),v=en(r),T=Math.sqrt(f-2*l*Math.sin(v))/l;return{x:T*Math.sin(p*l),y:T*Math.cos(p*l)-u,z:0}}unproject(e,r){let{n:l,c:f,r0:u}=this,p=u+r,v=Math.atan2(e,Math.abs(p))*Math.sign(p);p*l<0&&(v-=Math.PI*Math.sign(e)*Math.sign(p));let T=en(this.center[0])*l;v=zo(v,-Math.PI-T,Math.PI-T);let D=zt(Fr(v/l)+this.center[0],-180,180),_=Math.asin(zt((f-(e*e+p*p)*l*l)/(2*l),-1,1)),E=zt(Fr(_),-ae,ae);return new R(D,E)}}let Nf=1.340264,zf=-.081106,Bf=893e-6,Vf=.003796,Sg=Math.sqrt(3)/2;class mO extends gl{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;let l=Math.asin(Sg*Math.sin(r)),f=l*l,u=f*f*f;return{x:.5*(e*Math.cos(l)/(Sg*(Nf+3*zf*f+u*(7*Bf+9*Vf*f)))/Math.PI+.5),y:1-.5*(l*(Nf+zf*f+u*(Bf+Vf*f))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,f=l*l,u=f*f*f;for(let _,E,S,w=0;w<12&&(E=l*(Nf+zf*f+u*(Bf+Vf*f))-r,S=Nf+3*zf*f+u*(7*Bf+9*Vf*f),_=E/S,l=zt(l-_,-Math.PI/3,Math.PI/3),f=l*l,u=f*f*f,!(Math.abs(_)<1e-12));++w);let p=Sg*e*(Nf+3*zf*f+u*(7*Bf+9*Vf*f))/Math.cos(l),v=Math.asin(Math.sin(l)/Sg),T=zt(180*p/Math.PI,-180,180),D=zt(180*v/Math.PI,-ae,ae);return new R(T,D)}}class gO extends gl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){let l=360*(e-.5),f=zt(360*(.5-r),-ae,ae);return new R(l,f)}}let uh=Math.PI/2;function Dg(s){return Math.tan((uh+s)/2)}class _O extends gl{constructor(e){super(e),this.center=e.center||[0,30];let[r,l]=this.parallels=e.parallels||[30,30],f=en(r),u=en(l);this.southernCenter=f+u<0,this.southernCenter&&(f=-f,u=-u);let p=Math.cos(f),v=Dg(f);this.n=f===u?Math.sin(f):Math.log(p/Math.cos(u))/Math.log(Dg(u)/v),this.f=p*Math.pow(Dg(f),this.n)/this.n}project(e,r){r=en(r),this.southernCenter&&(r=-r),e=en(e-this.center[0]);let l=1e-6,{n:f,f:u}=this;u>0?r<-uh+l&&(r=-uh+l):r>uh-l&&(r=uh-l);let p=u/Math.pow(Dg(r),f),v=p*Math.sin(f*e),T=u-p*Math.cos(f*e);return v=.5*(v/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:v,y:this.southernCenter?T:1-T,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;let{n:l,f}=this,u=f-r,p=Math.sign(u),v=Math.sign(l)*Math.sqrt(e*e+u*u),T=Math.atan2(e,Math.abs(u))*p;u*l<0&&(T-=Math.PI*Math.sign(e)*p);let D=zt(Fr(T/l)+this.center[0],-180,180),_=zt(Fr(2*Math.atan(Math.pow(f/v,1/l))-uh),-ae,ae);return new R(D,this.southernCenter?-_:_)}}class sT extends gl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:q(e),y:X(r),z:0}}unproject(e,r){let l=Q(e),f=re(r);return new R(l,f)}}let aT=en(ae);class yO extends gl{project(e,r){let l=(r=en(r))*r,f=l*l;return{x:.5*((e=en(e))*(.8707-.131979*l+f*(f*(.003971*l-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+l*(.015085+f*(.028874*l-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,f=25,u=0,p=l*l;do{p=l*l;let D=p*p;u=(l*(1.007226+p*(.015085+D*(.028874*p-.044475-.005916*D)))-r)/(1.007226+p*(.045255+D*(.259866*p-.311325-.005916*11*D))),l=zt(l-u,-aT,aT)}while(Math.abs(u)>1e-6&&--f>0);p=l*l;let v=zt(Fr(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),T=Fr(l);return new R(v,T)}}let lT=en(ae);class vO extends gl{project(e,r){r=en(r),e=en(e);let l=Math.cos(r),f=2/Math.PI,u=Math.acos(l*Math.cos(e/2)),p=Math.sin(u)/u,v=.5*(e*f+2*l*Math.sin(e/2)/p)||0,T=.5*(r+Math.sin(r)/p)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,r){let l=e=(2*e-.5)*Math.PI,f=r=(2*(1-r)-1)*Math.PI,u=25,p=1e-6,v=0,T=0;do{let D=Math.cos(f),_=Math.sin(f),E=2*_*D,S=_*_,w=D*D,I=Math.cos(l/2),M=Math.sin(l/2),L=2*I*M,k=M*M,B=1-w*I*I,V=B?1/B:0,N=B?Math.acos(D*I)*Math.sqrt(1/B):0,G=.5*(2*N*D*M+2*l/Math.PI)-e,H=.5*(N*_+f)-r,J=.5*V*(w*k+N*D*I*S)+1/Math.PI,oe=V*(L*E/4-N*_*M),ee=.125*V*(E*M-N*_*w*L),ne=.5*V*(S*I+N*k*D)+.5,pe=oe*ee-ne*J;v=(H*oe-G*ne)/pe,T=(G*ee-H*J)/pe,l=zt(l-v,-Math.PI,Math.PI),f=zt(f-T,-lT,lT)}while((Math.abs(v)>p||Math.abs(T)>p)&&--u>0);return new R(Fr(l),Fr(f))}}class cT extends gl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(en(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){let{scale:l,cosPhi:f}=this;return{x:en(e)*f*l+.5,y:-Math.sin(en(r))/f*l+.5,z:0}}unproject(e,r){let{scale:l,cosPhi:f}=this,u=-(r-.5)/l,p=zt(Fr((e-.5)/l)/f,-180,180),v=Math.asin(zt(u*f,-1,1)),T=zt(Fr(v),-ae,ae);return new R(p,T)}}class xO extends sT{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,l){let f=xf(e,r,l),u=lg(Ss(l));return we.vec3.transformMat4(f,f,u),{x:f[0],y:f[1],z:f[2]}}locationPoint(e,r){let l=C(r.lat,r.lng),f=we.vec3.normalize([],l),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,p=Z(1,0)*ot*u;we.vec3.scaleAndAdd(l,l,f,p);let v=we.mat4.identity(new Float64Array(16));return we.mat4.multiply(v,e.pixelMatrix,e.globeMatrix),we.vec3.transformMat4(l,l,v),new it(l[0],l[1])}pixelsPerMeter(e,r){return Z(1,0)*r}pixelSpaceConversion(e,r,l){let f=Z(1,e)*r,u=Mt(Z(1,45)*r,f,l);return this.pixelsPerMeter(e,r)/u}createTileMatrix(e,r,l){let f=Av(Ss(l.canonical));return we.mat4.multiply(new Float64Array(16),e.globeMatrix,f)}createInversionMatrix(e,r){let{center:l}=e,f=lg(Ss(r));return we.mat4.rotateY(f,f,en(l.lng)),we.mat4.rotateX(f,f,en(l.lat)),we.mat4.scale(f,f,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(e,r,l,f){return ul(e,r,l,!0)||new xe(0,0)}pointCoordinate3D(e,r,l){let f=this.pointCoordinate(e,r,l,0);return[f.x,f.y,f.z]}isPointAboveHorizon(e,r){return!ul(e,r.x,r.y,!1)}farthestPixelDistance(e){let r=function(f,u){let p=f.cameraToCenterDistance,v=f._centerAltitude*u,T=f._camera,D=f._camera.forward(),_=we.vec3.add([],we.vec3.scale([],D,-p),[0,0,v]),E=f.worldSize/(2*Math.PI),S=[0,0,-E],w=f.width/f.height,I=Math.tan(f.fovAboveCenter),M=we.vec3.scale([],T.up(),I),L=we.vec3.scale([],T.right(),I*w),k=we.vec3.normalize([],we.vec3.add([],we.vec3.add([],D,M),L)),B=[],V;if(new pi(_,k).closestPointOnSphere(S,E,B)){let N=we.vec3.add([],B,S),G=we.vec3.sub([],N,_);V=Math.cos(f.fovAboveCenter)*we.vec3.length(G)}else{let N=we.vec3.sub([],_,S),G=we.vec3.sub([],S,_);we.vec3.normalize(G,G);let H=we.vec3.length(N)-E;V=Math.sqrt(H*(H+2*E));let J=Math.acos(V/(E+H))-Math.acos(we.vec3.dot(D,G));V*=Math.cos(J)}return 1.01*V}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=hl(e.zoom);if(l>0){let f=iT(e,Z(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Mt(r,f+u*(1-Math.cos(p)),Math.pow(l,10))}return r}upVector(e,r,l){return xf(r,l,e,1)}upVectorScale(e){return{metersToTile:cl(ag(Ss(e)))}}}function uT(s){let e=s.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new sT(s);case"equirectangular":return new gO(s);case"naturalEarth":return new yO(s);case"equalEarth":return new mO(s);case"winkelTripel":return new vO(s);case"albers":return r?new cT(s):new pO(s);case"lambertConformalConic":return r?new cT(s):new _O(s);case"globe":return new xO(s)}throw new Error(`Invalid projection name: ${s.name}`)}let bO=oh.VectorTileFeature.types,wO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Cg(s,e,r,l,f,u,p,v,T,D,_,E,S){let w=v?Math.min(ml,Math.round(v[0])):0,I=v?Math.min(ml,Math.round(v[1])):0;s.emplaceBack(e,r,Math.round(32*l),Math.round(32*f),u,p,(w<<1)+(T?1:0),I,16*D,16*_,256*E,256*S)}function Mg(s,e,r){s.emplaceBack(e,r)}function Ag(s,e,r,l,f,u,p){s.emplaceBack(e,r,l,f,u,p)}function Rg(s,e,r,l,f){s.emplaceBack(e,r,l,f),s.emplaceBack(e,r,l,f),s.emplaceBack(e,r,l,f),s.emplaceBack(e,r,l,f)}function EO(s){for(let e of s.sections)if(gv(e.text))return!0;return!1}class l0{constructor(e){this.layoutVertexArray=new nl,this.indexArray=new ir,this.programConfigurations=e,this.segments=new dr,this.dynamicLayoutVertexArray=new Ho,this.opacityVertexArray=new af,this.placedSymbolArray=new df,this.iconTransitioningVertexArray=new Is,this.globeExtVertexArray=new sf,this.zOffsetVertexArray=new sl}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,l,f,u){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,VP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,UP.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,wO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,GP.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,jP.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,$P.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ht(l0,"SymbolBuffers");class c0{constructor(e,r,l){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new l,this.segments=new dr,this.collisionVertexArray=new il,this.collisionVertexArrayExt=new Ho}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,HP.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,qP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ht(c0,"CollisionBuffers");class Pg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=we.mat4.identity([]),this.placementViewportMatrix=we.mat4.identity([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jv(this.zoom,r["text-size"]),this.iconSizeData=Jv(this.zoom,r["icon-size"]);let l=this.layers[0].layout,f=l.get("symbol-sort-key"),u=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(p=>no[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=l.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new l0(new xo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new l0(new xo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Xm,this.lineVertexArray=new eh,this.symbolInstances=new ff}calculateGlyphDependencies(e,r,l,f,u){for(let p of e){let v=p.codePointAt(0);if(v===void 0)break;if(r[v]=!0,f&&u&&v<=65535){let T=Rf[p];T&&(r[T.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;let l=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Gv(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,r,l,f){let u=this.layers[0],p=u.layout,v=this.projection.name==="globe",T=p.get("text-font"),D=p.get("text-field"),_=p.get("icon-image"),E=(D.value.kind!=="constant"||D.value.value instanceof Qr&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),S=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,w=p.get("symbol-sort-key");if(this.features=[],!E&&!S)return;let I=r.iconDependencies,M=r.glyphDependencies,L=r.availableImages,k=new ar(this.zoom);for(let{feature:B,id:V,index:N,sourceLayerIndex:G}of e){let H=u._featureFilter.needGeometry,J=Ge(B,H);if(!u._featureFilter.filter(k,J,l))continue;if(H||(J.geometry=Se(B,l,f)),v&&B.type!==1&&l.z<=5){let pe=J.geometry,te=.98078528056,de=(ye,ve)=>{let Ee=xf(ye.x,ye.y,l,1),Me=xf(ve.x,ve.y,l,1);return we.vec3.dot(Ee,Me)<te};for(let ye=0;ye<pe.length;ye++)pe[ye]=Be(pe[ye],de)}let oe,ee;if(E){let pe=u.getValueAndResolveTokens("text-field",J,l,L),te=Qr.factory(pe);EO(te)&&(this.hasRTLText=!0),(!this.hasRTLText||Jd()==="unavailable"||this.hasRTLText&&Ci.isParsed())&&(oe=XP(te,u,J))}if(S){let pe=u.getValueAndResolveTokens("icon-image",J,l,L);ee=pe instanceof ri?pe:ri.fromString(pe)}if(!oe&&!ee)continue;let ne=this.sortFeaturesByKey?w.evaluate(J,{},l):void 0;if(this.features.push({id:V,text:oe,icon:ee,index:N,sourceLayerIndex:G,geometry:J.geometry,properties:B.properties,type:bO[B.type],sortKey:ne}),ee&&(I[ee.namePrimary]=!0,ee.nameSecondary&&(I[ee.nameSecondary]=!0)),oe){let pe=T.evaluate(J,{},l).join(","),te=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(no.vertical)>=0;for(let de of oe.sections)if(de.image)I[de.image.namePrimary]=!0;else{let ye=qd(oe.toString()),ve=de.fontStack||pe,Ee=M[ve]=M[ve]||{};this.calculateGlyphDependencies(de.text,Ee,te,this.allowVerticalPlacement,ye)}}}p.get("symbol-placement")==="line"&&(this.features=function(B){let V={},N={},G=[],H=0;function J(pe){G.push(B[pe]),H++}function oe(pe,te,de){let ye=N[pe];return delete N[pe],N[te]=ye,G[ye].geometry[0].pop(),G[ye].geometry[0]=G[ye].geometry[0].concat(de[0]),ye}function ee(pe,te,de){let ye=V[te];return delete V[te],V[pe]=ye,G[ye].geometry[0].shift(),G[ye].geometry[0]=de[0].concat(G[ye].geometry[0]),ye}function ne(pe,te,de){let ye=de?te[0][te[0].length-1]:te[0][0];return`${pe}:${ye.x}:${ye.y}`}for(let pe=0;pe<B.length;pe++){let te=B[pe],de=te.geometry,ye=te.text?te.text.toString():null;if(!ye){J(pe);continue}let ve=ne(ye,de),Ee=ne(ye,de,!0);if(ve in N&&Ee in V&&N[ve]!==V[Ee]){let Me=ee(ve,Ee,de),Re=oe(ve,Ee,G[Me].geometry);delete V[ve],delete N[Ee],N[ne(ye,G[Re].geometry,!0)]=Re,G[Me].geometry=null}else ve in N?oe(ve,Ee,de):Ee in V?ee(ve,Ee,de):(J(pe),V[ve]=H-1,N[Ee]=H-1)}return G.filter(pe=>pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((B,V)=>B.sortKey-V.sortKey)}update(e,r,l,f,u){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let v=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,r,v,l,f,u),this.icon.programConfigurations.updatePaintArrays(e,r,v,l,f,u)}updateZOffset(){let e=(u,p,v)=>{l+=p,l>u.length&&u.resize(l);for(let T=-p;T<0;T++)u.emplace(T+l,v)},r=(u,p,v)=>{f+=p,f>u.length&&u.resize(f);for(let T=-p;T<0;T++)u.emplace(T+f,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,f=0;for(let u=0;u<this.symbolInstances.length;u++){let p=this.symbolInstances.get(u),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:T,numIconVertices:D}=p,_=p.zOffset,E=D>0;if((v>0||T>0)&&(e(this.text.zOffsetVertexArray,v,_),e(this.text.zOffsetVertexArray,T,_)),E){let{placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:w}=p;S>=0&&r(this.icon.zOffsetVertexArray,D,_),w>=0&&r(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=uT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){let l=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:f,y:u}of r)this.lineVertexArray.emplaceBack(f,u);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,r,l,f,u,p,v,T,D,_,E,S,w,I,M,L){let k=e.indexArray,B=e.layoutVertexArray,V=e.globeExtVertexArray,N=e.segments.prepareSegment(4*r.length,B,k,this.canOverlap?p.sortKey:void 0),G=this.glyphOffsetArray.length,H=N.vertexLength,J=this.allowVerticalPlacement&&v===no.vertical?Math.PI/2:0,oe=p.text&&p.text.sections;for(let ne=0;ne<r.length;ne++){let{tl:pe,tr:te,bl:de,br:ye,texPrimary:ve,texSecondary:Ee,pixelOffsetTL:Me,pixelOffsetBR:Re,minFontScaleX:De,minFontScaleY:Ue,glyphOffset:Je,isSDF:ze,sectionIndex:ut}=r[ne],rt=N.vertexLength,et=Je[1];if(Cg(B,D.x,D.y,pe.x,et+pe.y,ve.x,ve.y,l,ze,Me.x,Me.y,De,Ue),Cg(B,D.x,D.y,te.x,et+te.y,ve.x+ve.w,ve.y,l,ze,Re.x,Me.y,De,Ue),Cg(B,D.x,D.y,de.x,et+de.y,ve.x,ve.y+ve.h,l,ze,Me.x,Re.y,De,Ue),Cg(B,D.x,D.y,ye.x,et+ye.y,ve.x+ve.w,ve.y+ve.h,l,ze,Re.x,Re.y,De,Ue),T){let{x:Xe,y:wt,z:ct}=T.anchor,[ft,Nt,Ht]=T.up;Ag(V,Xe,wt,ct,ft,Nt,Ht),Ag(V,Xe,wt,ct,ft,Nt,Ht),Ag(V,Xe,wt,ct,ft,Nt,Ht),Ag(V,Xe,wt,ct,ft,Nt,Ht),Rg(e.dynamicLayoutVertexArray,Xe,wt,ct,J)}else Rg(e.dynamicLayoutVertexArray,D.x,D.y,D.z,J);if(L){let Xe=Ee||ve;Mg(e.iconTransitioningVertexArray,Xe.x,Xe.y),Mg(e.iconTransitioningVertexArray,Xe.x+Xe.w,Xe.y),Mg(e.iconTransitioningVertexArray,Xe.x,Xe.y+Xe.h),Mg(e.iconTransitioningVertexArray,Xe.x+Xe.w,Xe.y+Xe.h)}k.emplaceBack(rt,rt+1,rt+2),k.emplaceBack(rt+1,rt+2,rt+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),ne!==r.length-1&&ut===r[ne+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,p,p.index,{},w,I,M,oe&&oe[ut])}let ee=T?T.anchor:D;e.placedSymbolArray.emplaceBack(ee.x,ee.y,ee.z,D.x,D.y,G,this.glyphOffsetArray.length-G,H,_,E,D.segment,l?l[0]:0,l?l[1]:0,f[0],f[1],v,0,!1,0,S,0)}_commitLayoutVertex(e,r,l,f,u,p,v){e.emplaceBack(r,l,f,u,p,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,r,l,f,u,p,v){let T=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),D=T.vertexLength,_=v.tileAnchorX,E=v.tileAnchorY;for(let w=0;w<4;w++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,r,e.padding,v.zOffset),this._commitLayoutVertex(l.layoutVertexArray,f,u,p,_,E,new it(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,f,u,p,_,E,new it(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,f,u,p,_,E,new it(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,f,u,p,_,E,new it(e.x1,e.y2)),T.vertexLength+=4;let S=l.indexArray;S.emplaceBack(D,D+1),S.emplaceBack(D+1,D+2),S.emplaceBack(D+2,D+3),S.emplaceBack(D+3,D),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,l,f,u,p){for(let v=f;v<u;v++){let T=l.get(v),D=this.getSymbolInstanceTextSize(e,p,r,v);this._addCollisionDebugVertices(T,D,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,r,l,f,u,p){for(let v=f;v<u;v++){let T=l.get(v),D=this.getSymbolInstanceIconSize(e,r,p.placedIconSymbolIndex);this._addCollisionDebugVertices(T,D,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new c0(Zu,PE.members,Is),this.iconCollisionBox=new c0(Zu,PE.members,Is);let f=sh(this.iconSizeData,e),u=sh(this.textSizeData,e,l);for(let p=0;p<this.symbolInstances.length;p++){let v=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,e,r,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(u,e,r,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(f,e,r,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(f,e,r,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,r,l,f){let u=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:f),p=vg(this.textSizeData,e,u)/qr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,r,l){let f=this.icon.placedSymbolArray.get(l),u=vg(this.iconSizeData,e,f);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,r,l,f){e.emplaceBack(r,-l,-l,f),e.emplaceBack(r,l,-l,f),e.emplaceBack(r,l,l,f),e.emplaceBack(r,-l,l,f)}_updateTextDebugCollisionBoxes(e,r,l,f,u,p,v){for(let T=f;T<u;T++){let D=l.get(T),_=this.getSymbolInstanceTextSize(e,p,r,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,D.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,r,l,f,u,p,v){for(let T=f;T<u;T++){let D=l.get(T),_=this.getSymbolInstanceIconSize(e,r,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,D.padding,p.zOffset)}}updateCollisionDebugBuffers(e,r,l,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let u=sh(this.iconSizeData,e,f),p=sh(this.textSizeData,e,l);for(let v=0;v<this.symbolInstances.length;v++){let T=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(p,e,r,T.textBoxStartIndex,T.textBoxEndIndex,T,l),this._updateTextDebugCollisionBoxes(p,e,r,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,l),this._updateIconDebugCollisionBoxes(u,e,r,T.iconBoxStartIndex,T.iconBoxEndIndex,T,f),this._updateIconDebugCollisionBoxes(u,e,r,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,l,f,u,p,v,T,D){let _={};if(r<l){let{x1:E,y1:S,x2:w,y2:I,padding:M,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:G}=e.get(r);_.textBox={x1:E,y1:S,x2:w,y2:I,padding:M,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.textFeatureIndex=G}if(f<u){let{x1:E,y1:S,x2:w,y2:I,padding:M,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:G}=e.get(f);_.verticalTextBox={x1:E,y1:S,x2:w,y2:I,padding:M,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.verticalTextFeatureIndex=G}if(p<v){let{x1:E,y1:S,x2:w,y2:I,padding:M,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:G}=e.get(p);_.iconBox={x1:E,y1:S,x2:w,y2:I,padding:M,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.iconFeatureIndex=G}if(T<D){let{x1:E,y1:S,x2:w,y2:I,padding:M,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:G}=e.get(T);_.verticalIconBox={x1:E,y1:S,x2:w,y2:I,padding:M,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.verticalIconFeatureIndex=G}return _}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){let l=e.placedSymbolArray.get(r),f=l.vertexStartIndex+4*l.numGlyphs;for(let u=l.vertexStartIndex;u<f;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(e),l=Math.cos(e),f=[],u=[],p=[];for(let v=0;v<this.symbolInstances.length;++v){p.push(v);let T=this.symbolInstances.get(v);f.push(0|Math.round(r*T.tileAnchorX+l*T.tileAnchorY)),u.push(T.featureIndex)}return p.sort((v,T)=>f[v]-f[T]||u[T]-u[v]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){let l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex);let{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:D}=l;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),u>=0&&u!==f&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&p!==f&&this.addIndicesForPlacedSymbol(this.text,p),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let hT,dT,u0;ht(Pg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Pg.addDynamicAttributes=Rg;class fT{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Yi,this.defaultValue=e}evaluate(e){if(e.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ht(fT,"FormatSectionOverride",{omit:["defaultValue"]});let h0=()=>u0||(u0={layout:hT||(hT=new Zn({"symbol-placement":new tt(Ae.layout_symbol["symbol-placement"]),"symbol-spacing":new tt(Ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tt(Ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xt(Ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tt(Ae.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new tt(Ae.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new tt(Ae.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new tt(Ae.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new tt(Ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new tt(Ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tt(Ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new xt(Ae.layout_symbol["icon-size"]),"icon-size-scale-range":new tt(Ae.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new xt(Ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xt(Ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new xt(Ae.layout_symbol["icon-image"]),"icon-rotate":new xt(Ae.layout_symbol["icon-rotate"]),"icon-padding":new tt(Ae.layout_symbol["icon-padding"]),"icon-keep-upright":new tt(Ae.layout_symbol["icon-keep-upright"]),"icon-offset":new xt(Ae.layout_symbol["icon-offset"]),"icon-anchor":new xt(Ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tt(Ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tt(Ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tt(Ae.layout_symbol["text-rotation-alignment"]),"text-field":new xt(Ae.layout_symbol["text-field"]),"text-font":new xt(Ae.layout_symbol["text-font"]),"text-size":new xt(Ae.layout_symbol["text-size"]),"text-size-scale-range":new tt(Ae.layout_symbol["text-size-scale-range"]),"text-max-width":new xt(Ae.layout_symbol["text-max-width"]),"text-line-height":new xt(Ae.layout_symbol["text-line-height"]),"text-letter-spacing":new xt(Ae.layout_symbol["text-letter-spacing"]),"text-justify":new xt(Ae.layout_symbol["text-justify"]),"text-radial-offset":new xt(Ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tt(Ae.layout_symbol["text-variable-anchor"]),"text-anchor":new xt(Ae.layout_symbol["text-anchor"]),"text-max-angle":new tt(Ae.layout_symbol["text-max-angle"]),"text-writing-mode":new tt(Ae.layout_symbol["text-writing-mode"]),"text-rotate":new xt(Ae.layout_symbol["text-rotate"]),"text-padding":new tt(Ae.layout_symbol["text-padding"]),"text-keep-upright":new tt(Ae.layout_symbol["text-keep-upright"]),"text-transform":new xt(Ae.layout_symbol["text-transform"]),"text-offset":new xt(Ae.layout_symbol["text-offset"]),"text-allow-overlap":new tt(Ae.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new tt(Ae.layout_symbol["text-ignore-placement"]),"text-optional":new tt(Ae.layout_symbol["text-optional"]),visibility:new tt(Ae.layout_symbol.visibility)})),paint:dT||(dT=new Zn({"icon-opacity":new xt(Ae.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new xt(Ae.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new xt(Ae.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new xt(Ae.paint_symbol["text-emissive-strength"]),"icon-color":new xt(Ae.paint_symbol["icon-color"]),"icon-halo-color":new xt(Ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new xt(Ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xt(Ae.paint_symbol["icon-halo-blur"]),"icon-translate":new tt(Ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new tt(Ae.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new xt(Ae.paint_symbol["icon-image-cross-fade"]),"text-opacity":new xt(Ae.paint_symbol["text-opacity"]),"text-occlusion-opacity":new xt(Ae.paint_symbol["text-occlusion-opacity"]),"text-color":new xt(Ae.paint_symbol["text-color"],{runtimeType:di,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new xt(Ae.paint_symbol["text-halo-color"]),"text-halo-width":new xt(Ae.paint_symbol["text-halo-width"]),"text-halo-blur":new xt(Ae.paint_symbol["text-halo-blur"]),"text-translate":new tt(Ae.paint_symbol["text-translate"]),"text-translate-anchor":new tt(Ae.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new tt(Ae.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new tt(Ae.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new tt(Ae.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new tt(Ae.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new xt(Ae.paint_symbol["symbol-z-offset"])}))},u0);class Og extends oi{constructor(e,r,l,f){super(e,h0(),r,l,f),this._colorAdjustmentMatrix=we.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let l=this.layout.get("text-writing-mode");if(l){let f=[];for(let u of l)f.indexOf(u)<0&&f.push(u);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,l,f){return this._saturation===e&&this._contrast===r&&this._brightnessMin===l&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(u,p,v,T){u=K(u),p=Y(p);let D=we.mat4.create(),_=u/3,E=1-2*_,S=[E,_,_,0,_,E,_,0,_,_,E,0,0,0,0,1],w=.5-.5*p,I=T-v;return we.mat4.multiply(D,[I,0,0,0,0,I,0,0,0,0,I,0,v,v,v,1],[p,0,0,0,0,p,0,0,0,0,p,0,w,w,w,1]),we.mat4.multiply(D,D,S),D}(e,r,l,f),this._saturation=e,this._contrast=r,this._brightnessMin=l,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,l,f){let u=this.layout.get(e).evaluate(r,{},l,f),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ku(p.value)||!u?u:function(v,T){return T.replace(/{([^{}]+)}/g,(D,_)=>_ in v?String(v[_]):"")}(r.properties,u)}createBucket(e){return new Pg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of h0().paint.overridableProperties){if(!Og.hasPaintOverride(this.layout,e))continue;let r=this.paint.get(e),l=new fT(r),f=new Ud(l,r.property.specification,this.scope,this.options),u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new Fu("source",f):new lc("composite",f,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Ka(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&Og.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){let l=e.get("text-field"),f=h0().paint.properties[r],u=!1,p=v=>{for(let T of v)if(f.overrides&&f.overrides.hasOverride(T))return void(u=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Qr)p(l.value.value.sections);else if(l.value.kind==="source"){let v=D=>{u||(D instanceof Ji&&Er(D.value)===Ra?p(D.value.sections):D instanceof ka?p(D.sections):D.eachChild(v))},T=l.value;T._styleExpression&&v(T._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,l){return{config:new Yo(this,{zoom:r,lut:l}),overrideFog:!1}}}let pT,mT,gT,_T;var d0=gn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function f0(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function p0(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class m0{constructor(e,r,l,f){this.context=e,this.format=l,this.useMipmap=f&&f.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:f&&f.premultiply})}update(e,r){let l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,f=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:u}=this,{gl:p}=u,{x:v,y:T}=r&&r.position?r.position:{x:0,y:0},D=Math.max(v+l,this.size?this.size[0]:0),_=Math.max(T+f,this.size?this.size[1]:0);!this.size||this.size[0]===D&&this.size[1]===_||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!r||r.premultiply!==!1));let E=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&D>0&&_>0){let S=this.useMipmap?Math.floor(Math.log2(Math.max(D,_)))+1:1;p.texStorage2D(p.TEXTURE_2D,S,this.format,D,_),this.size=[D,_]}if(this.size)if(E)p.texSubImage2D(p.TEXTURE_2D,0,v,T,f0(this.format),p0(this.format),e);else{let S=e.data;S&&p.texSubImage2D(p.TEXTURE_2D,0,v,T,l,f,f0(this.format),p0(this.format),S)}this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,r,l=!1){let{context:f}=this,{gl:u}=f;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,l,f){let{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),this.wrapS=l),f!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,f),this.wrapT=f)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Lg{constructor(e,r){this.context=e,this.texture=r}bind(e,r){let{context:l}=this,{gl:f}=l;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,r),this.wrapS=r)}}function kg(s,e,r,l,f,u,p,v){let T=[s,e,1,r,l,1,f,u,1],D=[p,v,1],_=we.mat3.adjoint([],T),[E,S,w]=we.vec3.transformMat3(D,D,_);return we.mat3.multiply(T,T,[E,0,0,0,S,0,0,0,w])}function yT(s,e,r,l,f,u,p,v){let T=function(D,_,E,S,w,I,M,L){let k=kg(0,0,1,0,1,1,0,1),B=kg(D,_,E,S,w,I,M,L),V=we.mat3.adjoint([],k);return we.mat3.multiply(B,B,V)}(s,e,r,l,f,u,p,v);return[T[2]/T[8]/ot,T[5]/T[8]/ot]}function Fg(s){return[s[0],Math.min(Math.max(s[1],-ae),ae)]}class vT extends Ma{constructor(e,r,l,f){super(),this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new _s("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=mo(this.map._requestManager.transformRequest(this.url,cu.Image),(l,f)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new Wl(l)):f&&(this.image=f instanceof HTMLImageElement?at.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Lg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _s("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Lg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],l=e[0][1];for(let u of e)u[1]>l&&(l=u[1]),u[1]<r&&(r=u[1]);let f=(l+r)/2;if(f>ae?this.onNorthPole=!0:f<-ae&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=e.map(xe.fromLngLat);this.tileID=function(p){let v=1/0,T=1/0,D=-1/0,_=-1/0;for(let M of p)v=Math.min(v,M.x),T=Math.min(T,M.y),D=Math.max(D,M.x),_=Math.max(_,M.y);let E=Math.max(D-v,_-T),S=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),w=Math.pow(2,S),I=Math.floor((v+D)/2*w);return I>1&&(I-=1),new Rr(S,I,Math.floor((T+_)/2*w))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new _s("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let k in this.tiles){let B=this.tiles[k];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let r=Ff(new Rr(0,0,0),this.map.transform.projection),l=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(k){let B=k[1].x-k[0].x,V=k[1].y-k[0].y,N=k[2].x-k[1].x,G=k[2].y-k[1].y,H=k[3].x-k[2].x,J=k[3].y-k[2].y,oe=k[0].x-k[3].x,ee=k[0].y-k[3].y,ne=B*G-N*V,pe=N*J-H*G,te=H*ee-oe*J,de=oe*V-B*ee;return ne>0&&pe>0&&te>0&&de>0||ne<0&&pe<0&&te<0&&de<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let f=Ff(this.tileID,this.map.transform.projection),[u,p,v,T]=this.coordinates.map(k=>{let B=f.projection.project(k[0],k[1]);return oT(f,B)._round()});this.perspectiveTransform=yT(u.x,u.y,p.x,p.y,v.x,v.y,T.x,T.y);let D=this._boundsArray=new tl;D.emplaceBack(u.x,u.y,0,0),D.emplaceBack(p.x,p.y,ot,0),D.emplaceBack(T.x,T.y,0,ot),D.emplaceBack(v.x,v.y,ot,ot),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(D,d0.members),this.boundsSegments=dr.simpleSegment(0,0,4,2);let _=[],E=[Fg((S=this.coordinates)[0]),Fg(S[1]),Fg(S[2]),Fg(S[3])];var S;let[w,I,M,L]=function(k){let B=k[0][0],V=B,N=k[0][1],G=N;for(let H=1;H<k.length;H++)k[H][0]<B?B=k[H][0]:k[H][0]>V&&(V=k[H][0]),k[H][1]<N?N=k[H][1]:k[H][1]>G&&(G=k[H][1]);return[B,N,V-B,G-N]}(E);{let k=new tl,[B,V,N,G]=function(Me){let Re=Me[0].x,De=Re,Ue=Me[0].y,Je=Ue;for(let ze=1;ze<Me.length;ze++)Me[ze].x<Re?Re=Me[ze].x:Me[ze].x>De&&(De=Me[ze].x),Me[ze].y<Ue?Ue=Me[ze].y:Me[ze].y>Je&&(Je=Me[ze].y);return[Re,Ue,De-Re,Je-Ue]}(l),H=Me=>[(Me.x-B)/N,(Me.y-V)/G],[J,oe,ee,ne]=l.map(H),pe=function(Me,Re,De,Ue,Je,ze,ut,rt){let et=kg(0,0,1,0,1,1,0,1),Xe=kg(Me,Re,De,Ue,Je,ze,ut,rt),wt=we.mat3.adjoint([],Xe);return we.mat3.multiply(et,et,wt)}(J[0],J[1],oe[0],oe[1],ee[0],ee[1],ne[0],ne[1]);this.elevatedGlobePerspectiveTransform=yT(J[0],J[1],oe[0],oe[1],ee[0],ee[1],ne[0],ne[1]);let te=(Me,Re)=>{_.push(Me.lng);let De=Math.round((Me.lng-w)/M*ot),Ue=Math.round((Me.lat-I)/L*ot),Je=H(Re),ze=we.vec3.transformMat3([],[Je[0],Je[1],1],pe),ut=Math.round(ze[0]/ze[2]*ot),rt=Math.round(ze[1]/ze[2]*ot);k.emplaceBack(De,Ue,ut,rt)},de=l[3].x-l[0].x,ye=l[3].y-l[0].y,ve=l[2].x-l[1].x,Ee=l[2].y-l[1].y;for(let Me=0;Me<65;Me++){let Re=Me/64,De=[l[0].x+Re*de,l[0].y+Re*ye],Ue=[l[1].x+Re*ve,l[1].y+Re*Ee],Je=Ue[0]-De[0],ze=Ue[1]-De[1];for(let ut=0;ut<65;ut++){let rt=ut/64,et={x:De[0]+Je*rt,y:De[1]+ze*rt,z:0};te(r.projection.unproject(et.x,et.y),et)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(k,d0.members)}{this.maxLongitudeTriangleSize=0;let k=[],B=new ir,V=(N,G,H)=>{B.emplaceBack(N,G,H);let J=_[N],oe=_[G],ee=_[H],ne=Math.min(Math.min(J,oe),ee),pe=Math.max(Math.max(J,oe),ee)-ne;pe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=pe),k.push(ne+pe/2)};for(let N=0;N<64;N++)for(let G=0;G<64;G++){let H=65*N+G,J=H+1,oe=H+65,ee=oe+1;V(H,oe,J),V(J,oe,ee)}[k,B]=function(N,G){let H=Array.from({length:N.length},(ee,ne)=>ne);H.sort((ee,ne)=>N[ee]-N[ne]);let J=[],oe=new ir;for(let ee=0;ee<H.length;ee++){let ne=H[ee];J.push(N[ne]);let pe=3*ne,te=pe+1;oe.emplaceBack(G.uint16[pe],G.uint16[te],G.uint16[te+1])}return[J,oe]}(k,B),this.elevatedGlobeTrianglesCenterLongitudes=k,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(B)}this.elevatedGlobeSegments=dr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,M/ot,0,L/ot,0,0,I,w,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let r=this.map.painter.context,l=r.gl;!this._dirty||this.texture instanceof Lg||(this.texture?this.texture.update(this.image):(this.texture=new m0(r,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;let l=this.elevatedGlobeTrianglesCenterLongitudes,f=(u=e+180)+360*Math.round((l[0]-u)/360);var u;let p=new dr,v=(E,S)=>{p.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:r.segments[0].vertexLength,primitiveLength:S,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-f)<=T){let E=Ne(l,0,l.length,f+T);return E===l.length||v(E,Hl(l,E+1,l.length,f+360-T)-E),p}f<l[0]&&(f+=360);let D=Hl(l,0,l.length,f-T);if(D===l.length)return v(0,l.length),p;v(0,D-0);let _=Ne(l,D+1,l.length,f+T);return _!==l.length&&v(_,l.length-_),p}}let TO=(Math.pow(256,2)-1)/16907520;class xT extends oi{constructor(e,r,l,f){super(e,{layout:gT||(gT=new Zn({visibility:new tt(Ae.layout_raster.visibility)})),paint:_T||(_T=new Zn({"raster-opacity":new tt(Ae.paint_raster["raster-opacity"]),"raster-color":new el(Ae.paint_raster["raster-color"]),"raster-color-mix":new tt(Ae.paint_raster["raster-color-mix"]),"raster-color-range":new tt(Ae.paint_raster["raster-color-range"]),"raster-hue-rotate":new tt(Ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tt(Ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tt(Ae.paint_raster["raster-brightness-max"]),"raster-saturation":new tt(Ae.paint_raster["raster-saturation"]),"raster-contrast":new tt(Ae.paint_raster["raster-contrast"]),"raster-resampling":new tt(Ae.paint_raster["raster-resampling"]),"raster-fade-duration":new tt(Ae.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new tt(Ae.paint_raster["raster-emissive-strength"]),"raster-array-band":new tt(Ae.paint_raster["raster-array-band"]),"raster-elevation":new tt(Ae.paint_raster["raster-elevation"])}))},r,l,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof vT&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let r=this._transitionablePaint._values["raster-color"].value.expression,[l,f]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(f)||l===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=bf({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,f])}}let bT,wT,ET,TT,IT;class ST extends oi{constructor(e,r,l,f){super(e,{layout:bT||(bT=new Zn({visibility:new tt(Ae["layout_raster-particle"].visibility)})),paint:wT||(wT=new Zn({"raster-particle-array-band":new tt(Ae["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new tt(Ae["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new el(Ae["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new tt(Ae["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new tt(Ae["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new tt(Ae["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new tt(Ae["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new tt(Ae["paint_raster-particle"]["raster-particle-elevation"])}))},r,l,f),this._updateColorRamp(),this.lastInvalidatedAt=at.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=bf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=at.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class IO extends oi{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function g0(s,e,r){let l=[0,0,1],f=we.quat.identity([]);return we.quat.rotateY(f,f,r?-en(s)+Math.PI:en(s)),we.quat.rotateX(f,f,-en(e)),we.vec3.transformQuat(l,l,f),we.vec3.normalize(l,l)}function DT(s,e){let r=Ng(s.projection,s.zoom,s.width,s.height),l=function(u,p,v,T,D){let _=new R(v.lng-180*_l,v.lat),E=new R(v.lng+180*_l,v.lat),S=u.project(_.lng,_.lat),w=u.project(E.lng,E.lat),I=-Math.atan2(w.y-S.y,w.x-S.x),M=xe.fromLngLat(v);M.y=zt(M.y,-1+_l,1-_l);let L=M.toLngLat(),k=u.project(L.lng,L.lat),B=xe.fromLngLat(L);B.x+=_l;let V=B.toLngLat(),N=u.project(V.lng,V.lat),G=MT(N.x-k.x,N.y-k.y,I),H=xe.fromLngLat(L);H.y+=_l;let J=H.toLngLat(),oe=u.project(J.lng,J.lat),ee=MT(oe.x-k.x,oe.y-k.y,I),ne=Math.abs(G.x)/Math.abs(ee.y),pe=we.mat4.identity([]);we.mat4.rotateZ(pe,pe,-I*(1-(D?0:T)));let te=we.mat4.identity([]);return we.mat4.scale(te,te,[1,1-(1-ne)*T,1]),te[4]=-ee.x/ee.y*T,we.mat4.rotateZ(te,te,I),we.mat4.multiply(te,pe,te),te}(s.projection,0,s.center,r,e),f=CT(s);return we.mat4.scale(l,l,[f,f,1]),l}function CT(s){let e=s.projection,r=Ng(s.projection,s.zoom,s.width,s.height),l=_0(e,s.center),f=_0(e,R.convert(e.center));return Math.pow(2,l*r+(1-r)*f)}function Ng(s,e,r,l,f=1/0){let u=s.range;if(!u)return 0;let p=Math.min(f,Math.max(r,l)),v=Math.log(p/1024)/Math.LN2;return wa(u[0]+v,u[1]+v,e)}let _l=1/4e4;function _0(s,e){let r=zt(e.lat,-ae,ae),l=new R(e.lng-180*_l,r),f=new R(e.lng+180*_l,r),u=s.project(l.lng,r),p=s.project(f.lng,r),v=xe.fromLngLat(l),T=xe.fromLngLat(f),D=p.x-u.x,_=p.y-u.y,E=T.x-v.x,S=T.y-v.y,w=Math.sqrt((E*E+S*S)/(D*D+_*_));return Math.log(w)/Math.LN2}function MT(s,e,r){let l=Math.cos(r),f=Math.sin(r);return{x:s*l-e*f,y:s*f+e*l}}function AT(s,e,r){we.mat4.identity(s),we.mat4.rotateZ(s,s,en(e[2])),we.mat4.rotateX(s,s,en(e[0])),we.mat4.rotateY(s,s,en(e[1])),we.mat4.scale(s,s,r),we.mat4.multiply(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function zg(s,e,r,l,f,u,p,v){let T=[r[0]-e[0],r[1]-e[1],0],D=[l[0]-e[0],l[1]-e[1],0];if(we.vec3.length(T)<1e-12||we.vec3.length(D)<1e-12)return we.quat.identity(s);let _=we.vec3.cross([],T,D);we.vec3.normalize(_,_),we.vec3.subtract(D,l,e),T[2]=(u-f)*v,D[2]=(p-f)*v;let E=T;return we.vec3.cross(E,T,D),we.vec3.normalize(E,E),we.quat.rotationTo(s,_,E)}function y0(s,e,r=!1){let l=hl(e.zoom),f=function(u,p,v){let T=p.worldSize,D=[u[12],u[13],u[14]],_=re(D[1]/T),E=Q(D[0]/T),S=we.mat4.identity([]),w=Z(1,_)*T,I=Z(1,0)*T*le(_,p.zoom),M=1/Rv(T),L=I*M;if(v){let N=Ng(p.projection,p.zoom,p.width,p.height,1024);L=M*p.projection.pixelSpaceConversion(p.center.lat,T,N)}let k=C(_,E);we.vec3.add(k,k,we.vec3.scale([],we.vec3.normalize([],k),w*L*D[2]));let B=function(N){let G=[N[0],N[1],N[2]],H=[0,1,0],J=we.vec3.cross([],H,G);return we.vec3.cross(H,G,J),we.vec3.squaredLength(H)===0&&(H=[0,1,0],we.vec3.cross(J,G,H)),we.vec3.normalize(J,J),we.vec3.normalize(H,H),we.vec3.normalize(G,G),[J[0],J[1],J[2],0,H[0],H[1],H[2],0,G[0],G[1],G[2],0,N[0],N[1],N[2],1]}(k);we.mat4.scale(S,S,[L,L,L*w]),we.mat4.translate(S,S,[-D[0],-D[1],-D[2]]);let V=we.mat4.multiply([],p.globeMatrix,B);return we.mat4.multiply(V,V,S),we.mat4.multiply(V,V,u),V}(s,e,r);if(l>0){let u=function(p,v){let T=v.worldSize,D=Z(1,0)*T*le(v.center.lat,v.zoom)/Rv(T),_=Z(1,v.center.lat)*T,E=we.mat4.identity([]);return we.mat4.rotateY(E,E,en(v.center.lng)),we.mat4.rotateX(E,E,en(v.center.lat)),we.mat4.translate(E,E,[0,0,Hr]),we.mat4.scale(E,E,[D,D,D*_]),we.mat4.translate(E,E,[v.point.x-.5*T,v.point.y-.5*T,0]),we.mat4.multiply(E,E,p),we.mat4.multiply(E,v.globeMatrix,E)}(s,e);return function(p,v,T){let D=(I,M,L)=>{let k=we.vec3.length(I),B=we.vec3.length(M),V=sa(I,M,L);return we.vec3.scale(V,V,1/we.vec3.length(V)*Mt(k,B,L))},_=D([p[0],p[1],p[2]],[v[0],v[1],v[2]],T),E=D([p[4],p[5],p[6]],[v[4],v[5],v[6]],T),S=D([p[8],p[9],p[10]],[v[8],v[9],v[10]],T),w=sa([p[12],p[13],p[14]],[v[12],v[13],v[14]],T);return[_[0],_[1],_[2],0,E[0],E[1],E[2],0,S[0],S[1],S[2],0,w[0],w[1],w[2],1]}(f,u,l)}return f}function RT(s,e,r,l){let f=Mn.projectAabbCorners(l,r),u=Number.MAX_VALUE,p=-1;for(let D=0;D<f.length;++D){let _=f[D];_[0]=(.5*_[0]+.5)*e.width,_[1]=(.5-.5*_[1])*e.height,_[2]<u&&(p=D,u=_[2])}let v=D=>new it(f[D][0],f[D][1]),T;switch(p){case 0:case 6:T=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:T=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:T=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:T=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if($e(s,T))return u}let SO=gn([{name:"a_pos_3f",components:3,type:"Float32"}]),DO=gn([{name:"a_color_3f",components:3,type:"Float32"}]),CO=gn([{name:"a_color_4f",components:4,type:"Float32"}]),MO=gn([{name:"a_uv_2f",components:2,type:"Float32"}]),AO=gn([{name:"a_normal_3f",components:3,type:"Float32"}]),RO=gn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),PO=gn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),PT={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Bg{constructor(e,r,l,f){this.message=(e?`${e}: `:"")+l,f&&(this.identifier=f),r!=null&&r.__line__&&(this.line=r.__line__)}}function OT(s,e){let r=s.indexOf("://")===-1;try{return new URL(s,r&&e?"http://example.com":void 0),!0}catch{return!1}}class LT{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class kT{constructor(){this.instancedDataArray=new vc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class v0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,r){}populate(e,r,l,f){this.tileToMeter=me(l);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:v,index:T,sourceLayerIndex:D}of e){let _=v??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),E=Ge(p,u);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),E,l))continue;let S={id:_,sourceLayerIndex:D,index:T,geometry:u?E.geometry:Se(p,l,f),properties:p.properties,type:p.type,patterns:{}},w=this.addFeature(S,S.geometry,E);w&&r.featureIndex.insert(p,S.geometry,T,D,this.index,this.instancesPerModel[w].instancedDataArray.length,ot/32)}this.lookup=null}update(e,r,l,f){for(let u in this.instancesPerModel){let p=this.instancesPerModel[u];for(let v in e)p.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(p.features[p.idToFeaturesIndex[v]],e[v],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let r in this.instancesPerModel){let l=this.instancesPerModel[r];for(let f of l.features){let u=this.layers[0],p=f.feature,v=this.canonical,T=u.paint.get("model-rotation").evaluate(p,{},v),D=u.paint.get("model-scale").evaluate(p,{},v),_=u.paint.get("model-translation").evaluate(p,{},v);we.vec3.exactEquals(f.rotation,T)&&we.vec3.exactEquals(f.scale,D)&&we.vec3.exactEquals(f.translation,_)||(this.evaluate(f,f.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,r,l,f){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;let u=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Gv(this.activeReplacements,u))return!1;this.activeReplacements=u;let p=!1;for(let v in this.instancesPerModel){let T=this.instancesPerModel[v],D=T.instancedDataArray;for(let _ of T.features){let E=_.instancedDataOffset,S=_.instancedDataCount;for(let w=0;w<S;w++){let I=16*(w+E),M=D.float32[I+0],L=M>ot;M=L?M-ot:M;let k=Math.floor(M),B=D.float32[I+1],V=!1;for(let N of this.activeReplacements)if(!Yw(N,l,PT.Model,f)&&!(N.min.x>k||k>N.max.x||N.min.y>B||B>N.max.y)&&(V=nE(tE(k,B,e.canonical,N.footprintTileId.canonical),N.footprint),V))break;D.float32[I]=V?M+ot:M,p=p||V!==L}}}return p}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let r in this.instancesPerModel){let l=this.instancesPerModel[r];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,RO.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let r in this.instancesPerModel){let l=this.instancesPerModel[r];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let r of this.modelUris)e.removeModel(r,"")}addFeature(e,r,l){let f=this.layers[0],u=f.layout.get("model-id").evaluate(l,{},this.canonical);if(!u)return ln(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),u;OT(u,!1)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new kT);let p=this.instancesPerModel[u],v=p.instancedDataArray,T=new LT(l,v.length);for(let D of r)for(let _ of D){if(_.x<0||_.x>=ot||_.y<0||_.y>=ot)continue;let E=(this.lookupDim-1)/ot,S=this.lookupDim*(_.y*E|0)+_.x*E|0;if(this.lookup){if(this.lookup[S]!==0)continue;this.lookup[S]=1}this.instanceCount++;let w=v.length;v.resize(w+1),p.instancesEvaluatedElevation.push(0),v.float32[16*w]=_.x,v.float32[16*w+1]=_.y}return T.instancedDataCount=p.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(T),this.evaluate(T,{},p,!1)),u}getModelUris(){return this.modelUris}evaluate(e,r,l,f){let u=this.layers[0],p=e.feature,v=this.canonical,T=e.rotation=u.paint.get("model-rotation").evaluate(p,r,v),D=e.scale=u.paint.get("model-scale").evaluate(p,r,v),_=e.translation=u.paint.get("model-translation").evaluate(p,r,v),E=u.paint.get("model-color").evaluate(p,r,v);E.a=u.paint.get("model-color-mix-intensity").evaluate(p,r,v);let S=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,D[0]),Math.max(D[1],D[2])),AT(S,T,D);let w=Math.round(100*E.a)+E.b/1.05;for(let I=0;I<e.instancedDataCount;++I){let M=e.instancedDataOffset+I,L=16*M,k=l.instancedDataArray.float32,B=0;f&&(B=k[L+6]-l.instancesEvaluatedElevation[M]);let V=0|k[L+1];k[L]=(0|k[L])+E.r/1.05,k[L+1]=V+E.g/1.05,k[L+2]=w,k[L+3]=1/(v.z>10?this.tileToMeter:me(v,V)),k[L+4]=_[0],k[L+5]=_[1],k[L+6]=_[2]+B,k[L+7]=S[0],k[L+8]=S[1],k[L+9]=S[2],k[L+10]=S[4],k[L+11]=S[5],k[L+12]=S[6],k[L+13]=S[8],k[L+14]=S[9],k[L+15]=S[10],l.instancesEvaluatedElevation[M]=_[2]}}}let FT,NT;ht(v0,"ModelBucket",{omit:["layers"]}),ht(kT,"PerModelAttributes"),ht(LT,"ModelFeature");let Dc=64,hh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function zT(s,e,r,l,f,u,p,v,T,D=!1){let _=r.zoom,E=r.project(l),S=le(l.lat,_),w=1/S;we.mat4.identity(s),we.mat4.translate(s,s,[E.x+p[0]*w,E.y+p[1]*w,p[2]]);let I=1,M=1,L=r.worldSize;if(D){if(r.projection.name==="mercator"){let N=0;r.elevation&&(N=r.elevation.getAtPointOrZero(new xe(E.x/L,E.y/L),0));let G=we.vec4.transformMat4([],[E.x,E.y,N,1],r.projMatrix)[3]/r.cameraToCenterDistance;I=G,M=G*le(r.center.lat,_)}else if(r.projection.name==="globe"){let N=y0(s,r),G=we.mat4.multiply([],r.projMatrix,N),H=[0,0,0,1];we.vec4.transformMat4(H,H,G);let J=H[3]/r.cameraToCenterDistance,oe=hl(_),ee=r.projection.pixelsPerMeter(l.lat,L)*le(l.lat,_),ne=r.projection.pixelsPerMeter(r.center.lat,L)*le(r.center.lat,_);I=J/Mt(ee,ue(r.center.lat),oe),M=J*S/ee,I*=ne,M*=ne}}else I=w;we.mat4.scale(s,s,[I,I,M]);let k=[...s],B=e.orientation,V=[];if(AT(V,[B[0]+f[0],B[1]+f[1],B[2]+f[2]],u),we.mat4.multiply(s,k,V),v&&r.elevation){let N=0,G=[];if(T&&r.elevation){N=function(oe,ee,ne,pe,te){let de=ee.elevation;if(!de)return 0;let ye=Mn.projectAabbCorners(ne,pe),ve=Z(1,te.lat)*ee.worldSize,Ee=function(wt,ct){let ft=[0,0,1],Nt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Ht of Nt){let Wt=wt[Ht.corners[0]],$t=wt[Ht.corners[1]],Kt=wt[Ht.corners[2]],Yt=[$t[0]-Wt[0],$t[1]-Wt[1],ct*($t[2]-Wt[2])],Un=we.vec3.cross(Yt,Yt,[Kt[0]-Wt[0],Kt[1]-Wt[1],ct*(Kt[2]-Wt[2])]);we.vec3.normalize(Un,Un),Ht.dotProductWithUp=we.vec3.dot(Un,ft)}return Nt.sort((Ht,Wt)=>Ht.dotProductWithUp-Wt.dotProductWithUp),Nt[0].corners}(ye,ve),Me=ye[Ee[0]],Re=ye[Ee[1]],De=ye[Ee[2]],Ue=ye[Ee[3]],Je=de.getAtPointOrZero(new xe(Me[0]/ee.worldSize,Me[1]/ee.worldSize),0),ze=de.getAtPointOrZero(new xe(Re[0]/ee.worldSize,Re[1]/ee.worldSize),0),ut=de.getAtPointOrZero(new xe(De[0]/ee.worldSize,De[1]/ee.worldSize),0),rt=de.getAtPointOrZero(new xe(Ue[0]/ee.worldSize,Ue[1]/ee.worldSize),0),et=(Je+rt)/2,Xe=(ze+ut)/2;return et>Xe?ze<ut?zg(oe,Re,Ue,Me,ze,rt,Je,ve):zg(oe,De,Me,Ue,ut,Je,rt,ve):Je<rt?zg(oe,Me,Re,De,Je,ze,ut,ve):zg(oe,Ue,De,Re,rt,ut,ze,ve),Math.max(et,Xe)}(G,r,e.aabb,s,l);let H=we.mat4.fromQuat([],G),J=we.mat4.multiply([],H,V);we.mat4.multiply(s,k,J)}else N=r.elevation.getAtPointOrZero(new xe(E.x/L,E.y/L),0);N!==0&&(s[14]+=N)}}function jf(s,e,r=!1){s.uploaded||(s.gfxTexture=new m0(e,s.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function OO(s,e,r){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,SO.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,AO.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,MO.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?DO:CO).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,PO.members,!0)),s.segments=dr.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);let l=s.material;l.pbrMetallicRoughness.baseColorTexture&&jf(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&jf(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&jf(l.normalTexture,e),l.occlusionTexture&&jf(l.occlusionTexture,e,r),l.emissionTexture&&jf(l.emissionTexture,e)}function x0(s,e,r){if(s.meshes)for(let l of s.meshes)OO(l,e,r);if(s.children)for(let l of s.children)x0(l,e,r)}function Vg(s){if(s.meshes)for(let e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(let e of s.children)Vg(e)}function b0(s){if(s.meshes)for(let r of s.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(s.children)for(let r of s.children)b0(r)}class dh{constructor(e,r,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=l}static create(e,r,l){let f=l||e.findDEMTileFor(r);if(!f||!f.dem)return;let u=f.dem,p=f.tileID,v=1<<r.canonical.z-p.canonical.z;return new dh(f,u.dim/ot/v,[(r.canonical.x/v-p.canonical.x)*u.dim,(r.canonical.y/v-p.canonical.y)*u.dim])}tileCoordToPixel(e,r){let l=r*this._scale+this._offset[1],f=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(l);return new it(f,u)}getElevationAt(e,r,l,f){let u=e*this._scale+this._offset[0],p=r*this._scale+this._offset[1],v=Math.floor(u),T=Math.floor(p),D=this._dem;return f=!!f,l?Mt(Mt(D.get(v,T,f),D.get(v,T+1,f),p-T),Mt(D.get(v+1,T,f),D.get(v+1,T+1,f),p-T),u-v):D.get(v,T,f)}getElevationAtPixel(e,r,l){return this._dem.get(e,r,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Z(1,e)*this._dem.stride}}let w0=new Float32Array(262144),Cc=new Uint8Array(262144);function BT(s){let e=0;if(s.meshes)for(let r of s.meshes)e=Math.max(e,r.aabb.max[2]);if(s.children)for(let r of s.children)e=Math.max(e,BT(r));return e}function VT(s,e,r){if(s.meshes)for(let l of s.meshes){if(l.aabb.min[0]===1/0)continue;let f=Mn.applyTransform(l.aabb,s.matrix);r.insert(e,f.min[0],f.min[1],f.max[0],f.max[1])}if(s.children)for(let l of s.children)VT(l,e,r)}let jT=["","wall","door","roof","window","lamp","logo"];class UT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:BT(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,r=new Mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=Mn.applyTransformFast(l.aabb,this.node.matrix),r.encapsulate(l.transformedAabb)),e++;this.aabb=r}return this.aabb}}class jg{constructor(e,r,l,f,u,p,v){this.id=l,this.layers=e,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=hh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=hh.HasMapboxMeshFeatures),u&&(this.modelTraits|=hh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let T of r)this.nodesInfo.push(new UT(T)),VT(T,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0)}updateFootprints(e,r){for(let l of this.getNodesInfo()){let f=l.node;f.footprint&&r.push({footprint:f.footprint,id:e})}}update(e){let r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;let l=r?this.stateDependentLayers:this.layers;for(let f of l)this.evaluate(f,e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let r=this.getNodesInfo();for(let l of r){let f=l.node;this.uploaded?this.updatePbrBuffer(f):x0(f,e,!0)}for(let l of r)Vg(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(let l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),r=!0);return r}needsReEvaluation(e,r,l){let f=e.transform.projectionOptions,u=e.style.getBrightness(),p=this.brightness!==u;return!!(!this.uploaded||this.dirty||f.name!==this.projection.name||Uf(l.paint.get("model-color").value,p)||Uf(l.paint.get("model-color-mix-intensity").value,p)||Uf(l.paint.get("model-roughness").value,p)||Uf(l.paint.get("model-emissive-strength").value,p)||Uf(l.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=f,this.brightness=u,!0)}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let l=this.getNodesInfo(),f=this.id.canonical;for(let u of l){let p=u.feature;u.evaluatedScale=r.paint.get("model-scale").evaluate(p,{},f)}}evaluate(e,r){let l=this.getNodesInfo();for(let f of l){if(!f.node.meshes)continue;let u=f.feature,p=r&&r[u.id],v=f.node.meshes&&f.node.meshes[0].featureData,T=f.evaluatedColor[2],D=f.evaluatedRMEA[2],_=this.id.canonical;if(f.hasTranslucentParts=!1,v){for(let E=0;E<jT.length;E++){let S=jT[E];S.length&&(u.properties.part=S);let w=e.paint.get("model-color").evaluate(u,p,_).toRenderColor(null),I=e.paint.get("model-color-mix-intensity").evaluate(u,p,_);f.evaluatedColor[E]=[w.r,w.g,w.b,I],f.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(u,p,_),f.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(u,p,_),f.evaluatedRMEA[E][3]=w.a,f.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,p,_),!f.hasTranslucentParts&&w.a<1&&(f.hasTranslucentParts=!0)}delete u.properties.part,kO(f,T!==f.evaluatedColor[2]||D!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,p,_);f.evaluatedScale=e.paint.get("model-scale").evaluate(u,p,_),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,l,f){let u=e.findDEMTileFor(l);if(u&&(u.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let p=dh.create(e,l,u);if(!p)return;this.modelTraits&hh.HasMapboxMeshFeatures&&this.updateDEM(e,p,l,f);for(let v of this.getNodesInfo()){let T=v.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;let D=T.footprint.vertices,_=p.getElevationAt(D[0].x,D[0].y,!0,!0);for(let E=1;E<D.length;E++)_=Math.min(_,p.getElevationAt(D[E].x,D[E].y,!0,!0));T.elevation=_}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,l,f){let u=r._dem._modifiedForSources[f];if(u===void 0&&(r._dem._modifiedForSources[f]=[],u=r._dem._modifiedForSources[f]),u.includes(l.canonical))return;let p=r._dem.dim;u.push(l.canonical);let v=!1;for(let T of this.getNodesInfo()){let D=T.node;if(!D.footprint||!D.footprint.grid)continue;let _=D.footprint.grid,E=r.tileCoordToPixel(_.min.x,_.min.y),S=r.tileCoordToPixel(_.max.x,_.max.y),w=Math.min(Math.min(p-S.y,E.x),Math.min(E.y,p-S.x));if(w<0)continue;let I=zt(w,2,5),M=Math.max(0,E.x-I),L=Math.max(0,E.y-I),k=Math.min(S.x+I,p-1),B=Math.min(S.y+I,p-1);for(let H=L;H<=B;++H)for(let J=M;J<=k;++J)Cc[H*p+J]=255;let V=0,N=0;for(let H=0;H<_.cellsY;++H)for(let J=0;J<_.cellsX;++J){if(!_.cells[H*_.cellsX+J])continue;let oe=r.tileCoordToPixel(_.min.x+J/_.xScale,_.min.y+H/_.yScale),ee=r.tileCoordToPixel(_.min.x+(J+1)/_.xScale,_.min.y+(H+1)/_.yScale);for(let ne=oe.y;ne<=Math.min(ee.y+1,p-1);++ne)for(let pe=oe.x;pe<=Math.min(ee.x+1,p-1);++pe)Cc[ne*p+pe]===255&&(Cc[ne*p+pe]=0,V+=r.getElevationAtPixel(pe,ne),N++)}let G=V/N;M=Math.max(1,E.x-I),L=Math.max(1,E.y-I),k=Math.min(S.x+I,p-2),B=Math.min(S.y+I,p-2),v=!0;for(let H=L;H<=B;++H)for(let J=M;J<=k;++J)Cc[H*p+J]===0&&(w0[H*p+J]=r._dem.set(J,H,G));for(let H=1;H<I;++H){M=Math.max(1,E.x-H),L=Math.max(1,E.y-H),k=Math.min(S.x+H,p-2),B=Math.min(S.y+H,p-2);for(let J=L;J<=B;++J)for(let oe=M;oe<=k;++oe){let ee=J*p+oe;if(Cc[ee]===255){let ne=0,pe=0,te=-1,de=-1;for(let ye=-1;ye<=1;++ye)for(let ve=-1;ve<=1;++ve){let Ee=(J+ye)*p+oe+ve;if(Cc[Ee]>=H)continue;let Me=w0[Ee],Re=Math.abs(Me);Re>pe&&(ne=Me,pe=Re,te=ve,de=ye)}if(pe>.1){let ye=1-(H+.5*Math.abs(te*de))/I,ve=r._dem.get(oe,J)+ne*ye,Ee=r._dem.get(oe+te,J+de),Me=r._dem.get(oe-te,J-de,!0);(ve-Ee)*(ve-Me)>0&&(ve=(Ee+Me)/2),w0[ee]=r._dem.set(oe,J,ve),Cc[ee]=H}}}}}v&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=at.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let r of e)Vg(r.node),b0(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;let l=r.getReplacementRegionsForTile(e.toUnwrapped()),f=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){let p=f[u].node;f[u].hiddenByReplacement=!!p.footprint&&!l.find(v=>v.footprint===p.footprint)}}getHeightAtTileCoord(e,r){let l=this.getNodesInfo(),f=[],u=[0,0,0],p=we.mat4.identity([]);for(let v=0;v<this.nodesInfo.length;v++){let T=l[v],D=T.node.meshes[0],_=D.transformedAabb;if(e<_.min[0]||r<_.min[1]||e>_.max[0]||r>_.max[1])continue;if(T.node.hidden===!0)return{height:1/0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};we.mat4.invert(p,T.node.matrix),u[0]=e,u[1]=r,we.vec3.transformMat4(u,u,p);let E=(u[0]-D.aabb.min[0])/(D.aabb.max[0]-D.aabb.min[0])*Dc|0,S=Math.min(63,(u[1]-D.aabb.min[1])/(D.aabb.max[1]-D.aabb.min[1])*Dc|0)*Dc+Math.min(63,E),w=D.heightmap[S];if(!(w<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:w,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new it(e,r),new it(e,r),f),f.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function Uf(s,e){return!s.isLightConstant&&e}function LO(s,e,r,l,f,u,p,v){let T=(61440&e|(61440&e)>>4)>>8,D=(3840&e|(3840&e)>>4)>>4,_=240&e|(240&e)>>4;r[3]>0&&(T=Mt(T,255*r[0],r[3]),D=Mt(D,255*r[1],r[3]),_=Mt(_,255*r[2],r[3]));let E=T<<8|D,S=_<<8|Math.floor(255*l[3]),w=function(H){let J=zt(H,0,2);return Math.min(Math.round(.5*J*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],I=zt(f[0],0,1),M=zt(f[1],0,1),L=zt(f[2],0,1),k=zt(f[3],0,1),B,V,N,G;if(I!==M&&p!==u&&M!==I){let H=p-u;V=1/(H*(M-I)),N=-(u+H*I)/(H*(M-I));let J=zt(f[4],-1,1);G=Math.pow(10,J),B=255*L<<8|255*k}else B=65535,V=0,N=1,G=1;if(s.emplaceBack(E,S,w,B,V,N,G),v){let H=v.length;v.clear();for(let J=0;J<H;J++)v.emplaceBack(E,S,w,B,V,N,G)}}function kO(s,e,r){let l=s.node,f=0,u=r&hh.HasMeshoptCompression;for(let p of l.meshes){if(l.lights&&l.lightMeshIndex===f||!p.featureData)continue;p.featureArray=new Yu,p.featureArray.reserve(p.featureData.length);let v=e;for(let T of p.featureData){let D=u?65535&T:T>>16&65535,_=u?T>>16&65535:65535&T,E=(15&_)<8?15&_:0,S=s.evaluatedRMEA[E],w=s.evaluatedColor[E],I=s.emissionHeightBasedParams[E],M;if(v&&E===2&&l.lights&&(M=new Yu,M.resize(10*l.lights.length)),LO(p.featureArray,D,w,S,I,p.aabb.min[2],p.aabb.max[2],M),M&&v){v=!1;let L=l.meshes[l.lightMeshIndex];L.featureArray=M,L.featureArray._trim()}}p.featureArray._trim(),f++}}ht(jg,"Tiled3dModelBucket",{omit:["layers"]}),ht(UT,"Tiled3dModelFeature");let FO=["id","tile","layer","source","sourceLayer","state"];class $f{constructor(e,r,l,f,u){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=l,this._y=f,this.properties=e.properties,this.id=u}clone(){let e=new $f(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=kt({},this.state)),this.layer&&(e.layer=kt({},this.layer)),this.namespace&&(e.namespace=this.namespace),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let r of FO)this[r]!==void 0&&(e[r]=this[r]);return e}}function $T(s,e,r,l){let f=1<<s.z;e.lat=re((l/ot+s.y)/f),e.lng=Q((r/ot+s.x)/f)}let NO={circle:class extends oi{constructor(s,e,r,l){super(s,{layout:Tn||(Tn=new Zn({"circle-sort-key":new xt(Ae.layout_circle["circle-sort-key"]),visibility:new tt(Ae.layout_circle.visibility)})),paint:Qn||(Qn=new Zn({"circle-radius":new xt(Ae.paint_circle["circle-radius"]),"circle-color":new xt(Ae.paint_circle["circle-color"]),"circle-blur":new xt(Ae.paint_circle["circle-blur"]),"circle-opacity":new xt(Ae.paint_circle["circle-opacity"]),"circle-translate":new tt(Ae.paint_circle["circle-translate"]),"circle-translate-anchor":new tt(Ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tt(Ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tt(Ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xt(Ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xt(Ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xt(Ae.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new tt(Ae.paint_circle["circle-emissive-strength"])}))},e,r,l)}createBucket(s){return new Ze(s)}queryRadius(s){let e=s;return Bn("circle-radius",this,e)+Bn("circle-stroke-width",this,e)+Jt(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,r,l,f,u,p,v){let T=On(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,s.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return bw(s,l,u,p,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,D)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,r){let l=xw(this);return{config:new Yo(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}},heatmap:class extends oi{createBucket(s){return new Ew(s)}constructor(s,e,r,l){super(s,{layout:Tw||(Tw=new Zn({visibility:new tt(Ae.layout_heatmap.visibility)})),paint:Iw||(Iw=new Zn({"heatmap-radius":new xt(Ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xt(Ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tt(Ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new el(Ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tt(Ae.paint_heatmap["heatmap-opacity"])}))},e,r,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Bn("heatmap-radius",this,s)}queryIntersectsFeature(s,e,r,l,f,u,p,v){let T=this.paint.get("heatmap-radius").evaluate(e,r);return bw(s,l,u,p,v,!0,!0,new it(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,r){return s==="heatmap"?{config:new Yo(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends oi{constructor(s,e,r,l){super(s,{layout:Sw||(Sw=new Zn({visibility:new tt(Ae.layout_hillshade.visibility)})),paint:Dw||(Dw=new Zn({"hillshade-illumination-direction":new tt(Ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tt(Ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tt(Ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tt(Ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tt(Ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tt(Ae.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new tt(Ae.paint_hillshade["hillshade-emissive-strength"])}))},e,r,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,r){return{overrideFog:!1}}},fill:class extends oi{constructor(s,e,r,l){super(s,{layout:kw||(kw=new Zn({"fill-sort-key":new xt(Ae.layout_fill["fill-sort-key"]),visibility:new tt(Ae.layout_fill.visibility),"fill-elevation-reference":new tt(Ae.layout_fill["fill-elevation-reference"])})),paint:Fw||(Fw=new Zn({"fill-antialias":new tt(Ae.paint_fill["fill-antialias"]),"fill-opacity":new xt(Ae.paint_fill["fill-opacity"]),"fill-color":new xt(Ae.paint_fill["fill-color"]),"fill-outline-color":new xt(Ae.paint_fill["fill-outline-color"]),"fill-translate":new tt(Ae.paint_fill["fill-translate"]),"fill-translate-anchor":new tt(Ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new xt(Ae.paint_fill["fill-pattern"]),"fill-emissive-strength":new tt(Ae.paint_fill["fill-emissive-strength"]),"fill-z-offset":new xt(Ae.paint_fill["fill-z-offset"])}))},e,r,l)}getProgramIds(){let s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(s,e,r){return{config:new Yo(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);let r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new zv(s)}queryRadius(){return Jt(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,r,l,f,u){return!s.queryGeometry.isAboveHorizon&&yt(kn(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,s.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends oi{constructor(s,e,r,l){super(s,{layout:_E||(_E=new Zn({visibility:new tt(Ae["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new tt(Ae["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:yE||(yE=new Zn({"fill-extrusion-opacity":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xt(Ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xt(Ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xt(Ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xt(Ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new xt(Ae["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new xt(Ae["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new xt(Ae["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new xt(Ae["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new tt(Ae["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new yg(s)}queryRadius(){return Jt(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,r,l,f,u,p,v,T){let D=On(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,s.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(e,r),E=this.paint.get("fill-extrusion-base").evaluate(e,r),S=[0,0],w=v&&u.elevation,I=u.elevation?u.elevation.exaggeration():1,M=s.tile.getBucket(this);if(w&&M instanceof yg){let N=M.centroidVertexArray,G=T+1;G<N.length&&(S[0]=N.geta_centroid_pos0(G),S[1]=N.geta_centroid_pos1(G))}if(S[0]===0&&S[1]===1)return!1;u.projection.name==="globe"&&(l=gE([l],[new it(0,0),new it(ot,ot)],s.tileID.canonical).map(N=>N.polygon).flat());let L=w?v:null,[k,B]=function(N,G,H,J,oe,ee,ne,pe,te,de,ye){return N.projection.name==="globe"?function(ve,Ee,Me,Re,De,Ue,Je,ze,ut,rt,et){let Xe=[],wt=[],ct=ve.projection.upVectorScale(et,ve.center.lat,ve.worldSize).metersToTile,ft=[0,0,0,1],Nt=[0,0,0,1],Ht=($t,Kt,Yt,Un)=>{$t[0]=Kt,$t[1]=Yt,$t[2]=Un,$t[3]=1},Wt=mE();Me>0&&(Me+=Wt),Re+=Wt;for(let $t of Ee){let Kt=[],Yt=[];for(let Un of $t){let Fn=Un.x+De.x,At=Un.y+De.y,In=ve.projection.projectTilePoint(Fn,At,et),An=ve.projection.upVector(et,Un.x,Un.y),tr=Me,_r=Re;if(Je){let Ir=xE(Fn,At,Me,Re,Je,ze,ut,rt);tr+=Ir.base,_r+=Ir.top}Me!==0?Ht(ft,In.x+An[0]*ct*tr,In.y+An[1]*ct*tr,In.z+An[2]*ct*tr):Ht(ft,In.x,In.y,In.z),Ht(Nt,In.x+An[0]*ct*_r,In.y+An[1]*ct*_r,In.z+An[2]*ct*_r),we.vec3.transformMat4(ft,ft,Ue),we.vec3.transformMat4(Nt,Nt,Ue),Kt.push(new Sc(ft[0],ft[1],ft[2])),Yt.push(new Sc(Nt[0],Nt[1],Nt[2]))}Xe.push(Kt),wt.push(Yt)}return[Xe,wt]}(N,G,H,J,oe,ee,ne,pe,te,de,ye):ne?function(ve,Ee,Me,Re,De,Ue,Je,ze,ut){let rt=[],et=[],Xe=[0,0,0,1];for(let wt of ve){let ct=[],ft=[];for(let Nt of wt){let Ht=Nt.x+Re.x,Wt=Nt.y+Re.y,$t=xE(Ht,Wt,Ee,Me,Ue,Je,ze,ut);Xe[0]=Ht,Xe[1]=Wt,Xe[2]=$t.base,Xe[3]=1,we.vec4.transformMat4(Xe,Xe,De),Xe[3]=Math.max(Xe[3],1e-5);let Kt=new Sc(Xe[0]/Xe[3],Xe[1]/Xe[3],Xe[2]/Xe[3]);Xe[0]=Ht,Xe[1]=Wt,Xe[2]=$t.top,Xe[3]=1,we.vec4.transformMat4(Xe,Xe,De),Xe[3]=Math.max(Xe[3],1e-5);let Yt=new Sc(Xe[0]/Xe[3],Xe[1]/Xe[3],Xe[2]/Xe[3]);ct.push(Kt),ft.push(Yt)}rt.push(ct),et.push(ft)}return[rt,et]}(G,H,J,oe,ee,ne,pe,te,de):function(ve,Ee,Me,Re,De){let Ue=[],Je=[],ze=De[8]*Ee,ut=De[9]*Ee,rt=De[10]*Ee,et=De[11]*Ee,Xe=De[8]*Me,wt=De[9]*Me,ct=De[10]*Me,ft=De[11]*Me;for(let Nt of ve){let Ht=[],Wt=[];for(let $t of Nt){let Kt=$t.x+Re.x,Yt=$t.y+Re.y,Un=De[0]*Kt+De[4]*Yt+De[12],Fn=De[1]*Kt+De[5]*Yt+De[13],At=De[2]*Kt+De[6]*Yt+De[14],In=De[3]*Kt+De[7]*Yt+De[15],An=Un+ze,tr=Fn+ut,_r=At+rt,Ir=Math.max(In+et,1e-5),yr=Un+Xe,ur=Fn+wt,br=At+ct,Mr=Math.max(In+ft,1e-5);Ht.push(new Sc(An/Ir,tr/Ir,_r/Ir)),Wt.push(new Sc(yr/Mr,ur/Mr,br/Mr))}Ue.push(Ht),Je.push(Wt)}return[Ue,Je]}(G,H,J,oe,ee)}(u,l,E,_,D,p,L,S,I,u.center.lat,s.tileID.canonical),V=s.queryGeometry;return function(N,G,H){let J=1/0;yt(H,G)&&(J=vE(H,G[0]));for(let oe=0;oe<G.length;oe++){let ee=G[oe],ne=N[oe];for(let pe=0;pe<ee.length-1;pe++){let te=ee[pe],de=[te,ee[pe+1],ne[pe+1],ne[pe],te];$e(H,de)&&(J=Math.min(J,vE(H,de)))}}return J!==1/0&&J}(k,B,V.isPointQuery()?V.screenBounds:V.screenGeometry)}},line:class extends oi{constructor(s,e,r,l){let f=AE();super(s,f,e,r,l),f.layout&&(this.layout=new Qa(f.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof nc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if(Af)return Af;let r=AE();return Af=new BP(r.paint.properties["line-width"].specification),Af.useIntegerZoom=!0,Af})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Zv(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,r){let l=CE(this);return{config:new Yo(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}queryRadius(s){let e=s,r=RE(Bn("line-width",this,e),Bn("line-gap-width",this,e)),l=Bn("line-offset",this,e);return r/2+Math.abs(l)+Jt(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,r,l,f,u){if(s.queryGeometry.isAboveHorizon)return!1;let p=kn(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,s.pixelToTileUnitsFactor),v=s.pixelToTileUnitsFactor/2*RE(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),T=this.paint.get("line-offset").evaluate(e,r);return T&&(l=function(D,_){let E=[],S=new it(0,0);for(let w=0;w<D.length;w++){let I=D[w],M=[];for(let L=0;L<I.length;L++){let k=I[L],B=I[L+1],V=L===0?S:k.sub(I[L-1])._unit()._perp(),N=L===I.length-1?S:B.sub(k)._unit()._perp(),G=V._add(N)._unit();G._mult(1/(G.x*N.x+G.y*N.y)),M.push(G._mult(_)._add(k))}E.push(M)}return E}(l,T*s.pixelToTileUnitsFactor)),function(D,_,E){for(let S=0;S<_.length;S++){let w=_[S];if(D.length>=3){for(let I=0;I<w.length;I++)if(tn(D,w[I]))return!0}if(bt(D,w,E))return!0}return!1}(p,l,v)}isTileClipped(){return!0}isDraped(s){let e=this.layout.get("line-z-offset"),r=e.isConstant()&&!e.constantOr(0),l=this.layout.get("line-elevation-reference");return!(l==="sea"||l==="ground")&&(r||l!=="none")}},symbol:Og,background:class extends oi{constructor(s,e,r,l){super(s,{layout:pT||(pT=new Zn({visibility:new tt(Ae.layout_background.visibility)})),paint:mT||(mT=new Zn({"background-pitch-alignment":new tt(Ae.paint_background["background-pitch-alignment"]),"background-color":new tt(Ae.paint_background["background-color"]),"background-pattern":new tt(Ae.paint_background["background-pattern"]),"background-opacity":new tt(Ae.paint_background["background-opacity"]),"background-emissive-strength":new tt(Ae.paint_background["background-emissive-strength"])}))},e,r,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,r){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:xT,"raster-particle":ST,sky:class extends oi{constructor(s,e,r,l){super(s,{layout:ET||(ET=new Zn({visibility:new tt(Ae.layout_sky.visibility)})),paint:TT||(TT=new Zn({"sky-type":new tt(Ae.paint_sky["sky-type"]),"sky-atmosphere-sun":new tt(Ae.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new tt(Ae.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new tt(Ae.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new tt(Ae.paint_sky["sky-gradient-radius"]),"sky-gradient":new el(Ae.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new tt(Ae.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new tt(Ae.paint_sky["sky-atmosphere-color"]),"sky-opacity":new tt(Ae.paint_sky["sky-opacity"])}))},e,r,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=bf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){let l=this.paint.get("sky-atmosphere-sun"),f=!l,u=s.style.light,p=u.properties.get("position");return f&&u.properties.get("anchor")==="viewport"&&ln("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?g0(p.azimuthal,90-p.polar,e):g0(l[0],90-l[1],e)}let r=this.paint.get("sky-gradient-center");return g0(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends oi{constructor(s,e,r,l){super(s,{paint:IT||(IT=new Zn({}))},e,null)}},model:class extends oi{constructor(s,e,r,l){super(s,{layout:FT||(FT=new Zn({visibility:new tt(Ae.layout_model.visibility),"model-id":new xt(Ae.layout_model["model-id"])})),paint:NT||(NT=new Zn({"model-opacity":new tt(Ae.paint_model["model-opacity"]),"model-rotation":new xt(Ae.paint_model["model-rotation"]),"model-scale":new xt(Ae.paint_model["model-scale"]),"model-translation":new xt(Ae.paint_model["model-translation"]),"model-color":new xt(Ae.paint_model["model-color"]),"model-color-mix-intensity":new xt(Ae.paint_model["model-color-mix-intensity"]),"model-type":new tt(Ae.paint_model["model-type"]),"model-cast-shadows":new tt(Ae.paint_model["model-cast-shadows"]),"model-receive-shadows":new tt(Ae.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new tt(Ae.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new xt(Ae.paint_model["model-emissive-strength"]),"model-roughness":new xt(Ae.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new xt(Ae.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new tt(Ae.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new tt(Ae.paint_model["model-front-cutoff"])}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new v0(s)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof jg?ot-1:0}queryIntersectsFeature(s,e,r,l,f,u){if(!this.modelManager)return!1;let p=this.modelManager,v=s.tile.getBucket(this);if(!(v&&v instanceof v0))return!1;let T=v;for(let D in T.instancesPerModel){let _=T.instancesPerModel[D],E=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(_.idToFeaturesIndex.hasOwnProperty(E)){let S=_.features[_.idToFeaturesIndex[E]],w=p.getModel(D,this.scope);if(!w)return!1;let I=we.mat4.create(),M=new R(0,0),L=T.canonical,k=Number.MAX_VALUE;for(let B=0;B<S.instancedDataCount;++B){let V=16*(S.instancedDataOffset+B),N=_.instancedDataArray.float32,G=[N[V+4],N[V+5],N[V+6]];$T(L,M,N[V],0|N[V+1]),zT(I,w,u,M,S.rotation,S.scale,G,!1,!1,!1),u.projection.name==="globe"&&(I=y0(I,u));let H=we.mat4.multiply([],u.projMatrix,I),J=s.queryGeometry,oe=RT(J.isPointQuery()?J.screenBounds:J.screenGeometry,u,H,w.aabb);oe!=null&&(k=Math.min(oe,k))}return k!==Number.MAX_VALUE&&k}}return!1}_handleOverridablePaintPropertyUpdate(s,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){let e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof lc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(s,e,r,l){let f=s.tile,u=f.getBucket(this),p=null,v=Number.MAX_VALUE;if(!(u&&u instanceof jg))return{queryFeature:p,intersectionZ:v};let T=u.getNodesInfo()[e];if(T.hiddenByReplacement||!T.node.meshes||!r.filter(new ar(f.tileID.overscaledZ),T.feature,f.tileID.canonical))return{queryFeature:p,intersectionZ:v};let D=T.node,_=l.calculatePosMatrix(f.tileID.toUnwrapped(),l.worldSize),E=T.evaluatedScale,S=0;l.elevation&&D.elevation&&(S=D.elevation*l.elevation.exaggeration()),we.mat4.translate(_,_,[(D.anchor?D.anchor[0]:0)*(E[0]-1),(D.anchor?D.anchor[1]:0)*(E[1]-1),S]),we.mat4.scale(_,_,E);let w=s.queryGeometry,I=w.isPointQuery()?w.screenBounds:w.screenGeometry,M=function(N){let G=we.mat4.multiply([],_,N.matrix);we.mat4.multiply(G,l.expandedFarZProjMatrix,G);for(let H=0;H<N.meshes.length;++H){let J=N.meshes[H];if(H===N.lightMeshIndex)continue;let oe=RT(I,l,G,J.aabb);oe!=null&&(v=Math.min(oe,v))}if(N.children)for(let H of N.children)M(H)};if(M(D),v===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:v};let L=new R(0,0);$T(f.tileID.canonical,L,T.node.anchor[0],T.node.anchor[1]);let{z:k,x:B,y:V}=f.tileID.canonical;return p=new $f({},k,B,V,T.feature.id),p.properties=T.feature.properties,p.geometry={type:"Point",coordinates:[L.lng,L.lat]},p.layer=Sr(kt({},this.serialize()),{id:this.fqid}),p.state={},p.tile=f.tileID.canonical,{queryFeature:p,intersectionZ:v}}},clip:class extends oi{constructor(s,e,r,l){super(s,{layout:Nw||(Nw=new Zn({"clip-layer-types":new tt(Ae.layout_clip["clip-layer-types"]),"clip-layer-scope":new tt(Ae.layout_clip["clip-layer-scope"])})),paint:zw||(zw=new Zn({}))},e,r,l)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new Bw(s)}isTileClipped(){return!0}is3D(){return!0}}};class zO{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class BO{constructor(){this.tasks={},this.taskQueue=[],Ea(["process"],this),this.invoker=new zO(this.process),this.nextId=0}add(e,r){let l=this.nextId++,f=function({type:u,isSymbolTile:p,zoom:v}){return v=v||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-v:u==="maybePrepare"&&p?400-v:500:200-v:100-v}(r);if(f===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:r,priority:f,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let f=0;f<this.taskQueue.length;f++){let u=this.tasks[this.taskQueue[f]];u.priority<r&&(r=u.priority,e=f)}if(e===null)return null;let l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class GT{constructor(e,r,l){this.target=e,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Ea(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new BO}send(e,r,l,f,u=!1,p){let v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=p,this.callbacks[v]=l);let T=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!l,targetMapId:f,mustQueue:u,sourceMapId:this.mapId,data:ta(r,T)},T),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(e){let r=e.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){let f=this.cancelCallbacks[l];delete this.cancelCallbacks[l],f&&f.cancel()}else if(r.mustQueue||Hs()){let f=this.callbacks[l],u=this.scheduler.add(()=>this.processTask(l,r),f&&f.metadata||{type:"message"});u&&(this.cancelCallbacks[l]=u)}else this.processTask(l,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){let l=this.callbacks[e];delete this.callbacks[e],l&&(r.error?l(ws(r.error)):l(null,ws(r.data)))}else{let l=new Set,f=r.hasCallback?(p,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?ta(p):null,data:ta(v,l)},l)}:()=>{},u=ws(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,u,f);else if(this.parent.getWorkerSource){let p=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,p[0],u.source,u.scope)[p[1]](u,f)}else f(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let E0=(()=>{class s{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=Vl();let f=this.workerPool.acquire(this.id);for(let u=0;u<f.length;u++){let p=new s.Actor(f[u],l,this.id);p.name=`Worker ${u}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,f){$s(this.actors,(u,p)=>{u.send(r,l,p)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}return s.Actor=GT,s})();class HT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){let l=this.toIdx(e,r);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function qT(s,e,r,l){let f=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(l[p])<1e-15){if(r[p]<s[p]||r[p]>e[p])return null}else{let v=1/l[p],T=(s[p]-r[p])*v,D=(e[p]-r[p])*v;if(T>D){let _=T;T=D,D=_}if(T>f&&(f=T),D<u&&(u=D),f>u)return null}return f}function WT(s,e,r,l,f,u,p,v,T,D,_){let E=l-s,S=f-e,w=u-r,I=p-s,M=v-e,L=T-r,k=_[1]*L-_[2]*M,B=_[2]*I-_[0]*L,V=_[0]*M-_[1]*I,N=E*k+S*B+w*V;if(Math.abs(N)<1e-15)return null;let G=1/N,H=D[0]-s,J=D[1]-e,oe=D[2]-r,ee=(H*k+J*B+oe*V)*G;if(ee<0||ee>1)return null;let ne=J*w-oe*S,pe=oe*E-H*w,te=H*S-J*E,de=(_[0]*ne+_[1]*pe+_[2]*te)*G;return de<0||ee+de>1?null:(I*ne+M*pe+L*te)*G}function ZT(s,e,r){return(s-e)/(r-e)}function XT(s,e,r,l,f,u,p,v,T){let D=1<<r,_=u-l,E=p-f,S=(s+1)/D*_+l,w=(e+0)/D*E+f,I=(e+1)/D*E+f;v[0]=(s+0)/D*_+l,v[1]=w,T[0]=S,T[1]=I}class YT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let r=function(u){let p=Math.ceil(Math.log2(u.dim/8)),v=[],T=Math.ceil(Math.pow(2,p)),D=1/T,_=(w,I,M,L,k)=>{let B=L?1:0,V=(w+1)*M-B,N=I*M,G=(I+1)*M-B;k[0]=w*M,k[1]=N,k[2]=V,k[3]=G},E=new HT(T),S=[];for(let w=0;w<T*T;w++){_(w%T,Math.floor(w/T),D,!1,S);let I=yl(S[0],S[1],u),M=yl(S[2],S[1],u),L=yl(S[2],S[3],u),k=yl(S[0],S[3],u);E.minimums.push(Math.min(I,M,L,k)),E.maximums.push(Math.max(I,M,L,k)),E.leaves.push(1)}for(v.push(E),T/=2;T>=1;T/=2){let w=v[v.length-1];E=new HT(T);for(let I=0;I<T*T;I++){_(I%T,Math.floor(I/T),2,!0,S);let M=w.getElevation(S[0],S[1]),L=w.getElevation(S[2],S[1]),k=w.getElevation(S[2],S[3]),B=w.getElevation(S[0],S[3]),V=w.isLeaf(S[0],S[1]),N=w.isLeaf(S[2],S[1]),G=w.isLeaf(S[2],S[3]),H=w.isLeaf(S[0],S[3]),J=Math.min(M.min,L.min,k.min,B.min),oe=Math.max(M.max,L.max,k.max,B.max),ee=V&&N&&G&&H;E.maximums.push(oe),E.minimums.push(J),E.leaves.push(oe-J<=5&&ee?1:0)}v.push(E)}return v}(this.dem),l=r.length-1,f=r[l];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(r,0,0,l,0)}raycastRoot(e,r,l,f,u,p,v=1){return qT([e,r,-100],[l,f,this.maximums[0]*v],u,p)}raycast(e,r,l,f,u,p,v=1){if(!this.nodeCount)return null;let T=this.raycastRoot(e,r,l,f,u,p,v);if(T==null)return null;let D=[],_=[],E=[],S=[],w=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;w.length>0;){let{idx:I,t:M,nodex:L,nodey:k,depth:B}=w.pop();if(this.leaves[I]){XT(L,k,B,e,r,l,f,E,S);let N=1<<B,G=(L+0)/N,H=(L+1)/N,J=(k+0)/N,oe=(k+1)/N,ee=yl(G,J,this.dem)*v,ne=yl(H,J,this.dem)*v,pe=yl(H,oe,this.dem)*v,te=yl(G,oe,this.dem)*v,de=WT(E[0],E[1],ee,S[0],E[1],ne,S[0],S[1],pe,u,p),ye=WT(S[0],S[1],pe,E[0],S[1],te,E[0],E[1],ee,u,p),ve=Math.min(de!==null?de:Number.MAX_VALUE,ye!==null?ye:Number.MAX_VALUE);if(ve!==Number.MAX_VALUE)return ve;{let Ee=we.vec3.scaleAndAdd([],u,p,M);if(JT(ee,ne,te,pe,ZT(Ee[0],E[0],S[0]),ZT(Ee[1],E[1],S[1]))>=Ee[2])return M}continue}let V=0;for(let N=0;N<this._siblingOffset.length;N++){XT((L<<1)+this._siblingOffset[N][0],(k<<1)+this._siblingOffset[N][1],B+1,e,r,l,f,E,S),E[2]=-100,S[2]=this.maximums[this.childOffsets[I]+N]*v;let G=qT(E,S,u,p);if(G!=null){let H=G;D[N]=H;let J=!1;for(let oe=0;oe<V&&!J;oe++)H>=D[_[oe]]&&(_.splice(oe,0,N),J=!0);J||(_[V]=N),V++}}for(let N=0;N<V;N++){let G=_[N];w.push({idx:this.childOffsets[I]+G,t:D[G],nodex:(L<<1)+this._siblingOffset[G][0],nodey:(k<<1)+this._siblingOffset[G][1],depth:B+1})}}return null}_addNode(e,r,l){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,l,f,u){if(e[f].isLeaf(r,l)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let p=f-1,v=e[p],T=0,D=0;for(let _=0;_<this._siblingOffset.length;_++){let E=2*r+this._siblingOffset[_][0],S=2*l+this._siblingOffset[_][1],w=v.getElevation(E,S),I=v.isLeaf(E,S),M=this._addNode(w.min,w.max,I);I&&(T|=1<<_),D||(D=M)}for(let _=0;_<this._siblingOffset.length;_++)T&1<<_||this._construct(e,2*r+this._siblingOffset[_][0],2*l+this._siblingOffset[_][1],p,D+_)}}function JT(s,e,r,l,f,u){return Mt(Mt(s,r,u),Mt(e,l,u),f)}function yl(s,e,r){let l=r.dim,f=zt(s*l-.5,0,l-1),u=zt(e*l-.5,0,l-1),p=Math.floor(f),v=Math.floor(u),T=Math.min(p+1,l-1),D=Math.min(v+1,l-1);return JT(r.get(p,v),r.get(T,v),r.get(p,D),r.get(T,D),f-p,u-v)}let VO={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function jO(s,e,r){return(256*s*256+256*e+r)/10-1e4}function UO(s,e,r){return 256*s+e+r/256-32768}class Ug{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,l,f=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void ln(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;let u=this.dim=r.height-2,p=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let T=0;T<u;T++)p[this._idx(-1,T)]=p[this._idx(0,T)],p[this._idx(u,T)]=p[this._idx(u-1,T)],p[this._idx(T,-1)]=p[this._idx(T,0)],p[this._idx(T,u)]=p[this._idx(T,u-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(u,-1)]=p[this._idx(u-1,0)],p[this._idx(-1,u)]=p[this._idx(0,u-1)],p[this._idx(u,u)]=p[this._idx(u-1,u-1)]}let v=l==="terrarium"?UO:jO;for(let T=0;T<p.length;++T){let D=4*T;this.floatView[T]=v(this.pixels[D],this.pixels[D+1],this.pixels[D+2])}this._timestamp=at.now()}_buildQuadTree(){this._tree=new YT(this)}get(e,r,l=!1){l&&(e=zt(e,-1,this.dim),r=zt(r,-1,this.dim));let f=this._idx(e,r);return this.floatView[f]}set(e,r,l){let f=this._idx(e,r),u=this.floatView[f];return this.floatView[f]=l,l-u}static getUnpackVector(e){return VO[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){let l=[0,0,0,0],f=Ug.getUnpackVector(r),u=Math.floor((e+f[3])/f[2]);return l[2]=u%256,u=Math.floor(u/256),l[1]=u%256,u=Math.floor(u/256),l[0]=u,l}getPixels(){return new Aw({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=r*this.dim,u=r*this.dim+this.dim,p=l*this.dim,v=l*this.dim+this.dim;switch(r){case-1:f=u-1;break;case 1:u=f+1}switch(l){case-1:p=v-1;break;case 1:v=p+1}let T=-r*this.dim,D=-l*this.dim;for(let _=p;_<v;_++)for(let E=f;E<u;E++){let S=4*this._idx(E,_),w=4*this._idx(E+T,_+D);this.pixels[S+0]=e.pixels[w+0],this.pixels[S+1]=e.pixels[w+1],this.pixels[S+2]=e.pixels[w+2],this.pixels[S+3]=e.pixels[w+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function $O(s,e,r){s===1?e.headerLength=r.readFixed32():s===2?e.x=r.readVarint():s===3?e.y=r.readVarint():s===4?e.z=r.readVarint():s===5&&e.layers.push(function(l,f){return l.readFields(ZO,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)}(r,r.readVarint()+r.pos))}function GO(s,e,r){s===1?(e.delta_filter=function(l,f){return l.readFields(HO,{blockSize:0},f)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):s===2?(r.readVarint(),e.filter="zigzag_filter"):s===3?(r.readVarint(),e.filter="bitshuffle_filter"):s===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function HO(s,e,r){s===1&&(e.blockSize=r.readVarint())}function qO(s,e,r){s===1?(r.readVarint(),e.codec="gzip_data"):s===2?(r.readVarint(),e.codec="jpeg_image"):s===3?(r.readVarint(),e.codec="webp_image"):s===4&&(r.readVarint(),e.codec="png_image")}function WO(s,e,r){let l=0,f=0;s===1?e.firstByte=r.readFixed64():s===2?e.lastByte=r.readFixed64():s===3?e.filters.push(function(u,p){return u.readFields(GO,{},p)}(r,r.readVarint()+r.pos)):s===4?e.codec=function(u,p){return u.readFields(qO,{},p)}(r,r.readVarint()+r.pos):s===5?f=r.readFloat():s===6?l=r.readFloat():s===7?e.bands.push(r.readString()):s===8?e.offset=r.readDouble():s===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=f),e.scale===0&&(e.scale=l)}function ZO(s,e,r){s===1?e.version=r.readVarint():s===2?e.name=r.readString():s===3?e.units=r.readString():s===4?e.tileSize=r.readVarint():s===5?e.buffer=r.readVarint():s===6?e.pixelFormat=r.readVarint():s===7&&e.dataIndex.push(function(l,f){return l.readFields(WO,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)}(r,r.readVarint()+r.pos))}function XO(s,e,r){if(s===2)(function(l,f,u){l.readFields(YO,u,f)})(r,r.readVarint()+r.pos,e);else if(s===3)throw new Error("Not implemented")}function YO(s,e,r){if(s===1){let l=0,f=r.readVarint()+r.pos;for(;r.pos<f;)e[l++]=r.readVarint()}}ht(Ug,"DEMData"),ht(YT,"DemMinMaxQuadTree",{omit:["dem"]});class JO{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}}function KO(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let l=2;l>=1;l--){let f=l===1?1:0,u=l===2?1:0;for(let p=0;p<e[0];p++){let v=e[1]*p;for(let T=f;T<e[1];T++){let D=e[2]*(T+v);for(let _=u;_<e[2];_++){let E=e[3]*(_+D);for(let S=0;S<e[3];S++){let w=E+S;s[w]+=s[w-r]}}}}r*=e[l]}return s}function QO(s){for(let e=0,r=s.length;e<r;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function eL(s,e){switch(e){case"uint32":return s;case"uint16":for(let r=0;r<s.length;r+=2){let l=s[r],f=s[r+1];s[r]=(240&l)>>4|(61440&l)>>8|(240&f)<<4|61440&f,s[r+1]=15&l|(3840&l)>>4|(15&f)<<8|(3840&f)<<4}return s;case"uint8":for(let r=0;r<s.length;r+=4){let l=s[r],f=s[r+1],u=s[r+2],p=s[r+3];s[r+0]=(192&l)>>6|(192&f)>>4|(192&u)>>2|192&p,s[r+1]=(48&l)>>4|(48&f)>>2|48&u|(48&p)<<2,s[r+2]=(12&l)>>2|12&f|(12&u)<<2|(12&p)<<4,s[r+3]=3&l|(3&f)<<2|(3&u)<<4|(3&p)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}var ro=Uint8Array,Gf=Uint16Array,tL=Int32Array,KT=new ro([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),QT=new ro([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nL=new ro([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),eI=function(s,e){for(var r=new Gf(31),l=0;l<31;++l)r[l]=e+=1<<s[l-1];var f=new tL(r[30]);for(l=1;l<30;++l)for(var u=r[l];u<r[l+1];++u)f[u]=u-r[l]<<5|l;return{b:r,r:f}},tI=eI(KT,2),nI=tI.b,rL=tI.r;nI[28]=258,rL[258]=28;for(var iL=eI(QT,0).b,rI=new Gf(32768),Tr=0;Tr<32768;++Tr){var fh=(43690&Tr)>>1|(21845&Tr)<<1;rI[Tr]=((65280&(fh=(61680&(fh=(52428&fh)>>2|(13107&fh)<<2))>>4|(3855&fh)<<4))>>8|(255&fh)<<8)>>1}var Hf=function(s,e,r){for(var l=s.length,f=0,u=new Gf(e);f<l;++f)s[f]&&++u[s[f]-1];var p,v=new Gf(e);for(f=1;f<e;++f)v[f]=v[f-1]+u[f-1]<<1;p=new Gf(1<<e);var T=15-e;for(f=0;f<l;++f)if(s[f])for(var D=f<<4|s[f],_=e-s[f],E=v[s[f]-1]++<<_,S=E|(1<<_)-1;E<=S;++E)p[rI[E]>>T]=D;return p},qf=new ro(288);for(Tr=0;Tr<144;++Tr)qf[Tr]=8;for(Tr=144;Tr<256;++Tr)qf[Tr]=9;for(Tr=256;Tr<280;++Tr)qf[Tr]=7;for(Tr=280;Tr<288;++Tr)qf[Tr]=8;var iI=new ro(32);for(Tr=0;Tr<32;++Tr)iI[Tr]=5;var oL=Hf(qf,9),sL=Hf(iI,5),T0=function(s){for(var e=s[0],r=1;r<s.length;++r)s[r]>e&&(e=s[r]);return e},es=function(s,e,r){var l=e/8|0;return(s[l]|s[l+1]<<8)>>(7&e)&r},I0=function(s,e){var r=e/8|0;return(s[r]|s[r+1]<<8|s[r+2]<<16)>>(7&e)},aL=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ts=function(s,e,r){var l=new Error(e||aL[s]);if(l.code=s,Error.captureStackTrace&&Error.captureStackTrace(l,ts),!r)throw l;return l},lL=new ro(0),cL=typeof TextDecoder<"u"&&new TextDecoder;try{cL.decode(lL,{stream:!0})}catch{}let uL={gzip_data:"gzip"};class wo extends Error{constructor(e){super(e),this.name="MRTError"}}let hL={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},oI={uint32:1,uint16:2,uint8:4},dL={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},S0;class D0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){let r=this.layers[e];if(!r)throw new wo(`Layer '${e}' not found`);return r}getHeaderLength(e){let r=new Uint8Array(e),l=new DataView(e);if(r[0]!==13)throw new wo("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){let r=new Uint8Array(e),l=this.getHeaderLength(e);if(r.length<l)throw new wo(`Expected header with length >= ${l} but got buffer of length ${r.length}`);let f=function(u,p){return u.readFields($O,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new S0(r.subarray(0,l)));if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new wo(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(let u of f.layers)this.layers[u.name]=new fL(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let r=[],l=this.getLayer(e.layerName);for(let f of e.blockIndices){let u=l.dataIndex[f],p=u.firstByte-e.firstByte,v=u.lastByte-e.firstByte;if(l._blocksInProgress.has(f))continue;let T={layerName:l.name,firstByte:p,lastByte:v,pixelFormat:l.pixelFormat,blockIndex:f,blockShape:[u.bands.length].concat(l.bandShape),buffer:l.buffer,codec:u.codec.codec,filters:u.filters.map(D=>D.filter)};l._blocksInProgress.add(f),r.push(T)}return new sI(r,()=>{r.forEach(f=>l._blocksInProgress.delete(f.blockIndex))},(f,u)=>{if(r.forEach(p=>l._blocksInProgress.delete(p.blockIndex)),f)throw f;u.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class fL{constructor({version:e,name:r,units:l,tileSize:f,pixelFormat:u,buffer:p,dataIndex:v},T){if(this.version=e,this.version!==1)throw new wo(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=l,this.tileSize=f,this.buffer=p,this.pixelFormat=hL[u],this.dataIndex=v,this.bandShape=[f+2*p,f+2*p,oI[this.pixelFormat]],this._decodedBlocks=new JO(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return oI[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){let r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(let[l,f]of this.dataIndex.entries()){for(let[u,p]of f.bands.entries())if(p===e)return{bandIndex:r+u,blockIndex:l,blockBandIndex:u};r+=f.bands.length}break;case"number":for(let[l,f]of this.dataIndex.entries()){if(e>=r&&e<r+f.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-r};r+=f.bands.length}break;default:throw new wo(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new wo(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,l=-1/0,f=[],u=new Set;for(let p of e){let{blockIndex:v}=this.getBlockForBand(p);if(v<0)throw new wo(`Invalid band: ${JSON.stringify(p)}`);let T=this.dataIndex[v];f.includes(v)||f.push(v),u.add(v),r=Math.min(r,T.firstByte),l=Math.max(l,T.lastByte)}if(u.size>this.cacheSize)throw new wo(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:l,blockIndices:f}}hasBand(e){let{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){let{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){let{blockIndex:r,blockBandIndex:l}=this.getBlockForBand(e),f=this._decodedBlocks.get(r.toString());if(!f)throw new wo(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let u=this.dataIndex[r],p=this.bandShape.reduce((D,_)=>D*_,1),v=l*p,T=f.subarray(v,v+p);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}D0.setPbf=function(s){S0=s};class sI{constructor(e,r,l){this.tasks=e,this._onCancel=r,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}D0.performDecoding=function(s,e){let r=new Uint8Array(s);return Promise.all(e.tasks.map(l=>{let{layerName:f,firstByte:u,lastByte:p,pixelFormat:v,blockShape:T,blockIndex:D,filters:_,codec:E}=l,S=r.subarray(u,p+1),w=new Uint32Array(T[0]*T[1]*T[2]),I;if(E!=="gzip_data")throw new wo(`Unhandled codec: ${E}`);return I=function(M,L){if(!globalThis.DecompressionStream&&L==="gzip_data")return Promise.resolve(((N=function(J){J[0]==31&&J[1]==139&&J[2]==8||ts(6,"invalid gzip data");var oe=J[3],ee=10;4&oe&&(ee+=2+(J[10]|J[11]<<8));for(var ne=(oe>>3&1)+(oe>>4&1);ne>0;ne-=!J[ee++]);return ee+(2&oe)}(V=M))+8>V.length&&ts(6,"invalid gzip data"),function(J,oe,ee,ne){var pe=J.length;if(!pe||oe.f&&!oe.l)return ee||new ro(0);var te=!ee,de=te||oe.i!=2,ye=oe.i;te&&(ee=new ro(3*pe));var ve,Ee,Me=function(vl){var Rc=ee.length;if(vl>Rc){var Qf=new ro(Math.max(2*Rc,vl));Qf.set(ee),ee=Qf}},Re=oe.f||0,De=oe.p||0,Ue=oe.b||0,Je=oe.l,ze=oe.d,ut=oe.m,rt=oe.n,et=8*pe;do{if(!Je){Re=es(J,De,1);var Xe=es(J,De+1,3);if(De+=3,!Xe){var wt=J[(At=4+((De+7)/8|0))-4]|J[At-3]<<8,ct=At+wt;if(ct>pe){ye&&ts(0);break}de&&Me(Ue+wt),ee.set(J.subarray(At,ct),Ue),oe.b=Ue+=wt,oe.p=De=8*ct,oe.f=Re;continue}if(Xe==1)Je=oL,ze=sL,ut=9,rt=5;else if(Xe==2){var ft=es(J,De,31)+257,Nt=es(J,De+10,15)+4,Ht=ft+es(J,De+5,31)+1;De+=14;for(var Wt=new ro(Ht),$t=new ro(19),Kt=0;Kt<Nt;++Kt)$t[nL[Kt]]=es(J,De+3*Kt,7);De+=3*Nt;var Yt=T0($t),Un=(1<<Yt)-1,Fn=Hf($t,Yt);for(Kt=0;Kt<Ht;){var At,In=Fn[es(J,De,Un)];if(De+=15&In,(At=In>>4)<16)Wt[Kt++]=At;else{var An=0,tr=0;for(At==16?(tr=3+es(J,De,3),De+=2,An=Wt[Kt-1]):At==17?(tr=3+es(J,De,7),De+=3):At==18&&(tr=11+es(J,De,127),De+=7);tr--;)Wt[Kt++]=An}}var _r=Wt.subarray(0,ft),Ir=Wt.subarray(ft);ut=T0(_r),rt=T0(Ir),Je=Hf(_r,ut),ze=Hf(Ir,rt)}else ts(1);if(De>et){ye&&ts(0);break}}de&&Me(Ue+131072);for(var yr=(1<<ut)-1,ur=(1<<rt)-1,br=De;;br=De){var Mr=(An=Je[I0(J,De)&yr])>>4;if((De+=15&An)>et){ye&&ts(0);break}if(An||ts(2),Mr<256)ee[Ue++]=Mr;else{if(Mr==256){br=De,Je=null;break}var Wr=Mr-254;Mr>264&&(Wr=es(J,De,(1<<(rs=KT[Kt=Mr-257]))-1)+nI[Kt],De+=rs);var Yn=ze[I0(J,De)&ur],Ai=Yn>>4;if(Yn||ts(3),De+=15&Yn,Ir=iL[Ai],Ai>3){var rs=QT[Ai];Ir+=I0(J,De)&(1<<rs)-1,De+=rs}if(De>et){ye&&ts(0);break}de&&Me(Ue+131072);var Eo=Ue+Wr;if(Ue<Ir){var To=0-Ir,Ac=Math.min(Ir,Eo);for(To+Ue<0&&ts(3);Ue<Ac;++Ue)ee[Ue]=(void 0)[To+Ue]}for(;Ue<Eo;++Ue)ee[Ue]=ee[Ue-Ir]}}oe.l=Je,oe.p=br,oe.b=Ue,oe.f=Re,Je&&(Re=1,oe.m=ut,oe.d=ze,oe.n=rt)}while(!Re);return Ue!=ee.length&&te?(ve=ee,((Ee=Ue)==null||Ee>ve.length)&&(Ee=ve.length),new ro(ve.subarray(0,Ee))):ee.subarray(0,Ue)}(V.subarray(N,-8),{i:2},new ro(((k=V)[(B=k.length)-4]|k[B-3]<<8|k[B-2]<<16|k[B-1]<<24)>>>0))));var k,B,V,N;let G=uL[L];if(!G)throw new Error(`Unhandled codec: ${L}`);let H=new globalThis.DecompressionStream(G);return new Response(new Blob([M]).stream().pipeThrough(H)).arrayBuffer().then(J=>new Uint8Array(J))}(S,E).then(M=>(function(L,k){L.readFields(XO,k)}(new S0(M),w),new dL[v](w.buffer))),I.then(M=>{for(let L=_.length-1;L>=0;L--)switch(_[L]){case"delta_filter":KO(M,T);break;case"zigzag_filter":QO(M);break;case"bitshuffle_filter":eL(M,v);break;default:throw new wo(`Unhandled filter "${_[L]}"`)}return{layerName:f,blockIndex:D,data:M}}).catch(M=>{throw M})}))},ht(sI,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var Wf={workerUrl:"",workerClass:null,workerParams:void 0};let C0="mapboxgl_preloaded_worker_pool";class Zf{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Zf.workerCount;)this.workers.push(Wf.workerClass!=null?new Wf.workerClass:new self.Worker(Wf.workerUrl,Wf.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[C0]}numActive(){return Object.keys(this.active).length}}let Xf;function $g(){return Xf||(Xf=new Zf),Xf}Zf.workerCount=2;let Yf,M0,ns,ph,A0,mh=null;function aI(){return Hs()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:M0||ce.DRACO_URL}function lI(){if(Hs()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(ph)return ph;let s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return ph=WebAssembly.validate(s)?ce.MESHOPT_SIMD_URL:ce.MESHOPT_URL,ph}let Gg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},pL={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Jf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function cI(s,e,r){let l=r.json.bufferViews.length,f=r.buffers.length;e.bufferView=l,r.json.bufferViews[l]={buffer:f,byteLength:s.byteLength},r.buffers[f]=s}let R0="KHR_draco_mesh_compression";function mL(s,e){let r=s.extensions&&s.extensions[R0];if(!r)return;let l=new ns.Decoder,f=fI(e,r.bufferView),u=new ns.Mesh;if(!l.DecodeArrayToMesh(f,f.byteLength,u))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[s.indices],v=Gg[p.componentType],T=p.count*v.BYTES_PER_ELEMENT,D=ns._malloc(T);v===Uint16Array?l.GetTrianglesUInt16Array(u,T,D):l.GetTrianglesUInt32Array(u,T,D),cI(ns.memory.buffer.slice(D,D+T),p,e),ns._free(D);for(let _ of Object.keys(r.attributes)){let E=l.GetAttributeByUniqueId(u,r.attributes[_]),S=e.json.accessors[s.attributes[_]],w=pL[S.componentType],I=S.count*Jf[S.type]*Gg[S.componentType].BYTES_PER_ELEMENT,M=ns._malloc(I);l.GetAttributeDataArrayForAllPoints(u,E,ns[w],I,M),cI(ns.memory.buffer.slice(M,M+I),S,e),ns._free(M)}l.destroy(),u.destroy(),delete s.extensions[R0]}let Hg="EXT_meshopt_compression";function gL(s,e){if(!s.extensions||!s.extensions[Hg])return;let r=s.extensions[Hg],l=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),f=new Uint8Array(r.count*r.byteStride);A0.decodeGltfBuffer(f,r.count,r.byteStride,l,r.mode,r.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=f.buffer,delete s.extensions[Hg]}let uI=1179937895,hI=new TextDecoder("utf8");function dI(s,e){return new URL(s,e).href}function _L(s,e,r,l){return fetch(dI(s.uri,l)).then(f=>f.arrayBuffer()).then(f=>{e.buffers[r]=f})}function fI(s,e){let r=s.json.bufferViews[e];return new Uint8Array(s.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function yL(s,e,r,l){if(s.uri){let f=dI(s.uri,l);return fetch(f).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[r]=u})}if(s.bufferView!==void 0){let f=fI(e,s.bufferView),u=new Blob([f],{type:s.mimeType});return createImageBitmap(u).then(p=>{e.images[r]=p})}}function pI(s,e=0,r){let l={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===uI){let _=new Uint32Array(s,e),E=2,S=(_[E++]>>2)-3,w=_[E++]>>2;if(E++,l.json=JSON.parse(hI.decode(_.subarray(E,E+w))),E+=w,E<S){let I=_[E++];E++;let M=e+(E<<2);l.buffers[0]=s.slice(M,M+I)}}else l.json=JSON.parse(hI.decode(new Uint8Array(s,e)));let{buffers:f,images:u,meshes:p,extensionsUsed:v,bufferViews:T}=l.json,D=Promise.resolve();if(f){let _=[];for(let E=0;E<f.length;E++){let S=f[E];S.uri?_.push(_L(S,l,E,r)):l.buffers[E]||(l.buffers[E]=null)}D=Promise.all(_)}return D.then(()=>{let _=[],E=v&&v.includes(R0),S=v&&v.includes(Hg);if(E&&_.push(function(){if(!ns)return Yf??(Yf=function(w){let I,M=null;function L(){I=new Uint8Array(M.buffer)}function k(){throw new Error("Unexpected Draco error.")}let B={a:{a:k,d:function(V,N,G){return I.copyWithin(V,N,N+G)},c:function(V){let N=I.length,G=Math.max(V>>>0,Math.ceil(1.2*N)),H=Math.ceil((G-N)/65536);try{return M.grow(H),L(),!0}catch{return!1}},b:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(w,B):w.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,B))).then(V=>{let{Rb:N,Qb:G,P:H,T:J,X:oe,Ja:ee,La:ne,Qa:pe,Va:te,Wa:de,eb:ye,jb:ve,f:Ee,e:Me,yb:Re,zb:De,Ab:Ue,Bb:Je,Db:ze,Gb:ut}=V.instance.exports;M=Me;let rt=(()=>{let et=0,Xe=0,wt=0,ct=0;return ft=>{wt&&(N(ct),N(et),Xe+=wt,wt=et=0),et||(Xe+=128,et=G(Xe));let Nt=ft.length+7&-8,Ht=et;Nt>=Xe&&(wt=Nt,Ht=ct=G(Nt));for(let Wt=0;Wt<ft.length;Wt++)I[Ht+Wt]=ft[Wt];return Ht}})();return L(),Ee(),{memory:Me,_free:N,_malloc:G,Mesh:class{constructor(){this.ptr=H()}destroy(){J(this.ptr)}},Decoder:class{constructor(){this.ptr=ee()}destroy(){ve(this.ptr)}DecodeArrayToMesh(et,Xe,wt){let ct=rt(et),ft=ne(this.ptr,ct,Xe,wt.ptr);return!!oe(ft)}GetAttributeByUniqueId(et,Xe){return{ptr:pe(this.ptr,et.ptr,Xe)}}GetTrianglesUInt16Array(et,Xe,wt){te(this.ptr,et.ptr,Xe,wt)}GetTrianglesUInt32Array(et,Xe,wt){de(this.ptr,et.ptr,Xe,wt)}GetAttributeDataArrayForAllPoints(et,Xe,wt,ct,ft){ye(this.ptr,et.ptr,Xe.ptr,wt,ct,ft)}},DT_INT8:Re(),DT_UINT8:De(),DT_INT16:Ue(),DT_UINT16:Je(),DT_UINT32:ze(),DT_FLOAT32:ut()}})}(fetch(aI())),Yf.then(w=>{ns=w,Yf=void 0}))}()),S&&_.push(function(){if(A0)return;let w=function(I){let M,L=WebAssembly.instantiateStreaming(I,{}).then(V=>{M=V.instance,M.exports.__wasm_call_ctors()}),k={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},B={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:L,supported:!0,decodeGltfBuffer(V,N,G,H,J,oe){(function(ee,ne,pe,te,de,ye,ve){let Ee=ee.exports.sbrk,Me=te+3&-4,Re=Ee(Me*de),De=Ee(ye.length),Ue=new Uint8Array(ee.exports.memory.buffer);Ue.set(ye,De);let Je=ne(Re,te,de,De,ye.length);if(Je===0&&ve&&ve(Re,Me,de),pe.set(Ue.subarray(Re,Re+te*de)),Ee(Re-Ee(0)),Je!==0)throw new Error(`Malformed buffer data: ${Je}`)})(M,M.exports[B[J]],V,N,G,H,M.exports[k[oe]])}}}(fetch(lI()));return w.ready.then(()=>{A0=w})}()),u)for(let w=0;w<u.length;w++)_.push(yL(u[w],l,w,r));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(E&&p)for(let{primitives:w}of p)for(let I of w)mL(I,l);if(S&&p&&T)for(let w of T)gL(w,l);return l})})}function Mc(s,e){let r=s.json.bufferViews[e.bufferView],l=Gg[e.componentType];return new l(s.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==Jf[e.type]*l.BYTES_PER_ELEMENT?r.byteStride/l.BYTES_PER_ELEMENT:Jf[e.type]))}function P0(s,e,r,l){let f=Gg[e.componentType],u=function(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),p=s.json.bufferViews[e.bufferView],v=p.byteStride?p.byteStride/f.BYTES_PER_ELEMENT:Jf[e.type],T=r.float32,D=T.length/r.capacity;for(let _=0,E=0;_<e.count*v;_+=v,E+=D)for(let S=0;S<D;S++)T[E+S]=l[_+S]*u;r._trim()}function vL(s,e,r){let l=s.indices,f=s.attributes,u={};u.indexArray=new ir;let p=e.json.accessors[l],v=p.count/3;u.indexArray.reserve(v);let T=Mc(e,p);for(let S=0;S<v;S++)u.indexArray.emplaceBack(T[3*S],T[3*S+1],T[3*S+2]);u.indexArray._trim(),u.vertexArray=new Ts;let D=e.json.accessors[f.POSITION];u.vertexArray.reserve(D.count);let _=Mc(e,D);for(let S=0;S<D.count;S++)u.vertexArray.emplaceBack(_[3*S],_[3*S+1],_[3*S+2]);if(u.vertexArray._trim(),u.aabb=new Mn(D.min,D.max),u.centroid=function(S,w){let I=[0,0,0],M=S.length;if(M>0){for(let L=0;L<M;L++){let k=3*S[L];I[0]+=w[k],I[1]+=w[k+1],I[2]+=w[k+2]}I[0]/=M,I[1]/=M,I[2]/=M}return I}(T,_),f.COLOR_0!==void 0){let S=e.json.accessors[f.COLOR_0],w=Jf[S.type],I=Mc(e,S);u.colorArray=w===3?new Ts:new Ho,u.colorArray.resize(S.count),P0(e,S,u.colorArray,I)}if(f.NORMAL!==void 0){u.normalArray=new Ts;let S=e.json.accessors[f.NORMAL];u.normalArray.resize(S.count);let w=Mc(e,S);P0(e,S,u.normalArray,w)}if(f.TEXCOORD_0!==void 0&&r.length>0){u.texcoordArray=new yc;let S=e.json.accessors[f.TEXCOORD_0];u.texcoordArray.resize(S.count);let w=Mc(e,S);P0(e,S,u.texcoordArray,w)}if(f._FEATURE_ID_RGBA4444!==void 0){let S=e.json.accessors[f._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=Mc(e,S))}f._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(Mc(e,e.json.accessors[f._FEATURE_RGBA4444]).buffer));let E=s.material;return u.material=function(S,w){let{emissiveFactor:I=[0,0,0],alphaMode:M="OPAQUE",alphaCutoff:L=.5,normalTexture:k,occlusionTexture:B,emissiveTexture:V,doubleSided:N}=S,{baseColorFactor:G=[1,1,1,1],metallicFactor:H=1,roughnessFactor:J=1,baseColorTexture:oe,metallicRoughnessTexture:ee}=S.pbrMetallicRoughness||{},ne=B?w[B.index]:void 0;if(B&&B.extensions&&B.extensions.KHR_texture_transform&&ne){let pe=B.extensions.KHR_texture_transform;ne.offsetScale=[pe.offset[0],pe.offset[1],pe.scale[0],pe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Rn(...G),metallicFactor:H,roughnessFactor:J,baseColorTexture:oe?w[oe.index]:void 0,metallicRoughnessTexture:ee?w[ee.index]:void 0},doubleSided:N,emissiveFactor:I,alphaMode:M,alphaCutoff:L,normalTexture:k?w[k.index]:void 0,occlusionTexture:ne,emissionTexture:V?w[V.index]:void 0,defined:S.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},r),u}function mI(s,e,r){let{matrix:l,rotation:f,translation:u,scale:p,mesh:v,extras:T,children:D}=s,_={};if(_.matrix=l||we.mat4.fromRotationTranslationScale([],f||[0,0,0,1],u||[0,0,0],p||[1,1,1]),v!==void 0){_.meshes=r[v];let E=_.anchor=[0,0];for(let S of _.meshes){let{min:w,max:I}=S.aabb;E[0]+=w[0]+I[0],E[1]+=w[1]+I[1]}E[0]=Math.floor(E[0]/_.meshes.length/2),E[1]=Math.floor(E[1]/_.meshes.length/2)}if(T&&(T.id&&(_.id=T.id),T.lights&&(_.lights=function(E){if(!E.length)return[];let S=function(k){let B=atob(k),V=new Uint8Array(B.length);for(let N=0;N<B.length;N++)V[N]=B.codePointAt(N);return V}(E),w=[],I=S.length/24,M=new Uint16Array(S.buffer),L=new Float32Array(S.buffer);for(let k=0;k<I;k++){let B=M[2*k*6]/30,V=M[2*k*6+1]/30,N=M[2*k*6+10]/100,G=L[6*k+1],H=L[6*k+2],J=L[6*k+3],oe=L[6*k+4],ee=J-G,ne=oe-H,pe=Math.hypot(ee,ne);w.push({pos:[G+.5*ee,H+.5*ne,V],normal:[ne/pe,-ee/pe,0],width:pe,height:B,depth:N,points:[G,H,J,oe]})}return w}(T.lights))),D){let E=[];for(let S of D)E.push(mI(e.json.nodes[S],e,r));_.children=E}return _}function xL(s){if(s.vertices.length===0||s.indices.length===0)return null;let e=new Bv(s.vertices,s.indices,8,256),[r,l]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:r,max:l}}function bL(s){if(!s.extras||!s.extras.ground)return null;let e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;let l=[];for(let p of r){if(!Array.isArray(p)||p.length!==2)continue;let v=p[0],T=p[1];typeof v=="number"&&typeof T=="number"&&l.push(new it(v,T))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let f=0;for(let p=0;p<l.length;p++){let v=l[p],T=l[(p+1)%l.length],D=l[(p+2)%l.length];f+=(v.x-T.x)*(D.y-T.y)-(D.x-T.x)*(v.y-T.y)}f>0&&l.reverse();let u=wf(l.flatMap(p=>[p.x,p.y]),[]);return u.length===0?null:{vertices:l,indices:u}}function wL(s,e){let r=[],l=[],f=0,u=[];for(let p of s){f=r.length;let v=p.vertexArray.float32,T=p.indexArray.uint16;for(let D=0;D<p.vertexArray.length;D++)u[0]=v[3*D+0],u[1]=v[3*D+1],u[2]=v[3*D+2],we.vec3.transformMat4(u,u,e),r.push(new it(u[0],u[1]));for(let D=0;D<3*p.indexArray.length;D++)l.push(T[D]+f)}if(l.length%3!=0)return null;for(let p=0;p<l.length;p+=3){let v=r[l[p+0]],T=r[l[p+1]],D=r[l[p+2]];(v.x-T.x)*(D.y-T.y)-(D.x-T.x)*(v.y-T.y)>0&&([l[p+1],l[p+2]]=[l[p+2],l[p+1]])}return{vertices:r,indices:l}}function gI(s){let e=function(T,D){let _=[],E=WebGL2RenderingContext;if(T.json.textures)for(let S of T.json.textures){let w={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};S.sampler!==void 0&&Object.assign(w,T.json.samplers[S.sampler]),_.push({image:D[S.source],sampler:w,uploaded:!1})}return _}(s,s.images),r=function(T,D){let _=[];for(let E of T.json.meshes){let S=[];for(let w of E.primitives)S.push(vL(w,T,D));_.push(S)}return _}(s,e),{scenes:l,scene:f,nodes:u}=s.json,p=l?l[f||0].nodes:u,v=[];for(let T of p)v.push(mI(u[T],s,r));return function(T,D,_){let E={},S=new Set;for(let w=0;w<T.length;w++){let I=_[D[w]];if(!I.extras)continue;let M=I.extras["mapbox:footprint:version"],L=I.extras["mapbox:footprint:id"];(M||L)&&S.add(w),M==="1.0.0"&&L&&(E[L]=w)}for(let w=0;w<T.length;w++){if(S.has(w))continue;let I=T[w],M=_[D[w]];if(!M.extras)continue;let L=null;I.id in E&&(L=wL(T[E[I.id]].meshes,I.matrix)),L||(L=bL(M)),L&&(I.footprint=xL(L))}if(S.size>0){let w=Array.from(S.values()).sort((I,M)=>I-M);for(let I=w.length-1;I>=0;I--)T.splice(w[I],1)}}(v,p,s.json.nodes),v}function EL(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);let e=s.vertexArray.float32,r=s.aabb.min[0]-1,l=s.aabb.min[1]-1,f=Dc/(s.aabb.max[0]-r+2),u=Dc/(s.aabb.max[1]-l+2);for(let p=0;p<e.length;p+=3){let v=e[p+2],T=(e[p+0]-r)*f|0,D=(e[p+1]-l)*u|0;v>s.heightmap[D*Dc+T]&&(s.heightmap[D*Dc+T]=v)}}function TL(s,e){let r={};r.indexArray=new ir,r.indexArray.reserve(4*s.length),r.vertexArray=new Ts,r.vertexArray.reserve(10*s.length),r.colorArray=new Ho,r.vertexArray.reserve(10*s.length);let l=0;for(let p of s){let v=Math.min(10,Math.max(4,1.3*p.height))*e,T=[-p.normal[1],p.normal[0],0],D=Math.min(.29,.1*p.width/p.depth),_=p.width-2*p.depth*e*(D+.01),E=we.vec3.scaleAndAdd([],p.pos,T,_/2),S=we.vec3.scaleAndAdd([],p.pos,T,-_/2),w=[E[0],E[1],E[2]+p.height],I=[S[0],S[1],S[2]+p.height],M=we.vec3.scaleAndAdd([],p.normal,T,D);we.vec3.scale(M,M,v);let L=we.vec3.scaleAndAdd([],p.normal,T,-D);we.vec3.scale(L,L,v),we.vec3.add(M,E,M),we.vec3.add(L,S,L),E[2]+=.1,S[2]+=.1,r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(L[0],L[1],L[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(w[0],w[1],w[2]),r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(L[0],L[1],L[2]);let k=_/v/2;r.colorArray.emplaceBack(-k-D,-1,k,.8),r.colorArray.emplaceBack(k+D,-1,k,.8),r.colorArray.emplaceBack(-k,0,k,1.3),r.colorArray.emplaceBack(k,0,k,1.3),r.colorArray.emplaceBack(k+D,-.8,k,.7),r.colorArray.emplaceBack(k+D,-.8,k,.7),r.colorArray.emplaceBack(0,0,k,1.3),r.colorArray.emplaceBack(0,0,k,1.3),r.colorArray.emplaceBack(k+D,-1.2,k,.8),r.colorArray.emplaceBack(k+D,-1.2,k,.8),r.indexArray.emplaceBack(6+l,4+l,8+l),r.indexArray.emplaceBack(7+l,9+l,5+l),r.indexArray.emplaceBack(0+l,1+l,2+l),r.indexArray.emplaceBack(1+l,3+l,2+l),l+=10}let f={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Rn.white,f.pbrMetallicRoughness=u,r.material=f,r.aabb=new Mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}class _I{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){let l=e[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class yI{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ea(ot,16,0),this.featureIndexArray=new Jm,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,l,f,u,p=0,v=0){let T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,f,u,p);let D=this.grid;for(let _=0;_<r.length;_++){let E=r[_],S=[1/0,1/0,-1/0,-1/0];for(let w=0;w<E.length;w++){let I=E[w];S[0]=Math.min(S[0],I.x),S[1]=Math.min(S[1],I.y),S[2]=Math.max(S[2],I.x),S[3]=Math.max(S[3],I.y)}v!==0&&(S[0]-=v,S[1]-=v,S[2]+=v,S[3]+=v),S[0]<ot&&S[1]<ot&&S[2]>=0&&S[3]>=0&&D.insert(T,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new oh.VectorTile(new xg(this.rawTileData)).layers,this.sourceLayerCoder=new _I(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,l){this.loadVTLayers(),this.serializedLayersCache.clear();let f=Uu(e.filter),u=e.tileResult,p=e.transform,v=u.bufferedTilespaceBounds,T=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(S,w,I,M)=>zn(u.bufferedTilespaceGeometry,S,w,I,M));T.sort(IL);let D=null;p.elevation&&T.length>0&&(D=dh.create(p.elevation,this.tileID));let _={},E;for(let S=0;S<T.length;S++){let w=T[S];if(w===E)continue;E=w;let I=this.featureIndexArray.get(w),M=null;if(this.is3DTile){let L=this.bucketLayerIDs[0][0],k=r[L];if(k.type!=="model")continue;let{queryFeature:B,intersectionZ:V}=k.queryIntersectsMatchingFeature(u,I.featureIndex,f,p);B&&this.appendToResult(_,L,I.featureIndex,B,V)}else this.loadMatchingFeature(_,I,f,e.layers,e.availableImages,r,l,(L,k,B,V=0)=>(M||(M=Se(L,this.tileID.canonical,e.tileTransform)),k.queryIntersectsFeature(u,L,B,M,this.z,e.transform,e.pixelPosMatrix,D,V)))}return _}loadMatchingFeature(e,r,l,f,u,p,v,T){let{featureIndex:D,bucketIndex:_,sourceLayerIndex:E,layoutVertexArrayOffset:S}=r,w=this.bucketLayerIDs[_];if(f.length&&!function(k,B){for(let V=0;V<k.length;V++)if(B.indexOf(k[V])>=0)return!0;return!1}(f,w))return;let I=this.sourceLayerCoder.decode(E),M=this.vtLayers[I].feature(D);if(l.needGeometry){let k=Ge(M,!0);if(!l.filter(new ar(this.tileID.overscaledZ),k,this.tileID.canonical))return}else if(!l.filter(new ar(this.tileID.overscaledZ),M))return;let L=this.getId(M,I);for(let k=0;k<w.length;k++){let B=w[k];if(f.length&&f.indexOf(B)<0)continue;let V=p[B];if(!V)continue;let N={};L!==void 0&&v&&(N=v.getState(V.sourceLayer||"_geojsonTileLayer",L));let G=!T||T(M,V,N,S);if(!G)continue;let H=new $f(M,this.z,this.x,this.y,L),J=this.serializedLayersCache.get(B);J||(J=V.serialize(),J.id=B,this.serializedLayersCache.set(B,J)),H.layer=Jr({},J),H.tile=this.tileID.canonical,H.layer.paint=vI(J.paint,V.paint,M,N,u),H.layer.layout=vI(J.layout,V.layout,M,N,u),this.appendToResult(e,B,D,H,G)}}appendToResult(e,r,l,f,u){let p=e[r];p===void 0&&(p=e[r]=[]),p.push({featureIndex:l,feature:f,intersectionZ:u})}lookupSymbolFeatures(e,r,l,f,u,p,v){let T={};this.loadVTLayers();let D=Uu(f);for(let _ of e)this.loadMatchingFeature(T,{bucketIndex:r,sourceLayerIndex:l,featureIndex:_,layoutVertexArrayOffset:0},D,u,p,v);return T}loadFeature(e){let{featureIndex:r,sourceLayerIndex:l}=e;this.loadVTLayers();let f=this.sourceLayerCoder.decode(l),u=this.vtFeatures[f];if(u[r])return u[r];let p=this.vtLayers[f].feature(r);return u[r]=p,p}hasLayer(e){for(let r of this.bucketLayerIDs)for(let l of r)if(e===l)return!0;return!1}getId(e,r){let l=e.id;if(this.promoteId){let f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];f!=null&&(l=e.properties[f]),typeof l=="boolean"&&(l=Number(l))}return l}}function vI(s,e,r,l,f){return Gs(s,(u,p)=>{let v=e instanceof Qa?e.get(p):null;return v&&v.evaluate?v.evaluate(r,l,f):v})}function IL(s,e){return e-s}ht(yI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let xI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class O0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,l]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let f=l>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);let u=xI[15&l];if(!u)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new O0(v,p,u,e)}constructor(e,r=64,l=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let u=xI.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${l}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+v+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){let l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=r,l}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return L0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:p,nodeSize:v}=this,T=[0,u.length-1,0],D=[];for(;T.length;){let _=T.pop()||0,E=T.pop()||0,S=T.pop()||0;if(E-S<=v){for(let L=S;L<=E;L++){let k=p[2*L],B=p[2*L+1];k>=e&&k<=l&&B>=r&&B<=f&&D.push(u[L])}continue}let w=S+E>>1,I=p[2*w],M=p[2*w+1];I>=e&&I<=l&&M>=r&&M<=f&&D.push(u[w]),(_===0?e<=I:r<=M)&&(T.push(S),T.push(w-1),T.push(1-_)),(_===0?l>=I:f>=M)&&(T.push(w+1),T.push(E),T.push(1-_))}return D}within(e,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:f,coords:u,nodeSize:p}=this,v=[0,f.length-1,0],T=[],D=l*l;for(;v.length;){let _=v.pop()||0,E=v.pop()||0,S=v.pop()||0;if(E-S<=p){for(let L=S;L<=E;L++)wI(u[2*L],u[2*L+1],e,r)<=D&&T.push(f[L]);continue}let w=S+E>>1,I=u[2*w],M=u[2*w+1];wI(I,M,e,r)<=D&&T.push(f[w]),(_===0?e-l<=I:r-l<=M)&&(v.push(S),v.push(w-1),v.push(1-_)),(_===0?e+l>=I:r+l>=M)&&(v.push(w+1),v.push(E),v.push(1-_))}return T}}function L0(s,e,r,l,f,u){if(f-l<=r)return;let p=l+f>>1;bI(s,e,p,l,f,u),L0(s,e,r,l,p-1,1-u),L0(s,e,r,p+1,f,1-u)}function bI(s,e,r,l,f,u){for(;f>l;){if(f-l>600){let D=f-l+1,_=r-l+1,E=Math.log(D),S=.5*Math.exp(2*E/3),w=.5*Math.sqrt(E*S*(D-S)/D)*(_-D/2<0?-1:1);bI(s,e,r,Math.max(l,Math.floor(r-_*S/D+w)),Math.min(f,Math.floor(r+(D-_)*S/D+w)),u)}let p=e[2*r+u],v=l,T=f;for(Kf(s,e,l,r),e[2*f+u]>p&&Kf(s,e,l,f);v<T;){for(Kf(s,e,v,T),v++,T--;e[2*v+u]<p;)v++;for(;e[2*T+u]>p;)T--}e[2*l+u]===p?Kf(s,e,l,T):(T++,Kf(s,e,T,f)),T<=r&&(l=T+1),r<=T&&(f=T-1)}}function Kf(s,e,r,l){k0(s,r,l),k0(e,2*r,2*l),k0(e,2*r+1,2*l+1)}function k0(s,e,r){let l=s[e];s[e]=s[r],s[r]=l}function wI(s,e,r,l){let f=s-r,u=e-l;return f*f+u*u}n.$=Bm,n.A=class extends Bg{},n.B=Zs,n.C=Aa,n.D=Qd,n.E=Ma,n.F=zd,n.G=Ks,n.H=Nd,n.I=r0,n.J=ku,n.K=na,n.L=Qs,n.M=Ya,n.N=Du,n.O=Ha,n.P=it,n.Q=ec,n.R=cu,n.S=fi,n.T=m0,n.U=hd,n.V=Bg,n.W=ef,n.X=Bd,n.Y=Pm,n.Z=function(s){let e=s.value,r=[];if(!e)return r;let l=Zs(e);return l!=="string"?(r=r.concat([new Bg(s.key,e,`string expected, "${l}" found`)]),r):(OT(e,!0)||(r=r.concat([new Bg(s.key,e,`invalid url "${e}"`)])),r)},n._=Ae,n.a=function(s){return ce.API_CDN_URL_REGEX.test(s)},n.a$=Es,n.a0=Zn,n.a1=tt,n.a2=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return bi(s.expression.evaluate(e))}interpolate(s,e,r){return{x:Mt(s.x,e.x,r),y:Mt(s.y,e.y,r),z:Mt(s.z,e.z,r),azimuthal:Mt(s.azimuthal,e.azimuthal,r),polar:Mt(s.polar,e.polar,r)}}},n.a3=ar,n.a4=lc,n.a5=xe,n.a6=we,n.a7=wa,n.a8=Qa,n.a9=hl,n.aA=nn,n.aB=xT,n.aC=ST,n.aD=vT,n.aE=function(s,e){let r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let l=0;l<s.length;l++){let f=document.createElement("source");Fi(s[l])||(r.crossOrigin="Anonymous"),f.src=s[l],r.appendChild(f)}return{cancel:()=>{}}},n.aF=Lg,n.aG=function(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>pI(e,0,s))},n.aH=gI,n.aI=class{constructor(s,e,r,l){this.id=s,this.position=e!=null?new R(e[0],e[1]):new R(0,0),this.orientation=r??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new Mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,e){if(we.mat4.multiply(s.matrix,e,s.matrix),s.meshes)for(let r of s.meshes){let l=Mn.applyTransformFast(r.aabb,s.matrix);this.aabb.encapsulate(l)}if(s.children)for(let r of s.children)this._applyTransformations(r,s.matrix)}computeBoundsAndApplyParent(){let s=we.mat4.identity([]);for(let e of this.nodes)this._applyTransformations(e,s)}computeModelMatrix(s,e,r,l,f,u,p=!1){zT(this.matrix,this,s.transform,this.position,e,r,l,f,u,p)}upload(s){if(!this.uploaded){for(let e of this.nodes)x0(e,s);for(let e of this.nodes)Vg(e);this.uploaded=!0}}destroy(){for(let s of this.nodes)b0(s)}},n.aJ=Ea,n.aK=function(s){return s.indexOf(fc)>=0},n.aL=Ff,n.aM=Q,n.aN=re,n.aO=tl,n.aP=ir,n.aQ=Vl,n.aR=Qu,n.aS=Pg,n.aT=function(){Ci.isLoading()||Ci.isLoaded()||Jd()!=="deferred"||zm()},n.aU=Uu,n.aV=Ge,n.aW=$f,n.aX=$l,n.aY=Zv,n.aZ=zv,n.a_=Se,n.aa=Mt,n.ab=ot,n.ac=Zl,n.ad=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([r,l]){let f=bi([1,r,l]);return{x:f.x,y:f.y,z:f.z}}(s.expression.evaluate(e))}interpolate(s,e,r){return{x:Mt(s.x,e.x,r),y:Mt(s.y,e.y,r),z:Mt(s.z,e.z,r)}}},n.ae=function(s,e,r=0,l=!0){let f=new it(r,r),u=s.sub(f),p=e.add(f),v=[u,new it(p.x,u.y),p,new it(u.x,p.y)];return l&&v.push(u.clone()),v},n.af=function(s,e){let r=[];for(let l=0;l<s.length;l++){let f=zo(l-1,-1,s.length-1),u=zo(l+1,-1,s.length-1),p=s[l],v=s[u],T=s[f].sub(p).unit(),D=v.sub(p).unit(),_=D.angleWithSep(T.x,T.y),E=T.add(D).unit().mult(-1*e/Math.sin(_/2));r.push(p.add(E))}return r},n.ag=oT,n.ah=zn,n.ai=function(s,e,r=0){return we.vec3.fromValues(((e.x-r)*s.scale-s.x)*ot,(e.y*s.scale-s.y)*ot,ie(e.z,e.y))},n.aj=pi,n.ak=TE,n.al=function(s){let e=1/0,r=1/0,l=-1/0,f=-1/0;for(let u of s)e=Math.min(e,u.x),r=Math.min(r,u.y),l=Math.max(l,u.x),f=Math.max(f,u.y);return{min:new it(e,r),max:new it(l,f)}},n.am=q,n.an=tn,n.ao=ge,n.ap=zt,n.aq=Hr,n.ar=function(s,e){let r={};for(let l=0;l<e.length;l++){let f=e[l];f in s&&(r[f]=s[f])}return r},n.as=F,n.at=X,n.au=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,r,l){let f=this.entries[s]=this.entries[s]||{callbacks:[]};if(f.result){let[u,p]=f.result;return this.scheduler?this.scheduler.add(()=>{l(u,p)},e):l(u,p),()=>{}}return f.callbacks.push(l),f.cancel||(f.cancel=r((u,p)=>{f.result=[u,p];for(let v of f.callbacks)this.scheduler?this.scheduler.add(()=>{v(u,p)},e):v(u,p);setTimeout(()=>delete this.entries[s],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(u=>u!==l),f.callbacks.length||(f.cancel(),delete this.entries[s]))}}},n.av=Hu,n.aw=function(s,e,r){let l=JSON.stringify(s.request);return s.data&&(this.deduped.entries[l]={result:[null,s.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},f=>{let u=Da(s.request,(p,v,T,D)=>{p?f(p):v&&f(null,{vectorTile:r?void 0:new oh.VectorTile(new xg(v)),rawData:v,cacheControl:T,expires:D})});return()=>{u.cancel(),f()}},e)},n.ax=function(s){Or++,Or>Ot&&(s.getActor().send("enforceCacheSizeLimit",Vt),Or=0)},n.ay=Qe,n.az=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},n.b=function(s){return ce.API_FONTS_REGEX.test(s)},n.b$=mi,n.b0=hf,n.b1=bo,n.b2=dr,n.b3=wf,n.b4=d0,n.b5=function(s,e){let r=hl(e.zoom);if(r===0)return Ss(s);let l=sg(s),f=Mv(l),u=q(l.getWest())*e.worldSize,p=q(l.getEast())*e.worldSize,v=X(l.getNorth())*e.worldSize,T=X(l.getSouth())*e.worldSize,D=[u,v,0],_=[p,v,0],E=[u,T,0],S=[p,T,0],w=we.mat4.invert([],e.globeMatrix);return we.vec3.transformMat4(D,D,w),we.vec3.transformMat4(_,_,w),we.vec3.transformMat4(E,E,w),we.vec3.transformMat4(S,S,w),f[0]=sa(f[0],E,r),f[1]=sa(f[1],S,r),f[2]=sa(f[2],_,r),f[3]=sa(f[3],D,r),Mn.fromPoints(f)},n.b6=lg,n.b7=xf,n.b8=sa,n.b9=qu,n.bA=Rn,n.bB=zo,n.bC=en,n.bD=Ia,n.bE=Z,n.bF=function(s,e,r){s[4*e+0]=r[0],s[4*e+1]=r[1],s[4*e+2]=r[2],s[4*e+3]=r[3]},n.bG=wc,n.bH=vo,n.bI=mf,n.bJ=Ar,n.bK=oa,n.bL=R,n.bM=uT,n.bN=hn,n.bO=Bi,n.bP=CT,n.bQ=Rr,n.bR=pw,n.bS=function(s,e,r,l,f,u,p,v,T){if(T.name==="globe")return pw(s,e,new Rr(r,l,f),!1);let D=Ff({z:r,x:l,y:f},T);return new Mn([(u+D.x/D.scale)*e,e*(D.y/D.scale),p],[(u+D.x2/D.scale)*e,e*(D.y2/D.scale),v])},n.bT=function(s,e,r){let l=0;for(let f=0;f<2;++f)s[f]>0&&(l+=(s[f]-0)*(s[f]-0)),e[f]<0&&(l+=(0-e[f])*(0-e[f]));return l},n.bU=ae,n.bV=h,n.bW=function(s){let e=we.mat4.identity(new Float64Array(16));we.mat4.multiply(e,s.pixelMatrix,s.globeMatrix);let r=[0,g,0],l=[0,y,0];return we.vec3.transformMat4(r,r,e),we.vec3.transformMat4(l,l,e),[r[0]>0&&r[0]<=s.width&&r[1]>0&&r[1]<=s.height&&!Pv(s,new R(s.center.lat,90)),l[0]>0&&l[0]<=s.width&&l[1]>0&&l[1]<=s.height&&!Pv(s,new R(s.center.lat,-90))]},n.bX=function(s,e){let{scale:r}=s.tileTransform,l=r*ot/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return we.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},n.bY=Ng,n.bZ=DT,n.b_=function(s){let e=DT(s,!0);return we.mat2.invert([],[e[0],e[1],e[4],e[5]])},n.ba=kr,n.bb=D0,n.bc=xg,n.bd=Da,n.be=function(s){let e=[];for(let r in s)e.push(s[r]);return e},n.bf=function(s,e){let r=[];for(let l in s)l in e||r.push(l);return r},n.bg=$s,n.bh=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bi=js,n.bj=function(s,e){let{x:r,y:l}=s.point,f=_w(r,l,s.worldSize/s._pixelsPerMercatorPixel,0,0);return we.mat4.multiply(f,f,Av(Ss(e)))},n.bk=sh,n.bl=no,n.bm=vg,n.bn=function(s,e,r,l,f){let u=5*e+2;s.float32[u+0]=r,s.float32[u+1]=l,s.float32[u+2]=f},n.bo=Rg,n.bp=ZE,n.bq=$e,n.br=qr,n.bs=Yw,n.bt=PT,n.bu=tE,n.bv=nE,n.bw=s0,n.bx=tT,n.by=n0,n.bz=O0,n.c=fe,n.c$=jn,n.c0=function(s){let{x:e,y:r}=s.point,{lng:l,lat:f}=s._center;return _w(e,r,s.worldSize,l,f)},n.c1=Fr,n.c2=wn,n.c3=og,n.c4=function(s){let e=Math.round((s+45+360)%360/90)%4;return qi[e]},n.c5=45,n.c6=W,n.c7=nh,n.c8=function(s,e,r){let l=Math.sqrt(s*s+e*e+r*r),f=l>0?Math.acos(r/l)*No:0,u=s!==0||e!==0?Math.atan2(-e,-s)*No+90:0;return u<0&&(u+=360),[l,u,f]},n.c9=me,n.cA=function(s){let e=ae-5;s=zt(s,-e,e)/e*90;let r=Math.pow(Math.abs(Math.sin(en(s))),3);return Math.round(r*(d.length-1))},n.cB=function(s,e,r,l){let f=e.getNorth(),u=e.getSouth(),p=e.getWest(),v=e.getEast(),T=1<<s.z,D=v-p,_=f-u,E=D/o,S=-_/d[r],w=[0,E,0,S,0,0,f,p,0];if(s.z>0){let I=180/l;we.mat3.multiply(w,w,[I/D+1,0,0,0,I/_+1,0,-.5*I/E,.5*I/S,1])}return w[2]=T,w[5]=s.x,w[8]=s.y,w},n.cC=Ss,n.cD=function(s,e,r){let l=we.mat4.identity(new Float64Array(16)),f=(e/(1<<s)-.5)*Math.PI*2;return we.mat4.rotateY(l,r.globeMatrix,f),Float32Array.from(l)},n.cE=class{isDataAvailableAtPoint(s){let e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;let r=e.getSource().maxzoom,l=1<<r,f=Math.floor(s.x),u=Math.floor((s.x-f)*l),p=Math.floor(s.y*l),v=this.findDEMTileFor(new nn(r,f,r,u,p));return!(!v||!v.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let l=this._source();if(!l||s.y<0||s.y>1)return e;let f=l.getSource().maxzoom,u=1<<f,p=Math.floor(s.x),v=s.x-p,T=new nn(f,p,f,Math.floor(v*u),Math.floor(s.y*u)),D=this.findDEMTileFor(T);if(!D||!D.dem)return e;let _=D.dem,E=1<<D.tileID.canonical.z,S=(v*E-D.tileID.canonical.x)*_.dim,w=(s.y*E-D.tileID.canonical.y)*_.dim,I=Math.floor(S),M=Math.floor(w);return(r?this.exaggeration():1)*Mt(Mt(_.get(I,M),_.get(I,M+1),w-M),Mt(_.get(I+1,M),_.get(I+1,M+1),w-M),S-I)}getAtTileOffset(s,e,r){let l=1<<s.canonical.z;return this.getAtPointOrZero(new xe(s.wrap+(s.canonical.x+e/ot)/l,(s.canonical.y+r/ot)/l))}getAtTileOffsetFunc(s,e,r,l){return f=>{let u=this.getAtTileOffset(s,f.x,f.y),p=l.upVector(s.canonical,f.x,f.y),v=l.upVectorScale(s.canonical,e,r).metersToTile;return we.vec3.scale(p,p,u*v),p}}getForTilePoints(s,e,r,l){if(this.isUsingMockSource())return!1;let f=dh.create(this,s,l);return!!f&&(e.forEach(u=>{u[2]=this.exaggeration()*f.getElevationAt(u[0],u[1],r)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(s);if(!e||!e.dem)return null;let r=e.dem.tree,l=e.tileID,f=1<<s.canonical.z-l.canonical.z,u=s.canonical.x/f-l.canonical.x,p=s.canonical.y/f-l.canonical.y,v=0;for(let T=0;T<s.canonical.z-l.canonical.z&&!r.leaves[v];T++){u*=2,p*=2;let D=2*Math.floor(p)+Math.floor(u);v=r.childOffsets[v]+D,u%=1,p%=1}return{min:this.exaggeration()*r.minimums[v],max:this.exaggeration()*r.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,r=Number.MAX_VALUE,l=Number.MIN_VALUE;for(let f of s){let u=this.getMinMaxForTile(f.tileID);u&&(r=Math.min(r,u.min),l=Math.max(l,u.max),e=!0)}return e?{min:r,max:l}:null}},n.cF=Aw,n.cG=cl,n.cH=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},n.cI=gw,n.cJ=K,n.cK=Y,n.cL=256,n.cM=function(s,e){let r=[0,0,0],l=lg(Ss(e.canonical));return we.vec3.transformMat4(r,r,l),we.vec3.transformMat4(r,r,s),r},n.cN=s=>({u_camera_to_center_distance:new Ar(s),u_extrude_scale:new rh(s),u_device_pixel_ratio:new Ar(s),u_matrix:new wc(s),u_inv_rot_matrix:new wc(s),u_merc_center:new vo(s),u_tile_id:new mf(s),u_zoom_transition:new Ar(s),u_up_dir:new mf(s),u_emissive_strength:new Ar(s)}),n.cO=s=>({u_matrix:new wc(s),u_pixels_to_tile_units:new rh(s),u_device_pixel_ratio:new Ar(s),u_units_to_pixels:new vo(s),u_dash_image:new oa(s),u_gradient_image:new oa(s),u_image_height:new Ar(s),u_texsize:new vo(s),u_tile_units_to_pixels:new Ar(s),u_alpha_discard_threshold:new Ar(s),u_trim_offset:new vo(s),u_trim_fade_range:new vo(s),u_trim_color:new nh(s),u_emissive_strength:new Ar(s),u_zbias_factor:new Ar(s),u_tile_to_meter:new Ar(s)}),n.cP=s=>({u_matrix:new wc(s),u_texsize:new vo(s),u_pixels_to_tile_units:new rh(s),u_device_pixel_ratio:new Ar(s),u_image:new oa(s),u_units_to_pixels:new vo(s),u_tile_units_to_pixels:new Ar(s),u_alpha_discard_threshold:new Ar(s),u_trim_offset:new vo(s),u_emissive_strength:new Ar(s),u_zbias_factor:new Ar(s),u_tile_to_meter:new Ar(s)}),n.cQ=rl,n.cR=WP,n.cS=ZP,n.cT=xw,n.cU=(s,e,r,l,f,u)=>{let p=s.transform,v=p.projection.name==="globe",T;if(u.paint.get("circle-pitch-alignment")==="map")if(v){let _=gw(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;T=Float32Array.from([_,0,0,_])}else T=p.calculatePixelsToTileUnitsMatrix(r);else T=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let D={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(p.projection),u_matrix:s.translatePosMatrix(e.projMatrix,r,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:at.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:JR,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(v){D.u_inv_rot_matrix=l,D.u_merc_center=f,D.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],D.u_zoom_transition=hl(p.zoom);let _=f[0]*ot,E=f[1]*ot;D.u_up_dir=p.projection.upVector(new Rr(0,0,0),_,E)}return D},n.cV=CE,n.cW=(s,e,r,l,f,u)=>{let p=s.transform,v=p.pitch<15?IE(.07,.7,zt((14-p.zoom)/5,0,1)):.07;return{u_matrix:DE(s,e,r,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:f,u_image:0,u_tile_units_to_pixels:SE(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u,u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:v,u_tile_to_meter:me(e.tileID.canonical,0)}},n.cX=(s,e,r,l,f,u,p)=>{let v=s.transform,T=v.calculatePixelsToTileUnitsMatrix(e),D=v.pitch<15?IE(.07,.7,zt((14-v.zoom)/5,0,1)):.07;return{u_matrix:DE(s,e,r,l),u_pixels_to_tile_units:T,u_device_pixel_ratio:u,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:ME(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:SE(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:me(e.tileID.canonical,0)}},n.cY=jl,n.cZ=bf,n.c_=mE,n.ca=Mn,n.cb=bi,n.cc=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},n.cd=function(s){return s({pluginStatus:Gr,pluginURL:Di}),Yd.on("pluginStateChange",s),s},n.ce=E0,n.cf=$g,n.cg=lh,n.ch=i0,n.ci=sd,n.cj=Nm,n.ck=Pt,n.cl=hi,n.cm=ki,n.cn=function(s){let e=s.indexOf(fc);return e>=0?s.slice(0,e):s},n.co=function(s){let e=s.indexOf(fc);return e>=0?s.slice(e+1):""},n.cp=function(s){let e=[],r=s.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},n.cq=function(s,e,r,l){return s.type==="custom"?new IO(s,e):new NO[s.type](s,e,r,l)},n.cr=Ta,n.cs=Yd,n.ct=Sa,n.cu=gf,n.cv=class extends Wo{constructor(s){super(s),this.current=Tv}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let l=0;l<9;l++)if(r[l]!==this.current[l]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},n.cw=Us,n.cx=function(s,e,r){let l=hl(r.zoom),f=s.style.map._antialias,u=e.options.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return l===0&&!f&&!u},n.cy=function(s){let e=s.pixelsPerMeter,r=e/Z(1,s.center.lat),l=we.mat4.identity(new Float64Array(16));return we.mat4.translate(l,l,[s.point.x,s.point.y,0]),we.mat4.scale(l,l,[r,r,e]),Float32Array.from(l)},n.cz=sg,n.d=function(s){return ce.API_TILEJSON_REGEX.test(s)},n.d$=P,n.d0=yg,n.d1=fl,n.d2=450,n.d3=7,n.d4=TO,n.d5=gn,n.d6=Ju,n.d7=256,n.d8=Av,n.d9=Ts,n.dA=yw,n.dB=function(s){let e=[0,0,0],r=we.mat4.identity(new Float64Array(16));return we.mat4.multiply(r,s.pixelMatrix,s.globeMatrix),we.vec3.transformMat4(e,e,r),new it(e[0],e[1])},n.dC=function(s,e,r=!1){if(Gr===Zd||Gr===hc||Gr===dc)throw new Error("setRTLTextPlugin cannot be called multiple times.");Di=at.resolveURL(s),Gr=Zd,Vu=e,Xd(),r||zm()},n.dD=Jd,n.dE=function(){$g().acquire(C0)},n.dF=function(){let s=Xf;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(C0),Xf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.dG=Zf,n.dH=function(s){let e=Ln();if(!e)return;let r=e.delete(Bt);s&&r.catch(s).then(()=>s())},n.dI=Wf,n.dJ=aI,n.dK=function(s){M0=at.resolveURL(s),mh||(mh=new E0($g(),new Ma)),mh.broadcast("setDracoUrl",M0)},n.dL=lI,n.dM=function(s){ph=at.resolveURL(s),mh||(mh=new E0($g(),new Ma)),mh.broadcast("setMeshoptUrl",ph)},n.dN=ht,n.dO=dl,n.dP=Qo,n.dQ=_I,n.dR=yI,n.dS=bE,n.dT=Gs,n.dU=YE,n.dV=function(s,e,r,l,f,u,p,v,T,D,_=1,E){s.createArrays(),s.tilePixelRatio=ot/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;let S=s.layers[0].layout,w=s.layers[0]._unevaluatedLayout._values,I={};if(I.scaleFactor=_,I.textSizeScaleRange=S.get("text-size-scale-range"),I.iconSizeScaleRange=S.get("icon-size-scale-range"),I.textScaleFactor=zt(I.scaleFactor,I.textSizeScaleRange[0],I.textSizeScaleRange[1]),I.iconScaleFactor=zt(I.scaleFactor,I.iconSizeScaleRange[0],I.iconSizeScaleRange[1]),s.textSizeData.kind==="composite"){let{minZoom:B,maxZoom:V}=s.textSizeData;I.compositeTextSizes=[w["text-size"].possiblyEvaluate(new ar(B),v),w["text-size"].possiblyEvaluate(new ar(V),v)]}if(s.iconSizeData.kind==="composite"){let{minZoom:B,maxZoom:V}=s.iconSizeData;I.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new ar(B),v),w["icon-size"].possiblyEvaluate(new ar(V),v)]}I.layoutTextSize=w["text-size"].possiblyEvaluate(new ar(T+1),v),I.layoutIconSize=w["icon-size"].possiblyEvaluate(new ar(T+1),v),I.textMaxSize=w["text-size"].possiblyEvaluate(new ar(18),v);let M=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",L=S.get("text-size"),k=!1;for(let B of s.features)if(B.icon&&B.icon.nameSecondary){k=!0;break}for(let B of s.features){let V=S.get("text-font").evaluate(B,{},v).join(","),N=L.evaluate(B,{},v)*I.textScaleFactor,G=I.layoutTextSize.evaluate(B,{},v)*I.textScaleFactor,H=(I.layoutIconSize.evaluate(B,{},v),{horizontal:{},vertical:void 0}),J=B.text,oe,ee=[0,0];if(J){let te=J.toString(),de=S.get("text-letter-spacing").evaluate(B,{},v)*qr,ye=S.get("text-line-height").evaluate(B,{},v)*qr,ve=km(te)?de:0,Ee=S.get("text-anchor").evaluate(B,{},v),Me=S.get("text-variable-anchor");if(!Me){let ze=S.get("text-radial-offset").evaluate(B,{},v);ee=ze?tT(Ee,[ze*qr,o0]):S.get("text-offset").evaluate(B,{},v).map(ut=>ut*qr)}let Re=M?"center":S.get("text-justify").evaluate(B,{},v),De=S.get("symbol-placement")==="point",Ue=De?S.get("text-max-width").evaluate(B,{},v)*qr:1/0,Je=ze=>{s.allowVerticalPlacement&&qd(te)&&(H.vertical=t0(J,e,r,f,V,Ue,ye,Ee,ze,ve,ee,no.vertical,!0,G,N))};if(!M&&Me){let ze=Re==="auto"?Me.map(rt=>s0(rt)):[Re],ut=!1;for(let rt=0;rt<ze.length;rt++){let et=ze[rt];if(!H.horizontal[et])if(ut)H.horizontal[et]=H.horizontal[0];else{let Xe=t0(J,e,r,f,V,Ue,ye,"center",et,ve,ee,no.horizontal,!1,G,N);Xe&&(H.horizontal[et]=Xe,ut=Xe.positionedLines.length===1)}}Je("left")}else{if(Re==="auto"&&(Re=s0(Ee)),De||S.get("text-writing-mode").indexOf("horizontal")>=0||!qd(te)){let ze=t0(J,e,r,f,V,Ue,ye,Ee,Re,ve,ee,no.horizontal,!1,G,N);ze&&(H.horizontal[Re]=ze)}Je(De?"left":Re)}}let ne=!1;if(B.icon&&B.icon.namePrimary){let te=l[B.icon.namePrimary];te&&(oe=iO(f[B.icon.namePrimary],B.icon.nameSecondary?f[B.icon.nameSecondary]:void 0,S.get("icon-offset").evaluate(B,{},v),S.get("icon-anchor").evaluate(B,{},v)),ne=te.sdf,s.sdfIcons===void 0?s.sdfIcons=te.sdf:s.sdfIcons!==te.sdf&&ln("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(te.pixelRatio!==s.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}let pe=rT(H.horizontal)||H.vertical;s.iconsInText||(s.iconsInText=!!pe&&pe.iconsInText),(pe||oe)&&hO(s,B,H,oe,l,I,G,0,ee,ne,p,v,D,E,k)}u&&s.generateCollisionDebugBuffers(T,s.collisionBoxArray,I.textScaleFactor)},n.dW=oh,n.dX=Ug,n.dY=Bl,n.dZ=qw,n.d_=kE,n.da=ia,n.db=uf,n.dc=function(s,e,r,l,f){return zt((s-e)/(r-e)*(f-l)+l,l,f)},n.dd=Ou,n.de=le,n.df=class{constructor(s,e,r,l){this.context=s,this.format=l,this.size=r,this.texture=s.gl.createTexture();let[f,u,p]=this.size,{gl:v}=s;v.bindTexture(v.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),v.texImage3D(v.TEXTURE_3D,0,this.format,f,u,p,0,f0(this.format),p0(this.format),e.data)}bind(s,e){let{context:r}=this,{gl:l}=r;l.bindTexture(l.TEXTURE_3D,this.texture),s!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,s),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},n.dg=y0,n.dh=[1,1,1],n.di=dh,n.dj=hh,n.dk=Is,n.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new it(1/0,1/0),max:new it(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){let r=Kw(new it(0,0),new it(ot,ot),s),l=[];if(e&&!$v(r,this._globalClipBounds))return l;for(let f of this._activeRegions){if(f.hiddenByOverlap||!$v(r,f))continue;let u=xP(f.min,f.max,s);l.push({min:u.min,max:u.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return l}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let r=[];for(let l of e.cache.getVisibleCoordinates()){let f=e.cache.getTile(l).buckets[e.layer];f&&f.updateFootprints(l.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){let e=s.getFootprints();if(e.length===0)return;let r=s.getOrder(),l=s.getClipMask(),f=s.getClipScope();for(let u of e){if(!u.footprint)continue;let p=Kw(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:r,clipMask:l,clipScope:f})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||gg(e.min,r.min)||gg(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(l,f){let u=(p,v)=>p+v;return l.length-f.length||l.reduce(u,"").localeCompare(f.reduce(u,""))}(e.clipScope,r.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){let r=this._activeRegions[e],l=this._prevRegions[e];s=r.priority!==l.priority||!Jw(r,l)||r.order!==l.order||r.clipMask!==l.clipMask||!js(r.clipScope,l.clipScope),++e}}if(s){++this._updateTime;for(let r of this._activeRegions)r.order!==mg&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));let e=r=>{let l=this._activeRegions;if(r>=l.length)return r;let f=l[r].priority;for(;r<l.length&&l[r].priority===f;)++r;return r};if(this._sourceIds.length>1){let r=0,l=e(r);for(;r!==l;){let f=r,u=r;for(;f!==l;){let p=this._activeRegions[f];p.hiddenByOverlap=!1;for(let v=0;v<u;v++){let T=this._activeRegions[v];if(!T.hiddenByOverlap&&p.order===mg&&$v(p,T)&&(p.hiddenByOverlap=eE(p.footprint,p.tileId,T.footprint,T.tileId),p.hiddenByOverlap))break}++f}r=l,l=e(r)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},n.dm=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let s of this._poleSegments)s.destroy();for(let s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){let r=new Es,l=new ir,f=[],u=s+1+2,p=e[0]+1,v=e[0]+1+(1+e.length),T=(D,_,E)=>{let S=D===u-1?D-2:D===0?D:D-1;return S+=E?24575:0,[S,_]};for(let D=0;D<u;++D)r.emplaceBack(...T(D,0,!0));for(let D=0;D<p;++D)for(let _=0;_<u;++_)r.emplaceBack(...T(_,D,(_===0||_===u-1)&&!0));for(let D=0;D<e.length;++D){let _=e[D];for(let E=0;E<u;++E)r.emplaceBack(...T(E,_,!0))}for(let D=0;D<e.length;++D){let _=l.length,E=e[D]+1+2,S=new ir;for(let M=0;M<E-1;M++){let L=M===E-2,k=L?u*(v-e.length+D-M):u;for(let B=0;B<u-1;B++){let V=M*u+B;M===0||L||B===0||B===u-2?(S.emplaceBack(V+1,V,V+k),S.emplaceBack(V+k,V+k+1,V+1)):(l.emplaceBack(V+1,V,V+k),l.emplaceBack(V+k,V+k+1,V+1))}}let w=dr.simpleSegment(0,_,r.length,l.length-_);for(let M=0;M<S.uint16.length;M+=3)l.emplaceBack(S.uint16[M],S.uint16[M+1],S.uint16[M+2]);let I=dr.simpleSegment(0,_,r.length,l.length-_);f.push({withoutSkirts:w,withSkirts:I})}return{vertices:r,indices:l,segments:f}}_createGrid(s){let e=this._fillGridMeshWithLods(o,d);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,bo.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){let e=new ir;for(let p=0;p<=o;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);let r=new ia,l=new ia,f=new ia,u=new ia;this._poleSegments=[];for(let p=0,v=0;p<og;p++){let T=360/(1<<p);r.emplaceBack(0,-Hr,0,.5,0),l.emplaceBack(0,-Hr,0,.5,1),f.emplaceBack(0,-Hr,0,.5,.5),u.emplaceBack(0,-Hr,0,.5,.5);for(let D=0;D<=o;D++){let _=D/o,E=0,S=Mt(0,T,_),[w,I,M]=x(XR,YR,S,Hr);r.emplaceBack(w,I,M,_,E),l.emplaceBack(w,I,M,_,1-E);let L=en(S);_=.5+.5*Math.sin(L),E=.5+.5*Math.cos(L),f.emplaceBack(w,I,M,_,E),u.emplaceBack(w,I,M,_,1-E)}this._poleSegments.push(dr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(r,er,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(l,er,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(f,er,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(u,er,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},n.dn=mg,n.dp=ms,n.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.dr=ba,n.ds=he,n.dt=C,n.du=function([s,e,r]){let l=Math.hypot(s,e,r),f=Math.atan2(s,r),u=.5*Math.PI-Math.acos(-e/l);return new R(Fr(f),Fr(u))},n.dv=_0,n.dw=A,n.dx=function(s){let e=s.navigator?s.navigator.userAgent:null;return!!function(r){if(Gl==null){let l=r.navigator?r.navigator.userAgent:null;Gl=!!r.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Gl}(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.dy=function(s,e){Vt=s,Ot=e},n.dz=Pv,n.e=ce,n.e0=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==uI){let r=new Uint32Array(s,0,7),[,,l,f,u,p]=r;e=r.byteLength+f+u+p+u,(l!==s.byteLength||e>=s.byteLength)&&ln("Invalid b3dm header information.")}return pI(s,e)},n.e1=function(s,e){let r=gI(s);for(let l of r){for(let f of l.meshes)EL(f);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(TL(l.lights,e)))}return r},n.e2=jg,n.e3=GT,n.e4=Ci,n.e5=function(s){Kn(),pn?.then(e=>{e.keys().then(r=>{for(let l=0;l<r.length-s;l++)e.delete(r[l])})})},n.f=function(s){return s.indexOf("mapbox:")===0},n.g=function(s,e){return Sa(Jr(s,{method:"GET"}),e)},n.h=be,n.i=function(s){return ce.API_STYLE_REGEX.test(s)&&!fe(s)},n.j=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.k=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},n.l=Jr,n.m=Br,n.n=function(s,e){return Sa(Jr(s,{type:"json"}),e)},n.o=mo,n.p=function(s,e){return Sa(Jr(s,{method:"POST"}),e)},n.q=at,n.r=si,n.s=function(s){try{let e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=Wl,n.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},n.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},n.w=ln,n.x=_s,n.y=2,n.z=XE}),m(["./shared"],function(n){function P(Ne){let Y=Ne?Ne.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function U(Ne){if(typeof Ne=="number"||typeof Ne=="boolean"||typeof Ne=="string"||Ne==null)return JSON.stringify(Ne);if(Array.isArray(Ne)){let K="[";for(let ce of Ne)K+=`${U(ce)},`;return`${K}]`}let Y="{";for(let K of Object.keys(Ne).sort())Y+=`${K}:${U(Ne[K])},`;return`${Y}}`}function $(Ne){let Y="";for(let K of n.bh)Y+=`/${U(Ne[K])}`;return Y}class se{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,K){this._layerConfigs={},this._layers={},this.update(Y,[],K)}update(Y,K,ce){this._options=ce;for(let fe of Y)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=n.cq(fe,this.scope,null,this._options)).compileFilter(ce),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(let fe of K)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};let be=function(fe,Ie){let ke={};for(let Fe=0;Fe<fe.length;Fe++){let Ve=Ie&&Ie[fe[Fe].id]||$(fe[Fe]);Ie&&(Ie[fe[Fe].id]=Ve);let je=ke[Ve];je||(je=ke[Ve]=[]),je.push(fe[Fe])}let Ce=[];for(let Fe in ke)Ce.push(ke[Fe]);return Ce}(n.be(this._layerConfigs),this.keyCache);for(let fe of be){let Ie=fe.map(Qe=>this._layers[Qe.id]),ke=Ie[0];if(ke.visibility==="none")continue;let Ce=ke.source||"",Fe=this.familiesBySource[Ce];Fe||(Fe=this.familiesBySource[Ce]={});let Ve=ke.sourceLayer||"_geojsonTileLayer",je=Fe[Ve];je||(je=Fe[Ve]=[]),je.push(Ie)}}}let Te=1*n.dP;class Pe{constructor(Y){let K={},ce=[];for(let ke in Y){let Ce=Y[ke],Fe=K[ke]={};for(let Ve in Ce.glyphs){let je=Ce.glyphs[+Ve];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;let Qe=je.metrics.localGlyph?Te:1,at={x:0,y:0,w:je.bitmap.width+2*Qe,h:je.bitmap.height+2*Qe};ce.push(at),Fe[Ve]=at}}let{w:be,h:fe}=n.z(ce),Ie=new n.dO({width:be||1,height:fe||1});for(let ke in Y){let Ce=Y[ke];for(let Fe in Ce.glyphs){let Ve=Ce.glyphs[+Fe];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;let je=K[ke][Fe],Qe=Ve.metrics.localGlyph?Te:1;n.dO.copy(Ve.bitmap,Ie,{x:0,y:0},{x:je.x+Qe,y:je.y+Qe},Ve.bitmap)}}this.image=Ie,this.positions=K}}n.dN(Pe,"GlyphAtlas");class Ye{constructor(Y){this.tileID=new n.aA(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=n.aL(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor}parse(Y,K,ce,be,fe){this.status="parsing",this.data=Y,this.collisionBoxArray=new n.aR;let Ie=new n.dQ(Object.keys(Y.layers).sort()),ke=new n.dR(this.tileID,this.promoteId);ke.bucketLayerIDs=[];let Ce={},Fe=new n.dS(256,256),Ve={featureIndex:ke,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Fe,availableImages:ce,brightness:this.brightness},je=K.familiesBySource[this.source];for(let Ot in je){let Cn=Y.layers[Ot];if(!Cn)continue;let pn=!1,Xt=!1,Ln=!1;for(let Br of je[Ot])Br[0].type==="symbol"?pn=!0:Xt=!0,Br[0].is3D()&&Br[0].type!=="model"&&(Ln=!0);if(this.extraShadowCaster&&!Ln||this.isSymbolTile===!0&&!pn||this.isSymbolTile===!1&&!Xt)continue;Cn.version===1&&n.w(`Vector tile source "${this.source}" layer "${Ot}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Kn=Ie.encode(Ot),Or=[];for(let Br=0,Dr=0;Br<Cn.length;Br++){let Vr=Cn.feature(Br),gs=ke.getId(Vr,Ot);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ot)){let po=Vr.properties?Vr.properties.worldview:null;if(this.worldview&&typeof po=="string")if(po==="all")Vr.properties.$localized=!0;else{if(!po.split(",").includes(this.worldview))continue;Vr.properties.$localized=!0,Vr.properties.worldview=this.worldview}}Or.push({feature:Vr,id:gs,index:Dr,sourceLayerIndex:Kn}),Dr++}for(let Br of je[Ot]){let Dr=Br[0];(!this.extraShadowCaster||Dr.is3D()&&Dr.type!=="model")&&(this.isSymbolTile!==void 0&&Dr.type==="symbol"!==this.isSymbolTile||Dr.minzoom&&this.zoom<Math.floor(Dr.minzoom)||Dr.maxzoom&&this.zoom>=Dr.maxzoom||Dr.visibility!=="none"&&(We(Br,this.zoom,Ve.brightness,ce),(Ce[Dr.id]=Dr.createBucket({index:ke.bucketLayerIDs.length,layers:Br,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Or,Ve,this.tileID.canonical,this.tileTransform),ke.bucketLayerIDs.push(Br.map(Vr=>n.av(Vr.id,Vr.scope)))))}}let Qe,at,gt,Pt;Fe.trim();let Bt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Vt=()=>{if(Qe)return this.status="done",fe(Qe);if(this.extraShadowCaster)this.status="done",fe(null,{buckets:n.be(Ce).filter(Ot=>!Ot.isEmpty()),featureIndex:ke,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ve.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(at&&gt&&Pt){let Ot=new Pe(at),Cn=new n.dU(gt,Pt,this.lut);for(let pn in Ce){let Xt=Ce[pn];Xt instanceof n.aS?(We(Xt.layers,this.zoom,Ve.brightness,ce),n.dV(Xt,at,Ot.positions,gt,Cn.iconPositions,this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.brightness)):Xt.hasPattern&&(Xt instanceof n.aY||Xt instanceof n.aZ||Xt instanceof n.d0)&&(We(Xt.layers,this.zoom,Ve.brightness,ce),Xt.addFeatures(Ve,this.tileID.canonical,Cn.patternPositions,ce,this.tileTransform,this.brightness))}this.status="done",fe(null,{buckets:n.be(Ce).filter(pn=>!pn.isEmpty()),featureIndex:ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ot.image,lineAtlas:Fe,imageAtlas:Cn,brightness:Ve.brightness})}};if(!this.extraShadowCaster){let Ot=n.dT(Ve.glyphDependencies,Xt=>Object.keys(Xt).map(Number));Object.keys(Ot).length?be.send("getGlyphs",{uid:this.uid,stacks:Ot,scope:this.scope},(Xt,Ln)=>{Qe||(Qe=Xt,at=Ln,Vt())},void 0,!1,Bt):at={};let Cn=Object.keys(Ve.iconDependencies);Cn.length?be.send("getImages",{icons:Cn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Xt,Ln)=>{Qe||(Qe=Xt,gt=Ln,Vt())},void 0,!1,Bt):gt={};let pn=Object.keys(Ve.patternDependencies);pn.length?be.send("getImages",{icons:pn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Xt,Ln)=>{Qe||(Qe=Xt,Pt=Ln,Vt())},void 0,!1,Bt):Pt={}}Vt()}}function We(Ne,Y,K,ce){let be=new n.a3(Y,{brightness:K});for(let fe of Ne)fe.recalculate(be,ce)}class pt extends n.E{constructor(Y,K,ce,be,fe,Ie){super(),this.actor=Y,this.layerIndex=K,this.availableImages=ce,this.loadVectorData=fe||n.aw,this.loading={},this.loaded={},this.deduped=new n.au(Y.scheduler),this.isSpriteLoaded=be,this.scheduler=Y.scheduler,this.brightness=Ie}loadTile(Y,K){let ce=Y.uid,be=Y&&Y.request,fe=be&&be.collectResourceTiming,Ie=this.loading[ce]=new Ye(Y);Ie.abort=this.loadVectorData(Y,(ke,Ce)=>{let Fe=!this.loading[ce];if(delete this.loading[ce],Fe||ke||!Ce)return Ie.status="done",Fe||(this.loaded[ce]=Ie),K(ke);let Ve=Ce.rawData,je={};Ce.expires&&(je.expires=Ce.expires),Ce.cacheControl&&(je.cacheControl=Ce.cacheControl),Ie.vectorTile=Ce.vectorTile||new n.dW.VectorTile(new n.bc(Ve));let Qe=()=>{Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,(at,gt)=>{if(at||!gt)return K(at);let Pt={};if(fe){let Bt=P(be);Bt.length>0&&(Pt.resourceTiming=JSON.parse(JSON.stringify(Bt)))}K(null,n.l({rawTileData:Ve.slice(0)},gt,je,Pt))})};this.isSpriteLoaded?Qe():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Qe,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):Qe()}),this.loaded=this.loaded||{},this.loaded[ce]=Ie})}reloadTile(Y,K){let ce=this.loaded,be=Y.uid;if(ce&&ce[be]){let fe=ce[be];fe.scaleFactor=Y.scaleFactor,fe.showCollisionBoxes=Y.showCollisionBoxes,fe.projection=Y.projection,fe.brightness=Y.brightness,fe.tileTransform=n.aL(Y.tileID.canonical,Y.projection),fe.extraShadowCaster=Y.extraShadowCaster,fe.lut=Y.lut;let Ie=(ke,Ce)=>{let Fe=fe.reloadCallback;Fe&&(delete fe.reloadCallback,fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,Fe)),K(ke,Ce)};fe.status==="parsing"?fe.reloadCallback=Ie:fe.status==="done"&&(fe.vectorTile?fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,Ie):Ie())}else K(null,void 0)}abortTile(Y,K){let ce=Y.uid,be=this.loading[ce];be&&(be.abort&&be.abort(),delete this.loading[ce]),K()}removeTile(Y,K){let ce=this.loaded,be=Y.uid;ce&&ce[be]&&delete ce[be],K()}}class _t{loadTile(Y,K){let{uid:ce,encoding:be,rawImageData:fe,padding:Ie}=Y,ke=ImageBitmap&&fe instanceof ImageBitmap?this.getImageData(fe,Ie):fe;K(null,new n.dX(ce,ke,be,Ie<1))}getImageData(Y,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);let ce=this.offscreenCanvasContext.getImageData(-K,-K,Y.width+2*K,Y.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}n.bb.setPbf(n.bc);class on{decodeRasterArray({task:Y,buffer:K},ce){n.bb.performDecoding(K,Y).then(be=>{ce(null,be)},be=>{ce(be)})}}let an=n.dW.VectorTileFeature.prototype.toGeoJSON;class Ft{constructor(Y){this._feature=Y,this.extent=n.ab,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){let Y=[];for(let K of this._feature.geometry)Y.push([new n.P(K[0],K[1])]);return Y}{let Y=[];for(let K of this._feature.geometry){let ce=[];for(let be of K)ce.push(new n.P(be[0],be[1]));Y.push(ce)}return Y}}toGeoJSON(Y,K,ce){return an.call(this,Y,K,ce)}}class mr{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.ab,this.length=Y.length,this._features=Y}feature(Y){return new Ft(this._features[Y])}}let Dn=64/4096,St=128;class xn{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],K){for(let ce of Y){let be=ce.id;if(be==null)continue;let fe=this.features.get(be);fe&&this.updateCache(fe,K),ce.geometry?(fe=Ct(ce),this.updateCache(fe,K),this.features.set(be,fe)):this.features.delete(be),this.updateCache(fe,K)}}updateCache(Y,K){for(let{canonical:ce,uid:be}of Object.values(K)){let{z:fe,x:Ie,y:ke}=ce;xr(Y,Math.pow(2,fe),Ie,ke)&&delete K[be]}}getTile(Y,K,ce){let be=Math.pow(2,Y),fe=[];for(let Ie of this.features.values())xr(Ie,be,K,ce)&&fe.push(ou(Ie,be,K,ce));return{features:fe}}getFeatures(){return[...this.features.values()]}}function xr({minX:Ne,minY:Y,maxX:K,maxY:ce},be,fe,Ie){return Ne<(fe+1+Dn)/be&&Y<(Ie+1+Dn)/be&&K>(fe-Dn)/be&&ce>(Ie-Dn)/be}function Ct(Ne){let{id:Y,geometry:K,properties:ce}=Ne;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:be,coordinates:fe}=K,Ie={id:Y,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ke=Ie.geometry;if(be==="Point")Rt(fe,ke,Ie);else if(be==="MultiPoint")for(let Ce of fe)Rt(Ce,ke,Ie);else if(be==="LineString")Ie.type=2,zs(fe,ke,Ie);else if(be==="MultiLineString")Ie.type=2,fs(fe,ke,Ie);else if(be==="Polygon")Ie.type=3,fs(fe,ke,Ie,!0);else{if(be!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ie.type=3;for(let Ce of fe)fs(Ce,ke,Ie,!0)}return Ie}function Rt([Ne,Y],K,ce){let be=n.am(Ne),fe=n.at(Y);fe=fe<0?0:fe>1?1:fe,K.push(be,fe),ce.minX=Math.min(ce.minX,be),ce.minY=Math.min(ce.minY,fe),ce.maxX=Math.max(ce.maxX,be),ce.maxY=Math.max(ce.maxY,fe)}function zs(Ne,Y,K,ce=!1,be=!1){let fe=[];for(let Ie of Ne)Rt(Ie,fe,K);Y.push(fe),ce&&function(Ie,ke){let Ce=0;for(let Fe=0,Ve=Ie.length,je=Ve-2;Fe<Ve;je=Fe,Fe+=2)Ce+=(Ie[Fe]-Ie[je])*(Ie[Fe+1]+Ie[je+1]);if(Ce>0===ke)for(let Fe=0,Ve=Ie.length;Fe<Ve/2;Fe+=2){let je=Ie[Fe],Qe=Ie[Fe+1];Ie[Fe]=Ie[Ve-2-Fe],Ie[Fe+1]=Ie[Ve-1-Fe],Ie[Ve-2-Fe]=je,Ie[Ve-1-Fe]=Qe}}(fe,be)}function fs(Ne,Y,K,ce=!1){for(let be=0;be<Ne.length;be++)zs(Ne[be],Y,K,ce,be===0)}function ou(Ne,Y,K,ce){let{id:be,type:fe,geometry:Ie,tags:ke}=Ne,Ce=[];if(fe===1)(function(Fe,Ve,je,Qe,at){for(let gt=0;gt<Fe.length;gt+=2){let Pt=Math.round(n.ab*(Fe[gt+0]*Ve-je)),Bt=Math.round(n.ab*(Fe[gt+1]*Ve-Qe));at.push([Pt,Bt])}})(Ie,Y,K,ce,Ce);else for(let Fe of Ie)Zt(Fe,Y,K,ce,Ce);return{id:be,type:fe,geometry:Ce,tags:ke}}function Zt(Ne,Y,K,ce,be){let fe=-St,Ie=n.ab+St,ke;for(let Ce=0;Ce<Ne.length-2;Ce+=2){let Fe=Math.round(n.ab*(Ne[Ce+0]*Y-K)),Ve=Math.round(n.ab*(Ne[Ce+1]*Y-ce)),je=Math.round(n.ab*(Ne[Ce+2]*Y-K)),Qe=Math.round(n.ab*(Ne[Ce+3]*Y-ce)),at=je-Fe,gt=Qe-Ve;Fe<fe&&je<fe||(Fe<fe?(Ve+=Math.round(gt*((fe-Fe)/at)),Fe=fe):je<fe&&(Qe=Ve+Math.round(gt*((fe-Fe)/at)),je=fe),Ve<fe&&Qe<fe||(Ve<fe?(Fe+=Math.round(at*((fe-Ve)/gt)),Ve=fe):Qe<fe&&(je=Fe+Math.round(at*((fe-Ve)/gt)),Qe=fe),Fe>=Ie&&je>=Ie||(Fe>=Ie?(Ve+=Math.round(gt*((Ie-Fe)/at)),Fe=Ie):je>=Ie&&(Qe=Ve+Math.round(gt*((Ie-Fe)/at)),je=Ie),Ve>=Ie&&Qe>=Ie||(Ve>=Ie?(Fe+=Math.round(at*((Ie-Ve)/gt)),Ve=Ie):Qe>=Ie&&(je=Fe+Math.round(at*((Ie-Ve)/gt)),Qe=Ie),ke&&Fe===ke[ke.length-1][0]&&Ve===ke[ke.length-1][1]||(ke=[[Fe,Ve]],be.push(ke)),ke.push([je,Qe])))))}}var ti,ko,ya,qt={exports:{}},Bs=function(){if(ya)return qt.exports;ya=1;var Ne=n.d_(),Y=function(){if(ko)return ti;ko=1;var Ve=n.dY(),je=n.dZ().VectorTileFeature;function Qe(gt,Pt){this.options=Pt||{},this.features=gt,this.length=gt.length}function at(gt,Pt){this.id=typeof gt.id=="number"?gt.id:void 0,this.type=gt.type,this.rawGeometry=gt.type===1?[gt.geometry]:gt.geometry,this.properties=gt.tags,this.extent=Pt||4096}return ti=Qe,Qe.prototype.feature=function(gt){return new at(this.features[gt],this.options.extent)},at.prototype.loadGeometry=function(){var gt=this.rawGeometry;this.geometry=[];for(var Pt=0;Pt<gt.length;Pt++){for(var Bt=gt[Pt],Vt=[],Ot=0;Ot<Bt.length;Ot++)Vt.push(new Ve(Bt[Ot][0],Bt[Ot][1]));this.geometry.push(Vt)}return this.geometry},at.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var gt=this.geometry,Pt=1/0,Bt=-1/0,Vt=1/0,Ot=-1/0,Cn=0;Cn<gt.length;Cn++)for(var pn=gt[Cn],Xt=0;Xt<pn.length;Xt++){var Ln=pn[Xt];Pt=Math.min(Pt,Ln.x),Bt=Math.max(Bt,Ln.x),Vt=Math.min(Vt,Ln.y),Ot=Math.max(Ot,Ln.y)}return[Pt,Vt,Bt,Ot]},at.prototype.toGeoJSON=je.prototype.toGeoJSON,ti}();function K(Ve){var je=new Ne;return function(Qe,at){for(var gt in Qe.layers)at.writeMessage(3,ce,Qe.layers[gt])}(Ve,je),je.finish()}function ce(Ve,je){var Qe;je.writeVarintField(15,Ve.version||1),je.writeStringField(1,Ve.name||""),je.writeVarintField(5,Ve.extent||4096);var at={keys:[],values:[],keycache:{},valuecache:{}};for(Qe=0;Qe<Ve.length;Qe++)at.feature=Ve.feature(Qe),je.writeMessage(2,be,at);var gt=at.keys;for(Qe=0;Qe<gt.length;Qe++)je.writeStringField(3,gt[Qe]);var Pt=at.values;for(Qe=0;Qe<Pt.length;Qe++)je.writeMessage(4,Fe,Pt[Qe])}function be(Ve,je){var Qe=Ve.feature;Qe.id!==void 0&&je.writeVarintField(1,Qe.id),je.writeMessage(2,fe,Ve),je.writeVarintField(3,Qe.type),je.writeMessage(4,Ce,Qe)}function fe(Ve,je){var Qe=Ve.feature,at=Ve.keys,gt=Ve.values,Pt=Ve.keycache,Bt=Ve.valuecache;for(var Vt in Qe.properties){var Ot=Qe.properties[Vt],Cn=Pt[Vt];if(Ot!==null){Cn===void 0&&(at.push(Vt),Pt[Vt]=Cn=at.length-1),je.writeVarint(Cn);var pn=typeof Ot;pn!=="string"&&pn!=="boolean"&&pn!=="number"&&(Ot=JSON.stringify(Ot));var Xt=pn+":"+Ot,Ln=Bt[Xt];Ln===void 0&&(gt.push(Ot),Bt[Xt]=Ln=gt.length-1),je.writeVarint(Ln)}}}function Ie(Ve,je){return(je<<3)+(7&Ve)}function ke(Ve){return Ve<<1^Ve>>31}function Ce(Ve,je){for(var Qe=Ve.loadGeometry(),at=Ve.type,gt=0,Pt=0,Bt=Qe.length,Vt=0;Vt<Bt;Vt++){var Ot=Qe[Vt],Cn=1;at===1&&(Cn=Ot.length),je.writeVarint(Ie(1,Cn));for(var pn=at===3?Ot.length-1:Ot.length,Xt=0;Xt<pn;Xt++){Xt===1&&at!==1&&je.writeVarint(Ie(2,pn-1));var Ln=Ot[Xt].x-gt,Kn=Ot[Xt].y-Pt;je.writeVarint(ke(Ln)),je.writeVarint(ke(Kn)),gt+=Ln,Pt+=Kn}at===3&&je.writeVarint(Ie(7,1))}}function Fe(Ve,je){var Qe=typeof Ve;Qe==="string"?je.writeStringField(1,Ve):Qe==="boolean"?je.writeBooleanField(7,Ve):Qe==="number"&&(Ve%1!=0?je.writeDoubleField(3,Ve):Ve<0?je.writeSVarintField(6,Ve):je.writeVarintField(5,Ve))}return qt.exports=K,qt.exports.fromVectorTileJs=K,qt.exports.fromGeojsonVt=function(Ve,je){je=je||{};var Qe={};for(var at in Ve)Qe[at]=new Y(Ve[at].features,je),Qe[at].name=at,Qe[at].version=je.version,Qe[at].extent=je.extent;return K({layers:Qe})},qt.exports.GeoJSONWrapper=Y,qt.exports}(),Fl=n.d$(Bs);let va={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ne=>Ne},Gt=Math.fround||(Nl=new Float32Array(1),Ne=>(Nl[0]=+Ne,Nl[0]));var Nl;let Hi=3,Li=5,xa=6;class zl{constructor(Y){this.options=Object.assign(Object.create(va),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){let{log:K,minZoom:ce,maxZoom:be}=this.options;K&&console.time("total time");let fe=`prepare ${Y.length} points`;K&&console.time(fe),this.points=Y;let Ie=[];for(let Ce=0;Ce<Y.length;Ce++){let Fe=Y[Ce];if(!Fe.geometry)continue;let[Ve,je]=Fe.geometry.coordinates,Qe=Gt(Fo(Ve)),at=Gt(ps(je));Ie.push(Qe,at,1/0,Ce,-1,1),this.options.reduce&&Ie.push(0)}let ke=this.trees[be+1]=this._createTree(Ie);K&&console.timeEnd(fe);for(let Ce=be;Ce>=ce;Ce--){let Fe=+Date.now();ke=this.trees[Ce]=this._createTree(this._cluster(ke,Ce)),K&&console.log("z%d: %d clusters in %dms",Ce,ke.numItems,+Date.now()-Fe)}return K&&console.timeEnd("total time"),this}getClusters(Y,K){let ce=((Y[0]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,Y[1])),fe=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,Ie=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ce=-180,fe=180;else if(ce>fe){let je=this.getClusters([ce,be,180,Ie],K),Qe=this.getClusters([-180,be,fe,Ie],K);return je.concat(Qe)}let ke=this.trees[this._limitZoom(K)],Ce=ke.range(Fo(ce),ps(Ie),Fo(fe),ps(be)),Fe=ke.data,Ve=[];for(let je of Ce){let Qe=this.stride*je;Ve.push(Fe[Qe+Li]>1?Vs(Fe,Qe,this.clusterProps):this.points[Fe[Qe+Hi]])}return Ve}getChildren(Y){let K=this._getOriginId(Y),ce=this._getOriginZoom(Y),be="No cluster with the specified id.",fe=this.trees[ce];if(!fe)throw new Error(be);let Ie=fe.data;if(K*this.stride>=Ie.length)throw new Error(be);let ke=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Ce=fe.within(Ie[K*this.stride],Ie[K*this.stride+1],ke),Fe=[];for(let Ve of Ce){let je=Ve*this.stride;Ie[je+4]===Y&&Fe.push(Ie[je+Li]>1?Vs(Ie,je,this.clusterProps):this.points[Ie[je+Hi]])}if(Fe.length===0)throw new Error(be);return Fe}getLeaves(Y,K,ce){let be=[];return this._appendLeaves(be,Y,K=K||10,ce=ce||0,0),be}getTile(Y,K,ce){let be=this.trees[this._limitZoom(Y)],fe=Math.pow(2,Y),{extent:Ie,radius:ke}=this.options,Ce=ke/Ie,Fe=(ce-Ce)/fe,Ve=(ce+1+Ce)/fe,je={features:[]};return this._addTileFeatures(be.range((K-Ce)/fe,Fe,(K+1+Ce)/fe,Ve),be.data,K,ce,fe,je),K===0&&this._addTileFeatures(be.range(1-Ce/fe,Fe,1,Ve),be.data,fe,ce,fe,je),K===fe-1&&this._addTileFeatures(be.range(0,Fe,Ce/fe,Ve),be.data,-1,ce,fe,je),je.features.length?je:null}getClusterExpansionZoom(Y){let K=this._getOriginZoom(Y)-1;for(;K<=this.options.maxZoom;){let ce=this.getChildren(Y);if(K++,ce.length!==1)break;Y=ce[0].properties.cluster_id}return K}_appendLeaves(Y,K,ce,be,fe){let Ie=this.getChildren(K);for(let ke of Ie){let Ce=ke.properties;if(Ce&&Ce.cluster?fe+Ce.point_count<=be?fe+=Ce.point_count:fe=this._appendLeaves(Y,Ce.cluster_id,ce,be,fe):fe<be?fe++:Y.push(ke),Y.length===ce)break}return fe}_createTree(Y){let K=new n.bz(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<Y.length;ce+=this.stride)K.add(Y[ce],Y[ce+1]);return K.finish(),K.data=Y,K}_addTileFeatures(Y,K,ce,be,fe,Ie){for(let ke of Y){let Ce=ke*this.stride,Fe=K[Ce+Li]>1,Ve,je,Qe;if(Fe)Ve=we(K,Ce,this.clusterProps),je=K[Ce],Qe=K[Ce+1];else{let Pt=this.points[K[Ce+Hi]];Ve=Pt.properties;let[Bt,Vt]=Pt.geometry.coordinates;je=Fo(Bt),Qe=ps(Vt)}let at={type:1,geometry:[[Math.round(this.options.extent*(je*fe-ce)),Math.round(this.options.extent*(Qe*fe-be))]],tags:Ve},gt;gt=Fe||this.options.generateId?K[Ce+Hi]:this.points[K[Ce+Hi]].id,gt!==void 0&&(at.id=gt),Ie.features.push(at)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,K){let{radius:ce,extent:be,reduce:fe,minPoints:Ie}=this.options,ke=ce/(be*Math.pow(2,K)),Ce=Y.data,Fe=[],Ve=this.stride;for(let je=0;je<Ce.length;je+=Ve){if(Ce[je+2]<=K)continue;Ce[je+2]=K;let Qe=Ce[je],at=Ce[je+1],gt=Y.within(Ce[je],Ce[je+1],ke),Pt=Ce[je+Li],Bt=Pt;for(let Vt of gt){let Ot=Vt*Ve;Ce[Ot+2]>K&&(Bt+=Ce[Ot+Li])}if(Bt>Pt&&Bt>=Ie){let Vt,Ot=Qe*Pt,Cn=at*Pt,pn=-1,Xt=(je/Ve<<5)+(K+1)+this.points.length;for(let Ln of gt){let Kn=Ln*Ve;if(Ce[Kn+2]<=K)continue;Ce[Kn+2]=K;let Or=Ce[Kn+Li];Ot+=Ce[Kn]*Or,Cn+=Ce[Kn+1]*Or,Ce[Kn+4]=Xt,fe&&(Vt||(Vt=this._map(Ce,je,!0),pn=this.clusterProps.length,this.clusterProps.push(Vt)),fe(Vt,this._map(Ce,Kn)))}Ce[je+4]=Xt,Fe.push(Ot/Bt,Cn/Bt,1/0,Xt,-1,Bt),fe&&Fe.push(pn)}else{for(let Vt=0;Vt<Ve;Vt++)Fe.push(Ce[je+Vt]);if(Bt>1)for(let Vt of gt){let Ot=Vt*Ve;if(!(Ce[Ot+2]<=K)){Ce[Ot+2]=K;for(let Cn=0;Cn<Ve;Cn++)Fe.push(Ce[Ot+Cn])}}}}return Fe}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,K,ce){if(Y[K+Li]>1){let Ie=this.clusterProps[Y[K+xa]];return ce?Object.assign({},Ie):Ie}let be=this.points[Y[K+Hi]].properties,fe=this.options.map(be);return ce&&fe===be?Object.assign({},fe):fe}}function Vs(Ne,Y,K){return{type:"Feature",id:Ne[Y+Hi],properties:we(Ne,Y,K),geometry:{type:"Point",coordinates:[(ce=Ne[Y],360*(ce-.5)),Bl(Ne[Y+1])]}};var ce}function we(Ne,Y,K){let ce=Ne[Y+Li],be=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,fe=Ne[Y+xa],Ie=fe===-1?{}:Object.assign({},K[fe]);return Object.assign(Ie,{cluster:!0,cluster_id:Ne[Y+Hi],point_count:ce,point_count_abbreviated:be})}function Fo(Ne){return Ne/360+.5}function ps(Ne){let Y=Math.sin(Ne*Math.PI/180),K=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return K<0?0:K>1?1:K}function Bl(Ne){let Y=(180-360*Ne)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function it(Ne,Y,K,ce){let be=ce,fe=Y+(K-Y>>1),Ie,ke=K-Y,Ce=Ne[Y],Fe=Ne[Y+1],Ve=Ne[K],je=Ne[K+1];for(let Qe=Y+3;Qe<K;Qe+=3){let at=js(Ne[Qe],Ne[Qe+1],Ce,Fe,Ve,je);if(at>be)Ie=Qe,be=at;else if(at===be){let gt=Math.abs(Qe-fe);gt<ke&&(Ie=Qe,ke=gt)}}be>ce&&(Ie-Y>3&&it(Ne,Y,Ie,ce),Ne[Ie+2]=be,K-Ie>3&&it(Ne,Ie,K,ce))}function js(Ne,Y,K,ce,be,fe){let Ie=be-K,ke=fe-ce;if(Ie!==0||ke!==0){let Ce=((Ne-K)*Ie+(Y-ce)*ke)/(Ie*Ie+ke*ke);Ce>1?(K=be,ce=fe):Ce>0&&(K+=Ie*Ce,ce+=ke*Ce)}return Ie=Ne-K,ke=Y-ce,Ie*Ie+ke*ke}function zr(Ne,Y,K,ce){let be={id:Ne??null,type:Y,geometry:K,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")No(be,K);else if(Y==="Polygon")No(be,K[0]);else if(Y==="MultiLineString")for(let fe of K)No(be,fe);else if(Y==="MultiPolygon")for(let fe of K)No(be,fe[0]);return be}function No(Ne,Y){for(let K=0;K<Y.length;K+=3)Ne.minX=Math.min(Ne.minX,Y[K]),Ne.minY=Math.min(Ne.minY,Y[K+1]),Ne.maxX=Math.max(Ne.maxX,Y[K]),Ne.maxY=Math.max(Ne.maxY,Y[K+1])}function en(Ne,Y,K,ce){if(!Y.geometry)return;let be=Y.geometry.coordinates;if(be&&be.length===0)return;let fe=Y.geometry.type,Ie=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),ke=[],Ce=Y.id;if(K.promoteId?Ce=Y.properties[K.promoteId]:K.generateId&&(Ce=ce||0),fe==="Point")Fr(be,ke);else if(fe==="MultiPoint")for(let Fe of be)Fr(Fe,ke);else if(fe==="LineString")qi(be,ke,Ie,!1);else if(fe==="MultiLineString"){if(K.lineMetrics){for(let Fe of be)ke=[],qi(Fe,ke,Ie,!1),Ne.push(zr(Ce,"LineString",ke,Y.properties));return}Us(be,ke,Ie,!1)}else if(fe==="Polygon")Us(be,ke,Ie,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(let Fe of Y.geometry.geometries)en(Ne,{id:Ce,geometry:Fe,properties:Y.properties},K,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Fe of be){let Ve=[];Us(Fe,Ve,Ie,!0),ke.push(Ve)}}Ne.push(zr(Ce,fe,ke,Y.properties))}function Fr(Ne,Y){Y.push(ms(Ne[0]),ba(Ne[1]),0)}function qi(Ne,Y,K,ce){let be,fe,Ie=0;for(let Ce=0;Ce<Ne.length;Ce++){let Fe=ms(Ne[Ce][0]),Ve=ba(Ne[Ce][1]);Y.push(Fe,Ve,0),Ce>0&&(Ie+=ce?(be*Ve-Fe*fe)/2:Math.sqrt(Math.pow(Fe-be,2)+Math.pow(Ve-fe,2))),be=Fe,fe=Ve}let ke=Y.length-3;Y[2]=1,it(Y,0,ke,K),Y[ke+2]=1,Y.size=Math.abs(Ie),Y.start=0,Y.end=Y.size}function Us(Ne,Y,K,ce){for(let be=0;be<Ne.length;be++){let fe=[];qi(Ne[be],fe,K,ce),Y.push(fe)}}function ms(Ne){return Ne/360+.5}function ba(Ne){let Y=Math.sin(Ne*Math.PI/180),K=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return K<0?0:K>1?1:K}function zt(Ne,Y,K,ce,be,fe,Ie,ke){if(ce/=Y,fe>=(K/=Y)&&Ie<ce)return Ne;if(Ie<K||fe>=ce)return null;let Ce=[];for(let Fe of Ne){let Ve=Fe.geometry,je=Fe.type,Qe=be===0?Fe.minX:Fe.minY,at=be===0?Fe.maxX:Fe.maxY;if(Qe>=K&&at<ce){Ce.push(Fe);continue}if(at<K||Qe>=ce)continue;let gt=[];if(je==="Point"||je==="MultiPoint")wa(Ve,gt,K,ce,be);else if(je==="LineString")zo(Ve,gt,K,ce,be,!1,ke.lineMetrics);else if(je==="MultiLineString")Jr(Ve,gt,K,ce,be,!1);else if(je==="Polygon")Jr(Ve,gt,K,ce,be,!0);else if(je==="MultiPolygon")for(let Pt of Ve){let Bt=[];Jr(Pt,Bt,K,ce,be,!0),Bt.length&&gt.push(Bt)}if(gt.length){if(ke.lineMetrics&&je==="LineString"){for(let Pt of gt)Ce.push(zr(Fe.id,je,Pt,Fe.tags));continue}je!=="LineString"&&je!=="MultiLineString"||(gt.length===1?(je="LineString",gt=gt[0]):je="MultiLineString"),je!=="Point"&&je!=="MultiPoint"||(je=gt.length===3?"Point":"MultiPoint"),Ce.push(zr(Fe.id,je,gt,Fe.tags))}}return Ce.length?Ce:null}function wa(Ne,Y,K,ce,be){for(let fe=0;fe<Ne.length;fe+=3){let Ie=Ne[fe+be];Ie>=K&&Ie<=ce&&xi(Y,Ne[fe],Ne[fe+1],Ne[fe+2])}}function zo(Ne,Y,K,ce,be,fe,Ie){let ke=$s(Ne),Ce=be===0?Vl:jl,Fe,Ve,je=Ne.start;for(let Bt=0;Bt<Ne.length-3;Bt+=3){let Vt=Ne[Bt],Ot=Ne[Bt+1],Cn=Ne[Bt+2],pn=Ne[Bt+3],Xt=Ne[Bt+4],Ln=be===0?Vt:Ot,Kn=be===0?pn:Xt,Or=!1;Ie&&(Fe=Math.sqrt(Math.pow(Vt-pn,2)+Math.pow(Ot-Xt,2))),Ln<K?Kn>K&&(Ve=Ce(ke,Vt,Ot,pn,Xt,K),Ie&&(ke.start=je+Fe*Ve)):Ln>ce?Kn<ce&&(Ve=Ce(ke,Vt,Ot,pn,Xt,ce),Ie&&(ke.start=je+Fe*Ve)):xi(ke,Vt,Ot,Cn),Kn<K&&Ln>=K&&(Ve=Ce(ke,Vt,Ot,pn,Xt,K),Or=!0),Kn>ce&&Ln<=ce&&(Ve=Ce(ke,Vt,Ot,pn,Xt,ce),Or=!0),!fe&&Or&&(Ie&&(ke.end=je+Fe*Ve),Y.push(ke),ke=$s(Ne)),Ie&&(je+=Fe)}let Qe=Ne.length-3,at=Ne[Qe],gt=Ne[Qe+1],Pt=be===0?at:gt;Pt>=K&&Pt<=ce&&xi(ke,at,gt,Ne[Qe+2]),Qe=ke.length-3,fe&&Qe>=3&&(ke[Qe]!==ke[0]||ke[Qe+1]!==ke[1])&&xi(ke,ke[0],ke[1],ke[2]),ke.length&&Y.push(ke)}function $s(Ne){let Y=[];return Y.size=Ne.size,Y.start=Ne.start,Y.end=Ne.end,Y}function Jr(Ne,Y,K,ce,be,fe){for(let Ie of Ne)zo(Ie,Y,K,ce,be,fe,!1)}function xi(Ne,Y,K,ce){Ne.push(Y,K,ce)}function Vl(Ne,Y,K,ce,be,fe){let Ie=(fe-Y)/(ce-Y);return xi(Ne,fe,K+(be-K)*Ie,1),Ie}function jl(Ne,Y,K,ce,be,fe){let Ie=(fe-K)/(be-K);return xi(Ne,Y+(ce-Y)*Ie,fe,1),Ie}function Ea(Ne,Y){let K=[];for(let ce=0;ce<Ne.length;ce++){let be=Ne[ce],fe=be.type,Ie;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")Ie=Bo(be.geometry,Y);else if(fe==="MultiLineString"||fe==="Polygon"){Ie=[];for(let ke of be.geometry)Ie.push(Bo(ke,Y))}else if(fe==="MultiPolygon"){Ie=[];for(let ke of be.geometry){let Ce=[];for(let Fe of ke)Ce.push(Bo(Fe,Y));Ie.push(Ce)}}K.push(zr(be.id,fe,Ie,be.tags))}return K}function Bo(Ne,Y){let K=[];K.size=Ne.size,Ne.start!==void 0&&(K.start=Ne.start,K.end=Ne.end);for(let ce=0;ce<Ne.length;ce+=3)K.push(Ne[ce]+Y,Ne[ce+1],Ne[ce+2]);return K}function Gs(Ne,Y){if(Ne.transformed)return Ne;let K=1<<Ne.z,ce=Ne.x,be=Ne.y;for(let fe of Ne.features){let Ie=fe.geometry,ke=fe.type;if(fe.geometry=[],ke===1)for(let Ce=0;Ce<Ie.length;Ce+=2)fe.geometry.push(Ta(Ie[Ce],Ie[Ce+1],Y,K,ce,be));else for(let Ce=0;Ce<Ie.length;Ce++){let Fe=[];for(let Ve=0;Ve<Ie[Ce].length;Ve+=2)Fe.push(Ta(Ie[Ce][Ve],Ie[Ce][Ve+1],Y,K,ce,be));fe.geometry.push(Fe)}}return Ne.transformed=!0,Ne}function Ta(Ne,Y,K,ce,be,fe){return[Math.round(K*(Ne*ce-be)),Math.round(K*(Y*ce-fe))]}function ki(Ne,Y,K,ce,be){let fe=Y===be.maxZoom?0:be.tolerance/((1<<Y)*be.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:Ne.length,source:null,x:K,y:ce,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let ke of Ne)Ul(Ie,ke,fe,be);return Ie}function Ul(Ne,Y,K,ce){let be=Y.geometry,fe=Y.type,Ie=[];if(Ne.minX=Math.min(Ne.minX,Y.minX),Ne.minY=Math.min(Ne.minY,Y.minY),Ne.maxX=Math.max(Ne.maxX,Y.maxX),Ne.maxY=Math.max(Ne.maxY,Y.maxY),fe==="Point"||fe==="MultiPoint")for(let ke=0;ke<be.length;ke+=3)Ie.push(be[ke],be[ke+1]),Ne.numPoints++,Ne.numSimplified++;else if(fe==="LineString")ln(Ie,be,Ne,K,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let ke=0;ke<be.length;ke++)ln(Ie,be[ke],Ne,K,fe==="Polygon",ke===0);else if(fe==="MultiPolygon")for(let ke=0;ke<be.length;ke++){let Ce=be[ke];for(let Fe=0;Fe<Ce.length;Fe++)ln(Ie,Ce[Fe],Ne,K,!0,Fe===0)}if(Ie.length){let ke=Y.tags||null;if(fe==="LineString"&&ce.lineMetrics){ke={};for(let Fe in Y.tags)ke[Fe]=Y.tags[Fe];ke.mapbox_clip_start=be.start/be.size,ke.mapbox_clip_end=be.end/be.size}let Ce={geometry:Ie,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:ke};Y.id!==null&&(Ce.id=Y.id),Ne.features.push(Ce)}}function ln(Ne,Y,K,ce,be,fe){let Ie=ce*ce;if(ce>0&&Y.size<(be?Ie:ce))return void(K.numPoints+=Y.length/3);let ke=[];for(let Ce=0;Ce<Y.length;Ce+=3)(ce===0||Y[Ce+2]>Ie)&&(K.numSimplified++,ke.push(Y[Ce],Y[Ce+1])),K.numPoints++;be&&function(Ce,Fe){let Ve=0;for(let je=0,Qe=Ce.length,at=Qe-2;je<Qe;at=je,je+=2)Ve+=(Ce[je]-Ce[at])*(Ce[je+1]+Ce[at+1]);if(Ve>0===Fe)for(let je=0,Qe=Ce.length;je<Qe/2;je+=2){let at=Ce[je],gt=Ce[je+1];Ce[je]=Ce[Qe-2-je],Ce[je+1]=Ce[Qe-1-je],Ce[Qe-2-je]=at,Ce[Qe-1-je]=gt}}(ke,fe),Ne.push(ke)}let fo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class su{constructor(Y,K){let ce=(K=this.options=function(fe,Ie){for(let ke in Ie)fe[ke]=Ie[ke];return fe}(Object.create(fo),K)).debug;if(ce&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let be=function(fe,Ie){let ke=[];if(fe.type==="FeatureCollection")for(let Ce=0;Ce<fe.features.length;Ce++)en(ke,fe.features[Ce],Ie,Ce);else en(ke,fe.type==="Feature"?fe:{geometry:fe},Ie);return ke}(Y,K);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),be=function(fe,Ie){let ke=Ie.buffer/Ie.extent,Ce=fe,Fe=zt(fe,1,-1-ke,ke,0,-1,2,Ie),Ve=zt(fe,1,1-ke,2+ke,0,-1,2,Ie);return(Fe||Ve)&&(Ce=zt(fe,1,-ke,1+ke,0,-1,2,Ie)||[],Fe&&(Ce=Ea(Fe,1).concat(Ce)),Ve&&(Ce=Ce.concat(Ea(Ve,-1)))),Ce}(be,K),be.length&&this.splitTile(be,0,0,0),ce&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,K,ce,be,fe,Ie,ke){let Ce=[Y,K,ce,be],Fe=this.options,Ve=Fe.debug;for(;Ce.length;){be=Ce.pop(),ce=Ce.pop(),K=Ce.pop(),Y=Ce.pop();let je=1<<K,Qe=bi(K,ce,be),at=this.tiles[Qe];if(!at&&(Ve>1&&console.time("creation"),at=this.tiles[Qe]=ki(Y,K,ce,be,Fe),this.tileCoords.push({z:K,x:ce,y:be}),Ve)){Ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ce,be,at.numFeatures,at.numPoints,at.numSimplified),console.timeEnd("creation"));let Or=`z${K}`;this.stats[Or]=(this.stats[Or]||0)+1,this.total++}if(at.source=Y,fe==null){if(K===Fe.indexMaxZoom||at.numPoints<=Fe.indexMaxPoints)continue}else{if(K===Fe.maxZoom||K===fe)continue;if(fe!=null){let Or=fe-K;if(ce!==Ie>>Or||be!==ke>>Or)continue}}if(at.source=null,Y.length===0)continue;Ve>1&&console.time("clipping");let gt=.5*Fe.buffer/Fe.extent,Pt=.5-gt,Bt=.5+gt,Vt=1+gt,Ot=null,Cn=null,pn=null,Xt=null,Ln=zt(Y,je,ce-gt,ce+Bt,0,at.minX,at.maxX,Fe),Kn=zt(Y,je,ce+Pt,ce+Vt,0,at.minX,at.maxX,Fe);Y=null,Ln&&(Ot=zt(Ln,je,be-gt,be+Bt,1,at.minY,at.maxY,Fe),Cn=zt(Ln,je,be+Pt,be+Vt,1,at.minY,at.maxY,Fe),Ln=null),Kn&&(pn=zt(Kn,je,be-gt,be+Bt,1,at.minY,at.maxY,Fe),Xt=zt(Kn,je,be+Pt,be+Vt,1,at.minY,at.maxY,Fe),Kn=null),Ve>1&&console.timeEnd("clipping"),Ce.push(Ot||[],K+1,2*ce,2*be),Ce.push(Cn||[],K+1,2*ce,2*be+1),Ce.push(pn||[],K+1,2*ce+1,2*be),Ce.push(Xt||[],K+1,2*ce+1,2*be+1)}}getTile(Y,K,ce){Y=+Y,K=+K,ce=+ce;let be=this.options,{extent:fe,debug:Ie}=be;if(Y<0||Y>24)return null;let ke=1<<Y,Ce=bi(Y,K=K+ke&ke-1,ce);if(this.tiles[Ce])return Gs(this.tiles[Ce],fe);Ie>1&&console.log("drilling down to z%d-%d-%d",Y,K,ce);let Fe,Ve=Y,je=K,Qe=ce;for(;!Fe&&Ve>0;)Ve--,je>>=1,Qe>>=1,Fe=this.tiles[bi(Ve,je,Qe)];return Fe&&Fe.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",Ve,je,Qe),console.time("drilling down")),this.splitTile(Fe.source,Ve,je,Qe,Y,K,ce),Ie>1&&console.timeEnd("drilling down"),this.tiles[Ce]?Gs(this.tiles[Ce],fe):null):null}}function bi(Ne,Y,K){return 32*((1<<Ne)*K+Y)+Ne}function Hs(Ne,Y){let K=Ne.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);let ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return void Y(null,null);let be=new mr(ce.features),fe=Fl(be);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),Y(null,{vectorTile:be,rawData:fe.buffer})}class $l extends pt{constructor(Y,K,ce,be,fe,Ie){super(Y,K,ce,be,Hs,Ie),fe&&(this.loadGeoJSON=fe),this._dynamicIndex=new xn}loadData(Y,K){let ce=Y&&Y.request,be=ce&&ce.collectResourceTiming;this.loadGeoJSON(Y,(fe,Ie)=>{if(fe||!Ie)return K(fe);if(typeof Ie!="object")return K(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){let Ce=n.M(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ce.result==="error")throw new Error(Ce.value.map(Fe=>`${Fe.key}: ${Fe.message}`).join(", "));Ie.features=Ie.features.filter(Fe=>Ce.value.evaluate({zoom:0},Fe))}Y.dynamic?(Ie.type==="Feature"&&(Ie={type:"FeatureCollection",features:[Ie]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ie.features,this.loaded),Y.cluster&&(Ie.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new zl(function({superclusterOptions:Ce,clusterProperties:Fe}){if(!Fe||!Ce)return Ce;let Ve={},je={},Qe={accumulated:null,zoom:0},at={properties:null},gt=Object.keys(Fe);for(let Pt of gt){let[Bt,Vt]=Fe[Pt],Ot=n.M(Vt),Cn=n.M(typeof Bt=="string"?[Bt,["accumulated"],["get",Pt]]:Bt);Ve[Pt]=Ot.value,je[Pt]=Cn.value}return Ce.map=Pt=>{at.properties=Pt;let Bt={};for(let Vt of gt)Bt[Vt]=Ve[Vt].evaluate(Qe,at);return Bt},Ce.reduce=(Pt,Bt)=>{at.properties=Bt;for(let Vt of gt)Qe.accumulated=Pt[Vt],Pt[Vt]=je[Vt].evaluate(Qe,at)},Ce}(Y)).load(Ie.features):Y.dynamic?this._dynamicIndex:function(Ce,Fe){return new su(Ce,Fe)}(Ie,Y.geojsonVtOptions)}catch(Ce){return K(Ce)}let ke={};if(be){let Ce=P(ce);Ce&&(ke.resourceTiming={},ke.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Ce)))}K(null,ke)}})}reloadTile(Y,K){let ce=this.loaded;return ce&&ce[Y.uid]?Y.partial?K(null,void 0):super.reloadTile(Y,K):this.loadTile(Y,K)}loadGeoJSON(Y,K){if(Y.request)n.n(Y.request,K);else{if(typeof Y.data!="string")return K(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(Y.data))}catch{return K(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(ce){K(ce)}}getClusterChildren(Y,K){try{K(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(ce){K(ce)}}getClusterLeaves(Y,K){try{K(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(ce){K(ce)}}}class Gl{constructor(Y,K){this.tileID=new n.aA(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=K}parse(Y,K,ce,be){this.status="parsing";let fe=new n.aA(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Ie=[],ke=K.familiesBySource[ce.source],Ce=new n.dR(fe,ce.promoteId);return Ce.bucketLayerIDs=[],Ce.is3DTile=!0,n.e0(Y).then(Fe=>{if(!Fe)return be(new Error("Could not parse tile"));let Ve=n.e1(Fe,1/n.c9(ce.tileID.canonical)),je=Fe.json.extensionsUsed&&Fe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Fe.json.asset.extras&&Fe.json.asset.extras.MAPBOX_mesh_features,Qe=Fe.json.extensionsUsed&&Fe.json.extensionsUsed.includes("EXT_meshopt_compression"),at=new n.a3(this.zoom,{brightness:this.brightness});for(let gt in ke)for(let Pt of ke[gt]){let Bt=Pt[0];Ce.bucketLayerIDs.push(Pt.map(Ot=>n.av(Ot.id,Ot.scope))),Bt.recalculate(at,[]);let Vt=new n.e2(Pt,Ve,fe,je,Qe,this.brightness,Ce);je||(Vt.needsUpload=!0),Ie.push(Vt),Vt.evaluate(Bt)}this.status="done",be(null,{buckets:Ie,featureIndex:Ce,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Fe=>be(new Error(Fe.message)))}}class Ia{constructor(Y,K,ce,be,fe,Ie){this.actor=Y,this.layerIndex=K,this.availableImages=ce,this.brightness=Ie,this.loading={},this.loaded={}}loadTile(Y,K){let ce=Y.uid,be=this.loading[ce]=new Gl(Y,this.brightness);n.bd(Y.request,(fe,Ie)=>{let ke=!this.loading[ce];return delete this.loading[ce],ke||fe?(be.status="done",ke||(this.loaded[ce]=be),K(fe)):Ie&&Ie.byteLength!==0?void be.parse(Ie,this.layerIndex,Y,(Ce,Fe)=>{be.status="done",this.loaded=this.loaded||{},this.loaded[ce]=be,Ce||!Fe?K(Ce):K(null,Fe)}):(be.status="done",this.loaded[ce]=be,K())})}reloadTile(Y,K){let ce=this.loaded,be=Y.uid;if(ce&&ce[be]){let fe=ce[be];fe.projection=Y.projection,fe.brightness=Y.brightness;let Ie=(ke,Ce)=>{fe.reloadCallback&&(delete fe.reloadCallback,this.loadTile(Y,K)),K(ke,Ce)};fe.status==="parsing"?fe.reloadCallback=Ie:fe.status==="done"&&this.loadTile(Y,K)}}abortTile(Y,K){let ce=Y.uid;this.loading[ce]&&delete this.loading[ce],K()}removeTile(Y,K){let ce=this.loaded,be=Y.uid;ce&&ce[be]&&delete ce[be],K()}}class Hl{constructor(Y){this.self=Y,this.actor=new n.e3(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.bM({name:"mercator"}),this.workerSourceTypes={vector:pt,geojson:$l,"batched-model":Ia},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(n.e4.isParsed())throw new Error("RTL text plugin already registered.");n.e4.applyArabicShaping=K.applyArabicShaping,n.e4.processBidirectionalText=K.processBidirectionalText,n.e4.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(Y,K,ce){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],delete this.rasterArrayWorkerSource,ce()}checkIfReady(Y,K,ce){ce()}setReferrer(Y,K){this.referrer=K}spriteLoaded(Y,{scope:K,isLoaded:ce}){if(this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.isSpriteLoaded[Y][K]=ce,this.workerSources[Y]&&this.workerSources[Y][K])for(let be in this.workerSources[Y][K]){let fe=this.workerSources[Y][K][be];for(let Ie in fe){let ke=fe[Ie];ke instanceof pt&&(ke.isSpriteLoaded=ce,ke.fire(new n.x("isSpriteLoaded")))}}}setImages(Y,{scope:K,images:ce},be){if(this.availableImages[Y]||(this.availableImages[Y]={}),this.availableImages[Y][K]=ce,this.workerSources[Y]&&this.workerSources[Y][K]){for(let fe in this.workerSources[Y][K]){let Ie=this.workerSources[Y][K][fe];for(let ke in Ie)Ie[ke].availableImages=ce}be()}else be()}setProjection(Y,K){this.projections[Y]=n.bM(K)}setBrightness(Y,K,ce){this.brightness=K,ce()}setLayers(Y,K,ce){this.getLayerIndex(Y,K.scope).replace(K.layers,K.options),ce()}updateLayers(Y,K,ce){this.getLayerIndex(Y,K.scope).update(K.layers,K.removedIds,K.options),ce()}loadTile(Y,K,ce){K.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,K.type,K.source,K.scope).loadTile(K,ce)}loadDEMTile(Y,K,ce){this.getDEMWorkerSource(Y,K.source,K.scope).loadTile(K,ce)}decodeRasterArray(Y,K,ce){this.getRasterArrayWorkerSource().decodeRasterArray(K,ce)}reloadTile(Y,K,ce){K.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,K.type,K.source,K.scope).reloadTile(K,ce)}abortTile(Y,K,ce){this.getWorkerSource(Y,K.type,K.source,K.scope).abortTile(K,ce)}removeTile(Y,K,ce){this.getWorkerSource(Y,K.type,K.source,K.scope).removeTile(K,ce)}removeSource(Y,K,ce){if(!(this.workerSources[Y]&&this.workerSources[Y][K.scope]&&this.workerSources[Y][K.scope][K.type]&&this.workerSources[Y][K.scope][K.type][K.source]))return;let be=this.workerSources[Y][K.scope][K.type][K.source];delete this.workerSources[Y][K.scope][K.type][K.source],be.removeSource!==void 0?be.removeSource(K,ce):ce()}loadWorkerSource(Y,K,ce){try{this.self.importScripts(K.url),ce()}catch(be){ce(be.toString())}}syncRTLPluginState(Y,K,ce){try{n.e4.setState(K);let be=n.e4.getPluginURL();if(n.e4.isLoaded()&&!n.e4.isParsed()&&be!=null){this.self.importScripts(be);let fe=n.e4.isParsed();ce(fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${be}`),fe)}}catch(be){ce(be.toString())}}setDracoUrl(Y,K){this.dracoUrl=K}getAvailableImages(Y,K){this.availableImages[Y]||(this.availableImages[Y]={});let ce=this.availableImages[Y][K];return ce||(ce=[]),ce}getLayerIndex(Y,K){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let ce=this.layerIndexes[Y][K];return ce||(ce=this.layerIndexes[Y][K]=new se,ce.scope=K),ce}getWorkerSource(Y,K,ce,be){return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][be]||(this.workerSources[Y][be]={}),this.workerSources[Y][be][K]||(this.workerSources[Y][be][K]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.workerSources[Y][be][K][ce]||(this.workerSources[Y][be][K][ce]=new this.workerSourceTypes[K]({send:(fe,Ie,ke,Ce,Fe,Ve)=>{this.actor.send(fe,Ie,ke,Y,Fe,Ve)},scheduler:this.actor.scheduler},this.getLayerIndex(Y,be),this.getAvailableImages(Y,be),this.isSpriteLoaded[Y][be],void 0,this.brightness)),this.workerSources[Y][be][K][ce]}getDEMWorkerSource(Y,K,ce){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][ce]||(this.demWorkerSources[Y][ce]={}),this.demWorkerSources[Y][ce][K]||(this.demWorkerSources[Y][ce][K]=new _t),this.demWorkerSources[Y][ce][K]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new on),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Y,K){n.e5(K)}getWorkerPerformanceMetrics(Y,K,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Hl(self)),Hl}),m(["./shared"],function(n){var P="3.8.0";let U={create:"create",load:"load",fullLoad:"fullLoad"},$={mark(h){performance.mark(h)},measure(h,t,o){performance.measure(h,t,o)}};function se(h){let t=h.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var Te,Pe={},Ye=function(){if(Te)return Pe;function h(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,x,C=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(C);try{x=new Worker(A),y=!0}catch{y=!1}return x&&x.terminate(),URL.revokeObjectURL(A),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var x=y.getContext("2d");if(!x)return!1;var C=x.getImageData(0,0,1,1);return C&&C.width===y.width}()?(o[g=d&&d.failIfMajorPerformanceCaveat]===void 0&&(o[g]=function(y){var x,C=function(A){var O=document.createElement("canvas"),R=Object.create(h.webGLContextAttributes);return R.failIfMajorPerformanceCaveat=A,O.getContext("webgl2",R)}(y);if(!C)return!1;try{x=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!x||C.isContextLost())&&(C.shaderSource(x,"void main() {}"),C.compileShader(x),C.getShaderParameter(x,C.COMPILE_STATUS)===!0)}(g)),o[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}Te=1,Pe.supported=h,Pe.notSupportedReason=t;var o={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Pe}();function We(h,t,o){let d=document.createElement(h);return t!=null&&(d.className=t),o&&o.appendChild(d),d}function pt(h,t,o){let d=document.createElementNS("http://www.w3.org/2000/svg",h);for(let g of Object.keys(t))d.setAttributeNS(null,g,String(t[g]));return o&&o.appendChild(d),d}let _t=typeof document<"u"?document.documentElement&&document.documentElement.style:null,on=_t&&_t.userSelect!==void 0?"userSelect":"WebkitUserSelect",an;function Ft(){_t&&on&&(an=_t[on],_t[on]="none")}function mr(){_t&&on&&(_t[on]=an)}function Dn(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",Dn,!0)}function St(){window.addEventListener("click",Dn,!0),window.setTimeout(()=>{window.removeEventListener("click",Dn,!0)},0)}function xn(h,t){let o=h.getBoundingClientRect();return Rt(h,o,t)}function xr(h,t){let o=h.getBoundingClientRect(),d=[];for(let g=0;g<t.length;g++)d.push(Rt(h,o,t[g]));return d}function Ct(h){return window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Rt(h,t,o){let d=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new n.P((o.clientX-t.left)*d,(o.clientY-t.top)*d)}let zs="01",fs="NO_ACCESS_TOKEN";class ou{constructor(t,o,d){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){let t=function(){let o="";for(let d=0;d<10;d++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",zs,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!n.f(t))return t;let d=ti(t);return d.params.push(`sdk=js-${P}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!n.f(t))return t;let d=ti(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeModelURL(t,o){if(!n.f(t))return t;let d=ti(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeSourceURL(t,o,d,g){if(!n.f(t))return t;let y=ti(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),d&&y.params.push(`language=${d}`),g&&y.params.push(`worldview=${g}`),this._makeAPIURL(y,this._customAccessToken||o)}normalizeSpriteURL(t,o,d,g){let y=ti(t);return n.f(t)?(y.path=`/styles/v1${y.path}/sprite${o}${d}`,this._makeAPIURL(y,this._customAccessToken||g)):(y.path+=`${o}${d}`,ko(y))}normalizeTileURL(t,o,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.f(t))return t;let g=ti(t);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||d&&g.authority!=="raster"&&d===512?"@2x":""}${n.m.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${n.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${n.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${n.e.TILE_URL_VERSION}${g.path}`);let y=this._customAccessToken||function(x){for(let C of x){let A=C.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(g.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,y)}canonicalizeTileURL(t,o){let d=ti(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let g="mapbox://";d.path.match(/^\/raster\/v1\//)?g+=`raster/${d.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${d.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${d.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let y=d.params;return o&&(y=y.filter(x=>!x.match(/^access_token=/))),y.length&&(g+=`?${y.join("&")}`),g}canonicalizeTileset(t,o){let d=!!o&&n.f(o),g=[];for(let y of t.tiles||[])n.h(y)?g.push(this.canonicalizeTileURL(y,d)):g.push(y);return g}_makeAPIURL(t,o){let d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=ti(n.e.API_URL);if(t.protocol=g.protocol,t.authority=g.authority,t.protocol==="http"){let y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(g.path!=="/"&&(t.path=`${g.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return ko(t);if(o=o||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(y=>y.indexOf("access_token")===-1),t.params.push(`access_token=${o||""}`),ko(t)}}let Zt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ti(h){let t=h.match(Zt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ko(h){let t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}let ya="mapbox.eventData";function qt(h){if(!h)return null;let t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.j(t[1]))}catch{return null}}class Bs{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let o=qt(n.e.ACCESS_TOKEN),d="";return d=o&&o.u?n.k(o.u):n.e.ACCESS_TOKEN||"",t?`${ya}.${t}:${d}`:`${ya}:${d}`}fetchEventData(){let t=n.s("localStorage"),o=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{let g=localStorage.getItem(o);g&&(this.eventData=JSON.parse(g));let y=localStorage.getItem(d);y&&(this.anonId=y)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){let t=n.s("localStorage"),o=this.getStorageKey(),d=this.getStorageKey("uuid"),g=this.anonId;if(t&&g)try{localStorage.setItem(d,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,d,g){if(!n.e.EVENTS_URL)return;let y=ti(n.e.EVENTS_URL);y.params.push(`access_token=${g||n.e.ACCESS_TOKEN||""}`);let x={event:this.type,created:new Date(t).toISOString()},C=o?n.l(x,o):x,A={url:ko(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=n.p(A,O=>{this.pendingRequest=null,d(O),this.saveEventData(),this.processRequests(g)})}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}let Fl=new class extends Bs{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(o=>n.f(o)||n.h(o))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=qt(n.e.ACCESS_TOKEN),o=t?t.u:n.e.ACCESS_TOKEN,d=o!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),d=!0);let g=this.queue.shift();if(this.eventData.lastSuccess){let y=new Date(this.eventData.lastSuccess),x=new Date(g),C=(g-this.eventData.lastSuccess)/864e5;d=d||C>=1||C<-1||y.getDate()!==x.getDate()}else d=!0;d?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:zs,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=g,this.eventData.tokenU=o)},h):this.processRequests()}},va=Fl.postTurnstileEvent.bind(Fl),Gt=new class extends Bs{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,o,d){this.skuToken=t,this.errorCb=d,n.e.EVENTS_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},o):this.errorCb(new Error(fs)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:zs,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},h))}remove(){this.errorCb=null}},Nl=Gt.postMapLoadEvent.bind(Gt),Hi=new class extends Bs{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=n.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){let t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){let{map:o,style:d,importedStyles:g}=t;if(!n.e.EVENTS_URL||!h&&!n.e.ACCESS_TOKEN)return;let y=this.getMapInstanceId(o),x={mapInstanceId:y,eventId:this.getEventId(y),style:d};g.length&&(x.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:x},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,()=>{},h)}},Li=Hi.postStyleLoadEvent.bind(Hi),xa=new class extends Bs{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){n.e.EVENTS_URL&&(h||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,performanceData:o}=this.queue.shift(),d=function(g){let y=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),C=function(j){let W={};if(j){for(let q in j)if(q!=="other")for(let X of j[q]){let Z=`${q}ResolveRangeMin`,Q=`${q}ResolveRangeMax`,re=`${q}RequestCount`,ie=`${q}RequestCachedCount`;W[Z]=Math.min(W[Z]||1/0,X.startTime),W[Q]=Math.max(W[Q]||-1/0,X.responseEnd);let ae=ue=>{W[ue]===void 0&&(W[ue]=0),++W[ue]};X.transferSize!==void 0&&X.transferSize===0&&ae(ie),ae(re)}}return W}(function(j,W){let q={};if(j)for(let X of j){let Z=W(X);q[Z]===void 0&&(q[Z]=[]),q[Z].push(X)}return q}(y,se)),A=window.devicePixelRatio,O=navigator.connection||navigator.mozConnection||navigator.webkitConnection,R=O?O.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},z=(j,W,q)=>{q!=null&&j.push({name:W,value:q.toString()})};for(let j in C)z(F.counters,j,C[j]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(z(F.counters,"interactionRangeMin",g.interactionRange[0]),z(F.counters,"interactionRangeMax",g.interactionRange[1])),x)for(let j of Object.keys(U)){let W=U[j],q=x.find(X=>X.name===W);q&&z(F.counters,W,q.startTime)}return z(F.counters,"visibilityHidden",g.visibilityHidden),z(F.attributes,"style",function(j){if(j)for(let W of j){let q=W.name.split("?")[0];if(n.i(q)){let X=q.split("/").slice(-2);if(X.length===2)return`mapbox://styles/${X[0]}/${X[1]}`}}}(y)),z(F.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),z(F.attributes,"fogEnabled",g.fogEnabled?"true":"false"),z(F.attributes,"projection",g.projection),z(F.attributes,"zoom",g.zoom),z(F.metadata,"devicePixelRatio",A),z(F.metadata,"connectionEffectiveType",R),z(F.metadata,"navigatorUserAgent",navigator.userAgent),z(F.metadata,"screenWidth",window.screen.width),z(F.metadata,"screenHeight",window.screen.height),z(F.metadata,"windowWidth",window.innerWidth),z(F.metadata,"windowHeight",window.innerHeight),z(F.metadata,"mapWidth",g.width/A),z(F.metadata,"mapHeight",g.height/A),z(F.metadata,"webglRenderer",g.renderer),z(F.metadata,"webglVendor",g.vendor),z(F.metadata,"sdkVersion",P),z(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(o);for(let g of d.metadata);for(let g of d.counters);for(let g of d.attributes);this.postEvent(t,d,()=>{},h)}},zl=xa.postPerformanceEvent.bind(xa),Vs=new class extends Bs{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,o,d){if(!n.e.API_URL||!n.e.SESSION_PATH)return;let g=ti(n.e.API_URL+n.e.SESSION_PATH);g.params.push(`sku=${t||""}`),g.params.push(`access_token=${d||n.e.ACCESS_TOKEN||""}`);let y={url:ko(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(y,x=>{this.pendingRequest=null,o(x),this.saveEventData(),this.processRequests(d)})}getSessionAPI(h,t,o,d){this.skuToken=t,this.errorCb=d,n.e.SESSION_PATH&&n.e.API_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},o):this.errorCb(new Error(fs)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},h)}remove(){this.errorCb=null}},we=Vs.getSessionAPI.bind(Vs),Fo=new Set;function ps(h,t){t?Fo.add(h):Fo.delete(h)}class Bl{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){let o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){let o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){let t={};for(let o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(let o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function it(h){let{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class js extends n.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new n.r({width:1,height:1})}isLoaded(){for(let t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,o){if(this.loaded[o]!==t&&(this.loaded[o]=t,t)){for(let{ids:d,callback:g}of this.requestors)this._notify(d,o,g);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images[o][t]}addImage(t,o,d){this._validate(t,d)&&(this.images[o][t]=d)}_validate(t,o){let d=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(o.content,o)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,o){if(!t)return!0;let d=0;for(let g of t){if(g[0]<d||g[1]<g[0]||o<g[1])return!1;d=g[1]}return!0}_validateContent(t,o){return!(t&&(t.length!==4||t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,o,d){d.version=this.images[o][t].version+1,this.images[o][t]=d,this.updatedImages[o][t]=!0}removeImage(t,o){let d=this.images[o][t];delete this.images[o][t],delete this.patterns[o][t],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,o,d){let g=!0,y=!!this.loaded[o];if(!y)for(let x of t)this.images[o][x]||(g=!1);y||g?this._notify(t,o,d):this.requestors.push({ids:t,scope:o,callback:d})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,o,d){let g={};for(let y of t){this.images[o][y]||this.fire(new n.x("styleimagemissing",{id:y}));let x=this.images[o][y];x?g[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:n.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,g)}getPixelSize(t){let{width:o,height:d}=this.atlasImage[t];return{width:o,height:d}}getPattern(t,o,d){let g=this.patterns[o][t],y=this.getImage(t,o);if(!y)return null;if(g&&g.position.version===y.version)return g.position;if(g)g.position.version=y.version;else{let x={w:y.data.width+2*n.y,h:y.data.height+2*n.y,x:0,y:0},C=new n.I(x,y,n.y);this.patterns[o][t]={bin:x,position:C}}return this._updatePatternAtlas(o,d),this.patterns[o][t].position}bind(t,o){let d=t.gl,g=this.atlasTexture[o];g?this.dirty&&(g.update(this.atlasImage[o]),this.dirty=!1):(g=new n.T(t,this.atlasImage[o],d.RGBA8),this.atlasTexture[o]=g),g.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){let d=[];for(let C in this.patterns[t])d.push(this.patterns[t][C].bin);let{w:g,h:y}=n.z(d),x=this.atlasImage[t];x.resize({width:g||1,height:y||1});for(let C in this.patterns[t]){let{bin:A,position:O}=this.patterns[t][C],R=O.padding,F=A.x+R,z=A.y+R,j=this.images[t][C].data,W=j.width,q=j.height;R=R>1?R-1:R,n.r.copy(j,x,{x:0,y:0},{x:F,y:z},{width:W,height:q},o),n.r.copy(j,x,{x:0,y:q-R},{x:F,y:z-R},{width:W,height:R},o),n.r.copy(j,x,{x:0,y:0},{x:F,y:z+q},{width:W,height:R},o),n.r.copy(j,x,{x:W-R,y:0},{x:F-R,y:z},{width:R,height:q},o),n.r.copy(j,x,{x:0,y:0},{x:F+W,y:z},{width:R,height:q},o),n.r.copy(j,x,{x:W-R,y:q-R},{x:F-R,y:z-R},{width:R,height:R},o),n.r.copy(j,x,{x:0,y:q-R},{x:F+W,y:z-R},{width:R,height:R},o),n.r.copy(j,x,{x:0,y:0},{x:F+W,y:z+q},{width:R,height:R},o),n.r.copy(j,x,{x:W-R,y:0},{x:F-R,y:z+q},{width:R,height:R},o)}this.dirty=!0}beginFrame(){for(let t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,o){for(let d of t){if(this.callbackDispatchedThisFrame[o][d])continue;this.callbackDispatchedThisFrame[o][d]=!0;let g=this.images[o][d];it(g)&&this.updateImage(d,o,g)}}}function zr(h){let t=h.key,o=h.value,d=h.valueSpec||{},g=h.objectElementValidators||{},y=h.style,x=h.styleSpec,C=[],A=n.B(o);if(A!=="object")return[new n.V(t,o,`object expected, ${A} found`)];for(let O in o){let R=O.split(".")[0],F;g[R]?F=g[R]:d[R]?F=ln:g["*"]?F=g["*"]:d["*"]&&(F=ln),F?C=C.concat(F({key:(t&&`${t}.`)+O,value:o[O],valueSpec:d[R]||d["*"],style:y,styleSpec:x,object:o,objectKey:O},o)):C.push(new n.A(t,o[O],`unknown property "${O}"`))}for(let O in d)g[O]||d[O].required&&d[O].default===void 0&&o[O]===void 0&&C.push(new n.V(t,o,`missing required property "${O}"`));return C}function No(h){let t=h.value,o=h.valueSpec,d=h.style,g=h.styleSpec,y=h.key,x=h.arrayElementValidator||ln;if(n.B(t)!=="array")return[new n.V(y,t,`array expected, ${n.B(t)} found`)];if(o.length&&t.length!==o.length)return[new n.V(y,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new n.V(y,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let C={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};g.$version<7&&(C.function=o.function),n.B(o.value)==="object"&&(C=o.value);let A=[];for(let O=0;O<t.length;O++)A=A.concat(x({array:t,arrayIndex:O,value:t[O],valueSpec:C,style:d,styleSpec:g,key:`${y}[${O}]`},!0));return A}function en(h){let t=h.key,o=h.value,d=h.valueSpec,g=n.B(o);if(g==="number"&&o!=o&&(g="NaN"),g!=="number")return[new n.V(t,o,`number expected, ${g} found`)];if("minimum"in d){let y=d.minimum;if(n.B(d.minimum)==="array"&&(y=d.minimum[h.arrayIndex]),o<y)return[new n.V(t,o,`${o} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if(n.B(d.maximum)==="array"&&(y=d.maximum[h.arrayIndex]),o>y)return[new n.V(t,o,`${o} is greater than the maximum value ${y}`)]}return[]}function Fr(h){let t=h.valueSpec,o=n.D(h.value.type),d,g,y,x={},C=o!=="categorical"&&h.value.property===void 0,A=!C,O=n.B(h.value.stops)==="array"&&n.B(h.value.stops[0])==="array"&&n.B(h.value.stops[0][0])==="object",R=zr({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(j){if(o==="identity")return[new n.V(j.key,j.value,'identity function may not have a "stops" property')];let W=[],q=j.value;return W=W.concat(No({key:j.key,value:q,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:F})),n.B(q)==="array"&&q.length===0&&W.push(new n.V(j.key,q,"array must have at least one stop")),W},default:function(j){return ln({key:j.key,value:j.value,valueSpec:t,style:j.style,styleSpec:j.styleSpec})}}});return o==="identity"&&C&&R.push(new n.V(h.key,h.value,'missing required property "property"')),o==="identity"||h.value.stops||R.push(new n.V(h.key,h.value,'missing required property "stops"')),o==="exponential"&&h.valueSpec.expression&&!n.F(h.valueSpec)&&R.push(new n.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(A&&!n.G(h.valueSpec)?R.push(new n.V(h.key,h.value,"property functions not supported")):C&&!n.H(h.valueSpec)&&R.push(new n.V(h.key,h.value,"zoom functions not supported"))),o!=="categorical"&&!O||h.value.property!==void 0||R.push(new n.V(h.key,h.value,'"property" property is required')),R;function F(j){let W=[],q=j.value,X=j.key;if(n.B(q)!=="array")return[new n.V(X,q,`array expected, ${n.B(q)} found`)];if(q.length!==2)return[new n.V(X,q,`array length 2 expected, length ${q.length} found`)];if(O){if(n.B(q[0])!=="object")return[new n.V(X,q,`object expected, ${n.B(q[0])} found`)];if(q[0].zoom===void 0)return[new n.V(X,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new n.V(X,q,"object stop key must have value")];let Z=n.D(q[0].zoom);if(typeof Z!="number")return[new n.V(X,q[0].zoom,"stop zoom values must be numbers")];if(y&&y>Z)return[new n.V(X,q[0].zoom,"stop zoom values must appear in ascending order")];Z!==y&&(y=Z,g=void 0,x={}),W=W.concat(zr({key:`${X}[0]`,value:q[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:en,value:z}}))}else W=W.concat(z({key:`${X}[0]`,value:q[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},q));return n.J(n.K(q[1]))?W.concat([new n.V(`${X}[1]`,q[1],"expressions are not allowed in function stops.")]):W.concat(ln({key:`${X}[1]`,value:q[1],valueSpec:t,style:j.style,styleSpec:j.styleSpec}))}function z(j,W){let q=n.B(j.value),X=n.D(j.value),Z=j.value!==null?j.value:W;if(d){if(q!==d)return[new n.V(j.key,Z,`${q} stop domain type must match previous stop domain type ${d}`)]}else d=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new n.V(j.key,Z,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&o!=="categorical"){let Q=`number expected, ${q} found`;return n.G(t)&&o===void 0&&(Q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(j.key,Z,Q)]}return o!=="categorical"||q!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?o!=="categorical"&&q==="number"&&typeof X=="number"&&typeof g=="number"&&g!==void 0&&X<g?[new n.V(j.key,Z,"stop domain values must appear in ascending order")]:(g=X,o==="categorical"&&X in x?[new n.V(j.key,Z,"stop domain values must be unique")]:(x[X]=!0,[])):[new n.V(j.key,Z,`integer expected, found ${String(X)}`)]}}function qi(h){let t=(h.expressionContext==="property"?n.L:n.M)(n.K(h.value),h.valueSpec);if(t.result==="error")return t.value.map(d=>new n.V(`${h.key}${d.key}`,h.value,d.message));let o=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!o.outputDefined())return[new n.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!n.N(o))return[new n.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return Us(o,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!n.O(o,["zoom","feature-state"]))return[new n.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!n.Q(o))return[new n.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Us(h,t){let o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(let g of t.valueSpec.expression.parameters)o.delete(g);if(o.size===0)return[];let d=[];return h instanceof n.S&&o.has(h.name)?[new n.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild(g=>{d.push(...Us(g,t))}),d)}function ms(h){let t=h.key,o=h.value,d=h.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(n.D(o))===-1&&g.push(new n.V(t,o,`expected one of [${d.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(d.values).indexOf(n.D(o))===-1&&g.push(new n.V(t,o,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(o)} found`)),g}function ba(h){return n.W(n.K(h.value))?qi(n.C({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):zt(h)}function zt(h){let t=h.value,o=h.key;if(n.B(t)!=="array")return[new n.V(o,t,`array expected, ${n.B(t)} found`)];let d=h.styleSpec,g,y=[];if(t.length<1)return[new n.V(o,t,"filter array must have at least 1 element")];switch(y=y.concat(ms({key:`${o}[0]`,value:t[0],valueSpec:d.filter_operator,style:h.style,styleSpec:h.styleSpec})),n.D(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.D(t[1])==="$type"&&y.push(new n.V(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new n.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(g=n.B(t[1]),g!=="string"&&y.push(new n.V(`${o}[1]`,t[1],`string expected, ${g} found`)));for(let x=2;x<t.length;x++)g=n.B(t[x]),n.D(t[1])==="$type"?y=y.concat(ms({key:`${o}[${x}]`,value:t[x],valueSpec:d.geometry_type,style:h.style,styleSpec:h.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new n.V(`${o}[${x}]`,t[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)y=y.concat(zt({key:`${o}[${x}]`,value:t[x],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":g=n.B(t[1]),t.length!==2?y.push(new n.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new n.V(`${o}[1]`,t[1],`string expected, ${g} found`))}return y}function wa(h,t){let o=h.key,d=h.style,g=h.layer,y=h.styleSpec,x=h.value,C=h.objectKey,A=y[`${t}_${h.layerType}`];if(!A)return[];let O=C.match(/^(.*)-transition$/);if(t==="paint"&&O&&A[O[1]]&&A[O[1]].transition)return ln({key:o,value:x,valueSpec:y.transition,style:d,styleSpec:y});let R=h.valueSpec||A[C];if(!R)return[new n.A(o,x,`unknown property "${C}"`)];let F;if(n.B(x)==="string"&&n.G(R)&&!R.tokens&&(F=/^{([^}]+)}$/.exec(x))){let j=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new n.V(o,x,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}let z=[];if(h.layerType==="symbol")C!=="text-field"||!d||d.glyphs||d.imports||z.push(new n.V(o,x,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&n.X(n.K(x))&&n.D(x.type)==="identity"&&z.push(new n.V(o,x,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&n.G(R)&&(n.Y(R)||n.H(R))){let j=n.L(n.K(x),R),W=j.value.expression||j.value._styleExpression.expression;W&&!n.O(W,["measure-light"])&&(C==="model-emissive-strength"&&n.Q(W)&&n.N(W)||z.push(new n.V(o,x,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(ln({key:h.key,value:x,valueSpec:R,style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:C}))}function zo(h){return wa(h,"paint")}function $s(h){return wa(h,"layout")}function Jr(h){let t=[],o=h.value,d=h.key,g=h.style,y=h.styleSpec;o.type||o.ref||t.push(new n.V(d,o,'either "type" or "ref" is required'));let x=n.D(o.type),C=n.D(o.ref);if(o.id){let A=n.D(o.id);for(let O=0;O<h.arrayIndex;O++){let R=g.layers[O];n.D(R.id)===A&&t.push(new n.V(d,o.id,`duplicate layer id "${o.id}", previously used at line ${R.id.__line__}`))}}if("ref"in o){let A;["type","source","source-layer","filter","layout"].forEach(O=>{O in o&&t.push(new n.V(d,o[O],`"${O}" is prohibited for ref layers`))}),g.layers.forEach(O=>{n.D(O.id)===C&&(A=O)}),A?A.ref?t.push(new n.V(d,o.ref,"ref cannot reference another ref layer")):x=n.D(A.type):typeof C=="string"&&t.push(new n.V(d,o.ref,`ref layer "${C}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(o.source){let A=g.sources&&g.sources[o.source],O=A&&n.D(A.type);A?O==="vector"&&x==="raster"?t.push(new n.V(d,o.source,`layer "${o.id}" requires a raster source`)):O==="raster"&&x!=="raster"?t.push(new n.V(d,o.source,`layer "${o.id}" requires a vector source`)):O!=="vector"||o["source-layer"]?O==="raster-dem"&&x!=="hillshade"?t.push(new n.V(d,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||O==="geojson"&&A.lineMetrics?x==="raster-particle"&&O!=="raster-array"&&t.push(new n.V(d,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new n.V(d,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new n.V(d,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(d,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new n.V(d,o.source,`source "${o.source}" not found`))}else t.push(new n.V(d,o,'missing required property "source"'));return t=t.concat(zr({key:d,value:o,valueSpec:y.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ln({key:`${d}.type`,value:o.type,valueSpec:y.layer.type,style:h.style,styleSpec:h.styleSpec,object:o,objectKey:"type"}),filter:A=>ba(n.C({layerType:x},A)),layout:A=>zr({layer:o,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":O=>$s(n.C({layerType:x},O))}}),paint:A=>zr({layer:o,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":O=>zo(n.C({layerType:x,layer:o},O))}})}})),t}function xi(h){let t=h.value,o=h.key,d=n.B(t);return d!=="string"?[new n.V(o,t,`string expected, ${d} found`)]:[]}let Vl={promoteId:function({key:h,value:t}){if(n.B(t)==="string")return xi({key:h,value:t});{let o=[];for(let d in t)o.push(...xi({key:`${h}.${d}`,value:t[d]}));return o}}};function jl(h){let t=h.value,o=h.key,d=h.styleSpec,g=h.style;if(!t.type)return[new n.V(o,t,'"type" is required')];let y=n.D(t.type),x=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(t.url||t.tiles||x.push(new n.A(o,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(zr({key:o,value:t,valueSpec:d[`source_${y.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:Vl})),x;case"geojson":if(x=zr({key:o,value:t,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:Vl}),t.cluster)for(let C in t.clusterProperties){let[A,O]=t.clusterProperties[C],R=typeof A=="string"?[A,["accumulated"],["get",C]]:A;x.push(...qi({key:`${o}.${C}.map`,value:O,expressionContext:"cluster-map"})),x.push(...qi({key:`${o}.${C}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return x;case"video":return zr({key:o,value:t,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return zr({key:o,value:t,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new n.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ms({key:`${o}.type`,value:t.type,valueSpec:{values:Ea(d)},style:g,styleSpec:d})}}function Ea(h){return h.source.reduce((t,o)=>{let d=h[o];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t},[])}function Bo(h){let t=h.value,o=h.styleSpec,d=o.light,g=h.style,y=[],x=n.B(t);if(t===void 0)return y;if(x!=="object")return y=y.concat([new n.V("light",t,`object expected, ${x} found`)]),y;for(let C in t){let A=C.match(/^(.*)-transition$/);y=y.concat(A&&d[A[1]]&&d[A[1]].transition?ln({key:C,value:t[C],valueSpec:o.transition,style:g,styleSpec:o}):d[C]?ln({key:C,value:t[C],valueSpec:d[C],style:g,styleSpec:o}):[new n.V(C,t[C],`unknown property "${C}"`)])}return y}function Gs(h){let t=h.value,o=[];if(!t)return o;let d=n.B(t);if(d!=="object")return o=o.concat([new n.V("light-3d",t,`object expected, ${d} found`)]),o;let g=h.styleSpec,y=g["light-3d"],x=h.key,C=h.style,A=h.style.lights;for(let F of["type","id"])if(!(F in t))return o=o.concat([new n.V("light-3d",t,`missing property ${F} on light`)]),o;if(t.type&&A)for(let F=0;F<h.arrayIndex;F++){let z=n.D(t.type),j=A[F];n.D(j.type)===z&&o.push(new n.V(x,t.id,`duplicate light type "${t.type}", previously defined at line ${j.id.__line__}`))}let O=`properties_light_${t.type}`;if(!(O in g))return o=o.concat([new n.V("light-3d",t,`Invalid light type ${t.type}`)]),o;let R=g[O];for(let F in t)if(F==="properties"){let z=t[F],j=n.B(z);if(j!=="object")return o=o.concat([new n.V("properties",z,`object expected, ${j} found`)]),o;for(let W in z)o=o.concat(R[W]?ln({key:W,value:z[W],valueSpec:R[W],style:C,styleSpec:g}):[new n.A(h.key,z[W],`unknown property "${W}"`)])}else{let z=F.match(/^(.*)-transition$/);o=o.concat(z&&y[z[1]]&&y[z[1]].transition?ln({key:F,value:t[F],valueSpec:g.transition,style:C,styleSpec:g}):y[F]?ln({key:F,value:t[F],valueSpec:y[F],style:C,styleSpec:g}):[new n.A(F,t[F],`unknown property "${F}"`)])}return o}function Ta(h){let t=h.value,o=h.key,d=h.style,g=h.styleSpec,y=g.terrain,x=[],C=n.B(t);if(t===void 0||C==="null")return x;if(C!=="object")return x=x.concat([new n.V("terrain",t,`object expected, ${C} found`)]),x;for(let A in t){let O=A.match(/^(.*)-transition$/);x=x.concat(O&&y[O[1]]&&y[O[1]].transition?ln({key:A,value:t[A],valueSpec:g.transition,style:d,styleSpec:g}):y[A]?ln({key:A,value:t[A],valueSpec:y[A],style:d,styleSpec:g}):[new n.A(A,t[A],`unknown property "${A}"`)])}if(t.source){let A=d.sources&&d.sources[t.source],O=A&&n.D(A.type);A?O!=="raster-dem"&&x.push(new n.V(o,t.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):x.push(new n.V(o,t.source,`source "${t.source}" not found`))}else x.push(new n.V(o,t,'terrain is missing required property "source"'));return x}function ki(h){let t=h.value,o=h.style,d=h.styleSpec,g=d.fog,y=[],x=n.B(t);if(t===void 0)return y;if(x!=="object")return y=y.concat([new n.V("fog",t,`object expected, ${x} found`)]),y;for(let C in t){let A=C.match(/^(.*)-transition$/);y=y.concat(A&&g[A[1]]&&g[A[1]].transition?ln({key:C,value:t[C],valueSpec:d.transition,style:o,styleSpec:d}):g[C]?ln({key:C,value:t[C],valueSpec:g[C],style:o,styleSpec:d}):[new n.A(C,t[C],`unknown property "${C}"`)])}return y}let Ul={"*":()=>[],array:No,boolean:function(h){let t=h.value,o=h.key,d=n.B(t);return d!=="boolean"?[new n.V(o,t,`boolean expected, ${d} found`)]:[]},number:en,color:function(h){let t=h.key,o=h.value,d=n.B(o);return d!=="string"?[new n.V(t,o,`color expected, ${d} found`)]:n.U.parseCSSColor(o)===null?[new n.V(t,o,`color expected, "${o}" found`)]:[]},enum:ms,filter:ba,function:Fr,layer:Jr,object:zr,source:jl,model:n.Z,light:Bo,"light-3d":Gs,terrain:Ta,fog:ki,string:xi,formatted:function(h){return xi(h).length===0?[]:qi(h)},resolvedImage:function(h){return xi(h).length===0?[]:qi(h)},projection:function(h){let t=h.value,o=h.styleSpec,d=o.projection,g=h.style,y=[],x=n.B(t);if(x==="object")for(let C in t)y=y.concat(ln({key:C,value:t[C],valueSpec:d[C],style:g,styleSpec:o}));else x!=="string"&&(y=y.concat([new n.V("projection",t,`object or string expected, ${x} found`)]));return y},import:function(h){let{value:t,styleSpec:o}=h,x=t,{data:d}=x,g=tp(x,["data"]);Object.defineProperty(g,"__line__",{value:t.__line__,enumerable:!1});let y=zr(n.C({},h,{value:g,valueSpec:o.import}));return n.D(g.id)===""&&y.push(new n.V(`${h.key}.id`,g,"import id can't be an empty string")),d&&(y=y.concat(su(d,o,{key:`${h.key}.data`}))),y}};function ln(h,t=!1){let o=h.value,d=h.valueSpec,g=h.styleSpec;if(d.expression&&n.X(n.D(o)))return Fr(h);if(d.expression&&n.J(n.K(o)))return qi(h);if(d.type&&Ul[d.type]){let y=Ul[d.type](h);return t===!0&&y.length>0&&n.B(h.value)==="array"?qi(h):y}return zr(n.C({},h,{valueSpec:d.type?g[d.type]:d}))}function fo(h){let t=h.value,o=h.key,d=xi(h);return d.length||(t.indexOf("{fontstack}")===-1&&d.push(new n.V(o,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&d.push(new n.V(o,t,'"glyphs" url must include a "{range}" token'))),d}function su(h,t=n._,o={}){return ln({key:o.key||"",value:h,valueSpec:t.$root,styleSpec:t,style:h,objectElementValidators:{glyphs:fo,"*":()=>[]}})}function bi(h,t=n._){return fe(su(h,t))}let Hs=h=>fe(jl(h)),$l=h=>fe(Bo(h)),Gl=h=>fe(Gs(h)),Ia=h=>fe(Ta(h)),Hl=h=>fe(ki(h)),Ne=h=>fe(Jr(h)),Y=h=>fe(ba(h)),K=h=>fe(zo(h)),ce=h=>fe($s(h)),be=h=>fe(n.Z(h));function fe(h){return h.slice().sort((t,o)=>t.line&&o.line?t.line-o.line:0)}function Ie(h,t){let o=!1;if(t&&t.length)for(let d of t)d instanceof n.A?n.w(d.message):(h.fire(new n.t(new Error(d.message))),o=!0);return o}let ke;class Ce extends n.E{constructor(t,o="flat"){super(),this._transitionable=new n.$(ke||(ke=new n.a0({anchor:new n.a1(n._.light.anchor),position:new n.a2(n._.light.position),color:new n.a1(n._.light.color),intensity:new n.a1(n._.light.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,d={}){this._validate($l,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,d){return(!d||d.validate!==!1)&&Ie(this,t.call(bi,n.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}let Fe=class extends n.E{constructor(h,t,o,d){super(),this.scope=o,this._transitionable=new n.$(new n.a0({source:new n.a1(n._.terrain.source),exaggeration:new n.a1(n._.terrain.exaggeration)}),o,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new n.a3(h)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let h=this._transitionable._values.exaggeration;if(!h)return null;let t=h.value.expression;if(!t)return null;let o=-1,d=-1,g=1;for(let y of t.zoomStops)g=t.evaluate(new n.a3(y)),g>.01?(o=y,d=-1):d=y;return g<.01&&o>0&&d>o?[o,d]:null}isZoomDependent(){let h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof n.a4}},Ve=45,je=65,Qe=.05;function at(h,t,o,d){let g=n.a7(Ve,je,o),[y,x]=gt(h,d),C=1-Math.min(1,Math.exp((t-y)/(x-y)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*g*h.alpha}function gt(h,t){let o=.5/Math.tan(.5*t);return[h.range[0]+o,h.range[1]+o]}function Pt(h,t,o,d,g){let y=n.a6.vec3.transformMat4([],[t,o,d],g.mercatorFogMatrix);return at(h,n.a6.vec3.length(y),g.pitch,g._fov)}function Bt(h,t,o,d,g,y,x){let C=[[o,d,0],[g,d,0],[g,y,0],[o,y,0]],A=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(let R of C){let F=n.a6.vec3.transformMat4([],R,t),z=n.a6.vec3.length(F);A=Math.min(A,z),O=Math.max(O,z)}return[at(h,A,x.pitch,x._fov),at(h,O,x.pitch,x._fov)]}class Vt extends n.E{constructor(t,o,d,g){super();let y=new n.a0({range:new n.a1(n._.fog.range),color:new n.a1(n._.fog.color),"high-color":new n.a1(n._.fog["high-color"]),"space-color":new n.a1(n._.fog["space-color"]),"horizon-blend":new n.a1(n._.fog["horizon-blend"]),"star-intensity":new n.a1(n._.fog["star-intensity"]),"vertical-range":new n.a1(n._.fog["vertical-range"])});this._transitionable=new n.$(y,d,new Map(g)),this.set(t,g),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new n.a8(y),this.scope=d}get state(){let t=this._transform,o=t.projection.name==="globe",d=n.a9(t.zoom),g=this.properties.get("range"),y=[.5,3];return{range:o?[n.aa(y[0],g[0],d),n.aa(y[1],g[1],d)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,d={}){if(this._validate(Hl,t,d))return;let g=n.l({},t);for(let y of Object.keys(n._.fog))g[y]===void 0&&(g[y]=n._.fog[y].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;let o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.a7(Ve,je,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?function(d,g,y){let x=n.a5.fromLngLat(g),C=y.elevation?y.elevation.getAtPointOrZero(x):0;return Pt(d,x.x,x.y,C,y)}(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];let o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Bt(this.state,o,0,0,n.ab,n.ab,this._transform)}getOpacityForBounds(t,o,d,g,y){return this._transform.projection.supportsFog?Bt(this.state,t,o,d,g,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?gt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;let o=[4,5,6,7];for(let d of o){let g=t.points[d],y;if(g[2]>=0)y=g;else{let x=t.points[d-4];y=n.ac(x,g,x[2]/(x[2]-g[2]))}if(Pt(this.state,y[0],y[1],0,this._transform)>=Qe)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,d){return(!d||d.validate!==!1)&&Ie(this,t.call(bi,n.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}class Ot extends n.E{constructor(t,o,d,g){super(),this.scope=d,this._options=t,this.properties=new n.a8(o),this._transitionable=new n.$(o,d,new Map(g)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Cn,pn;class Xt{constructor(t,o,d,g){this.screenBounds=t,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(t,o){let d,g;if(t instanceof n.P||typeof t[0]=="number"){let y=n.P.convert(t);d=[y],g=o.isPointAboveHorizon(y)}else{let y=n.P.convert(t[0]),x=n.P.convert(t[1]);d=[y,x],g=n.ae(y,x).every(C=>o.isPointAboveHorizon(C))}return new Xt(d,o.getCameraPoint(),g,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){let o=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],g=n.ae(o,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<d.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?g[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(g[3]=this.cameraPoint)),n.af(g,t)}bufferedCameraGeometryGlobe(t){let o=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],g=n.ae(o,d,t),y=this.cameraPoint.clone();switch(3*((y.y>o.y)+(y.y>d.y))+((y.x>o.x)+(y.x>d.x))){case 0:g[0]=y,g[4]=y.clone();break;case 1:g.splice(1,0,y);break;case 2:g[1]=y;break;case 3:g.splice(4,0,y);break;case 5:g.splice(2,0,y);break;case 6:g[3]=y;break;case 7:g.splice(3,0,y);break;case 8:g[2]=y}return g}containsTile(t,o,d,g=0){let y=t.queryPadding/o._pixelsPerMercatorPixel+1,x=d?this._bufferedCameraMercator(y,o):this._bufferedScreenMercator(y,o),C=t.tileID.wrap+(x.unwrapped?g:0),A=x.polygon.map(X=>n.ag(t.tileTransform,X,C));if(!n.ah(A,0,0,n.ab,n.ab))return;C=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);let O=this.screenGeometryMercator.polygon.map(X=>n.ai(t.tileTransform,X,C)),R=O.map(X=>new n.P(X[0],X[1])),F=o.getFreeCameraOptions().position||new n.a5(0,0,0),z=n.ai(t.tileTransform,F,C),j=O.map(X=>{let Z=n.a6.vec3.sub(X,X,z);return n.a6.vec3.normalize(Z,Z),new n.aj(z,Z)}),W=n.ak(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:j,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(q=n.al(A),q.min.x=n.ap(q.min.x,0,n.ab),q.min.y=n.ap(q.min.y,0,n.ab),q.max.x=n.ap(q.max.x,0,n.ab),q.max.y=n.ap(q.max.y,0,n.ab),q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:W};var q}_bufferedScreenMercator(t,o){let d=Or(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[d]=g,g}}_bufferedCameraMercator(t,o){let d=Or(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[d]=g,g}}_projectAndResample(t,o){let d=function(y,x){let C=n.a6.mat4.multiply([],x.pixelMatrix,x.globeMatrix),A=[0,-n.aq,0,1],O=[0,n.aq,0,1],R=[0,0,0,1];n.a6.vec4.transformMat4(A,A,C),n.a6.vec4.transformMat4(O,O,C),n.a6.vec4.transformMat4(R,R,C);let F=new n.P(A[0]/A[3],A[1]/A[3]),z=new n.P(O[0]/O[3],O[1]/O[3]),j=n.an(y,F)&&A[3]<R[3],W=n.an(y,z)&&O[3]<R[3];if(!j&&!W)return null;let q=function(le,he,me){for(let xe=1;xe<le.length;xe++){let _e=Kn(he.pointCoordinate3D(le[xe-1]).x),ge=Kn(he.pointCoordinate3D(le[xe]).x);if(me<0){if(_e<ge)return{idx:xe,t:-_e/(ge-1-_e)}}else if(ge<_e)return{idx:xe,t:(1-_e)/(ge+1-_e)}}return null}(y,x,j?-1:1);if(!q)return null;let{idx:X,t:Z}=q,Q=X>1?Ln(y.slice(0,X),x):[],re=X<y.length?Ln(y.slice(X),x):[];Q=Q.map(le=>new n.P(Kn(le.x),le.y)),re=re.map(le=>new n.P(Kn(le.x),le.y));let ie=[...Q];ie.length===0&&ie.push(re[re.length-1]);let ae=n.aa(ie[ie.length-1].y,(re.length===0?Q[0]:re[0]).y,Z),ue;return ue=j?[new n.P(0,ae),new n.P(0,0),new n.P(1,0),new n.P(1,ae)]:[new n.P(1,ae),new n.P(1,1),new n.P(0,1),new n.P(0,ae)],ie.push(...ue),re.length===0?ie.push(Q[0]):ie.push(...re),{polygon:ie.map(le=>new n.a5(le.x,le.y)),unwrapped:!1}}(t,o);if(d)return d;let g=function(y,x){let C=!1,A=-1/0,O=0;for(let F=0;F<y.length-1;F++)y[F].x>A&&(A=y[F].x,O=F);for(let F=0;F<y.length-1;F++){let z=(O+F)%(y.length-1),j=y[z],W=y[z+1];Math.abs(j.x-W.x)>.5&&(j.x<W.x?(j.x+=1,z===0&&(y[y.length-1].x+=1)):(W.x+=1,z+1===y.length-1&&(y[0].x+=1)),C=!0)}let R=n.am(x.center.lng);return C&&R<Math.abs(R-1)&&y.forEach(F=>{F.x-=1}),{polygon:y,unwrapped:C}}(Ln(t,o).map(y=>new n.P(Kn(y.x),y.y)),o);return{polygon:g.polygon.map(y=>new n.a5(y.x,y.y)),unwrapped:g.unwrapped}}}function Ln(h,t){return n.ao(h,o=>{let d=t.pointCoordinate3D(o);o.x=d.x,o.y=d.y},1/256)}function Kn(h){return h<0?1+h%1:h%1}function Or(h){return 100*h|0}function Br(h,t,o,d,g){let y=function(C,A){if(C)return g(C);if(A){if(h.url&&A.tiles&&h.tiles&&delete h.tiles,A.variants){if(!Array.isArray(A.variants))return g(new Error("variants must be an array"));for(let R of A.variants){if(R==null||typeof R!="object"||R.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(R.capabilities))return g(new Error("capabilities must be an array"));if(R.capabilities.length===1&&R.capabilities[0]==="meshopt"){A=n.l(A,R);break}}}let O=n.ar(n.l({},A,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);O.tiles=t.canonicalizeTileset(O,h.url),g(null,O)}},x=function(C,A,O){if(!C)return null;if(!A&&!O)return C;O=O||C.worldview_default;let R=Object.values(C.language||{});if(R.length===0)return null;let F=Object.values(C.worldview||{});if(F.length===0)return null;let z=R.every(W=>W===A),j=F.every(W=>W===O);return z&&j?C:A in(C.language_options||{})||O in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(h.data,o,d);return x?n.q.frame(()=>y(null,x)):h.url?n.n(t.transformRequest(t.normalizeSourceURL(h.url,null,o,d),n.R.Source),y):n.q.frame(()=>{let O=h,{data:C}=O,A=tp(O,["data"]);y(null,A)})}class Dr{constructor(t,o,d){this.bounds=n.as.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){let o=Math.pow(2,t.z),d=Math.floor(n.am(this.bounds.getWest())*o),g=Math.floor(n.at(this.bounds.getNorth())*o),y=Math.ceil(n.am(this.bounds.getEast())*o),x=Math.ceil(n.at(this.bounds.getSouth())*o);return t.x>=d&&t.x<y&&t.y>=g&&t.y<x}}class Vr extends n.E{constructor(t,o,d,g){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.l(this,n.ar(o,["url","scheme","tileSize","promoteId"])),this._options=n.l({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new n.au}load(t){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Br(this._options,this.map._requestManager,o,d,(g,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new n.t(g));else if(y){if(n.l(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(let x of y.vector_layers)this.vectorLayerIds.push(x.id),y.worldview&&y.worldview[x.source]&&this.localizableLayerIds.add(x.id)}y.bounds&&(this.tileBounds=new Dr(y.bounds,this.minzoom,this.maxzoom)),va(y.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}t&&t(g)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}loadTile(t,o){let d=t.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(d),y=this.map._requestManager.transformRequest(g,n.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,C=x?{image:x.image.clone()}:null,A={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&n.f(d)&&(A.worldview=this.map.getWorldview()||this.worldviewDefault,A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",A,O.bind(this));else if(t.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",A,O.bind(this),void 0,!0);else{let R=n.aw.call({deduped:this._deduped},A,(F,z)=>{F||!z?O.call(this,F):(A.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},t.actor&&t.actor.send("loadTile",A,O.bind(this),void 0,!0))},!0);t.request={cancel:R}}function O(R,F){return delete t.request,t.aborted?o(null):R&&R.status!==404?o(R):(F&&F.resourceTiming&&(t.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&t.setExpiryData(F),t.loadVectorData(F,this.map.painter),n.ax(this.dispatcher),o(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class gs extends n.E{constructor(t,o,d,g){super(),this.id=t,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.l({type:"raster"},o),n.l(this,n.ar(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._tileJSONRequest=Br(this._options,this.map._requestManager,null,null,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new n.t(o)):d&&(n.l(this,d),d.raster_layers&&(this.rasterLayers=d.raster_layers,this.rasterLayerIds=this.rasterLayers.map(g=>g.id)),d.bounds&&(this.tileBounds=new Dr(d.bounds,this.minzoom,this.maxzoom)),va(d.tiles),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),t&&t(o)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){let d=n.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=n.o(this.map._requestManager.transformRequest(g,n.R.Tile),(y,x,C,A)=>(delete t.request,t.aborted?(t.state="unloaded",o(null)):y?(t.state="errored",o(y)):x?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:C,expires:A}),t.setTexture(x,this.map.painter),t.state="loaded",n.ax(this.dispatcher),void o(null)):o(null)))}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof n.T?(t.destroy(!0),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class po extends gs{constructor(t,o,d,g){super(t,o,d,g),this.type="raster-array",this.maxzoom=22,this._options=n.l({type:"raster-array"},o)}triggerRepaint(t){let o=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);o&&o.enabled&&d&&o._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){let d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(d,n.R.Tile);t.requestParams=g,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(y,x,C,A)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(y)return y.code===20?void 0:(t.state="errored",o(y));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:C,expires:A}),t.state="empty",o(null)})}unloadTile(t,o){let d=t.texture;d&&d instanceof n.T?(t.destroy(!0),this.map.painter.saveTileTexture(d)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,o,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(o,d,(g,y)=>{if(g)return t.state="errored",this.fire(new n.t(g)),void this.triggerRepaint(t);y&&(t.setTexture(y,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;let o=this.rasterLayers.find(({id:y})=>y===t),d=o&&o.fields,g=d&&d.bands&&d.bands;return g?g[0]:0}getTextureDescriptor(t,o,d){if(!t)return;let g=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let y=null;o instanceof n.aB?y=o.paint.get("raster-array-band"):o instanceof n.aC&&(y=o.paint.get("raster-particle-array-band"));let x=y||this.getInitialBand(g);if(x!=null)if(t.textureDescriptor){if(!t.updateNeeded(g,x)||d)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,g,x)}}let au={vector:Vr,raster:gs,"raster-dem":class extends gs{constructor(h,t,o,d){super(h,t,o,d),this.type="raster-dem",this.maxzoom=22,this._options=n.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){let o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(g,y){g&&(h.state="errored",t(g)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=n.o(this.map._requestManager.transformRequest(o,n.R.Tile),function(g,y,x,C){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(g)h.state="errored",t(g);else if(y){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:x,expires:C});let A=ImageBitmap&&y instanceof ImageBitmap&&n.ay(),O=1-(y.width-n.az(y.width))/2;O<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));let R=A?y:n.q.getImageData(y,O),F={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:R,encoding:this.encoding,padding:O};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",F,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){let t=h.canonical,o=Math.pow(2,t.z),d=(t.x-1+o)%o,g=t.x===0?h.wrap-1:h.wrap,y=(t.x+1+o)%o,x=t.x+1===o?h.wrap+1:h.wrap,C={};return C[new n.aA(h.overscaledZ,g,t.z,d,t.y).key]={backfilled:!1},C[new n.aA(h.overscaledZ,x,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(C[new n.aA(h.overscaledZ,g,t.z,d,t.y-1).key]={backfilled:!1},C[new n.aA(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},C[new n.aA(h.overscaledZ,x,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<o&&(C[new n.aA(h.overscaledZ,g,t.z,d,t.y+1).key]={backfilled:!1},C[new n.aA(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},C[new n.aA(h.overscaledZ,x,t.z,y,t.y+1).key]={backfilled:!1}),C}},"raster-array":po,geojson:class extends n.E{constructor(h,t,o,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(d),this._data=t.data,this._options=n.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;let g=n.ab/this.tileSize;this.workerOptions=n.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*g,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*g,extent:n.ab,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.ab,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new n.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new n.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let t=new Map;for(let o of this._data.features)t.set(o.id,o);for(let o of h.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,o,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:o},d),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.x("dataloading",{dataType:"source"})),this._loaded=!1;let t=n.l({append:h},this.workerOptions);t.scope=this.scope;let o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(n.q.resolveURL(o),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,g)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new n.t(d));else{let y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(y.resourceTiming=g.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new n.x("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,t){let o=h.actor?"reloadTile":"loadTile";h.actor=this.actor;let d=this.map.style?this.map.style.getLut(this.scope):null,g=d?{image:d.image.clone()}:null,y=this._partialReload,x={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:y};h.request=this.actor.send(o,x,(C,A)=>y&&!A?(h.state="loaded",t(null)):(delete h.request,h.destroy(),h.aborted?t(null):C?t(C):(h.loadVectorData(A,this.map.painter,o==="reloadTile"),t(null))),void 0,o==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aD{constructor(h,t,o,d){super(h,t,o,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;let h=this.options;this.urls=[];for(let t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aE(this.urls,(t,o)=>{this._loaded=!0,t?this.fire(new n.t(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){let t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new n.t(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aD,model:class extends n.E{constructor(h,t,o,d){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){let h=[];for(let t in this._options.models){let o=this._options.models[t],d=n.aG(this.map._requestManager.transformRequest(o.uri,n.R.Model).url).then(g=>{if(!g)return;let y=n.aH(g),x=new n.aI(t,o.position,o.orientation,y);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(g=>{this.fire(new n.t(new Error(`Could not load model ${t} from ${o.uri}: ${g.message}`)))});h.push(d)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new n.t(new Error(`Could not load models: ${t.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,t){}serialize(){return{type:"model"}}},"batched-model":class extends n.E{constructor(h,t,o,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}load(h){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));let t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=Br(this._options,this.map._requestManager,t,o,(d,g)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new n.t(d))):g&&(n.l(this,g),g.bounds&&(this.tileBounds=new Dr(g.bounds,this.minzoom,this.maxzoom)),va(g.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){let o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(o,n.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){let y=Object.values(h.buckets);for(let x of y)x.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,g.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,g.bind(this),void 0,!0);function g(y,x){return h.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&x&&h.setExpiryData(x),h.loadModelData(x,this.map.painter),h.state="loaded",void t(null))}}serialize(){return n.l({},this._options)}},canvas:class extends n.aD{constructor(h,t,o,d){super(h,t,o,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(y=>typeof y!="number"))||this.fire(new n.t(new n.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.t(new n.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.t(new n.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.t(new n.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.t(new n.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof n.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends n.E{constructor(h,t,o,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Dr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),n.l(this,n.ar(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){let{x:t,y:o,z:d}=h.canonical;return this._implementation.hasTile({x:t,y:o,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){let{x:o,y:d,z:g}=h.tileID.canonical,y=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:o,y:d,z:g},{signal:y.signal})).then(function(x){return delete h.request,h.aborted?(h.state="unloaded",t(null)):x===void 0?(h.state="errored",t(null)):x===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(x)?(this.loadTileData(h,x),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(x=>{x.code!==20&&(h.state="errored",t(x))}),h.request.cancel=()=>y.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof n.T?(h.destroy(!0),h.texture&&h.texture instanceof n.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){let{x:o,y:d,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:o,y:d,z:g})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){let h=n.av(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}}},lu=function(h,t,o,d){let g=new au[t.type](h,t,o,d);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return n.aJ(["load","abort","unload","serialize","prepare"],g),g};function cu(h,t){let o=n.a6.mat4.identity([]);return n.a6.mat4.scale(o,o,[.5*h.width,.5*-h.height,1]),n.a6.mat4.translate(o,o,[1,-1,0]),n.a6.mat4.multiply(o,o,h.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(o)}function od(h,t,o,d,g,y,x,C,A=!1){let O=h.tilesIn(o,C,A);O.sort(Sa);let R=[];for(let z of O)R.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,h._state,z,d,g,y,x,cu(h.transform,z.tile.tileID),A)});let F=function(z){let j={},W={};for(let q of z){let X=q.queryResults,Z=q.wrappedTileID,Q=W[Z]=W[Z]||{};for(let re in X){let ie=X[re],ae=Q[re]=Q[re]||{},ue=j[re]=j[re]||[];for(let le of ie)ae[le.featureIndex]||(ae[le.featureIndex]=!0,ue.push(le))}}return j}(R);for(let z in F)F[z].forEach(j=>{let W=j.feature,q=W.layer;q&&q.type!=="background"&&q.type!=="sky"&&q.type!=="slot"&&(n.aK(z)||(W.source=q.source,q["source-layer"]&&(W.sourceLayer=q["source-layer"])),W.state=W.id!==void 0?h.getFeatureState(q["source-layer"],W.id):{})});return F}function sd(h,t){let o=h.getRenderableIds().map(y=>h.getTileByID(y)),d=[],g={};for(let y=0;y<o.length;y++){let x=o[y],C=x.tileID.canonical.key;g[C]||(g[C]=!0,x.querySourceFeatures(d,t))}return d}function Sa(h,t){let o=h.tileID,d=t.tileID;return o.overscaledZ-d.overscaledZ||o.canonical.y-d.canonical.y||o.wrap-d.wrap||o.canonical.x-d.canonical.x}function Da(h,t){let o={};if(!t)return o;for(let d of h){let g=d.layerIds.map(y=>t.getLayer(y)).filter(Boolean);if(g.length!==0){d.layers=g,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(y=>g.filter(x=>x.id===y)[0]));for(let y of g)o[y.fqid]=d}}return o}let Fi=32,Wi=33,Zi=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,o=0,d=0,g=0,y=0,x=0,C=0;for(1&t?g=y=x=Fi:o=d=C=Fi;(t>>=1)>1;){let O=o+g>>1,R=d+y>>1;1&t?(g=o,y=d,o=x,d=C):(o=g,d=y,g=x,y=C),x=O,C=R}let A=4*h;Zi[A+0]=o,Zi[A+1]=d,Zi[A+2]=g,Zi[A+3]=y}let ui=new Uint16Array(2178),mo=new Uint8Array(1089),ql=new Uint16Array(1089);function ad(h){return h===0?-.03125:h===32?.03125:0}let ld={type:2,extent:n.ab,loadGeometry:()=>[[new n.P(0,0),new n.P(n.ab+1,0),new n.P(n.ab+1,n.ab+1),new n.P(0,n.ab+1),new n.P(0,0)]]};class go{constructor(t,o,d,g,y){this.tileID=t,this.uid=n.aQ(),this.uses=0,this.tileSize=o,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(t){let o=t+this.timeAdded;o<n.q.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aL(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Da(t.buckets,o.style),this.hasSymbolBuckets=!1;for(let g in this.buckets){let y=this.buckets[g];if(y instanceof n.aS){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let g in this.buckets){let y=this.buckets[g];if(y instanceof n.aS&&y.hasRTLText){this.hasRTLText=!0,n.aT();break}}this.queryPadding=0;for(let g in this.buckets){let y=this.buckets[g],x=o.style.getOwnLayer(g);if(!x)continue;let C=x.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,C)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.aR}unloadVectorData(){if(this.hasData()){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=kt(kt({},this.buckets),Da(t.buckets,o.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(let g in this.buckets){let y=this.buckets[g];y.uploadPending()&&y.upload(t)}let o=t.gl,d=this.imageAtlas;if(d&&!d.uploaded){let g=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new n.T(t,d.image,o.RGBA8,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let g=o.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this._lastUpdatedBrightness=g,this.updateBuckets(o)))}queryRenderedFeatures(t,o,d,g,y,x,C,A,O){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:A,transform:C,filter:g,layers:y,availableImages:x,tileTransform:this.tileTransform},t,o):{}}querySourceFeatures(t,o){let d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;let g=d.loadVTLayers(),y=o?o.sourceLayer:"",x=g._geojsonTileLayer||g[y];if(!x)return;let C=n.aU(o&&o.filter),{z:A,x:O,y:R}=this.tileID.canonical,F={z:A,x:O,y:R};for(let z=0;z<x.length;z++){let j=x.feature(z);if(C.needGeometry){let X=n.aV(j,!0);if(!C.filter(new n.a3(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!C.filter(new n.a3(this.tileID.overscaledZ),j))continue;let W=d.getId(j,y),q=new n.aW(j,A,O,R,W);q.tile=F,t.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let o=this.expirationTime;if(t.cacheControl){let d=n.aX(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let d=Date.now(),g=!1;if(this.expirationTime>d)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{let y=this.expirationTime-o;y?this.expirationTime=d+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t){if(!this.latestFeatureIndex)return;let o=this.latestFeatureIndex.loadVTLayers(),d=t.style.listImages(),g=t.style.getBrightness();for(let y in this.buckets){if(!t.style.hasLayer(y))continue;let x=this.buckets[y],C=x.layers[0],A=C.sourceLayer||"_geojsonTileLayer",O=o[A],R=t.style.getSourceCache(C.source,C.scope),F={};R&&(F=R._state.getState(A,void 0)),x.update(F,O,d,this.imageAtlas&&this.imageAtlas.patternPositions||{},g),(x instanceof n.aY||x instanceof n.aZ)&&t._terrain&&t._terrain.enabled&&R&&x.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(R.id,this.tileID);let z=t&&t.style&&t.style.getOwnLayer(y);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.q.now()+t}setTexture(t,o){let d=o.context,g=d.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(d,t,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(t,o){let d={};for(let g of o)d[g]=!0;this.dependencies[t]=d}hasDependency(t,o){for(let d of t){let g=this.dependencies[d];if(g){for(let y of o)if(g[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;let d=n.a_(ld,this.tileID.canonical,this.tileTransform)[0],g=new n.a$,y=new n.b0;for(let x=0;x<d.length;x++){let{x:C,y:A}=d[x];g.emplaceBack(C,A),y.emplaceBack(x)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(g,n.b1.members),this._tileDebugSegments=n.b2.simpleSegment(0,0,g.length,y.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;let d=n.a_(ld,this.tileID.canonical,this.tileTransform)[0],g,y;if(this.isRaster){let x=function(C,A){let O=n.aL(C,A),R=Math.pow(2,C.z);for(let X=0;X<Wi;X++)for(let Z=0;Z<Wi;Z++){let Q=n.aM((C.x+(Z+ad(Z))/Fi)/R),re=n.aN((C.y+(X+ad(X))/Fi)/R),ie=A.project(Q,re),ae=X*Wi+Z;ui[2*ae+0]=Math.round((ie.x*O.scale-O.x)*n.ab),ui[2*ae+1]=Math.round((ie.y*O.scale-O.y)*n.ab)}mo.fill(0),ql.fill(0);for(let X=2045;X>=0;X--){let Z=4*X,Q=Zi[Z+0],re=Zi[Z+1],ie=Zi[Z+2],ae=Zi[Z+3],ue=Q+ie>>1,le=re+ae>>1,he=ue+le-re,me=le+Q-ue,xe=re*Wi+Q,_e=ae*Wi+ie,ge=le*Wi+ue,Oe=Math.hypot((ui[2*xe+0]+ui[2*_e+0])/2-ui[2*ge+0],(ui[2*xe+1]+ui[2*_e+1])/2-ui[2*ge+1])>=16;mo[ge]=mo[ge]||(Oe?1:0),X<1022&&(mo[ge]=mo[ge]||mo[(re+me>>1)*Wi+(Q+he>>1)]||mo[(ae+me>>1)*Wi+(ie+he>>1)])}let F=new n.aO,z=new n.aP,j=0;function W(X,Z){let Q=Z*Wi+X;return ql[Q]===0&&(F.emplaceBack(ui[2*Q+0],ui[2*Q+1],X*n.ab/Fi,Z*n.ab/Fi),ql[Q]=++j),ql[Q]-1}function q(X,Z,Q,re,ie,ae){let ue=X+Q>>1,le=Z+re>>1;if(Math.abs(X-ie)+Math.abs(Z-ae)>1&&mo[le*Wi+ue])q(ie,ae,X,Z,ue,le),q(Q,re,ie,ae,ue,le);else{let he=W(X,Z),me=W(Q,re),xe=W(ie,ae);z.emplaceBack(he,me,xe)}}return q(0,0,Fi,Fi,Fi,0),q(Fi,Fi,0,0,0,Fi),{vertices:F,indices:z}}(this.tileID.canonical,o);g=x.vertices,y=x.indices}else{g=new n.aO,y=new n.aP;for(let{x:C,y:A}of d)g.emplaceBack(C,A,0,0);let x=n.b3(g.int16,void 0,4);for(let C=0;C<x.length;C+=3)y.emplaceBack(x[C],x[C+1],x[C+2])}this._tileBoundsBuffer=t.createVertexBuffer(g,n.b4.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=n.b2.simpleSegment(0,0,g.length,y.length)}_makeGlobeTileDebugBuffers(t,o){let d=o.projection;if(!d||d.name!=="globe"||o.freezeTileCoverage)return;let g=this.tileID.canonical,y=n.b5(g,o),x=n.b6(y),C=n.a9(o.zoom),A;C>0&&(A=n.a6.mat4.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,g,o,x,A,C),this._makeGlobeTileDebugTextBuffer(t,g,o,x,A,C)}_globePoint(t,o,d,g,y,x,C){let A=n.b7(t,o,d);if(x){let O=1<<d.z,R=n.am(g.center.lng),F=n.at(g.center.lat),z=(d.x+.5)/O-R,j=0;z>.5?j=-1:z<-.5&&(j=1);let W=(t/n.ab+d.x)/O+j,q=(o/n.ab+d.y)/O;W=(W-R)*g._pixelsPerMercatorPixel+R,q=(q-F)*g._pixelsPerMercatorPixel+F;let X=[W*g.worldSize,q*g.worldSize,0];n.a6.vec3.transformMat4(X,X,x),A=n.b8(A,X,C)}return n.a6.vec3.transformMat4(A,A,y)}_makeGlobeTileDebugBorderBuffer(t,o,d,g,y,x){let C=new n.a$,A=new n.b0,O=new n.b9,R=(z,j,W,q,X)=>{let Z=(W-z)/(X-1),Q=(q-j)/(X-1),re=C.length;for(let ie=0;ie<X;ie++){let ae=z+ie*Z,ue=j+ie*Q;C.emplaceBack(ae,ue);let le=this._globePoint(ae,ue,o,d,g,y,x);O.emplaceBack(le[0],le[1],le[2]),A.emplaceBack(re+ie)}},F=n.ab;R(0,0,F,0,16),R(F,0,F,F,16),R(F,F,0,F,16),R(0,F,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(C,n.b1.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(O,n.ba.members),this._tileDebugSegments=n.b2.simpleSegment(0,0,C.length,A.length)}_makeGlobeTileDebugTextBuffer(t,o,d,g,y,x){let C=n.ab/4,A=new n.a$,O=new n.aP,R=new n.b9,F=25;O.reserve(32),A.reserve(F),R.reserve(F);let z=(j,W)=>F*j+W;for(let j=0;j<F;j++){let W=j*C;for(let q=0;q<F;q++){let X=q*C;A.emplaceBack(X,W);let Z=this._globePoint(X,W,o,d,g,y,x);R.emplaceBack(Z[0],Z[1],Z[2])}}for(let j=0;j<4;j++)for(let W=0;W<4;W++){let q=z(j,W),X=z(j,W+1),Z=z(j+1,W),Q=z(j+1,W+1);O.emplaceBack(q,X,Z),O.emplaceBack(Z,X,Q)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(O),this._tileDebugTextBuffer=t.createVertexBuffer(A,n.b1.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(R,n.ba.members),this._tileDebugTextSegments=n.b2.simpleSegment(0,0,F,32)}destroy(t=!1){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bb.setPbf(n.bc);class uu extends go{constructor(t,o,d,g,y){super(t,o,d,g,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,o){let d=o.context,g=d.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t,{premultiply:!1}):this.texture=new n.T(d,t,g.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,o){let d=this._mrt=new n.bb(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.bd(g,(y,x,C,A)=>{if(y)o(y);else try{let O=d.getHeaderLength(x);if(O>t)return void(this.request=this.fetchHeader(O,o));d.parseHeader(x),this._isHeaderLoaded=!0;let R=0;for(let F of Object.values(d.layers))R=Math.max(R,F.dataIndex[F.dataIndex.length-1].last_byte);x.byteLength>=R&&(this.entireBuffer=x),o(null,this.entireBuffer||x,C,A)}catch(O){o(O)}}),this.request}fetchBand(t,o,d){let g=this._mrt;if(!this._isHeaderLoaded||!g)return void d(new Error("Tile header is not ready"));let y=this.actor;if(!y)return void d(new Error("Can't fetch tile band without an actor"));let x,C=(F,z)=>{x.complete(F,z),F?d(F):(this.updateTextureDescriptor(t,o),d(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(F,z)=>{if(F)return d(F);let j=y.send("decodeRasterArray",{buffer:z,task:x},C,void 0,!0);this._workQueue.push(()=>{j&&j.cancel(),x.cancel()})},O=g.getLayer(t);if(!O)return void d(new Error(`Unknown sourceLayer "${t}"`));if(O.hasDataForBand(o))return this.updateTextureDescriptor(t,o),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);let R=O.getDataRange([o]);if(x=g.createDecodingTask(R),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(R.firstByte,R.lastByte+1));else{let F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${R.firstByte}-${R.lastByte}`}}),z=n.bd(F,A);this._fetchQueue.push(()=>{z.cancel(),x.cancel()})}else d(null)}updateNeeded(t,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,o){if(!this._mrt)return;let d=this._mrt.getLayer(t);if(!d||!d.hasBand(o)||!d.hasDataForBand(o))return;let{bytes:g,tileSize:y,buffer:x,offset:C,scale:A}=d.getBandView(o),O=y+2*x,R={data:g,width:O,height:O},F=this.texture;F&&F instanceof n.T&&F.update(R,{premultiply:!1}),this.textureDescriptor={layer:t,band:o,img:R,buffer:x,offset:C,tileSize:y,format:d.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class nm{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(let t in this.data)for(let o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,d){let g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);let y={value:o,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},d)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){let o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;let d=t.wrapped().key,g=o===void 0?0:this.data[d].indexOf(o),y=this.data[d][g];return this.data[d].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){let o=[];for(let d in this.data)for(let g of this.data[d])t(g.value)||o.push(g);for(let d of o)this.remove(d.value.tileID,d)}}class tv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,d){let g=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},n.l(this.stateChanges[t][g],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(let y in this.state[t])y!==g&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(let y in this.state[t][g])d[y]||(this.deletedStates[t][g][y]=null)}else for(let y in d)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][y]===null&&delete this.deletedStates[t][g][y]}removeFeatureState(t,o,d){if(this.deletedStates[t]===null)return;let g=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&o!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][d]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(d in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][d]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,o){let d=this.state[t]||{},g=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(o!==void 0){let C=String(o),A=n.l({},d[C],g[C]);if(y){let O=y[o];if(O===null)return{};for(let R in O)delete A[R]}return A}let x=n.l({},d,g);if(y)for(let C in y)delete x[C];return x}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){let d={};for(let g in this.stateChanges){this.state[g]=this.state[g]||{};let y={};for(let x in this.stateChanges[g])this.state[g][x]||(this.state[g][x]={}),n.l(this.state[g][x],this.stateChanges[g][x]),y[x]=this.state[g][x];d[g]=y}for(let g in this.deletedStates){this.state[g]=this.state[g]||{};let y={};if(this.deletedStates[g]===null)for(let x in this.state[g])y[x]={},this.state[g][x]={};else for(let x in this.deletedStates[g]){if(this.deletedStates[g][x]===null)this.state[g][x]={};else if(this.state[g][x])for(let C of Object.keys(this.deletedStates[g][x]))delete this.state[g][x][C];y[x]=this.state[g][x]}d[g]=d[g]||{},n.l(d[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(let g in t)t[g].refreshFeatureState(o)}}class hi extends n.E{constructor(t,o,d){super(),this.id=t,this._onlySymbols=d,o.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new nm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new tv,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let t in this._tiles){let o=this._tiles[t];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let o in this._tiles){let d=this._tiles[o];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return n.be(this._tiles).map(t=>t.tileID).sort(_s).map(t=>t.key)}getRenderableIds(t,o){let d=[];for(let g in this._tiles)this._isIdRenderable(+g,t,o)&&d.push(this._tiles[g]);return t?d.sort((g,y)=>{let x=g.tileID,C=y.tileID,A=new n.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),O=new n.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-C.overscaledZ||O.y-A.y||O.x-A.x}).map(g=>g.tileID.key):d.map(g=>g.tileID).sort(_s).map(g=>g.key)}hasRenderableParent(t){let o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){let d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=o),this._loadTile(d,this._tileLoaded.bind(this,d,t,o)))}_tileLoaded(t,o,d,g){if(g)if(t.state="errored",g.status!==404)this._source.fire(new n.t(g,{tile:t}));else{if(this._source.fire(new n.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=n.q.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new n.x("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){let o=this.getRenderableIds();for(let g=0;g<o.length;g++){let y=o[g];if(t.neighboringTiles&&t.neighboringTiles[y]){let x=this.getTileByID(y);d(t,x),d(x,t)}}function d(g,y){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let x=y.tileID.canonical.x-g.tileID.canonical.x,C=y.tileID.canonical.y-g.tileID.canonical.y,A=Math.pow(2,g.tileID.canonical.z),O=y.tileID.key;x===0&&C===0||Math.abs(C)>1||(Math.abs(x)>1&&(Math.abs(x+A)===1?x+=A:Math.abs(x-A)===1&&(x-=A)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,x,C),g.neighboringTiles&&g.neighboringTiles[O]&&(g.neighboringTiles[O].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,d,g){for(let y in this._tiles){let x=this._tiles[y];if(g[y]||!x.hasData()||x.tileID.overscaledZ<=o||x.tileID.overscaledZ>d)continue;let C=x.tileID;for(;x&&x.tileID.overscaledZ>o+1;){let O=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[O.key],x&&x.hasData()&&(C=O)}let A=C;for(;A.overscaledZ>o;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){g[C.key]=C;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){let d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=o?d:null}for(let d=t.overscaledZ-1;d>=o;d--){let g=t.scaledTo(d),y=this._getLoadedTile(g);if(y)return y}}_getLoadedTile(t){let o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;let d=Math.ceil(t.width/o)+1,g=Math.ceil(t.height/o)+1,y=Math.floor(d*g*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(C)}handleWrapJump(t){let o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){let d={};for(let g in this._tiles){let y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),d[y.tileID.key]=y}this._tiles=d;for(let g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(let g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(t,o,d,g){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let y=this._source.type==="batched-model",x,C=this._source.maxzoom,A=this.map&&this.map.painter?this.map.painter._terrain:null;if(A&&A.sourceCache===this&&A.attenuationRange()){let F=A.attenuationRange()[0],z=Math.floor(F)-Math.log2(A.getDemUpscale());C>z&&(C=z)}if(this.used||this.usedForTerrain){if(this._source.tileID)x=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new n.aA(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y));else if(this.tileCoverLift!==0){let F=t.clone();F.tileCoverLift=this.tileCoverLift,x=F.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.minzoom<=1&&t.projection.name==="globe"&&(x.push(new n.aA(1,0,1,0,0)),x.push(new n.aA(1,0,1,1,0)),x.push(new n.aA(1,0,1,0,1)),x.push(new n.aA(1,0,1,1,1)))}else if(x=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.hasTile){let F=this._source.hasTile.bind(this._source);x=x.filter(z=>F(z))}}else x=[];if(x.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Wl(this._source.type)){let F=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),z=Math.min(F,this._source.maxzoom);if(y){let j=t.extendTileCover(x,z);for(let W of j)x.push(W)}else{let j=t.extendTileCover(x,z,g);for(let W of j)this._shadowCasterTiles[W.key]=!0,x.push(W)}}let O=this._updateRetainedTiles(x);if(Wl(this._source.type)&&x.length!==0){let F={},z={},j=Object.keys(O);for(let q of j){let X=O[q],Z=this._tiles[q];if(!Z||Z.fadeEndTime&&Z.fadeEndTime<=n.q.now())continue;let Q=this.findLoadedParent(X,Math.max(X.overscaledZ-hi.maxOverzooming,this._source.minzoom));Q&&(this._addTile(Q.tileID),F[Q.tileID.key]=Q.tileID),z[q]=X}let W=x[x.length-1].overscaledZ;for(let q in this._tiles){let X=this._tiles[q];if(O[q]||!X.hasData())continue;let Z=X.tileID;for(;Z.overscaledZ>W;){Z=Z.scaledTo(Z.overscaledZ-1);let Q=this._tiles[Z.key];if(Q&&Q.hasData()&&z[Z.key]){O[q]=X.tileID;break}}}for(let q in F)O[q]||(this._coveredTiles[q]=!0,O[q]=F[q])}for(let F in O)this._tiles[F].clearFadeHold();let R=n.bf(this._tiles,O);for(let F of R){let z=this._tiles[F];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){let o={};if(t.length===0)return o;let d={},g=t.reduce((O,R)=>Math.min(O,R.overscaledZ),1/0),y=t[0].overscaledZ,x=Math.max(y-hi.maxOverzooming,this._source.minzoom),C=Math.max(y+hi.maxUnderzooming,this._source.minzoom),A={};for(let O of t){let R=this._addTile(O);o[O.key]=O,R.hasData()||g<this._source.maxzoom&&(A[O.key]=O)}this._retainLoadedChildren(A,g,C,o);for(let O of t){let R=this._tiles[O.key];if(R.hasData())continue;if(O.canonical.z>=this._source.maxzoom){let z=O.children(this._source.maxzoom)[0],j=this.getTile(z);if(j&&j.hasData()){o[z.key]=z;continue}}else{let z=O.children(this._source.maxzoom);if(o[z[0].key]&&o[z[1].key]&&o[z[2].key]&&o[z[3].key])continue}let F=R.wasRequested();for(let z=O.overscaledZ-1;z>=x;--z){let j=O.scaledTo(z);if(d[j.key]||(d[j.key]=!0,R=this.getTile(j),!R&&F&&(R=this._addTile(j)),R&&(o[j.key]=j,F=R.wasRequested(),R.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let o=[],d,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}o.push(g.key);let y=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;g=y}for(let y of o)this._loadedParentTiles[y]=d}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));let d=!!o;if(!d){let g=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new uu(t,y,this.transform.tileZoom,g,this._isRaster):new go(t,y,this.transform.tileZoom,g,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o?(o.uses++,this._tiles[t.key]=o,d||this._source.fire(new n.x("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let d=o.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){let o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,d){let g=[],y=this.transform;if(!y)return g;let x=y.projection.name==="globe",C=n.am(y.center.lng);for(let A in this._tiles){let O=this._tiles[A];if(d&&O.clearQueryDebugViz(),O.holdingForFade())continue;let R;if(x){let F=O.tileID.canonical;if(F.z===0){let z=[Math.abs(n.ap(C,...Ca(F,-1))-C),Math.abs(n.ap(C,...Ca(F,1))-C)];R=[0,2*z.indexOf(Math.min(...z))-1]}else{let z=[Math.abs(n.ap(C,...Ca(F,-1))-C),Math.abs(n.ap(C,...Ca(F,0))-C),Math.abs(n.ap(C,...Ca(F,1))-C)];R=[z.indexOf(Math.min(...z))-1]}}else R=[0];for(let F of R){let z=t.containsTile(O,y,o,F);z&&g.push(z)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){let d=this.getRenderableIds(t,o).map(y=>this._tiles[y].tileID),g=this.transform.projection.name==="globe";for(let y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=g?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return d}sortCoordinatesByDistance(t){let o=t.slice(),d=this.transform._camera.position,g=this.transform._camera.forward(),y={};for(let x of o){let C=1/(1<<x.canonical.z);y[x.key]=((x.canonical.x+.5)*C+x.wrap-d[0])*g[0]+((x.canonical.y+.5)*C-d[1])*g[1]-d[2]*g[2]}return o.sort((x,C)=>y[x.key]-y[C.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(Wl(this._source.type))for(let t in this._tiles){let o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(t,o,d){this._state.updateState(t=t||"_geojsonTileLayer",o,d)}removeFeatureState(t,o,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,d)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,d){let g=this._tiles[t];g&&g.setDependencies(o,d)}reloadTilesForDependencies(t,o){for(let d in this._tiles)this._tiles[d].hasDependency(t,o)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,o))}_preloadTiles(t,o){if(!this._sourceLoaded){let A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,o))};return void this._source.on("data",A)}let d=new Map,g=Array.isArray(t)?t:[t],y=this.map.painter.terrain,x=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(let A of g){let O=A.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let R of O)d.set(R.key,R);this.usedForTerrain&&A.updateElevation(!1)}let C=Array.from(d.values());n.bg(C,(A,O)=>{let R=new go(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,F=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),O(F,R)})},o)}}function _s(h,t){let o=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||d-o||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function Wl(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Ca(h,t){let o=1<<h.z;return[h.x/o+t,(h.x+1)/o+t]}hi.maxOverzooming=10,hi.maxUnderzooming=3;class cd{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let t=!1,o=!1;for(let d in this.style._mergedLayers){let g=this.style._mergedLayers[d];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:t,visibilityChanged:o});else if(g.type==="model"){let y=this.style.getLayerSource(g);y&&y.type==="batched-model"&&this.layers.push({layer:g,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(let o of this.layers){let d=o.layer,g=!1;d.type==="fill-extrusion"?g=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(g=!d.isHidden(t)&&d.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!g&&o.visible,o.visible=g}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(let g of this.layers){let y=g.layer,x=this.style.getLayerSourceCache(y),C=1;y.type==="fill-extrusion"&&(C=g.visible?y.paint.get("fill-extrusion-vertical-scale"):0);let A=x?x.getTile(o):null;if(!A&&x&&o.canonical.z>x.getSource().minzoom){let O=o.scaledTo(Math.min(x.getSource().maxzoom,o.overscaledZ-1));for(;O.overscaledZ>=x.getSource().minzoom&&(A=x.getTile(O),!A&&O.overscaledZ!==0);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(y):null,tileID:A?A.tileID:o,verticalScale:C})}t.hasAnyZOffset=!1;let d=!1;for(let g=0;g<t.symbolInstances.length;g++){let y=t.symbolInstances.get(g),x=y.zOffset,C=this._getHeightAtTileOffset(o,y.tileAnchorX,y.tileAnchorY);y.zOffset=C!==Number.NEGATIVE_INFINITY?C:x,d||x===y.zOffset||(d=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,d,g){let y=o,x=d;if(t.canonical.z!==g.canonical.z){let C=g.canonical,A=1/(1<<t.canonical.z-C.z);y=(o+t.canonical.x*n.ab)*A-C.x*n.ab|0,x=(d+t.canonical.y*n.ab)*A-C.y*n.ab|0}return{tileX:y,tileY:x}}_getHeightAtTileOffset(t,o,d){let g,y;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;let{bucket:C,tileID:A,verticalScale:O}=this.currentBuildingBuckets[x];if(!C)continue;let{tileX:R,tileY:F}=this._mapCoordToOverlappingTile(t,o,d,A),z=C.getHeightAtTileCoord(R,F);z&&z.height!==void 0&&(z.hidden?g=z.height:y=Math.max(z.height*O,y||0))}if(y!==void 0)return y;for(let x=0;x<this.layers.length;++x){let C=this.layers[x];if(C.layer.type!=="model"||!C.visible)continue;let{bucket:A,tileID:O}=this.currentBuildingBuckets[x];if(!A)continue;let{tileX:R,tileY:F}=this._mapCoordToOverlappingTile(t,o,d,O),z=A.getHeightAtTileCoord(R,F);if(z&&!z.hidden)return z.height===void 0&&g!==void 0?Math.min(z.maxHeight,g)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ma(h,t){let o={};for(let d in h)d!=="ref"&&(o[d]=h[d]);return n.bh.forEach(d=>{d in t&&(o[d]=t[d])}),o}function ud(h){h=h.slice();let t=Object.create(null);for(let o=0;o<h.length;o++)t[h[o].id]=h[o];for(let o=0;o<h.length;o++)"ref"in h[o]&&(h[o]=Ma(h[o],t[h[o].ref]));return h}let mn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function hd(h,t,o){o.push({command:mn.addSource,args:[h,t[h]]})}function Rn(h,t,o){t.push({command:mn.removeSource,args:[h]}),o[h]=!0}function nv(h,t,o,d){Rn(h,o,d),hd(h,t,o)}function Mt(h,t,o){let d;for(d in h[o])if(h[o].hasOwnProperty(d)&&d!=="data"&&!n.bi(h[o][d],t[o][d]))return!1;for(d in t[o])if(t[o].hasOwnProperty(d)&&d!=="data"&&!n.bi(h[o][d],t[o][d]))return!1;return!0}function Zl(h,t,o,d,g,y){let x;for(x in t=t||{},h=h||{})h.hasOwnProperty(x)&&(n.bi(h[x],t[x])||o.push({command:y,args:[d,x,t[x],g]}));for(x in t)t.hasOwnProperty(x)&&!h.hasOwnProperty(x)&&(n.bi(h[x],t[x])||o.push({command:y,args:[d,x,t[x],g]}))}function qs(h){return h.id}function Aa(h,t){return h[t.id]=t,h}class Xi{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.ap(t,0,1);let o=1,d=this._distances[o],g=t*this.paddedLength+this.padding;for(;d<g&&o<this._distances.length;)d=this._distances[++o];let y=o-1,x=this._distances[y],C=d-x,A=C>0?(g-x)/C:0;return this.points[y].mult(1-A).add(this.points[o].mult(A))}}class hu{constructor(t,o,d){let g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(o/d);for(let x=0;x<this.xCellCount*this.yCellCount;x++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,d,g,y){this._forEachCell(o,d,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(t,o,d,g){this._forEachCell(o-g,d-g,o+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(d),this.circles.push(g)}_insertBoxCell(t,o,d,g,y,x){this.boxCells[y].push(x)}_insertCircleCell(t,o,d,g,y,x){this.circleCells[y].push(x)}_query(t,o,d,g,y,x){if(d<0||t>this.width||g<0||o>this.height)return!y&&[];let C=[];if(t<=0&&o<=0&&this.width<=d&&this.height<=g){if(y)return!0;for(let A=0;A<this.boxKeys.length;A++)C.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){let O=this.circles[3*A],R=this.circles[3*A+1],F=this.circles[3*A+2];C.push({key:this.circleKeys[A],x1:O-F,y1:R-F,x2:O+F,y2:R+F})}return x?C.filter(x):C}return this._forEachCell(t,o,d,g,this._queryCell,C,{hitTest:y,seenUids:{box:{},circle:{}}},x),y?C.length>0:C}_queryCircle(t,o,d,g,y){let x=t-d,C=t+d,A=o-d,O=o+d;if(C<0||x>this.width||O<0||A>this.height)return!g&&[];let R=[];return this._forEachCell(x,A,C,O,this._queryCellCircle,R,{hitTest:g,circle:{x:t,y:o,radius:d},seenUids:{box:{},circle:{}}},y),g?R.length>0:R}query(t,o,d,g,y){return this._query(t,o,d,g,!1,y)}hitTest(t,o,d,g,y){return this._query(t,o,d,g,!0,y)}hitTestCircle(t,o,d,g){return this._queryCircle(t,o,d,!0,g)}_queryCell(t,o,d,g,y,x,C,A){let O=C.seenUids,R=this.boxCells[y];if(R!==null){let z=this.bboxes;for(let j of R)if(!O.box[j]){O.box[j]=!0;let W=4*j;if(t<=z[W+2]&&o<=z[W+3]&&d>=z[W+0]&&g>=z[W+1]&&(!A||A(this.boxKeys[j]))){if(C.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[j],x1:z[W],y1:z[W+1],x2:z[W+2],y2:z[W+3]})}}}let F=this.circleCells[y];if(F!==null){let z=this.circles;for(let j of F)if(!O.circle[j]){O.circle[j]=!0;let W=3*j;if(this._circleAndRectCollide(z[W],z[W+1],z[W+2],t,o,d,g)&&(!A||A(this.circleKeys[j]))){if(C.hitTest)return x.push(!0),!0;{let q=z[W],X=z[W+1],Z=z[W+2];x.push({key:this.circleKeys[j],x1:q-Z,y1:X-Z,x2:q+Z,y2:X+Z})}}}}}_queryCellCircle(t,o,d,g,y,x,C,A){let O=C.circle,R=C.seenUids,F=this.boxCells[y];if(F!==null){let j=this.bboxes;for(let W of F)if(!R.box[W]){R.box[W]=!0;let q=4*W;if(this._circleAndRectCollide(O.x,O.y,O.radius,j[q+0],j[q+1],j[q+2],j[q+3])&&(!A||A(this.boxKeys[W])))return x.push(!0),!0}}let z=this.circleCells[y];if(z!==null){let j=this.circles;for(let W of z)if(!R.circle[W]){R.circle[W]=!0;let q=3*W;if(this._circlesCollide(j[q],j[q+1],j[q+2],O.x,O.y,O.radius)&&(!A||A(this.circleKeys[W])))return x.push(!0),!0}}}_forEachCell(t,o,d,g,y,x,C,A){let O=this._convertToXCellCoord(t),R=this._convertToYCellCoord(o),F=this._convertToXCellCoord(d),z=this._convertToYCellCoord(g);for(let j=O;j<=F;j++)for(let W=R;W<=z;W++)if(y.call(this,t,o,d,g,this.xCellCount*W+j,x,C,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,d,g,y,x){let C=g-t,A=y-o,O=d+x;return O*O>C*C+A*A}_circleAndRectCollide(t,o,d,g,y,x,C){let A=(x-g)/2,O=Math.abs(t-(g+A));if(O>A+d)return!1;let R=(C-y)/2,F=Math.abs(o-(y+R));if(F>R+d)return!1;if(O<=A||F<=R)return!0;let z=O-A,j=F-R;return z*z+j*j<=d*d}}let Yi={unknown:0,flipRequired:1,flipNotRequired:2},mt=Math.tan(85*Math.PI/180);function cn(h,t,o,d,g,y,x){let C=n.a6.mat4.create();if(o)if(y.name==="globe"){let A=n.bj(g,t);n.a6.mat4.multiply(C,C,A)}else{let A=n.a6.mat2.invert([],x);C[0]=A[0],C[1]=A[1],C[4]=A[2],C[5]=A[3],d||n.a6.mat4.rotateZ(C,C,g.angle)}else n.a6.mat4.multiply(C,g.labelPlaneMatrix,h);return C}function un(h,t,o,d,g,y,x){let C=cn(h,t,o,d,g,y,x);return y.name==="globe"&&o||(C[2]=C[6]=C[10]=C[14]=0),C}function di(h,t,o,d,g,y,x){if(o){if(y.name==="globe"){let C=cn(h,t,o,d,g,y,x);return n.a6.mat4.invert(C,C),n.a6.mat4.multiply(C,h,C),C}{let C=n.a6.mat4.clone(h),A=n.a6.mat4.identity([]);return A[0]=x[0],A[1]=x[1],A[4]=x[2],A[5]=x[3],n.a6.mat4.multiply(C,C,A),d||n.a6.mat4.rotateZ(C,C,-g.angle),C}}return g.glCoordMatrix}function Kr(h,t,o,d){let g=[h,t,o,1];o?n.a6.vec4.transformMat4(g,g,d):fu(g,g,d);let y=g[3];return g[0]/=y,g[1]/=y,g[2]/=y,g}function dn(h,t){return Math.min(.5+h/t*.5,1.5)}function du(h,t){let o=h[0]/h[3],d=h[1]/h[3];return o>=-t[0]&&o<=t[0]&&d>=-t[1]&&d<=t[1]}function Ra(h,t,o,d,g,y,x,C,A,O){let R=o.transform,F=d?h.textSizeData:h.iconSizeData,z=n.bk(F,o.transform.zoom),j=R.projection.name==="globe",W=[256/o.width*2+1,256/o.height*2+1],q=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;q.clear();let X=null;j&&(X=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);let Z=h.lineVertexArray,Q=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,re=o.transform.width/o.transform.height,ie,ae=!1;for(let ue=0;ue<Q.length;ue++){let le=Q.get(ue),{numGlyphs:he,writingMode:me}=le;if(me!==n.bl.vertical||ae||ie===n.bl.horizontal||(ae=!0),ie=me,(le.hidden||me===n.bl.vertical)&&!ae){_o(he,q);continue}ae=!1;let xe=new n.P(le.tileAnchorX,le.tileAnchorY),{x:_e,y:ge,z:Oe}=R.projection.projectTilePoint(xe.x,xe.y,O.canonical);if(A){let[$e,st,yt]=A(xe);_e+=$e,ge+=st,Oe+=yt}let Be=[_e,ge,Oe,1];if(n.a6.vec4.transformMat4(Be,Be,t),!du(Be,W)){_o(he,q);continue}let qe=Be[3],Ke=dn(o.transform.getCameraToCenterDistance(R.projection),qe),nt=n.bm(F,z,le),Se=x?nt/Ke:nt*Ke,Ge=Kr(_e,ge,Oe,g);if(Ge[3]<=0){_o(he,q);continue}let Le={},He=x?null:A,Ze=gr(le,Se,!1,C,t,g,y,h.glyphOffsetArray,Z,q,X,Ge,xe,Le,re,He,R.projection,O,x);ae=Ze.useVertical,He&&Ze.needsFlipping&&(Le={}),(Ze.notEnoughRoom||ae||Ze.needsFlipping&&gr(le,Se,!0,C,t,g,y,h.glyphOffsetArray,Z,q,X,Ge,xe,Le,re,He,R.projection,O,x).notEnoughRoom)&&_o(he,q)}d?(h.text.dynamicLayoutVertexBuffer.updateData(q),X&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(X)):(h.icon.dynamicLayoutVertexBuffer.updateData(q),X&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(X))}function Pa(h,t,o,d,g,y,x,C,A,O,R,F,z,j,W,q){let{lineStartIndex:X,glyphStartIndex:Z,segment:Q}=C,re=Z+C.numGlyphs,ie=X+C.lineLength,ae=t.getoffsetX(Z),ue=t.getoffsetX(re-1),le=La(h*ae,o,d,g,y,x,Q,X,ie,A,O,R,F,z,!0,j,W,q);if(!le)return null;let he=La(h*ue,o,d,g,y,x,Q,X,ie,A,O,R,F,z,!0,j,W,q);return he?{first:le,last:he}:null}function ni(h,t,o,d){return h===n.bl.horizontal&&Math.abs(d)>Math.abs(o)?{useVertical:!0}:h===n.bl.vertical?d>0?{needsFlipping:!0}:null:t!==Yi.unknown&&function(g,y){return g===0||Math.abs(y/g)>mt}(o,d)?t===Yi.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function gr(h,t,o,d,g,y,x,C,A,O,R,F,z,j,W,q,X,Z,Q){let re=t/24,ie=h.lineOffsetX*re,ae=h.lineOffsetY*re,{lineStartIndex:ue,glyphStartIndex:le,numGlyphs:he,segment:me,writingMode:xe,flipState:_e}=h,ge=ue+h.lineLength,Oe=Be=>{if(R){let[Se,Ge,Le]=Be.up,He=O.length;n.bn(R,He+0,Se,Ge,Le),n.bn(R,He+1,Se,Ge,Le),n.bn(R,He+2,Se,Ge,Le),n.bn(R,He+3,Se,Ge,Le)}let[qe,Ke,nt]=Be.point;n.bo(O,qe,Ke,nt,Be.angle)};if(he>1){let Be=Pa(re,C,ie,ae,o,F,z,h,A,y,j,q,!1,X,Z,Q);if(!Be)return{notEnoughRoom:!0};if(d&&!o){let[qe,Ke,nt]=Be.first.point,[Se,Ge,Le]=Be.last.point;[qe,Ke]=Kr(qe,Ke,nt,x),[Se,Ge]=Kr(Se,Ge,Le,x);let He=ni(xe,_e,(Se-qe)*W,Ge-Ke);if(h.flipState=He&&He.needsFlipping?Yi.flipRequired:Yi.flipNotRequired,He)return He}Oe(Be.first);for(let qe=le+1;qe<le+he-1;qe++){let Ke=La(re*C.getoffsetX(qe),ie,ae,o,F,z,me,ue,ge,A,y,j,q,!1,!1,X,Z,Q);if(!Ke)return O.length-=4*(qe-le),{notEnoughRoom:!0};Oe(Ke)}Oe(Be.last)}else{if(d&&!o){let qe=Kr(z.x,z.y,0,g),Ke=ue+me+1,nt=new n.P(A.getx(Ke),A.gety(Ke)),Se=Kr(nt.x,nt.y,0,g),Ge=Se[3]>0?Se:Oa(z,nt,qe,1,g,void 0,X,Z.canonical),Le=ni(xe,_e,(Ge[0]-qe[0])*W,Ge[1]-qe[1]);if(h.flipState=Le&&Le.needsFlipping?Yi.flipRequired:Yi.flipNotRequired,Le)return Le}let Be=La(re*C.getoffsetX(le),ie,ae,o,F,z,me,ue,ge,A,y,j,q,!1,!1,X,Z,Q);if(!Be)return{notEnoughRoom:!0};Oe(Be)}return{}}function rm(h,t,o,d,g){let{x:y,y:x,z:C}=d.projectTilePoint(h.x,h.y,t);if(!g)return Kr(y,x,C,o);let[A,O,R]=g(h);return Kr(y+A,x+O,C+R,o)}function Oa(h,t,o,d,g,y,x,C){let A=rm(h.sub(t)._unit()._add(h),C,g,x,y);return n.a6.vec3.sub(A,o,A),n.a6.vec3.normalize(A,A),n.a6.vec3.scaleAndAdd(A,o,A,d)}function La(h,t,o,d,g,y,x,C,A,O,R,F,z,j,W,q,X,Z){let Q=d?h-t:h+t,re=Q>0?1:-1,ie=0;d&&(re*=-1,ie=Math.PI),re<0&&(ie+=Math.PI);let ae=C+x+(re>0?0:1)|0,ue=g,le=g,he=0,me=0,xe=Math.abs(Q),_e=[],ge=[],Oe=y,Be=Oe,qe=()=>Oa(Be,Oe,le,xe-he+1,R,z,q,X.canonical);for(;he+me<=xe;){if(ae+=re,ae<C||ae>=A)return null;if(le=ue,Be=Oe,_e.push(le),j&&ge.push(Be),Oe=new n.P(O.getx(ae),O.gety(ae)),ue=F[ae],!ue){let st=rm(Oe,X.canonical,R,q,z);ue=st[3]>0?F[ae]=st:qe()}he+=me,me=n.a6.vec3.distance(le,ue)}W&&z&&(F[ae]&&(ue=qe(),me=n.a6.vec3.distance(le,ue)),F[ae]=ue);let Ke=(xe-he)/me,nt=Oe.sub(Be)._mult(Ke)._add(Be),Se=n.a6.vec3.sub([],ue,le),Ge=n.a6.vec3.scaleAndAdd([],le,Se,Ke),Le=[0,0,1],He=Se[0],Ze=Se[1];if(Z&&(Le=q.upVector(X.canonical,nt.x,nt.y),Le[0]!==0||Le[1]!==0||Le[2]!==1)){let st=[Le[2],0,-Le[0]],yt=n.a6.vec3.cross([],Le,st);n.a6.vec3.normalize(st,st),n.a6.vec3.normalize(yt,yt),He=n.a6.vec3.dot(Se,st),Ze=n.a6.vec3.dot(Se,yt)}if(o){let st=n.a6.vec3.cross([],Le,Se);n.a6.vec3.normalize(st,st),n.a6.vec3.scaleAndAdd(Ge,Ge,st,o*re)}let $e=ie+Math.atan2(Ze,He);return _e.push(Ge),j&&ge.push(nt),{point:Ge,angle:$e,path:_e,tilePath:ge,up:Le}}function _o(h,t){let o=t.length,d=o+4*h;t.resize(d),t.float32.fill(-1/0,4*o,4*d)}function fu(h,t,o){let d=t[0],g=t[1];return h[0]=o[0]*d+o[4]*g+o[12],h[1]=o[1]*d+o[5]*g+o[13],h[3]=o[3]*d+o[7]*g+o[15],h}let wi=100;class Qr{constructor(t,o,d=new hu(t.width+200,t.height+200,25),g=new hu(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+wi,this.screenBottomBoundary=t.height+wi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,d,g,y,x,C,A){let O=d.projectedAnchorX,R=d.projectedAnchorY,F=d.projectedAnchorZ,z=d.elevation,j=d.tileID,W=t.getProjection();if(z&&j){let[ue,le,he]=W.upVector(j.canonical,d.tileAnchorX,d.tileAnchorY),me=W.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=ue*z*me,R+=le*z*me,F+=he*z*me}let q=this.projectAndGetPerspectiveRatio(C,O,R,F,d.tileID,W.name==="globe"||!!z||this.transform.pitch>0,W),X=x*q.perspectiveRatio,Z=(d.x1*o+g.x-d.padding)*X+q.point.x,Q=(d.y1*o+g.y-d.padding)*X+q.point.y,re=(d.x2*o+g.x+d.padding)*X+q.point.x,ie=(d.y2*o+g.y+d.padding)*X+q.point.y,ae=q.perspectiveRatio<=.55||q.occluded;return!this.isInsideGrid(Z,Q,re,ie)||!y&&this.grid.hitTest(Z,Q,re,ie,A)||ae?{box:[],offscreen:!1,occluded:q.occluded}:{box:[Z,Q,re,ie],offscreen:this.isOffscreen(Z,Q,re,ie),occluded:!1}}placeCollisionCircles(t,o,d,g,y,x,C,A,O,R,F,z,j,W,q){let X=[],Z=this.transform.elevation,Q=t.getProjection(),re=Z?Z.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,Q):null,ie=new n.P(d.tileAnchorX,d.tileAnchorY),{x:ae,y:ue,z:le}=Q.projectTilePoint(ie.x,ie.y,q.canonical);if(re){let[nt,Se,Ge]=re(ie);ae+=nt,ue+=Se,le+=Ge}let he=Q.name==="globe",me=this.projectAndGetPerspectiveRatio(C,ae,ue,le,q,he||!!Z||this.transform.pitch>0,Q),{perspectiveRatio:xe}=me,_e=(F?x/xe:x*xe)/n.br,ge=Kr(ae,ue,le,A),Oe=me.signedDistanceFromCamera>0?Pa(_e,y,d.lineOffsetX*_e,d.lineOffsetY*_e,!1,ge,ie,d,g,A,{},Z&&!F?re:null,F&&!!Z,Q,q,F):null,Be=!1,qe=!1,Ke=!0;if(Oe&&!me.occluded){let nt=.5*j*xe+W,Se=new n.P(-100,-100),Ge=new n.P(this.screenRightBoundary,this.screenBottomBoundary),Le=new Xi,{first:He,last:Ze}=Oe,$e=He.path.length,st=[];for(let dt=$e-1;dt>=1;dt--)st.push(He.path[dt]);for(let dt=1;dt<Ze.path.length;dt++)st.push(Ze.path[dt]);let yt=2.5*nt;O&&(st=st.map(([dt,Tt,lt],Dt)=>(re&&!he&&(lt=re(Dt<$e-1?He.tilePath[$e-1-Dt]:Ze.tilePath[Dt-$e+2])[2]),Kr(dt,Tt,lt,O))),st.some(dt=>dt[3]<=0)&&(st=[]));let bt=[];if(st.length>0){let dt=1/0,Tt=-1/0,lt=1/0,Dt=-1/0;for(let Ut of st)dt=Math.min(dt,Ut[0]),lt=Math.min(lt,Ut[1]),Tt=Math.max(Tt,Ut[0]),Dt=Math.max(Dt,Ut[1]);Tt>=Se.x&&dt<=Ge.x&&Dt>=Se.y&&lt<=Ge.y&&(bt=[st.map(Ut=>new n.P(Ut[0],Ut[1]))],(dt<Se.x||Tt>Ge.x||lt<Se.y||Dt>Ge.y)&&(bt=n.bp(bt,Se.x,Se.y,Ge.x,Ge.y)))}for(let dt of bt){Le.reset(dt,.25*nt);let Tt=0;Tt=Le.length<=.5*nt?1:Math.ceil(Le.paddedLength/yt)+1;for(let lt=0;lt<Tt;lt++){let Dt=lt/Math.max(Tt-1,1),Ut=Le.lerp(Dt),tn=Ut.x+wi,zn=Ut.y+wi;X.push(tn,zn,nt,0);let fn=tn-nt,qn=zn-nt,bn=tn+nt,Bn=zn+nt;if(Ke=Ke&&this.isOffscreen(fn,qn,bn,Bn),qe=qe||this.isInsideGrid(fn,qn,bn,Bn),!o&&this.grid.hitTestCircle(tn,zn,nt,z)&&(Be=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!R&&Be||!qe?[]:X,offscreen:Ke,collisionDetected:Be,occluded:me.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let o=[],d=1/0,g=1/0,y=-1/0,x=-1/0;for(let R of t){let F=new n.P(R.x+wi,R.y+wi);d=Math.min(d,F.x),g=Math.min(g,F.y),y=Math.max(y,F.x),x=Math.max(x,F.y),o.push(F)}let C=this.grid.query(d,g,y,x).concat(this.ignoredGrid.query(d,g,y,x)),A={},O={};for(let R of C){let F=R.key;if(A[F.bucketInstanceId]===void 0&&(A[F.bucketInstanceId]={}),A[F.bucketInstanceId][F.featureIndex])continue;let z=[new n.P(R.x1,R.y1),new n.P(R.x2,R.y1),new n.P(R.x2,R.y2),new n.P(R.x1,R.y2)];n.bq(o,z)&&(A[F.bucketInstanceId][F.featureIndex]=!0,O[F.bucketInstanceId]===void 0&&(O[F.bucketInstanceId]=[]),O[F.bucketInstanceId].push(F.featureIndex))}return O}insertCollisionBox(t,o,d,g,y){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,d,g,y){let x=o?this.ignoredGrid:this.grid,C={bucketInstanceId:d,featureIndex:g,collisionGroupID:y};for(let A=0;A<t.length;A+=4)x.insertCircle(C,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,o,d,g,y,x,C){let A=[o,d,g,1],O=!1;g||this.transform.pitch>0?(n.a6.vec4.transformMat4(A,A,t),this.fogState&&y&&C.name!=="globe"&&(O=function(z,j,W,q,X,Z){let Q=Z.calculateFogTileMatrix(X),re=[j,W,q];return n.a6.vec3.transformMat4(re,re,Q),at(z,n.a6.vec3.length(re),Z.pitch,Z._fov)}(this.fogState,o,d,g,y.toUnwrapped(),this.transform)>.9)):fu(A,A,t);let R=A[3];return{point:new n.P((A[0]/R+1)/2*this.transform.width+wi,(-A[1]/R+1)/2*this.transform.height+wi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/R*.5,1.5),signedDistanceFromCamera:R,occluded:x&&A[2]>R||O}}isOffscreen(t,o,d,g){return d<wi||t>=this.screenRightBoundary||g<wi||o>this.screenBottomBoundary}isInsideGrid(t,o,d,g){return d>=0&&t<this.gridRightBoundary&&g>=0&&o<this.gridBottomBoundary}getViewportMatrix(){let t=n.a6.mat4.identity([]);return n.a6.mat4.translate(t,t,[-100,-100,0]),t}}function ri(h,t,o){let d=t.createTileMatrix(h,h.worldSize,o.toUnwrapped());return n.a6.mat4.multiply(new Float32Array(16),h.projMatrix,d)}function im(h,t,o){if(t.projection.name===o.projection.name)return h.projMatrix;let d=o.clone();return d.setProjection(t.projection),ri(d,t.getProjection(),h)}function ys(h,t,o){return t.name===o.projection.name?h.projMatrix:ri(o,t,h)}class Er{constructor(t,o,d,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class ii{constructor(t,o,d,g,y,x=!1){this.text=new Er(t?t.text:null,o,d,y),this.icon=new Er(t?t.icon:null,o,g,y),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ji{constructor(t,o,d,g=!1){this.text=t,this.icon=o,this.skipFade=d,this.clipped=g}}class Lr{constructor(){this.invProjMatrix=n.a6.mat4.create(),this.viewportMatrix=n.a6.mat4.create(),this.circles=[]}}class dd{constructor(t,o,d,g,y){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=y}}class Ki{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:d=>d.collisionGroupID===o}}return this.collisionGroups[t]}}function ka(h,t,o,d,g){let{horizontalAlign:y,verticalAlign:x}=n.by(h),C=-(y-.5)*t,A=-(x-.5)*o,O=n.bx(h,d);return new n.P(C+O[0]*g,A+O[1]*g)}function Ws(h,t,o,d,g){let y=new n.P(h,t);return o&&y._rotate(d?g:-g),y}class Zs{constructor(t,o,d,g,y,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Qr(this.transform,y),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Ki(d),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,d,g,y=1){let x=d.getBucket(o),C=d.latestFeatureIndex;if(!x||!C||o.fqid!==x.layerIds[0])return;let A=x.layers[0].layout,O=x.layers[0].paint,R=d.collisionBoxArray,F=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),z=d.tileSize/n.ab,j=d.tileID.toUnwrapped();this.transform.setProjection(x.projection);let W=(q=d.tileID,X=x.getProjection(),Z=this.transform,X.name===this.projection?Z.calculateProjMatrix(q.toUnwrapped()):ri(Z,X,q));var q,X,Z;let Q=A.get("text-pitch-alignment")==="map",re=A.get("text-rotation-alignment")==="map";o.compileFilter(o.options);let ie=o.dynamicFilter(),ae=o.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(d),le=un(W,d.tileID.canonical,Q,re,this.transform,x.getProjection(),ue),he=null;if(Q){let qe=di(W,d.tileID.canonical,Q,re,this.transform,x.getProjection(),ue);he=n.a6.mat4.multiply([],this.transform.labelPlaneMatrix,qe)}let me=null;ie&&d.latestFeatureIndex&&(me={unwrappedTileID:j,dynamicFilter:ie,dynamicFilterNeedsFeature:ae}),this.retainedQueryData[x.bucketInstanceId]=new dd(x.bucketInstanceId,C,x.sourceLayerIndex,x.index,d.tileID);let xe=x.layers[0].layout.get("text-size-scale-range"),_e=n.ap(y,xe[0],xe[1]),ge=x.layers[0].layout.get("icon-size-scale-range"),Oe=n.ap(y,ge[0],ge[1]),Be={bucket:x,layout:A,paint:O,posMatrix:W,textLabelPlaneMatrix:le,labelToScreenMatrix:he,clippingData:me,scale:F,textPixelRatio:z,holdingForFade:d.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:n.bk(x.textSizeData,this.transform.zoom,_e),partiallyEvaluatedIconSize:n.bk(x.iconSizeData,this.transform.zoom,Oe),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(g)for(let qe of x.sortKeyRanges){let{sortKey:Ke,symbolInstanceStart:nt,symbolInstanceEnd:Se}=qe;t.push({sortKey:Ke,symbolInstanceStart:nt,symbolInstanceEnd:Se,parameters:Be})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(t,o,d,g,y,x,C,A,O,R,F,z,j,W,q,X,Z,Q){let{textOffset0:re,textOffset1:ie,crossTileID:ae}=z,ue=[re,ie],le=ka(t,d,g,ue,y),he=this.collisionIndex.placeCollisionBox(W,y,o,Ws(le.x,le.y,x,C,this.transform.angle),F,A,O,R.predicate);if(X){let me=W.getSymbolInstanceIconSize(Q,this.transform.zoom,z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(W,me,X,Ws(le.x,le.y,x,C,this.transform.angle),F,A,O,R.predicate).box.length===0)return}if(he.box.length>0){let me;return this.prevPlacement&&this.prevPlacement.variableOffsets[ae]&&this.prevPlacement.placements[ae]&&this.prevPlacement.placements[ae].text&&(me=this.prevPlacement.variableOffsets[ae].anchor),this.variableOffsets[ae]={textOffset:ue,width:d,height:g,anchor:t,textScale:y,prevAnchor:me},this.markUsedJustification(W,t,z,q),W.allowVerticalPlacement&&(this.markUsedOrientation(W,q,z),this.placedOrientations[ae]=q),{shift:le,placedGlyphBoxes:he}}}placeLayerBucketPart(t,o,d,g,y=1){let{bucket:x,layout:C,paint:A,posMatrix:O,textLabelPlaneMatrix:R,labelToScreenMatrix:F,clippingData:z,textPixelRatio:j,holdingForFade:W,collisionBoxArray:q,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:Z,collisionGroup:Q,latestFeatureIndex:re}=t.parameters,ie=C.get("text-optional"),ae=C.get("icon-optional"),ue=C.get("text-allow-overlap"),le=C.get("icon-allow-overlap"),he=C.get("text-rotation-alignment")==="map",me=C.get("text-pitch-alignment")==="map",xe=C.get("symbol-z-elevate"),_e=A.get("symbol-z-offset"),ge=C.get("symbol-elevation-reference")==="sea",Oe=C.get("text-size-scale-range"),Be=C.get("icon-size-scale-range"),qe=n.ap(y,Oe[0],Oe[1]),Ke=n.ap(y,Be[0],Be[1]);this.transform.setProjection(x.projection);let nt=ue&&(le||!x.hasIconData()||ae),Se=le&&(ue||!x.hasTextData()||ie),Ge=!_e.isConstant();!x.collisionArrays&&q&&x.deserializeCollisionBoxes(q),d&&g&&x.updateCollisionDebugBuffers(this.transform.zoom,q,qe,Ke);let Le=(He,Ze,$e)=>{let{crossTileID:st,numVerticalGlyphVertices:yt}=He,bt=null;if(z&&z.dynamicFilterNeedsFeature||Ge){let hn=this.retainedQueryData[x.bucketInstanceId];bt=re.loadFeature({featureIndex:He.featureIndex,bucketIndex:hn.bucketIndex,sourceLayerIndex:hn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(z&&!(0,z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},bt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new n.P(He.tileAnchorX,He.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[st]=new Ji(!1,!1,!1,!0),void o.add(st);let dt=_e.evaluate(bt,{});if(o.has(st))return;if(W)return void(this.placements[st]=new Ji(!1,!1,!1));let Tt=!1,lt=!1,Dt=!0,Ut=!1,tn=!1,zn=null,fn={box:null,offscreen:null,occluded:null},qn={box:null,offscreen:null,occluded:null},bn=null,Bn=null,Jt=null,kn=0,On=0,Tn=0;$e.textFeatureIndex?kn=$e.textFeatureIndex:He.useRuntimeCollisionCircles&&(kn=He.featureIndex),$e.verticalTextFeatureIndex&&(On=$e.verticalTextFeatureIndex);let Qn=hn=>{hn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let nn=this.transform.elevation;hn.elevation=ge?dt:dt+(nn?nn.getAtTileOffset(hn.tileID,hn.tileAnchorX,hn.tileAnchorY):0),hn.elevation+=He.zOffset},Cr=$e.textBox;if(Cr){Qn(Cr);let hn=wn=>{let jn=n.bl.horizontal;if(x.allowVerticalPlacement&&!wn&&this.prevPlacement){let fr=this.prevPlacement.placedOrientations[st];fr&&(this.placedOrientations[st]=fr,jn=fr,this.markUsedOrientation(x,jn,He))}return jn},nn=(wn,jn)=>{if(x.allowVerticalPlacement&&yt>0&&$e.verticalTextBox){for(let fr of x.writingModes)if(fr===n.bl.vertical?(fn=jn(),qn=fn):fn=wn(),fn&&fn.box&&fn.box.length)break}else fn=wn()};if(C.get("text-variable-anchor")){let wn=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[st]){let er=this.prevPlacement.variableOffsets[st];wn.indexOf(er.anchor)>0&&(wn=wn.filter(kr=>kr!==er.anchor),wn.unshift(er.anchor))}let jn=(er,kr,bo)=>{let pi=x.getSymbolInstanceTextSize(X,He,this.transform.zoom,Ze),mi=(er.x2-er.x1)*pi+2*er.padding,zi=(er.y2-er.y1)*pi+2*er.padding,to=He.hasIconTextFit&&!le?kr:null;to&&Qn(to);let gi={box:[],offscreen:!1,occluded:!1},Jo=ue?2*wn.length:wn.length;for(let Bi=0;Bi<Jo;++Bi){let Mn=this.attemptAnchorPlacement(wn[Bi%wn.length],er,mi,zi,pi,he,me,j,O,Q,Bi>=wn.length,He,Ze,x,bo,to,X,Z);if(Mn&&(gi=Mn.placedGlyphBoxes,gi&&gi.box&&gi.box.length)){Tt=!0,zn=Mn.shift;break}}return gi};nn(()=>jn(Cr,$e.iconBox,n.bl.horizontal),()=>{let er=$e.verticalTextBox;return er&&Qn(er),x.allowVerticalPlacement&&!(fn&&fn.box&&fn.box.length)&&yt>0&&er?jn(er,$e.verticalIconBox,n.bl.vertical):{box:null,offscreen:null,occluded:null}}),fn&&(Tt=fn.box,Dt=fn.offscreen,Ut=fn.occluded);let fr=hn(!(!fn||!fn.box));if(!Tt&&this.prevPlacement){let er=this.prevPlacement.variableOffsets[st];er&&(this.variableOffsets[st]=er,this.markUsedJustification(x,er.anchor,He,fr))}}else{let wn=(jn,fr)=>{let er=x.getSymbolInstanceTextSize(X,He,this.transform.zoom,Ze,y),kr=this.collisionIndex.placeCollisionBox(x,er,jn,new n.P(0,0),ue,j,O,Q.predicate);return kr&&kr.box&&kr.box.length&&(this.markUsedOrientation(x,fr,He),this.placedOrientations[st]=fr),kr};nn(()=>wn(Cr,n.bl.horizontal),()=>{let jn=$e.verticalTextBox;return x.allowVerticalPlacement&&yt>0&&jn?(Qn(jn),wn(jn,n.bl.vertical)):{box:null,offscreen:null,occluded:null}}),hn(!!(fn&&fn.box&&fn.box.length))}}if(bn=fn,Tt=bn&&bn.box&&bn.box.length>0,Dt=bn&&bn.offscreen,Ut=bn&&bn.occluded,He.useRuntimeCollisionCircles){let hn=x.text.placedSymbolArray.get(He.centerJustifiedTextSymbolIndex>=0?He.centerJustifiedTextSymbolIndex:He.verticalPlacedTextSymbolIndex),nn=n.bm(x.textSizeData,X,hn),wn=C.get("text-padding");Bn=this.collisionIndex.placeCollisionCircles(x,ue,hn,x.lineVertexArray,x.glyphOffsetArray,nn,O,R,F,d,me,Q.predicate,He.collisionCircleDiameter*nn/n.br,wn,this.retainedQueryData[x.bucketInstanceId].tileID),Tt=ue||Bn.circles.length>0&&!Bn.collisionDetected,Dt=Dt&&Bn.offscreen,Ut=Bn.occluded}if($e.iconFeatureIndex&&(Tn=$e.iconFeatureIndex),$e.iconBox){let hn=nn=>{Qn(nn);let wn=He.hasIconTextFit&&zn?Ws(zn.x,zn.y,he,me,this.transform.angle):new n.P(0,0),jn=x.getSymbolInstanceIconSize(Z,this.transform.zoom,He.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,jn,nn,wn,le,j,O,Q.predicate)};qn&&qn.box&&qn.box.length&&$e.verticalIconBox?(Jt=hn($e.verticalIconBox),lt=Jt.box.length>0):(Jt=hn($e.iconBox),lt=Jt.box.length>0),Dt=Dt&&Jt.offscreen,tn=Jt.occluded}let Mi=ie||He.numHorizontalGlyphVertices===0&&yt===0,Ni=ae||He.numIconVertices===0;if(Mi||Ni?Ni?Mi||(lt=lt&&Tt):Tt=lt&&Tt:lt=Tt=lt&&Tt,Tt&&bn&&bn.box&&this.collisionIndex.insertCollisionBox(bn.box,C.get("text-ignore-placement"),x.bucketInstanceId,qn&&qn.box&&On?On:kn,Q.ID),lt&&Jt&&this.collisionIndex.insertCollisionBox(Jt.box,C.get("icon-ignore-placement"),x.bucketInstanceId,Tn,Q.ID),Bn&&(Tt&&this.collisionIndex.insertCollisionCircles(Bn.circles,C.get("text-ignore-placement"),x.bucketInstanceId,kn,Q.ID),d)){let hn=x.bucketInstanceId,nn=this.collisionCircleArrays[hn];nn===void 0&&(nn=this.collisionCircleArrays[hn]=new Lr);for(let wn=0;wn<Bn.circles.length;wn+=4)nn.circles.push(Bn.circles[wn+0]),nn.circles.push(Bn.circles[wn+1]),nn.circles.push(Bn.circles[wn+2]),nn.circles.push(Bn.collisionDetected?1:0)}let Rr=x.projection.name!=="globe";nt=nt&&(Rr||!Ut),Se=Se&&(Rr||!tn),this.placements[st]=new Ji(Tt||nt,lt||Se,Dt||x.justReloaded),o.add(st)};if(xe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),x.sortFeaturesByY){let He=x.getSortedSymbolIndexes(this.transform.angle);for(let Ze=He.length-1;Ze>=0;--Ze){let $e=He[Ze];Le(x.symbolInstances.get($e),$e,x.collisionArrays[$e])}x.hasAnyZOffset&&n.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let He=x.getSortedIndexesByZOffset();for(let Ze=0;Ze<He.length;++Ze){let $e=He[Ze];Le(x.symbolInstances.get($e),$e,x.collisionArrays[$e])}}else for(let He=t.symbolInstanceStart;He<t.symbolInstanceEnd;He++)Le(x.symbolInstances.get(He),He,x.collisionArrays[He]);if(d&&x.bucketInstanceId in this.collisionCircleArrays){let He=this.collisionCircleArrays[x.bucketInstanceId];n.a6.mat4.invert(He.invProjMatrix,O),He.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,o,d,g){let{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:A,crossTileID:O}=d,R=n.bw(o),F=g===n.bl.vertical?A:R==="left"?y:R==="center"?x:R==="right"?C:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=F>=0&&y!==F?0:O),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:O),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=F>=0&&C!==F?0:O),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=F>=0&&A!==F?0:O)}markUsedOrientation(t,o,d){let g=o===n.bl.horizontal||o===n.bl.horizontalOnly?o:0,y=o===n.bl.vertical?o:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:O}=d,R=t.text.placedSymbolArray;x>=0&&(R.get(x).placedOrientation=g),C>=0&&(R.get(C).placedOrientation=g),A>=0&&(R.get(A).placedOrientation=g),O>=0&&(R.get(O).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let o=this.prevPlacement,d=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;let g=o?o.symbolFadeChange(t):1,y=o?o.opacities:{},x=o?o.variableOffsets:{},C=o?o.placedOrientations:{};for(let A in this.placements){let O=this.placements[A],R=y[A];R?(this.opacities[A]=new ii(R,g,O.text,O.icon,null,O.clipped),d=d||O.text!==R.text.placed||O.icon!==R.icon.placed):(this.opacities[A]=new ii(null,g,O.text,O.icon,O.skipFade,O.clipped),d=d||O.text||O.icon)}for(let A in y){let O=y[A];if(!this.opacities[A]){let R=new ii(O,g,!1,!1);R.isHidden()||(this.opacities[A]=R,d=d||O.text.placed||O.icon.placed)}}for(let A in x)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=x[A]);for(let A in C)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=C[A]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,d,g){let y=new Set;for(let x of o){let C=x.getBucket(t);C&&x.latestFeatureIndex&&t.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,y,x,x.collisionBoxArray,d,g,x.tileID,t.scope),C.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,x.tileID),C.updateZOffset()))}}updateBucketOpacities(t,o,d,g,y,x,C,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let O=t.layers[0].layout,R=t.layers[0].paint,F=!!t.layers[0].dynamicFilter(),z=new ii(null,0,!1,!1,!0),j=O.get("text-allow-overlap"),W=O.get("icon-allow-overlap"),q=O.get("text-variable-anchor"),X=O.get("text-rotation-alignment")==="map",Z=O.get("text-pitch-alignment")==="map",Q=R.get("symbol-z-offset"),re=O.get("symbol-elevation-reference")==="sea",ie=!Q.isConstant(),ae=new ii(null,0,j&&(W||!t.hasIconData()||O.get("icon-optional")),W&&(j||!t.hasTextData()||O.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);let ue=(he,me,xe)=>{for(let _e=0;_e<me/4;_e++)he.opacityVertexArray.emplaceBack(xe)},le=0;x&&t.updateReplacement(C,x);for(let he=0;he<t.symbolInstances.length;he++){let me=t.symbolInstances.get(he),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:_e,crossTileID:ge,numIconVertices:Oe,tileAnchorX:Be,tileAnchorY:qe}=me,Ke=null,nt=this.retainedQueryData[t.bucketInstanceId];ie&&me&&nt&&(Ke=d.latestFeatureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:nt.bucketIndex,sourceLayerIndex:nt.sourceLayerIndex,layoutVertexArrayOffset:0}));let Se=Q.evaluate(Ke,{}),Ge=o.has(ge),Le=this.opacities[ge];Ge?Le=z:Le||(Le=ae,this.opacities[ge]=Le),o.add(ge);let He=xe>0||_e>0,Ze=Oe>0,$e=this.placedOrientations[ge],st=$e===n.bl.vertical,yt=$e===n.bl.horizontal||$e===n.bl.horizontalOnly;!He&&!Ze||Le.isHidden()||le++;let bt=!1;if((He||Ze)&&x)for(let dt of t.activeReplacements){if(n.bs(dt,y,n.bt.Symbol,A)||dt.min.x>Be||Be>dt.max.x||dt.min.y>qe||qe>dt.max.y)continue;let Tt=n.bu(Be,qe,C.canonical,dt.footprintTileId.canonical);if(bt=n.bv(Tt,dt.footprint),bt)break}if(He){let dt=bt?Na:Fa(Le.text);ue(t.text,xe,st?Na:dt),ue(t.text,_e,yt?Na:dt);let Tt=Le.text.isHidden(),{leftJustifiedTextSymbolIndex:lt,centerJustifiedTextSymbolIndex:Dt,rightJustifiedTextSymbolIndex:Ut,verticalPlacedTextSymbolIndex:tn}=me,zn=t.text.placedSymbolArray,fn=Tt||st?1:0;lt>=0&&(zn.get(lt).hidden=fn),Dt>=0&&(zn.get(Dt).hidden=fn),Ut>=0&&(zn.get(Ut).hidden=fn),tn>=0&&(zn.get(tn).hidden=Tt||yt?1:0);let qn=this.variableOffsets[ge];qn&&this.markUsedJustification(t,qn.anchor,me,$e);let bn=this.placedOrientations[ge];bn&&(this.markUsedJustification(t,"left",me,bn),this.markUsedOrientation(t,bn,me))}if(Ze){let dt=bt?Na:Fa(Le.icon),{placedIconSymbolIndex:Tt,verticalPlacedIconSymbolIndex:lt}=me,Dt=t.icon.placedSymbolArray,Ut=Le.icon.isHidden()?1:0;Tt>=0&&(ue(t.icon,Oe,st?Na:dt),Dt.get(Tt).hidden=Ut),lt>=0&&(ue(t.icon,me.numVerticalIconVertices,yt?Na:dt),Dt.get(lt).hidden=Ut)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let dt=t.collisionArrays[he];if(dt){let Tt=new n.P(0,0),lt=!0;if(dt.textBox||dt.verticalTextBox){if(q){let Ut=this.variableOffsets[ge];Ut?(Tt=ka(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textScale),X&&Tt._rotate(Z?this.transform.angle:-this.transform.angle)):lt=!1}F&&(lt=!Le.clipped),dt.textBox&&pu(t.textCollisionBox.collisionVertexArray,Le.text.placed,!lt||st,Se,re,Tt.x,Tt.y),dt.verticalTextBox&&pu(t.textCollisionBox.collisionVertexArray,Le.text.placed,!lt||yt,Se,re,Tt.x,Tt.y)}let Dt=lt&&!!(!yt&&dt.verticalIconBox);dt.iconBox&&pu(t.iconCollisionBox.collisionVertexArray,Le.icon.placed,Dt,Se,re,me.hasIconTextFit?Tt.x:0,me.hasIconTextFit?Tt.y:0),dt.verticalIconBox&&pu(t.iconCollisionBox.collisionVertexArray,Le.icon.placed,!Dt,Se,re,me.hasIconTextFit?Tt.x:0,me.hasIconTextFit?Tt.y:0)}}}if(t.fullyClipped=le===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){let he=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=he.invProjMatrix,t.placementViewportMatrix=he.viewportMatrix,t.collisionCircleArray=he.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){let d=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function pu(h,t,o,d,g,y,x){h.emplaceBack(t?1:0,o?1:0,y||0,x||0,d,g?1:0),h.emplaceBack(t?1:0,o?1:0,y||0,x||0,d,g?1:0),h.emplaceBack(t?1:0,o?1:0,y||0,x||0,d,g?1:0),h.emplaceBack(t?1:0,o?1:0,y||0,x||0,d,g?1:0)}let Vo=Math.pow(2,25),rv=Math.pow(2,24),om=Math.pow(2,17),fi=Math.pow(2,16),iv=Math.pow(2,9),mu=Math.pow(2,8),sm=Math.pow(2,1);function Fa(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;let t=h.placed?1:0,o=Math.floor(127*h.opacity);return o*Vo+t*rv+o*om+t*fi+o*iv+t*mu+o*sm+t}let Na=0;class ov{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,d,g,y,x){let C=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(C,g,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((A,O)=>A.sortKey-O.sortKey));this._currentPartIndex<C.length;){let A=C[this._currentPartIndex];if(o.placeLayerBucketPart(A,this._seenCrossTileIDs,d,A.symbolInstanceStart===0,x),this._currentPartIndex++,y())return!0}return!1}}class Xl{constructor(t,o,d,g,y,x,C,A,O){this.placement=new Zs(t,y,x,C,A,O),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,o,d,g,y){let x=n.q.now(),C=()=>{let A=n.q.now()-x;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){let A=o[t[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=O)&&(!A.maxzoom||A.maxzoom>O)){let R=A,F=R.layout.get("symbol-z-elevate"),z=R.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=R.layout.get("symbol-z-order"),W=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&z),q=R.layout.get("text-allow-overlap")||R.layout.get("icon-allow-overlap")||R.layout.get("text-ignore-placement")||R.layout.get("icon-ignore-placement"),X=W&&q,Z=this._inProgressLayer=this._inProgressLayer||new ov(R),Q=n.av(A.source,A.scope);if(Z.continuePlacement(F||X?g[Q]:d[Q],this.placement,this._showCollisionBoxes,A,C,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let Xs=512/n.ab/2;class sv{constructor(t,o,d){this.tileID=t,this.bucketInstanceId=d,this.index=new n.bz(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let g=t.canonical.x*n.ab,y=t.canonical.y*n.ab;for(let x=0;x<o.length;x++){let{key:C,crossTileID:A,tileAnchorX:O,tileAnchorY:R}=o.get(x),F=Math.floor((g+O)*Xs),z=Math.floor((y+R)*Xs);this.index.add(F,z),this.keys.push(C),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,o,d){let g=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),y=Xs/Math.pow(2,o.canonical.z-this.tileID.canonical.z),x=o.canonical.x*n.ab,C=o.canonical.y*n.ab;for(let A=0;A<t.length;A++){let O=t.get(A);if(O.crossTileID)continue;let{key:R,tileAnchorX:F,tileAnchorY:z}=O,j=Math.floor((x+F)*y),W=Math.floor((C+z)*y),q=this.index.range(j-g,W-g,j+g,W+g);for(let X of q){let Z=this.crossTileIDs[X];if(this.keys[X]===R&&!d.has(Z)){d.add(Z),O.crossTileID=Z;break}}}}}class za{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class am{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let o=Math.round((t-this.lng)/360);if(o!==0)for(let d in this.indexes){let g=this.indexes[d],y={};for(let x in g){let C=g[x];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+o),y[C.tileID.key]=C}this.indexes[d]=y}this.lng=t}addBucket(t,o,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);let g=this.usedCrossTileIDs[t.overscaledZ];for(let y in this.indexes){let x=this.indexes[y];if(Number(y)>t.overscaledZ)for(let C in x){let A=x[C];A.tileID.isChildOf(t)&&A.findMatches(o.symbolInstances,t,g)}else{let C=x[t.scaledTo(Number(y)).key];C&&C.findMatches(o.symbolInstances,t,g)}}for(let y=0;y<o.symbolInstances.length;y++){let x=o.symbolInstances.get(y);x.crossTileID||(x.crossTileID=d.generate(),g.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new sv(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(let d of o.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let o=!1;for(let d in this.indexes){let g=this.indexes[d];for(let y in g)t[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[y]),delete g[y],o=!0)}return o}}class gu{constructor(){this.layerIndexes={},this.crossTileIDs=new za,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,d,g){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new am);let x=!1,C={};g.name!=="globe"&&y.handleWrapJump(d);for(let A of o){let O=A.getBucket(t);O&&t.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(A.tileID,O,this.crossTileIDs)&&(x=!0),C[O.bucketInstanceId]=!0)}return y.removeStaleBuckets(C)&&(x=!0),x}pruneUnusedLayers(t){let o={};t.forEach(d=>{o[d]=!0});for(let d in this.layerIndexes)o[d]||delete this.layerIndexes[d]}}let Ei=771;class Qt{constructor(t,o,d,g){this.blendFunction=t,this.blendColor=o,this.mask=d,this.blendEquation=g}}Qt.Replace=[1,0,1,0],Qt.disabled=new Qt(Qt.Replace,n.bA.transparent,[!1,!1,!1,!1]),Qt.unblended=new Qt(Qt.Replace,n.bA.transparent,[!0,!0,!0,!0]),Qt.alphaBlended=new Qt([1,Ei,1,Ei],n.bA.transparent,[!0,!0,!0,!0]),Qt.alphaBlendedNonPremultiplied=new Qt([770,Ei,770,Ei],n.bA.transparent,[!0,!0,!0,!0]),Qt.multiply=new Qt([774,0,774,0],n.bA.transparent,[!0,!0,!0,!0]);class It{constructor(t,o,d){this.func=t,this.mask=o,this.range=d}}It.ReadOnly=!1,It.ReadWrite=!0,It.disabled=new It(519,It.ReadOnly,[0,1]);let fd=7680;class jt{constructor(t,o,d,g,y,x){this.test=t,this.ref=o,this.mask=d,this.fail=g,this.depthFail=y,this.pass=x}}jt.disabled=new jt({func:519,mask:0},0,0,fd,fd,fd);let pd=1029,Yl=2305;class Lt{constructor(t,o,d){this.enable=t,this.mode=o,this.frontFace=d}}function md(h,t){let o=n.bD(h,3);n.a6.mat4.fromQuat(h,t),n.bF(h,3,o)}function _u(h,t){let o=n.a6.quat.identity([]);return n.a6.quat.rotateZ(o,o,-t),n.a6.quat.rotateX(o,o,-h),o}function gd(h,t){let o=[h[0],h[1],0],d=[t[0],t[1],0];if(n.a6.vec3.length(o)>=1e-15){let x=n.a6.vec3.normalize([],o);n.a6.vec3.scale(d,x,n.a6.vec3.dot(d,x)),t[0]=d[0],t[1]=d[1]}let g=n.a6.vec3.cross([],t,h);if(n.a6.vec3.len(g)<1e-15)return null;let y=Math.atan2(-g[1],g[0]);return _u(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}Lt.disabled=new Lt(!1,pd,Yl),Lt.backCCW=new Lt(!0,pd,Yl),Lt.backCW=new Lt(!0,pd,2304),Lt.frontCW=new Lt(!0,1028,2304),Lt.frontCCW=new Lt(!0,1028,Yl);class vs{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){let o=t instanceof n.a5?t:new n.a5(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=n.bB(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o){if(this.orientation=null,!this.position)return;let d=this.position,g=this._elevation?this._elevation.getAtPointOrZero(n.a5.fromLngLat(t)):0,y=n.a5.fromLngLat(t,g),x=[y.x-d.x,y.y-d.y,y.z-d.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=gd(x,o)}setPitchBearing(t,o){this.orientation=_u(n.bC(t),n.bC(-o))}}class Ys{constructor(t,o){this._transform=n.a6.mat4.identity([]),this.orientation=o,this.position=t}get mercatorPosition(){let t=this.position;return new n.a5(t[0],t[1],t[2])}get position(){let t=n.bD(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&n.bF(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.a6.quat.identity([]),t&&md(this._transform,this._orientation)}getPitchBearing(){let t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=_u(t,o),md(this._transform,this._orientation)}forward(){let t=n.bD(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){let t=n.bD(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){let t=n.bD(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){let d=new Float64Array(16);return n.a6.mat4.invert(d,this.getWorldToCamera(t,o)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,d){let g=this.position;n.a6.vec3.scale(g,g,-t);let y=new Float64Array(16);return n.a6.mat4.fromScaling(y,[d,d,d]),n.a6.mat4.translate(y,y,g),y[10]*=o,y}getWorldToCamera(t,o){let d=new Float64Array(16),g=new Float64Array(4),y=this.position;return n.a6.quat.conjugate(g,this._orientation),n.a6.vec3.scale(y,y,-t),n.a6.mat4.fromQuat(d,g),n.a6.mat4.translate(d,d,y),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=o,d[9]*=o,d[10]*=o,d[11]*=o,d}getCameraToClipPerspective(t,o,d,g){let y=new Float64Array(16);return n.a6.mat4.perspective(y,t,o,d,g),y}getCameraToClipOrthographic(t,o,d,g,y,x){let C=new Float64Array(16);return n.a6.mat4.ortho(C,t,o,d,g,y,x),C}getDistanceToElevation(t,o=!1){let d=t===0?0:n.bE(t,o?n.aN(this.position[1]):this.position[1]),g=this.forward();return(d-this.position[2])/g[2]}clone(){return new Ys([...this.position],[...this.orientation])}}let $r={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class yu{constructor(t=0,o=0,d=0,g=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=d,this.right=g}interpolate(t,o,d){return o.top!=null&&t.top!=null&&(this.top=n.aa(t.top,o.top,d)),o.bottom!=null&&t.bottom!=null&&(this.bottom=n.aa(t.bottom,o.bottom,d)),o.left!=null&&t.left!=null&&(this.left=n.aa(t.left,o.left,d)),o.right!=null&&t.right!=null&&(this.right=n.aa(t.right,o.right,d)),this}getCenter(t,o){let d=n.ap((this.left+t-this.right)/2,0,t),g=n.ap((this.top+o-this.bottom)/2,0,o);return new n.P(d,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new yu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Ba=(h,t,o)=>(1-o)*h+o*t,Va=h=>h*h*h*h*h;class vu{constructor(t,o,d,g,y,x,C){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=d??0,this._maxPitch=g??60,this.setProjection(x),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new n.bL(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new yu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ys,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let t=new vu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){let d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return n.ar(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};let o=this.projection?this.getProjection():void 0;this.projection=n.bM(this.projectionOptions);let d=this.getProjection(),g=!n.bi(o,d);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){let t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.bM({name:"mercator"});let o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.bE(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bB(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){let o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=n.a6.mat2.create(),n.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let o=n.ap(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.bC(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){let o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){let t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let d=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop(),g=0,y=0;for(let x=0;x<o.length;x++){let C=new n.P(o[x][0]*this.width,d+o[x][1]*(this.height-d)),A=t.pointCoordinate(C);if(!A)continue;let O=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);g+=A[3]*O,y+=O}return y===0?NaN:g/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*o,g=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),x=Math.max(g-d,y);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){let o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),d;d=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];let g=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,d));return n.ap(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!n.a6.quat.exactEquals(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){let d=[t.position.x,t.position.y,t.position.z];n.a6.vec3.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let t=this._camera.position,o=new vs;return o.position=new n.a5(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!n.a6.quat.length(t))return!1;n.a6.quat.normalize(t,t);let o=n.a6.vec3.transformQuat([],[0,0,-1],t),d=n.a6.vec3.transformQuat([],[0,-1,0],t);if(d[2]<0)return!1;let g=gd(o,d);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){let o=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=n.ap(t[2],g/d,g/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,d){this._unmodified=!1,this._edgeInsets.interpolate(t,o,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){let o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){let o=[new n.bN(0,t)];if(this.renderWorldCopies){let d=this.pointCoordinate(new n.P(0,0)),g=this.pointCoordinate(new n.P(this.width,0)),y=this.pointCoordinate(new n.P(this.width,this.height)),x=this.pointCoordinate(new n.P(0,this.height)),C=Math.floor(Math.min(d.x,g.x,y.x,x.x)),A=Math.floor(Math.max(d.x,g.x,y.x,x.x)),O=1;for(let R=C-O;R<=A+O;R++)R!==0&&o.push(new n.bN(R,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,d){let g=[],y=d!==void 0,x=!y;if(x&&this.zoom<o||y&&d[0]===0&&d[1]===0)return g;let C=new Set,A=(R,F,z,j,W)=>{let q=n.c2(F,R,z,j,W);C.has(q)||(g.push(new n.aA(R,F,z,j,W)),C.add(q))};for(let R=0;R<t.length;R++){let F=t[R];if(x&&F.canonical.z!==o)continue;let z=F.canonical,j=F.overscaledZ,W=F.wrap,q=1<<z.z,X=z.x+1<q,Z=z.x>0,Q=z.y+1<q,re=z.y>0,ie=F.wrap-(Z?0:1),ae=F.wrap+(X?0:1),ue=Z?z.x-1:q-1,le=X?z.x+1:0;if(y)d[0]<0?(A(j,ae,z.z,le,z.y),d[1]<0&&Q&&(A(j,W,z.z,z.x,z.y+1),A(j,ae,z.z,le,z.y+1)),d[1]>0&&re&&(A(j,W,z.z,z.x,z.y-1),A(j,ae,z.z,le,z.y-1))):d[0]>0?(A(j,ie,z.z,ue,z.y),d[1]<0&&Q&&(A(j,W,z.z,z.x,z.y+1),A(j,ie,z.z,ue,z.y+1)),d[1]>0&&re&&(A(j,W,z.z,z.x,z.y-1),A(j,ie,z.z,ue,z.y-1))):d[1]<0&&Q?A(j,W,z.z,z.x,z.y+1):re&&A(j,W,z.z,z.x,z.y-1);else{let he=F.visibleQuadrants;1&he&&(A(j,ie,z.z,ue,z.y),re&&(A(j,W,z.z,z.x,z.y-1),A(j,ie,z.z,ue,z.y-1))),2&he&&(A(j,ae,z.z,le,z.y),re&&(A(j,W,z.z,z.x,z.y-1),A(j,ae,z.z,le,z.y-1))),4&he&&(A(j,ie,z.z,ue,z.y),Q&&(A(j,W,z.z,z.x,z.y+1),A(j,ie,z.z,ue,z.y+1))),8&he&&(A(j,ae,z.z,le,z.y),Q&&(A(j,W,z.z,z.x,z.y+1),A(j,ae,z.z,le,z.y+1)))}}let O=[];for(let R of g)g.some(F=>R.isChildOf(F))||O.push(R);if(g=O.filter(R=>!t.some(F=>!!(R.overscaledZ<o&&F.isChildOf(R))||R.equals(F)||R.isChildOf(F))),x){let R=1<<o,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),z=[R*F.x,R*F.y],j=4,W=j*j;g=g.filter(q=>{let X=q.canonical.x+.5-z[0],Z=q.canonical.y+.5-z[1];return X*X+Z*Z<W})}return g}coveringTiles(t){let o=this.coveringZoomLevel(t),d=o,g=this.elevation&&this.elevation.exaggeration(),y=g&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);let C=this.locationCoordinate(this.center),A=this.center.lat,O=1<<o,R=[O*C.x,O*C.y,0],F=this.projection.name==="globe",z=!F,j=n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,z),W=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=O*n.bE(1,this.center.lat),X=this._camera.position[2]/n.bE(1,this.center.lat),Z=[O*W.x,O*W.y,X*(z?1:q)],Q=F||g,re=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ie=this.isLODDisabled(!0)?o:0,ae;if(this._elevation&&t.isTerrainDEM)ae=1e4*this._elevation.exaggeration();else if(this._elevation){let Se=this._elevation.getMinMaxForVisibleTiles();ae=Se?Se.max:this._centerAltitude}else ae=this._centerAltitude;let ue=t.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,le=this.projection.isReprojectedInTileSpace?n.bP(this):1,he=Se=>{let Le=new n.a5(Se.x+25e-6,Se.y,Se.z),He=new n.a5(Se.x,Se.y+25e-6,Se.z),Ze=Se.toLngLat(),$e=Le.toLngLat(),st=He.toLngLat(),yt=this.locationCoordinate(Ze),bt=this.locationCoordinate($e),dt=this.locationCoordinate(st),Tt=Math.hypot(bt.x-yt.x,bt.y-yt.y),lt=Math.hypot(dt.x-yt.x,dt.y-yt.y);return Math.sqrt(Tt*lt)*le/25e-6},me=Se=>{let Ge=ae,Le=ue;return{aabb:n.bS(this,O,0,0,0,Se,Le,Ge,this.projection),zoom:0,x:0,y:0,minZ:Le,maxZ:Ge,wrap:Se,fullyVisible:!1}},xe=[],_e=[],ge=o,Oe=t.reparseOverscaled?d:o,Be=(X-this._centerAltitude)*q,qe=Se=>{if(!this._elevation||!Se.tileID||!x)return;let Ge=this._elevation.getMinMaxForTile(Se.tileID),Le=Se.aabb;Ge?(Le.min[2]=Ge.min,Le.max[2]=Ge.max,Le.center[2]=(Le.min[2]+Le.max[2])/2):(Se.shouldSplit=nt(Se),Se.shouldSplit||(Le.min[2]=Le.max[2]=Le.center[2]=this._centerAltitude))},Ke=(Se,Ge)=>{if(.707*Ge<Se)return 1;let Le=Ge/Se;return Le/(1.4144271570014144+(Math.pow(1.1,Le-1.4144271570014144+1)-1)/(1.1-1)-1)},nt=Se=>{if(Se.zoom<ie)return!0;if(Se.zoom===ge)return!1;if(Se.shouldSplit!=null)return Se.shouldSplit;let Ge=Se.aabb.distanceX(Z),Le=Se.aabb.distanceY(Z),He=Be,Ze=1;if(F){He=Se.aabb.distanceZ(Z);let lt=Math.pow(2,Se.zoom),Dt=n.aN((Se.y+1)/lt),Ut=n.aN(Se.y/lt),tn=Math.min(Math.max(A,Dt),Ut),zn=n.c6(tn)/n.c6(A);if(Ze=tn===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,zn/this._mercatorScaleRatio),this.zoom<=n.c3&&Se.zoom===ge-1&&zn>=.9)return!0}else if(y&&(He=Se.aabb.distanceZ(Z)*q),this.projection.isReprojectedInTileSpace&&d<=5){let lt=Math.pow(2,Se.zoom),Dt=he(new n.a5((Se.x+.5)/lt,(Se.y+.5)/lt));Ze=Dt>.85?1:Dt}if(!x){let lt=Math.sqrt(Ge*Ge+Le*Le+He*He),Dt=(1<<ge-Se.zoom)*re*Ze;return Dt*=Ke(Math.max(He,Be),lt),lt<Dt}let $e=Number.MAX_VALUE,st=0,yt=Se.aabb.getCorners(),bt=[];for(let lt of yt){n.a6.vec3.sub(bt,lt,Z),F||(y?bt[2]*=q:bt[2]=Be);let Dt=n.a6.vec3.dot(bt,this._camera.forward());Dt<$e&&($e=Dt,st=Math.abs(bt[2]))}let dt=(1<<ge-Se.zoom)*re*Ze;if(dt*=Ke(Math.max(st,Be),$e),$e<dt)return!0;let Tt=Se.aabb.closestPoint(R);return Tt[0]===R[0]&&Tt[1]===R[1]};if(this.renderWorldCopies)for(let Se=1;Se<=3;Se++)xe.push(me(-Se)),xe.push(me(Se));for(xe.push(me(0));xe.length>0;){let Se=xe.pop(),Ge=Se.x,Le=Se.y,He=Se.fullyVisible,Ze=()=>this.projection.name==="globe"&&(Se.y===0||Se.y===(1<<Se.zoom)-1);if(!He){let $e=Q?Se.aabb.intersects(j):Se.aabb.intersectsFlat(j);if($e===0&&Ze()){let st=new n.bQ(Se.zoom,Ge,Le);$e=n.bR(this,O,st,!0).intersects(j)}if($e===0)continue;He=$e===2}if(Se.zoom!==ge&&nt(Se))for(let $e=0;$e<4;$e++){let st=(Ge<<1)+$e%2,yt=(Le<<1)+($e>>1),bt={aabb:x?Se.aabb.quadrant($e):n.bS(this,O,Se.zoom+1,st,yt,Se.wrap,Se.minZ,Se.maxZ,this.projection),zoom:Se.zoom+1,x:st,y:yt,wrap:Se.wrap,fullyVisible:He,tileID:void 0,shouldSplit:void 0,minZ:Se.minZ,maxZ:Se.maxZ};y&&!F&&(bt.tileID=new n.aA(Se.zoom+1===ge?Oe:Se.zoom+1,Se.wrap,Se.zoom+1,st,yt),qe(bt)),xe.push(bt)}else{let $e=Se.zoom===ge?Oe:Se.zoom;if(t.minzoom&&t.minzoom>$e)continue;let st=0;if(!He){let Tt=Q?Se.aabb.intersectsPrecise(j):Se.aabb.intersectsPreciseFlat(j);if(Tt===0&&Ze()){let lt=new n.bQ(Se.zoom,Ge,Le);Tt=n.bR(this,O,lt,!0).intersectsPrecise(j)}if(Tt===0)continue;if(t.calculateQuadrantVisibility)if(j.containsPoint(Se.aabb.center))st=15;else for(let lt=0;lt<4;lt++)Se.aabb.quadrant(lt).intersects(j)!==0&&(st|=1<<lt)}let yt=R[0]-(.5+Ge+(Se.wrap<<Se.zoom))*(1<<o-Se.zoom),bt=R[1]-.5-Le,dt=Se.tileID?Se.tileID:new n.aA($e,Se.wrap,Se.zoom,Ge,Le);t.calculateQuadrantVisibility&&(dt.visibleQuadrants=st),_e.push({tileID:dt,distanceSq:yt*yt+bt*bt})}}if(this.fogCullDistSq){let Se=this.fogCullDistSq,Ge=this.horizonLineFromTop();_e=_e.filter(Le=>{let He=[0,0,0,1],Ze=[n.ab,n.ab,0,1],$e=this.calculateFogTileMatrix(Le.tileID.toUnwrapped());n.a6.vec4.transformMat4(He,He,$e),n.a6.vec4.transformMat4(Ze,Ze,$e);let st=n.a6.vec4.min([],He,Ze),yt=n.a6.vec4.max([],He,Ze),bt=n.bT(st,yt);if(bt===0)return!0;let dt=!1,Tt=this._elevation;if(Tt&&bt>Se&&Ge!==0){let lt=this.calculateProjMatrix(Le.tileID.toUnwrapped()),Dt;t.isTerrainDEM||(Dt=Tt.getMinMaxForTile(Le.tileID)),Dt||(Dt={min:ue,max:ae});let Ut=n.c4(this.rotation),tn=[Ut[0]*n.ab,Ut[1]*n.ab,Dt.max];n.a6.vec3.transformMat4(tn,tn,lt),dt=(1-tn[1])*this.height*.5<Ge}return bt<Se||dt})}return _e.sort((Se,Ge)=>Se.distanceSq-Ge.distanceSq).map(Se=>Se.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){let o=n.ap(t.lat,-n.bU,n.bU),d=this.projection.project(t.lng,o);return new n.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.bE(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let d,g,y=this.centerPoint;if(this.projection.name==="globe"){let C=this.worldSize;d=(o.x-y.x)/C,g=(o.y-y.y)/C}else{let C=this.pointCoordinate(o),A=this.pointCoordinate(y);d=C.x-A.x,g=C.y-A.y}let x=this.locationCoordinate(t);this.setLocation(new n.a5(x.x-d,x.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,o){let d=o?n.bE(o,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new n.a5(g.x,g.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){let d=o??this._centerAltitude,g=[t.x,t.y,0,1],y=[t.x,t.y,1,1];n.a6.vec4.transformMat4(g,g,this.pixelMatrixInverse),n.a6.vec4.transformMat4(y,y,this.pixelMatrixInverse);let x=y[3];n.a6.vec4.scale(g,g,1/g[3]),n.a6.vec4.scale(y,y,1/x);let C=g[2],A=y[2];return{p0:g,p1:y,t:C===A?0:(d-C)/(A-C)}}screenPointToMercatorRay(t){let o=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return n.a6.vec4.transformMat4(o,o,this.pixelMatrixInverse),n.a6.vec4.transformMat4(d,d,this.pixelMatrixInverse),n.a6.vec4.scale(o,o,1/o[3]),n.a6.vec4.scale(d,d,1/d[3]),o[2]=n.bE(o[2],this._center.lat)*this.worldSize,d[2]=n.bE(d[2],this._center.lat)*this.worldSize,n.a6.vec4.scale(o,o,1/this.worldSize),n.a6.vec4.scale(d,d,1/this.worldSize),new n.aj([o[0],o[1],o[2]],n.a6.vec3.normalize([],n.a6.vec3.sub([],d,o)))}rayIntersectionCoordinate(t){let{p0:o,p1:d,t:g}=t,y=n.bE(o[2],this._center.lat),x=n.bE(d[2],this._center.lat);return new n.a5(n.aa(o[0],d[0],g)/this.worldSize,n.aa(o[1],d[1],g)/this.worldSize,n.aa(y,x,g))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let o=this.projection.pointCoordinate3D(this,t.x,t.y);if(o)return new n.a5(o[0],o[1],o[2]);let d=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t);let y=.02*g,x=t.clone();for(let C=0;C<10&&g-d>y;C++){x.y=n.aa(d,g,.66);let A=this.projection.pointCoordinate3D(this,x.x,x.y);A?(g=x.y,o=A):d=x.y}return o?new n.a5(o[0],o[1],o[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.bV)return!this.isPointAboveHorizon(t);let o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){let d=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return n.a6.vec4.transformMat4(g,g,this.pixelMatrix),g[3]>0?new n.P(g[0]/g[3],g[1]/g[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:t,left:o}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,y=this.pointLocation3D(new n.P(o,t)),x=this.pointLocation3D(new n.P(g,t)),C=this.pointLocation3D(new n.P(g,d)),A=this.pointLocation3D(new n.P(o,d)),O=Math.min(y.lng,x.lng,C.lng,A.lng),R=Math.max(y.lng,x.lng,C.lng,A.lng),F=Math.min(y.lat,x.lat,C.lat,A.lat),z=Math.max(y.lat,x.lat,C.lat,A.lat),j=Math.pow(2,-this.zoom)/16*270,W=this.projection.name==="globe"?1:4,q=(X,Z,Q,re,ie)=>{let ae=(X+Q)/2,ue=(Z+re)/2,le=new n.P(ae,ue),{lng:he,lat:me}=this.pointLocation3D(le),xe=Math.max(0,O-he,F-me,he-R,me-z);O=Math.min(O,he),R=Math.max(R,he),F=Math.min(F,me),z=Math.max(z,me),(ie<W||xe>j)&&(q(X,Z,ae,ue,ie+1),q(ae,ue,Q,re,ie+1))};if(q(o,t,g,t,1),q(g,t,g,d,1),q(g,d,o,d,1),q(o,d,o,t,1),this.projection.name==="globe"){let[X,Z]=n.bW(this);X?(z=90,R=180,O=-180):Z&&(F=-90,R=180,O=-180)}return new n.as(new n.bL(O,F),new n.bL(R,z))}_getBoundsRectangular(t,o){let{top:d,left:g}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,C=new n.P(g,d),A=new n.P(x,d),O=new n.P(x,y),R=new n.P(g,y),F=this.pointCoordinate(C,t),z=this.pointCoordinate(A,t),j=this.pointCoordinate(O,o),W=this.pointCoordinate(R,o),q=(X,Z)=>(Z.y-X.y)/(Z.x-X.x);return F.y>1&&z.y>=0?F=new n.a5((1-W.y)/q(W,F)+W.x,1):F.y<0&&z.y<=1&&(F=new n.a5(-W.y/q(W,F)+W.x,0)),z.y>1&&F.y>=0?z=new n.a5((1-j.y)/q(j,z)+j.x,1):z.y<0&&F.y<=1&&(z=new n.a5(-j.y/q(j,z)+j.x,0)),new n.as().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){let t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);let o=t.visibleDemTiles.reduce((d,g)=>{if(g.dem){let y=g.dem.tree;d.min=Math.min(d.min,y.minimums[0]),d.max=Math.max(d.max,y.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){let o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.bU,this.maxLat=n.bU,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.am(this.minLng)*this.tileSize,this.worldMaxX=n.am(this.maxLng)*this.tileSize,this.worldMinY=n.at(this.maxLat)*this.tileSize,this.worldMaxY=n.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){let o=t.key,d=this._distanceTileDataCache;if(d[o])return d[o];let g=t.canonical,y=1/this.height,x=this.cameraWorldSize,C=x/this.zoomScale(g.z),A=(g.x+Math.pow(2,g.z)*t.wrap)*C,O=g.y*C,R=this.point;R.x*=x/this.worldSize,R.y*=x/this.worldSize;let F=this.angle,z=Math.sin(-F),j=-Math.cos(-F);return d[o]={bearing:[z,j],center:[(R.x-A)*y,(R.y-O)*y],scale:C/n.ab*y},d[o]}calculateFogTileMatrix(t){let o=t.key,d=this._fogTileMatrixCache;if(d[o])return d[o];let g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.a6.mat4.multiply(g,this.worldToFogMatrix,g),d[o]=new Float32Array(g),d[o]}calculateProjMatrix(t,o=!1,d=!1){let g=t.key,y;if(y=d?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,y[g])return y[g];let x=this.calculatePosMatrix(t,this.worldSize),C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,n.a6.mat4.multiply(x,C,x),y[g]=new Float32Array(x),y[g]}calculatePixelsToTileUnitsMatrix(t){let o=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[o])return d[o];let g=n.bX(t,this);return d[o]=g,d[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let t=1/this.worldSize,o=n.a6.mat4.fromScaling([],[t,t,t]);return n.a6.mat4.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let t=this._elevation;this._updateCameraState();let o=n.bE(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(o),g=this._camera.forward(),y=n.bE(1,this._center.lat);d[2]/=y,g[2]/=y,n.a6.vec3.normalize(g,g);let x=t.raycast(d,g,t.exaggeration());if(x){let C=n.a6.vec3.scaleAndAdd([],d,g,x),A=new n.a5(C[0],C[1],n.bE(C[2],n.aN(C[1]))),O=(A.z+n.a6.vec3.length([A.x-d[0],A.y-d[1],A.z-d[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;let o=this._elevation,d=n.bE(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(d),y=o.getAtPointOrZero(new n.a5(...g)),x=this.pixelsPerMeter/this.worldSize*y,C=this._minimumHeightOverTerrain(),A=g[2]-x;if(A<=C)if(A<0||t){let O=this.locationCoordinate(this._center,this._centerAltitude),R=[g[0],g[1],O.z-g[2]],F=n.a6.vec3.length(R);R[2]-=(C-A)/this._pixelsPerMercatorPixel;let z=n.a6.vec3.length(R);if(z===0)return;n.a6.vec3.scale(R,R,F/z*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],O.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){let z=this.center;return z.lat=n.ap(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(z.lng=n.ap(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}let o=this._unmodified,{x:d,y:g}=this.point,y=0,x=d,C=g,A=this.width/2,O=this.height/2,R=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(g-O<R&&(C=R+O),g+O>F&&(C=F-O),F-R<this.height&&(y=Math.max(y,this.height/(F-R)),C=(F+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let z=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,W=this.worldSize/2-(z+j)/2;x=(d+W+this.worldSize)%this.worldSize-W,x-A<z&&(x=z+A),x+A>j&&(x=j-A),j-z<this.width&&(y=Math.max(y,this.width/(j-z)),x=(j+z)/2)}x===d&&C===g||(this.center=this.unproject(new n.P(x,C))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,o=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.bE(1,this.center.lat)/n.bE(1,n.c5));let g=n.bY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let y=this.projection.zAxisUnit==="meters"?d:1,x=this._camera.getWorldToCamera(this.worldSize,y),C,A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let me=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),xe=me*this.aspect,_e=-xe,ge=-me;xe-=t.x,_e-=t.x,me+=t.y,ge+=t.y,C=this._camera.getCameraToClipOrthographic(_e,xe,ge,me,this._nearZ,this._farZ),((Oe,Be,qe,Ke)=>{for(let nt=0;nt<16;nt++)Oe[nt]=Ba(Be[nt],qe[nt],Ke)})(C,C,A,Va(this.pitch>=15?1:this.pitch/15))}else C=A;let O=n.a6.mat4.mul([],A,x),R=n.a6.mat4.mul([],C,x);if(this.projection.isReprojectedInTileSpace){let me=this.locationCoordinate(this.center),xe=n.a6.mat4.identity([]);n.a6.mat4.translate(xe,xe,[me.x*this.worldSize,me.y*this.worldSize,0]),n.a6.mat4.multiply(xe,xe,n.bZ(this)),n.a6.mat4.translate(xe,xe,[-me.x*this.worldSize,-me.y*this.worldSize,0]),n.a6.mat4.multiply(R,R,xe),n.a6.mat4.multiply(O,O,xe),this.inverseAdjustmentMatrix=n.b_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.a6.mat4.scale([],R,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=R,this.invProjMatrix=n.a6.mat4.invert(new Float64Array(16),this.projMatrix),o){let me=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);me[8]=2*-t.x/this.width,me[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.a6.mat4.mul([],me,x)}else this.expandedFarZProjMatrix=this.projMatrix;let F=n.a6.mat4.invert([],C);this.frustumCorners=n.b$.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);let z=new Float32Array(16);n.a6.mat4.identity(z),n.a6.mat4.scale(z,z,[1,-1,1]),n.a6.mat4.rotateX(z,z,this._pitch),n.a6.mat4.rotateZ(z,z,this.angle);let j=n.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.a6.mat4.clone(j);let W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-t.x/this.width,j[9]=2*(t.y+W)/this.height,this.skyboxMatrix=n.a6.mat4.multiply(z,j,z);let q=this.point,X=q.x,Z=q.y,Q=this.width%2/2,re=this.height%2/2,ie=Math.cos(this.angle),ae=Math.sin(this.angle),ue=X-Math.round(X)+ie*Q+ae*re,le=Z-Math.round(Z)+ie*re+ae*Q,he=new Float64Array(R);if(n.a6.mat4.translate(he,he,[ue>.5?ue-1:ue,le>.5?le-1:le,0]),this.alignedProjMatrix=he,R=n.a6.mat4.create(),n.a6.mat4.scale(R,R,[this.width/2,-this.height/2,1]),n.a6.mat4.translate(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=n.a6.mat4.create(),n.a6.mat4.scale(R,R,[1,-1,1]),n.a6.mat4.translate(R,R,[-1,-1,0]),n.a6.mat4.scale(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=n.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},R=n.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.c0(this);let me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.a6.vec3.transformMat4(me,me,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,d=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,o];n.a6.vec3.scale(y,y,g),n.a6.vec3.scale(d,d,-1),n.a6.vec3.multiply(d,d,y);let x=n.a6.mat4.create();n.a6.mat4.translate(x,x,d),n.a6.mat4.scale(x,x,y),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,g)}_computeCameraPosition(t){let o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),g=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-d[0]*y,g.y/this.worldSize-d[1]*y,t/this.worldSize*this._centerAltitude-d[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){let o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],g=t[2],y=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(y=Math.min((o-d)/g,1)),this._camera.position=n.a6.vec3.scaleAndAdd([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){let t=this._camera.position,o=this._camera.forward(),{pitch:d,bearing:g}=this._camera.getPitchBearing(),y=n.bE(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.bC(this._maxPitch)),C=Math.max((t[2]-y)/Math.cos(d),x),A=this._zoomFromMercatorZ(C);n.a6.vec3.scaleAndAdd(t,t,o,C),this._pitch=n.ap(d,n.bC(this.minPitch),n.bC(this.maxPitch)),this.angle=n.bB(g,-Math.PI,Math.PI),this._setZoom(n.ap(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.a5(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){let t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,d=n.bV,g=0,y=1/0;for(;d-o>1e-6&&d>o;){let x=o+.5*(d-o),C=this.tileSize*Math.pow(2,x),A=this.getCameraToCenterDistance(this.projection,x,C),O=this.scaleZoom(A/(t*this.tileSize)),R=Math.abs(x-O);R<y&&(y=R,g=x),x<O?o=x:d=x}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){let d=Math.min(t.x,o.x),g=Math.max(t.x,o.x),y=Math.min(t.y,o.y),x=Math.max(t.y,o.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let C=[new n.P(d,y),new n.P(g,x),new n.P(d,x),new n.P(g,y)],A=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(let R of C){let F=this.pointRayIntersection(R);if(F.t<0)return!0;let z=this.rayIntersectionCoordinate(F);if(z.x<A||z.y<0||z.x>O||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.c1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,o){let d=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,t)),g=this._zoomFromMercatorZ(d)+o;return d-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){let t=function([o,d,g],y){let x=[o,d,g,1];n.a6.vec4.transformMat4(x,x,y);let C=x[3]=Math.max(x[3],1e-6);return x[0]/=C,x[1]/=C,x[2]/=C,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,d=this.worldSize){let g=n.bY(t,o,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,d,g),x=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(x=Ba(1,x,Va(this.pitch>=15?1:this.pitch/15))),x}getWorldToCameraMatrix(){let t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.a6.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}let jo=(h,t)=>{if(t>0&&h.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let o=h.transform,d=Math.max(Math.abs(o._zoom-(h.minCutoffZoom-1)),1),g=o.isLODDisabled(!1)?n.a7(60,45,o.pitch):n.a7(30,15,o.pitch),y=o._farZ-o._nearZ,x=t*o.height,C=((1-(A=g))*o.cameraToCenterDistance+A*(o._farZ+x))*d;var A;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(C-o._nearZ)/y,(C-x-o._nearZ)/y]}}},cr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class _d{constructor(t,o){this.aabb=t,this.lastCascade=o}}class ot{add(t,o){let d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],o.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],o.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],o.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],o.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],o.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],o.max[2])):this.receivers[t.key]=new _d(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,d){let g=n.ca.fromPoints(t.points),y=0;for(let x in this.receivers){let C=this.receivers[x];if(!C||!g.intersectsAabb(C.aabb))continue;C.aabb.min=g.closestPoint(C.aabb.min),C.aabb.max=g.closestPoint(C.aabb.max);let A=C.aabb.getCorners();for(let O=0;O<d.length;O++){let R=!0;for(let F of A){let z=[F[0]*o,F[1]*o,F[2]];if(n.a6.vec3.transformMat4(z,z,d[O].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){R=!1;break}}if(C.lastCascade=O,y=Math.max(y,O),R)break}}return y+1}}class lm{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ot,this._depthMode=new It(t.context.gl.LEQUAL,It.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(cr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(cr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(cr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){let d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;let g=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||g<=0||(this._shadowLayerCount=d.style.order.reduce((W,q)=>{let X=d.style._mergedLayers[q];return W+(X.hasShadowPass()&&!X.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let y=d.context,x=cr.shadowMapResolution,C=cr.shadowMapResolution;if(this._cascades.length===0||cr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let W=0;W<cr.cascadeCount;++W){let q=d._shadowMapDebug,X=y.gl,Z=y.createFramebuffer(x,C,q,"texture"),Q=new n.T(y,{width:x,height:C,data:null},X.DEPTH_COMPONENT16);if(Z.depthAttachment.set(Q.texture),q){let re=new n.T(y,{width:x,height:C,data:null},X.RGBA8);Z.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:Z,texture:Q,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.bO,scale:0})}}this.shadowDirection=xu(o);let A=0;if(t.elevation){let W=t.elevation,q=[1e4,-1e4];W.visibleDemTiles.filter(X=>X.dem).forEach(X=>{let Z=X.dem.tree;q[0]=Math.min(q[0],Z.minimums[0]),q[1]=Math.max(q[1],Z.maximums[0])}),q[0]!==1e4&&(A=(q[1]-q[0])*W.exaggeration())}let O=1.5*t.cameraToCenterDistance,R=3*O,F=new Float64Array(16);for(let W=0;W<this._cascades.length;++W){let q=this._cascades[W],X=t.height/50,Z=1;cr.cascadeCount===1?Z=R:W===0?Z=O:(X=O,Z=R);let[Q,re]=wu(t,this.shadowDirection,X,Z,cr.shadowMapResolution,A);q.scale=t.scale,q.matrix=Q,q.boundingSphereRadius=re,n.a6.mat4.invert(F,q.matrix),q.frustum=n.bO.fromInvProjectionMatrix(F,1,0,!0),q.far=Z}let z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/cr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=cr.shadowMapResolution,this._uniformValues.u_shadowmap_0=$r.ShadowMap0,this._uniformValues.u_shadowmap_1=$r.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let j=d.transform.elevation;for(let W of this._groundShadowTiles){let q={min:0,max:0};if(j){let X=j.getMinMaxForTile(W);X&&(q=X)}this.addShadowReceiver(W.toUnwrapped(),q.min,q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;let d=this.painter,g=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),g.viewport.set([0,0,cr.shadowMapResolution,cr.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){d.currentShadowCascade=y,g.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),g.clear({color:n.bA.white,depth:1});for(let x of t.order){let C=t._mergedLayers[x];if(!C.hasShadowPass()||C.isHidden(d.transform.zoom))continue;let A=t.getLayerSourceCache(C),O=A?o[A.id]:void 0;(C.type==="model"||O&&O.length)&&d.renderLayer(d,A,C,O)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let t=this.painter,o=t.style,d=t.context,g=o.directionalLight,y=o.ambientLight;if(!g||!y)return;let x=[],C=jo(t,t.longestCutoffRange);C.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&x.push("NORMAL_OFFSET");let A=bu(o,g,y),O=new It(d.gl.LEQUAL,It.ReadOnly,t.depthRangeFor3D);for(let R of this._groundShadowTiles){let F=R.toUnwrapped(),z=t.isTileAffectedByFog(R),j=t.getOrCreateProgram("groundShadow",{defines:x,overrideFog:z});this.setupShadows(F,j),t.uploadCommonUniforms(d,j,F,null,C);let W={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:A};j.draw(t,d.gl.TRIANGLES,O,jt.disabled,Qt.multiply,Lt.disabled,W,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Qt.unblended:Qt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){let o=this.painter.transform,d=o.calculatePosMatrix(t,o.worldSize);return n.a6.mat4.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return n.a6.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,o,d,g=0){if(!this.enabled)return;let y=this.painter.transform,x=this.painter.context,C=x.gl,A=this._uniformValues,O=new Float64Array(16),R=y.calculatePosMatrix(t,y.worldSize);for(let F=0;F<this._cascades.length;F++)n.a6.mat4.multiply(O,this._cascades[F].matrix,R),A[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),x.activeTexture.set(C.TEXTURE0+$r.ShadowMap0+F),this._cascades[F].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){let F=n.c9(t.canonical),z=2/y.tileSize*n.ab/cr.shadowMapResolution,j=z*this._cascades[0].boundingSphereRadius,W=z*this._cascades[this._cascades.length-1].boundingSphereRadius,q=(d==="vector-tile"?1:3)/Math.pow(2,g-t.canonical.z-(1-y.zoom+Math.floor(y.zoom)));A.u_shadow_normal_offset=[F,j*q,W*q],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(x,A)}setupShadowsFromMatrix(t,o,d=!1){if(!this.enabled)return;let g=this.painter.context,y=g.gl,x=this._uniformValues,C=new Float64Array(16);for(let A=0;A<cr.cascadeCount;A++)n.a6.mat4.multiply(C,this._cascades[A].matrix,t),x[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),g.activeTexture.set(y.TEXTURE0+$r.ShadowMap0+A),this._cascades[A].texture.bind(y.NEAREST,y.CLAMP_TO_EDGE);if(this.useNormalOffset=d,d){let A=cr.normalOffset;x.u_shadow_normal_offset=[1,A,A],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(g,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,d,g){if(g[2]>=0)return{};let y=function(A,O,R){let F=R/(1<<A.canonical.z);return new n.ca([A.canonical.x*F+A.wrap*R,A.canonical.y*F+A.wrap*R,0],[(A.canonical.x+1)*F+A.wrap*R,(A.canonical.y+1)*F+A.wrap*R,O])}(t,o,d).getCorners(),x=o/-g[2];g[0]<0?(n.a6.vec3.add(y[0],y[0],[g[0]*x,0,0]),n.a6.vec3.add(y[3],y[3],[g[0]*x,0,0])):g[0]>0&&(n.a6.vec3.add(y[1],y[1],[g[0]*x,0,0]),n.a6.vec3.add(y[2],y[2],[g[0]*x,0,0])),g[1]<0?(n.a6.vec3.add(y[0],y[0],[0,g[1]*x,0]),n.a6.vec3.add(y[1],y[1],[0,g[1]*x,0])):g[1]>0&&(n.a6.vec3.add(y[2],y[2],[0,g[1]*x,0]),n.a6.vec3.add(y[3],y[3],[0,g[1]*x,0]));let C={};return C.vertices=y,C.planes=[ja(y[1],y[0],y[4]),ja(y[2],y[1],y[5]),ja(y[3],y[2],y[6]),ja(y[0],y[3],y[7])],C}addShadowReceiver(t,o,d){this._receivers.add(t,n.ca.fromTileIdAndHeight(t,o,d))}getMaxCascadeForTile(t){let o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function ja(h,t,o){let d=n.a6.vec3.sub([],o,t),g=n.a6.vec3.sub([],h,t),y=n.a6.vec3.cross([],d,g),x=n.a6.vec3.length(y);return x===0?[0,0,1,0]:(n.a6.vec3.scale(y,y,1/x),[y[0],y[1],y[2],-n.a6.vec3.dot(y,t)])}function xu(h){let t=h.properties.get("direction"),o=n.c8(t.x,t.y,t.z);o[2]=n.ap(o[2],0,75);let d=n.cb([o[0],o[1],o[2]]);return n.a6.vec3.fromValues(d.x,d.y,d.z)}function bu(h,t,o){let d=t.properties.get("color"),g=t.properties.get("intensity"),y=t.properties.get("direction"),x=[y.x,y.y,y.z],C=o.properties.get("color"),A=o.properties.get("intensity"),O=Math.max(n.a6.vec3.dot([0,0,1],x),0),R=[0,0,0];n.a6.vec3.scale(R,C.toRenderColor(h.getLut(t.scope)).toArray01Linear().slice(0,3),A);let F=[0,0,0];return n.a6.vec3.scale(F,d.toRenderColor(h.getLut(o.scope)).toArray01Linear().slice(0,3),O*g),n.cc([R[0]>0?R[0]/(R[0]+F[0]):0,R[1]>0?R[1]/(R[1]+F[1]):0,R[2]>0?R[2]/(R[2]+F[2]):0])}function wu(h,t,o,d,g,y){let x=h.zoom,C=h.scale,A=h.worldSize,O=1/A,R=h.aspect,F=Math.sqrt(1+R*R)*Math.tan(.5*h.fovX),z=F*F,j=d-o,W=d+o,q,X;z>j/W?(q=d,X=d*F):(q=.5*W*(1+z),X=.5*Math.sqrt(j*j+2*(d*d+o*o)*z+W*W*z*z));let Z=h.projection.pixelsPerMeter(h.center.lat,A),Q=h._camera.getCameraToWorldMercator(),re=[0,0,-q*O];n.a6.vec3.transformMat4(re,re,Q);let ie=X*O,ae=h._edgeInsets;if(!(ae.left===0&&ae.top===0&&ae.right===0&&ae.bottom===0||ae.left===ae.right&&ae.top===ae.bottom)){let He=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?Z:1),Ze=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,o,d);Ze[8]=2*-h.centerOffset.x/h.width,Ze[9]=2*h.centerOffset.y/h.height;let $e=new Float64Array(16);n.a6.mat4.mul($e,Ze,He);let st=new Float64Array(16);n.a6.mat4.invert(st,$e);let yt=n.bO.fromInvProjectionMatrix(st,A,x,!0);for(let bt of yt.points){let dt=((ue=bt)[0]/=C,ue[1]/=C,ue[2]=n.bE(ue[2],h._center.lat),ue);ie=Math.max(ie,n.a6.vec3.len(n.a6.vec3.subtract([],re,dt)))}}var ue;ie*=g/(g-1);let le=Math.acos(t[2]),he=Math.atan2(-t[0],-t[1]),me=new Ys;me.position=re,me.setPitchBearing(le,he);let xe=me.getWorldToCamera(A,Z),_e=ie*A,ge=Math.min(h._mercatorZfromZoom(17)*A*-2,-2*_e),Oe=me.getCameraToClipOrthographic(-_e,_e,-_e,_e,ge,(_e+y*Z)/t[2]),Be=new Float64Array(16);n.a6.mat4.multiply(Be,Oe,xe);let qe=n.a6.vec3.fromValues(Math.floor(1e6*re[0])/1e6*A,Math.floor(1e6*re[1])/1e6*A,0),Ke=.5*g,nt=[0,0,0];n.a6.vec3.transformMat4(nt,qe,Be),n.a6.vec3.scale(nt,nt,Ke);let Se=[Math.floor(nt[0]),Math.floor(nt[1]),Math.floor(nt[2])],Ge=[0,0,0];n.a6.vec3.sub(Ge,nt,Se),n.a6.vec3.scale(Ge,Ge,-1/Ke);let Le=new Float64Array(16);return n.a6.mat4.identity(Le),n.a6.mat4.translate(Le,Le,Ge),n.a6.mat4.multiply(Be,Le,Be),[Be,_e]}class Uo extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,o){return n.aG(this.requestManager.transformRequest(o,n.R.Model).url).then(d=>{if(!d)return;let g=n.aH(d),y=new n.aI(t,void 0,void 0,g);return y.computeBoundsAndApplyParent(),y}).catch(d=>{if(d&&d.status===404)return null;this.fire(new n.t(new Error(`Could not load model ${t} from ${o}: ${d.message}`)))})}load(t,o){this.models[o]||(this.models[o]={});let d=Object.keys(t);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+d.length;let g=[];for(let y of d)g.push(this.loadModel(y,t[y]));Promise.allSettled(g).then(y=>{for(let x=0;x<y.length;x++){let{status:C,value:A}=y[x];C==="fulfilled"&&A&&(this.models[o][d[x]]={model:A,numReferences:1})}this.numModelsLoading[o]-=d.length,this.fire(new n.x("data",{dataType:"style"}))}).catch(y=>{this.fire(new n.t(new Error(`Could not load models: ${y.message}`)))})}isLoaded(){for(let t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o){return!!this.getModel(t,o)}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}addModel(t,o,d){this.models[d]||(this.models[d]={}),this.hasModel(t,d)&&this.models[d][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(o)},d)}addModels(t,o){this.models[o]||(this.models[o]={});let d={};for(let g in t)this.models[o][g]={},d[g]=this.requestManager.normalizeModelURL(t[g]);this.load(d,o)}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={});let d={};for(let g of t)this.hasModel(g,o)?this.models[o][g].numReferences++:d[g]=this.requestManager.normalizeModelURL(g);this.load(d,o)}removeModel(t,o){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0)){let d=this.models[o][t].model;delete this.models[o][t],d.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(let d in this.models[o])this.models[o][d].model&&this.models[o][d].model.upload(t.context)}}let yd=new n.a0({data:new n.a1(n._.colorTheme.data)}),Ti=(h,t)=>Ie(h,t&&t.filter(o=>o.identifier!=="source.canvas")),Eu=n.ar(mn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Ua=n.ar(mn,["setCenter","setZoom","setBearing","setPitch"]),cm={version:8,layers:[],sources:{}},um={duration:300,delay:0};class Ii extends n.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=n.l({},um),this._buildingIndex=new cd(this),this.crossTileSymbolIndex=new gu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._mergedLayerSelectors=new Map,this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Bl,this.dispatcher=o.dispatcher?o.dispatcher:new n.ce(n.cf(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new js,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new n.cg(t._requestManager,o.localFontFamily?n.ch.all:o.localIdeographFontFamily?n.ch.ideographs:n.ch.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new Uo(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",n.ci());let d=this;this._rtlTextPluginCallback=Ii.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(y,x)=>{if(n.cj(y),x&&x.every(C=>C))for(let C in d._sourceCaches){let A=d._sourceCaches[C],O=A.getSource().type;O!=="vector"&&O!=="geojson"||A.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;let y=this.getOwnSource(g.sourceId);if(y&&y.vectorLayerIds)for(let x in this._layers){let C=this._layers[x];C.source===y.id&&this._validateLayer(C)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.f(t))return t;let o=n.ck(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${n.cl(JSON.stringify(t))}`}_diffStyle(t,o,d){this.globalId=this._getGlobalId(t);let g=(y,x)=>{try{x(null,this.setState(y,d))}catch(C){x(C,!1)}};if(typeof t=="string"){let y=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(y,n.R.Style);n.n(x,(C,A)=>{C?this.fire(new n.t(C)):A&&g(A,o)})}else typeof t=="object"&&g(t,o)}loadURL(t,o={}){this.fire(new n.x("dataloading",{dataType:"style"}));let d=typeof o.validate=="boolean"?o.validate:!n.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);let g=this.importsCache.get(t);if(g)return this._load(g,d);let y=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.n(y,(x,C)=>{if(this._request=null,x)this.fire(new n.t(x));else if(C)return this.importsCache.set(t,C),this._load(C,d)})}loadJSON(t,o={}){this.fire(new n.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.q.frame(()=>{this._request=null,this._load(t,o.validate!==!1)})}loadEmpty(){this.fire(new n.x("dataloading",{dataType:"style"})),this._load(cm,!1)}_loadImports(t,o,d){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let g=[];for(let y of t){let x=this._createFragmentStyle(y),C=new Promise(R=>{x.once("style.import.load",R),x.once("error",R)}).then(()=>this.mergeAll());if(g.push(C),this.resolvedImports.has(y.url)){x.loadEmpty();continue}let A=y.data||this.importsCache.get(y.url);A?(x.loadJSON(A,{validate:o}),this._isInternalStyle(A)&&(x.globalId=null)):y.url?x.loadURL(y.url,{validate:o}):x.loadEmpty();let O={style:x,id:y.id,config:y.config};if(d){let R=this.fragments.findIndex(({id:F})=>F===d);this.fragments=this.fragments.slice(0,R).concat(O).concat(this.fragments.slice(R))}else this.fragments.push(O)}return Promise.allSettled(g)}getImportGlobalIds(t=this,o=new Set){for(let d of t.fragments)d.style.globalId&&o.add(d.style.globalId),this.getImportGlobalIds(d.style,o);return[...o.values()]}_createFragmentStyle(t){let o=this.scope?n.av(t.id,this.scope):t.id,d,g=this._initialConfig&&this._initialConfig[o];(t.config||g)&&(d=n.l({},t.config,g));let y=new Ii(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){let d=t.schema;if(this._isInternalStyle(t)){let x=n.l({},cm,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(x,o)}if(this.updateConfig(this._config,d),o&&Ti(this,bi(t)))return;this._loaded=!0,this.stylesheet=n.cm(t);let g=()=>{for(let O in t.sources)this.addSource(O,t.sources[O],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);let x=ud(this.stylesheet.layers);if(this._order=x.map(O=>O.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let O=this.stylesheet.lights[0];this.light=new Ce(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ce(this.stylesheet.light)),this._layers={};for(let O of x){let R=n.cq(O,this.scope,this._styleColorTheme.lut,this.options);R.configDependencies.size!==0&&this._configDependentLayers.add(R.fqid),R.setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=R;let F=this.getOwnLayerSourceCache(R),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&R.canCastShadows()&&z&&(F.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.x("data",{dataType:"style"}));let A=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then(()=>{this._reloadImports(),this.fire(new n.x(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.x(A?"style.load":"style.import.load")))},y=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=y,y){let x=this._evaluateColorThemeData(y);this._loadColorTheme(x).then(()=>{g()}).catch(C=>{n.w(`Couldn't load color theme from the stylesheet: ${C}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,o,d,g,y,x,C,A,O={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(R=>{if(R.stylesheet){if(R.light!=null&&(t=R.light),R.stylesheet.lights)for(let F of R.stylesheet.lights)F.type==="ambient"&&R.ambientLight!=null&&(o=R.ambientLight),F.type==="directional"&&R.directionalLight!=null&&(d=R.directionalLight);g=this._prioritizeTerrain(g,R.terrain,R.stylesheet.terrain),R.stylesheet.fog&&R.fog!=null&&(y=R.fog),R.stylesheet.camera!=null&&(A=R.stylesheet.camera),R.stylesheet.projection!=null&&(x=R.stylesheet.projection),R.stylesheet.transition!=null&&(C=R.stylesheet.transition),O[R.scope]=R._styleColorTheme}}),this.light=t,this.ambientLight=o,this.directionalLight=d,this.fog=y,this._styleColorThemeForScope=O,g===null?delete this.terrain:this.terrain=g,this.camera=A||{"camera-projection":"perspective"},this.projection=x||{name:"mercator"},this.transition=n.l({},um,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){let o=d=>{for(let g of d.fragments)o(g.style);t(d)};o(this)}_prioritizeTerrain(t,o,d){let g=t&&t.drapeRenderMode===0;return d===null?o&&o.drapeRenderMode===0?o:g?t:null:o!=null&&(!t||g||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){let t={},o={},d={};this.forEachFragmentStyle(g=>{for(let y in g._sourceCaches){let x=n.av(y,g.scope);t[x]=g._sourceCaches[y]}for(let y in g._otherSourceCaches){let x=n.av(y,g.scope);o[x]=g._otherSourceCaches[y]}for(let y in g._symbolSourceCaches){let x=n.av(y,g.scope);d[x]=g._symbolSourceCaches[y]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=d}mergeLayers(){let t={},o=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._mergedLayerSelectors.clear(),this.forEachFragmentStyle(y=>{for(let C of y._order){let A=y._layers[C];if(A.type==="slot"){let O=n.cn(C);if(t[O])continue;t[O]=[]}A.slot&&t[A.slot]?t[A.slot].push(A):o.push(A)}let{featuresets:x}=y.stylesheet||{};if(x)for(let C in x){let{selectors:A}=x[C];for(let O of A){let R=y._layers[O.layer],F=this._mergedLayerSelectors.get(R.fqid)||[],z;if(O.properties)for(let j in O.properties){let W=n.M(O.properties[j]);W.result==="success"&&(z=z||{},z[j]=W.value)}F.push({featuresetId:C,featureNamespace:O.featureNamespace,properties:z}),this._mergedLayerSelectors.set(R.fqid,F)}}}),this._mergedOrder=[];let g=(y=[])=>{for(let x of y)if(x.type==="slot"){let C=n.cn(x.id);t[C]&&g(t[C]),this._mergedSlots.push(C)}else{let C=n.av(x.id,x.scope);this._mergedOrder.push(C),d[C]=x,x.is3D()&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0),x.type==="clip"&&(this._clipLayerPresent=!0)}};g(o),this._mergedOrder.sort((y,x)=>{let C=d[y],A=d[x];return C.hasInitialOcclusionOpacityProperties?A.is3D()?1:0:C.is3D()&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=n.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(o,d,g){let y=n.l({},d);for(let C of Object.keys(n._.colorTheme))y[C]===void 0&&(y[C]=n._.colorTheme[C].default);let x=new n.$(yd,o,new Map(g));return x.setTransitionOrValue(y,g),x.untransitioned().possiblyEvaluate(new n.a3(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,g)=>{let y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let x=t;x.startsWith(y)||(x=y+x);let C="mapbox-reserved-lut",A=new Image;A.src=x,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void d();this._styleColorTheme.lutLoading=!1;let{width:O,height:R,data:F}=n.q.getImageData(A);if(R>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(O!==R*R)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new n.r({width:O,height:R},F),pixelRatio:1,sdf:!1,version:0});let z=this.imageManager.getImage(C,this.scope);z?(this._styleColorTheme.lut={image:z.data,data:t},d()):g(new Error("Missing LUT image."))}})}getLut(t){let o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(o,d,g){let y,x,C,A=n.q.devicePixelRatio>1?"@2x":"",O=n.n(d.transformRequest(d.normalizeSpriteURL(o,A,".json"),n.R.SpriteJSON),(z,j)=>{O=null,C||(C=z,y=j,F())}),R=n.o(d.transformRequest(d.normalizeSpriteURL(o,A,".png"),n.R.SpriteImage),(z,j)=>{R=null,C||(C=z,x=j,F())});function F(){if(C)g(C);else if(y&&x){let z=n.q.getImageData(x),j={};for(let W in y){let{width:q,height:X,x:Z,y:Q,sdf:re,pixelRatio:ie,stretchX:ae,stretchY:ue,content:le}=y[W],he=new n.r({width:q,height:X});n.r.copy(z,he,{x:Z,y:Q},{x:0,y:0},{width:q,height:X},null),j[W]={data:he,pixelRatio:ie,sdf:re,stretchX:ae,stretchY:ue,content:le}}g(null,j)}}return{cancel(){O&&(O.cancel(),O=null),R&&(R.cancel(),R=null)}}}(t,this.map._requestManager,(o,d)=>{if(this._spriteRequest=null,o)this.fire(new n.t(o));else if(d)for(let g in d)this.imageManager.addImage(g,this.scope,d[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.x("data",{dataType:"style"}))})}_validateLayer(t){let o=this.getOwnSource(t.source);if(!o)return;let d=t.sourceLayer;d&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(d)===-1)&&this.fire(new n.t(new Error(`Source layer "${d}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,o)=>{let d=this.fragments[o];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){let t={};for(let o in this._sourceCaches){let d=this._sourceCaches[o].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){let o=[];for(let d of t){let g=this._layers[d];g&&g.type!=="custom"&&o.push(g.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(let t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){let o=this.getOwnLayer(t);if(o)return o;this.fire(new n.t(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){let o=this.getOwnSource(t);if(o)return o;this.fire(new n.t(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){let d=this.map.painter;if(d)for(let g=t.minzoom||0;g<(t.maxzoom||25.5);g++){let y=t.getProgramIds();if(y)for(let x of y){let C=t.getDefaultProgramParams(x,o.zoom,this._styleColorTheme.lut);C&&(d.style=this,this.fog&&(d._fogVisible=!0,C.overrideFog=!0,d.getOrCreateProgram(x,C)),d._fogVisible=!1,C.overrideFog=!1,d.getOrCreateProgram(x,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,d.getOrCreateProgram(x,C)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);let o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));let d=this._changes.isDirty(),g=!1;if(this._changes.isDirty()){let x=this._changes.getLayerUpdatesByScope();for(let C in x){let{updatedIds:A,removedIds:O}=x[C];(A||O)&&(this._updateWorkerLayers(C,A,O),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}let y={};for(let x in this._mergedSourceCaches){let C=this._mergedSourceCaches[x];y[x]=C.used,C.used=!1,C.tileCoverLift=0}for(let x of this._mergedOrder){let C=this._mergedLayers[x];if(C.recalculate(t,this._availableImages),!C.isHidden(t.zoom)){let A=this.getLayerSourceCache(C);A&&(A.used=!0,A.tileCoverLift=Math.max(A.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,t)}):this.precompilePrograms(C,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();for(let x in y){let C=this._mergedSourceCaches[x];y[x]!==C.used&&C.getSource().fire(new n.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new n.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){let t=this._changes.getUpdatedImages();if(t.length){for(let o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,o,d){let g=this.getFragmentStyle(t);g&&this.dispatcher.broadcast("updateLayers",{layers:o?g._serializeLayers(o):[],scope:t,removedIds:d||[],options:g.options})}setState(t,o){if(this._checkLoaded(),Ti(this,bi(t)))return!1;(t=n.cm(t)).layers=ud(t.layers);let d=function(x,C){if(!x)return[{command:mn.setStyle,args:[C]}];let A=[];try{if(!n.bi(x.version,C.version))return[{command:mn.setStyle,args:[C]}];if(n.bi(x.center,C.center)||A.push({command:mn.setCenter,args:[C.center]}),n.bi(x.zoom,C.zoom)||A.push({command:mn.setZoom,args:[C.zoom]}),n.bi(x.bearing,C.bearing)||A.push({command:mn.setBearing,args:[C.bearing]}),n.bi(x.pitch,C.pitch)||A.push({command:mn.setPitch,args:[C.pitch]}),n.bi(x.sprite,C.sprite)||A.push({command:mn.setSprite,args:[C.sprite]}),n.bi(x.glyphs,C.glyphs)||A.push({command:mn.setGlyphs,args:[C.glyphs]}),n.bi(x.imports,C.imports)||function(j=[],W=[],q){W=W||[];let X=(j=j||[]).map(qs),Z=W.map(qs),Q=j.reduce(Aa,{}),re=W.reduce(Aa,{}),ie=X.slice(),ae,ue,le,he;for(ae=0,ue=0;ae<X.length;ae++)le=X[ae],re.hasOwnProperty(le)?ue++:(q.push({command:mn.removeImport,args:[le]}),ie.splice(ie.indexOf(le,ue),1));for(ae=0,ue=0;ae<Z.length;ae++)le=Z[Z.length-1-ae],ie[ie.length-1-ae]!==le&&(Q.hasOwnProperty(le)?(q.push({command:mn.removeImport,args:[le]}),ie.splice(ie.lastIndexOf(le,ie.length-ue),1)):ue++,he=ie[ie.length-ae],q.push({command:mn.addImport,args:[re[le],he]}),ie.splice(ie.length-ae,0,le));for(let me of W){let xe=Q[me.id];xe&&!n.bi(xe,me)&&q.push({command:mn.updateImport,args:[me.id,me]})}}(x.imports,C.imports,A),n.bi(x.transition,C.transition)||A.push({command:mn.setTransition,args:[C.transition]}),n.bi(x.light,C.light)||A.push({command:mn.setLight,args:[C.light]}),n.bi(x.fog,C.fog)||A.push({command:mn.setFog,args:[C.fog]}),n.bi(x.projection,C.projection)||A.push({command:mn.setProjection,args:[C.projection]}),n.bi(x.lights,C.lights)||A.push({command:mn.setLights,args:[C.lights]}),n.bi(x.camera,C.camera)||A.push({command:mn.setCamera,args:[C.camera]}),!n.bi(x["color-theme"],C["color-theme"]))return[{command:mn.setStyle,args:[C]}];let O={},R=[];(function(j,W,q,X){let Z;for(Z in W=W||{},j=j||{})j.hasOwnProperty(Z)&&(W.hasOwnProperty(Z)||Rn(Z,q,X));for(Z in W){if(!W.hasOwnProperty(Z))continue;let Q=W[Z];j.hasOwnProperty(Z)?n.bi(j[Z],Q)||(j[Z].type==="geojson"&&Q.type==="geojson"&&Mt(j,W,Z)?q.push({command:mn.setGeoJSONSourceData,args:[Z,Q.data]}):nv(Z,W,q,X)):hd(Z,W,q)}})(x.sources,C.sources,R,O);let F=[];x.layers&&x.layers.forEach(j=>{j.source&&O[j.source]?A.push({command:mn.removeLayer,args:[j.id]}):F.push(j)});let z=x.terrain;z&&O[z.source]&&(A.push({command:mn.setTerrain,args:[void 0]}),z=void 0),A=A.concat(R),n.bi(z,C.terrain)||A.push({command:mn.setTerrain,args:[C.terrain]}),function(j,W,q){W=W||[];let X=(j=j||[]).map(qs),Z=W.map(qs),Q=j.reduce(Aa,{}),re=W.reduce(Aa,{}),ie=X.slice(),ae=Object.create(null),ue,le,he,me,xe,_e,ge;for(ue=0,le=0;ue<X.length;ue++)he=X[ue],re.hasOwnProperty(he)?le++:(q.push({command:mn.removeLayer,args:[he]}),ie.splice(ie.indexOf(he,le),1));for(ue=0,le=0;ue<Z.length;ue++)he=Z[Z.length-1-ue],ie[ie.length-1-ue]!==he&&(Q.hasOwnProperty(he)?(q.push({command:mn.removeLayer,args:[he]}),ie.splice(ie.lastIndexOf(he,ie.length-le),1)):le++,_e=ie[ie.length-ue],q.push({command:mn.addLayer,args:[re[he],_e]}),ie.splice(ie.length-ue,0,he),ae[he]=!0);for(ue=0;ue<Z.length;ue++)if(he=Z[ue],me=Q[he],xe=re[he],!ae[he]&&!n.bi(me,xe))if(n.bi(me.source,xe.source)&&n.bi(me["source-layer"],xe["source-layer"])&&n.bi(me.type,xe.type)){for(ge in Zl(me.layout,xe.layout,q,he,null,mn.setLayoutProperty),Zl(me.paint,xe.paint,q,he,null,mn.setPaintProperty),n.bi(me.slot,xe.slot)||q.push({command:mn.setSlot,args:[he,xe.slot]}),n.bi(me.filter,xe.filter)||q.push({command:mn.setFilter,args:[he,xe.filter]}),n.bi(me.minzoom,xe.minzoom)&&n.bi(me.maxzoom,xe.maxzoom)||q.push({command:mn.setLayerZoomRange,args:[he,xe.minzoom,xe.maxzoom]}),me)me.hasOwnProperty(ge)&&ge!=="layout"&&ge!=="paint"&&ge!=="filter"&&ge!=="metadata"&&ge!=="minzoom"&&ge!=="maxzoom"&&ge!=="slot"&&(ge.indexOf("paint.")===0?Zl(me[ge],xe[ge],q,he,ge.slice(6),mn.setPaintProperty):n.bi(me[ge],xe[ge])||q.push({command:mn.setLayerProperty,args:[he,ge,xe[ge]]}));for(ge in xe)xe.hasOwnProperty(ge)&&!me.hasOwnProperty(ge)&&ge!=="layout"&&ge!=="paint"&&ge!=="filter"&&ge!=="metadata"&&ge!=="minzoom"&&ge!=="maxzoom"&&ge!=="slot"&&(ge.indexOf("paint.")===0?Zl(me[ge],xe[ge],q,he,ge.slice(6),mn.setPaintProperty):n.bi(me[ge],xe[ge])||q.push({command:mn.setLayerProperty,args:[he,ge,xe[ge]]}))}else q.push({command:mn.removeLayer,args:[he]}),_e=ie[ie.lastIndexOf(he)+1],q.push({command:mn.addLayer,args:[xe,_e]})}(F,C.layers,A)}catch(O){console.warn("Unable to compute style diff:",O),A=[{command:mn.setStyle,args:[C]}]}return A}(this.serialize(),t).filter(x=>!(x.command in Ua));if(d.length===0)return!1;let g=d.filter(x=>!(x.command in Eu));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);let y=[];return d.forEach(x=>{y.push(this[x.command].apply(this,x.args))}),o&&Promise.all(y).then(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,o){return this.getImage(t)?this.fire(new n.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,o),this._afterImageUpdated(t),this)}updateImage(t,o){this.imageManager.updateImage(t,this.scope,o)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new n.t(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new n.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,o,d={}){return this._checkLoaded(),this._validate(be,`models.${t}`,o,null,d)||(this.modelManager.addModel(t,o,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new n.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,o,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Hs,`sources.${t}`,o,null,d))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);let g=lu(t,o,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));let y=x=>{let C=(x?"symbol:":"other:")+g.id,A=n.av(C,this.scope),O=this._sourceCaches[C]=new hi(A,g,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=O,O.onAdd(this.map)};y(!1),o.type!=="vector"&&o.type!=="geojson"||y(!0),g.onAdd&&g.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();let o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(let g in this._layers)if(this._layers[g].source===t)return this.fire(new n.t(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.t(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));let d=this.getOwnSourceCaches(t);for(let g of d){let y=n.cn(g.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(g.id),g.fire(new n.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){let o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){let t=[];for(let o in this._otherSourceCaches){let d=this.getOwnSourceCache(o);d&&t.push(d.getSource())}return t}areTilesLoaded(){let t=this._mergedSourceCaches;for(let o in t){let d=t[o]._tiles;for(let g in d){let y=d[g];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;let o=this._getTransitionParameters();for(let g of t){if(this._validate(Gl,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){let y=this.ambientLight;y.set(g),y.updateTransitions(o)}else this.ambientLight=new Ot(g,Cn||(Cn=new n.a0({color:new n.a1(n._.properties_light_ambient.color),intensity:new n.a1(n._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let y=this.directionalLight;y.set(g),y.updateTransitions(o)}else this.directionalLight=new Ot(g,pn||(pn=new n.a0({direction:new n.ad(n._.properties_light_directional.direction),color:new n.a1(n._.properties_light_directional.color),intensity:new n.a1(n._.properties_light_directional.intensity),"cast-shadows":new n.a1(n._.properties_light_directional["cast-shadows"]),"shadow-intensity":new n.a1(n._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let d=new n.a3(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;let d=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),g=t.properties.get("color").toRenderColor(null).toArray01(),y=t.properties.get("intensity"),x=t.properties.get("direction"),C=1-n.c8(x.x,x.y,x.z)[2]/90,A=d(g)*y*C,O=o.properties.get("color").toRenderColor(null).toArray01(),R=o.properties.get("intensity"),F=d(O)*R;return Number(((A+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(n.aK(t)){let o=n.co(t),d=this.fragments.find(({id:y})=>y===o);if(!d)throw new Error(`Style import '${t}' not found`);let g=n.cn(t);return d.style.getFragmentStyle(g)}{let o=this.fragments.find(({id:d})=>d===t);if(!o)throw new Error(`Style import '${t}' not found`);return o.style}}getFeaturesetDescriptors(t){let o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];let d=[];for(let g in o.stylesheet.featuresets)d.push({featuresetId:g,importId:o.scope?o.scope:void 0});return d}getFeaturesetLayers(t,o){let d=this.getFragmentStyle(o),g=d.stylesheet.featuresets;if(!g||!g[t])return this.fire(new n.t(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];let y=[];for(let x of g[t].selectors){let C=d.getOwnLayer(x.layer);C&&y.push(C)}return y}getConfigProperty(t,o){let d=this.getFragmentStyle(t);if(!d)return null;let g=n.av(o,d.scope),y=d.options.get(g),x=y?y.value||y.default:null;return x?x.serialize():null}setConfigProperty(t,o,d){let g=this.getFragmentStyle(t);if(!g)return;let y=g.stylesheet.schema;if(!y||!y[o])return;let x=n.M(d);if(x.result!=="success")return void Ti(this,x.value);let C=x.value.expression,A=n.av(o,g.scope),O=g.options.get(A);if(!O)return;let R,{minValue:F,maxValue:z,stepValue:j,type:W,values:q}=y[o],X=n.M(y[o].default);X.result==="success"&&(R=X.value.expression),R?(this.options.set(A,Sr(kt({},O),{value:C,default:R,minValue:F,maxValue:z,stepValue:j,type:W,values:q})),this.updateConfigDependencies(o)):this.fire(new n.t(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){let o=this.getFragmentStyle(t);if(!o)return null;let d=o.stylesheet.schema;if(!d)return null;let g={};for(let y in d){let x=n.av(y,o.scope),C=o.options.get(x),A=C?C.value||C.default:null;g[y]=A?A.serialize():null}return g}setConfig(t,o){let d=this.getFragmentStyle(t);d&&(d.updateConfig(o,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){let o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){let d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=o,d.updateConfig(d._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(let d in o){let g,y,x=n.M(o[d].default);if(x.result==="success"&&(g=x.value.expression),t&&t[d]!==void 0){let z=n.M(t[d]);z.result==="success"&&(y=z.value.expression)}let{minValue:C,maxValue:A,stepValue:O,type:R,values:F}=o[d];if(g){let z=n.av(d,this.scope);this.options.set(z,{default:g,value:y,minValue:C,maxValue:A,stepValue:O,type:R,values:F})}else this.fire(new n.t(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new n.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(let o of this._configDependentLayers){let d=this.getLayer(o);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(o=>{if(o._styleColorTheme.colorTheme){let d=o._evaluateColorThemeData(o._styleColorTheme.colorTheme);(!o._styleColorTheme.lut&&d!==""||o._styleColorTheme.lut&&d!==o._styleColorTheme.lut.data)&&o.setColorTheme(o._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(t,o,d={}){this._checkLoaded();let g=t.id;if(this._layers[g])return void this.fire(new n.t(new Error(`Layer with id "${g}" already exists on this map`)));let y;if(t.type==="custom"){if(Ti(this,n.cp(t)))return;y=n.cq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(g,t.source),t=n.cm(t),t=n.l(t,{source:g})),this._validate(Ne,`layers.${g}`,t,{arrayIndex:-1},d))return;y=n.cq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let x=this._order.length;if(o){let R=this._order.indexOf(o);if(R===-1)return void this.fire(new n.t(new Error(`Layer with id "${o}" does not exist on this map.`)));y.slot===this._layers[o].slot?x=R:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,g),this._layerOrderChanged=!0,this._layers[g]=y;let C=this.getOwnLayerSourceCache(y),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&y.canCastShadows()&&A&&(C.castsShadows=!0);let O=this._changes.getRemovedLayer(y);if(O&&y.source&&C&&y.type!=="custom"){this._changes.discardLayerRemoval(y);let R=n.av(y.source,y.scope);O.type!==y.type?this._changes.updateSourceCache(R,"clear"):(this._changes.updateSourceCache(R,"reload"),C.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();let d=this._checkLayer(t);if(!d||t===o)return;let g=this._order.indexOf(t);this._order.splice(g,1);let y=this._order.length;if(o){let x=this._order.indexOf(o);if(x===-1)return void this.fire(new n.t(new Error(`Layer with id "${o}" does not exist on this map.`)));d.slot===this._layers[o].slot?y=x:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();let o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);let d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);let g=this.getOwnLayerSourceCache(o);if(g&&g.castsShadows){let y=!1;for(let x in this._layers)if(this._layers[x].source===o.source&&this._layers[x].canCastShadows()){y=!0;break}g.castsShadows=y}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(let o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,d){this._checkLoaded();let g=this._checkLayer(t);g&&(g.minzoom===o&&g.maxzoom===d||(o!=null&&(g.minzoom=o),d!=null&&(g.maxzoom=d),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();let d=this._checkLayer(t);d&&d.slot!==o&&(d.slot=o,this._updateLayer(d))}setFilter(t,o,d={}){this._checkLoaded();let g=this._checkLayer(t);if(g&&!n.bi(g.filter,o))return o==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Y,`layers.${g.id}.filter`,o,{layerType:g.type},d)||(g.filter=n.cm(o),this._updateLayer(g)))}getFilter(t){let o=this._checkLayer(t);if(o)return n.cm(o.filter)}setLayoutProperty(t,o,d,g={}){this._checkLoaded();let y=this._checkLayer(t);if(y&&!n.bi(y.getLayoutProperty(o),d)){if(d!=null&&(!g||g.validate!==!1)&&Ti(y,ce.call(bi,{key:`layers.${t}.layout.${o}`,layerType:y.type,objectKey:o,value:d,styleSpec:n._,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(o,d),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(t,o){let d=this._checkLayer(t);if(d)return d.getLayoutProperty(o)}setPaintProperty(t,o,d,g={}){this._checkLoaded();let y=this._checkLayer(t);if(!y||n.bi(y.getPaintProperty(o),d)||d!=null&&(!g||g.validate!==!1)&&Ti(y,K.call(bi,{key:`layers.${t}.paint.${o}`,layerType:y.type,objectKey:o,value:d,styleSpec:n._})))return;let x=y.setPaintProperty(o,d);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),x&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,o){let d=this._checkLayer(t);if(d)return d.getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();let d=t.featureset;if(d){if("featuresetId"in d){let O=this.getFragmentStyle(d.importId),R=O.getFeaturesetLayers(d.featuresetId);for(let{source:F,sourceLayer:z}of R)O.setFeatureState({id:t.id,source:F,sourceLayer:z},o)}else if("layerId"in d){let O=this.getLayer(d.layerId);this.setFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},o)}return}let g=t.source,y=t.sourceLayer,x=this._checkSource(g);if(!x)return;let C=x.type;if(C==="geojson"&&y)return void this.fire(new n.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(C==="vector"&&!y)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided.")));let A=this.getOwnSourceCaches(g);for(let O of A)O.setFeatureState(y,t.id,o)}removeFeatureState(t,o){this._checkLoaded();let d=t.featureset;if(d){if("featuresetId"in d){let O=this.getFragmentStyle(d.importId),R=O.getFeaturesetLayers(d.featuresetId);for(let{source:F,sourceLayer:z}of R)O.removeFeatureState({id:t.id,source:F,sourceLayer:z},o)}else if("layerId"in d){let O=this.getLayer(d.layerId);this.removeFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},o)}return}let g=t.source,y=this._checkSource(g);if(!y)return;let x=y.type,C=x==="vector"?t.sourceLayer:void 0;if(x==="vector"&&!C)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.t(new Error("A feature id is required to remove its specific state property.")));let A=this.getOwnSourceCaches(g);for(let O of A)O.removeFeatureState(C,t.id,o)}getFeatureState(t){this._checkLoaded();let o=t.featureset;if(o){let x;if("featuresetId"in o){let C=this.getFragmentStyle(o.importId),A=C.getFeaturesetLayers(o.featuresetId);for(let{source:O,sourceLayer:R}of A){let F=C.getFeatureState({id:t.id,source:O,sourceLayer:R});if(F&&!x)x=F;else if(!n.bi(x,F))return void this.fire(new n.t(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t){let C=this.getLayer(o.layerId);x=this.getFeatureState({id:t.id,source:C.source,sourceLayer:C.sourceLayer})}return x}let d=t.source,g=t.sourceLayer,y=this._checkSource(d);if(y){if(y.type!=="vector"||g)return t.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(g,t.id);this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=n.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return n.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();let t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(let o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);let o=this.getLayerSourceCache(t),d=n.av(t.source,t.scope),g=this._changes.getUpdatedSourceCaches();t.source&&!g[d]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){let o=C=>this._mergedLayers[C].is3D(),d=this.order,g={},y=[];for(let C=d.length-1;C>=0;C--){let A=d[C];if(o(A)){g[A]=C;for(let O of t){let R=O[A];if(R)for(let F of R)y.push(F)}}}y.sort((C,A)=>A.intersectionZ-C.intersectionZ);let x=[];for(let C=d.length-1;C>=0;C--){let A=d[C];if(o(A))for(let O=y.length-1;O>=0;O--){let R=y[O].feature;if(R.layer&&g[R.layer.id]<C)break;x.push(R),y.pop()}else for(let O of t){let R=O[A];if(R)for(let F of R)x.push(F.feature)}}return x}queryRenderedFeatures(t,o,d){o&&!Array.isArray(o)&&o.filter&&this._validate(Y,"queryRenderedFeatures.filter",o.filter,null,o);let g,y=!1,x=new Set;if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.t(new Error("parameters.layers must be an Array."))),[];g=[];for(let R of o.layers){let F=this._mergedLayers[R];if(!F)return this.fire(new n.t(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];F.is3D()&&(y=!0),x.add(F.source),g.push(R)}}else y=this.has3DLayers();let C=this._queryRenderedFeatures(t,d,{layerIds:g,filter:o.filter,has3DLayers:y,includedSources:x}),A=this._flattenAndSortRenderedFeatures(C),O=[];for(let R of A)n.co(R.layer.id)===this.scope&&O.push(R);return O}queryRenderedFeaturesForInteractions(t,o,d){let g=[];for(let{featureset:A,filter:O,radius:R}of o){let F=!1,z=[],j=new Set;if("featuresetId"in A){let q=this.getFeaturesetLayers(A.featuresetId,A.importId);if(q.length===0)continue;for(let X of q)X.is3D()&&(F=!0),j.add(X.source),z.push(X.fqid)}else if("layerId"in A){let q=this._mergedLayers[A.layerId];if(!q)return this.fire(new n.t(new Error(`The layer '${A.layerId}' does not exist in the map's style and cannot be queried for features.`))),[];q.is3D()&&(F=!0),j.add(q.source),z.push(A.layerId)}let W=t;if(R)if(t instanceof n.P||typeof t[0]=="number"){let q=n.P.convert(t);W=[[q.x-R,q.y-R],[q.x+R,q.y+R]]}else{let q=n.P.convert(t[0]),X=n.P.convert(t[1]);W=[[q.x-R,q.y-R],[X.x+R,X.y+R]]}g=g.concat(this._queryRenderedFeatures(W,d,{layerIds:z,filter:O,has3DLayers:F,includedSources:j}))}let y=this._flattenAndSortRenderedFeatures(g),x=(A,O,R)=>{let F=A.clone();if(delete F.layer,F.featureset=O,R&&R.featureNamespace&&(F.namespace=R.featureNamespace),R&&R.properties){let z={},j=this.map.transform.zoom;for(let W of Object.keys(R.properties)){let q=R.properties[W].evaluate({zoom:j},A._vectorTileFeature,A.state,A.tile,this._availableImages);q!=null&&(z[W]=q)}F.properties=z}return F},C=[];for(let A of y){let O=A.layer.id,R=n.cn(O),F=n.co(O);for(let{featureset:z}of o){if("layerId"in z&&z.layerId!==O)continue;if("layerId"in z&&z.layerId===O){let W=x(A,z);C.push(W);continue}if("featuresetId"in z&&(z.importId!==F||!this.getFeaturesetLayers(z.featuresetId,z.importId).map(W=>W.id).includes(R)))continue;let j=this._mergedLayerSelectors.get(O)||[];for(let W of j){let q=x(A,z,W);C.push(q)}}}return C}_queryRenderedFeatures(t,o,d){let{layerIds:g,filter:y,has3DLayers:x,includedSources:C}=d,A=[],O=Xt.createFromScreenPoints(t,o);for(let R in this._mergedSourceCaches){if(!this._mergedSourceCaches[R].getSource())continue;let F=this._mergedSourceCaches[R].getSource().id;g&&!C.has(F)||A.push(od(this._mergedSourceCaches[R],this._mergedLayers,O,y,g||[],this._availableImages,o,x,!!this.map._showQueryGeometry))}return this.placement&&A.push(function(R,F,z,j,W,q,X,Z){let Q={},re=X.queryRenderedSymbols(z),ie=[];for(let ae of Object.keys(re).map(Number))ie.push(Z[ae]);ie.sort(Sa);for(let ae of ie){let ue=ae.featureIndex.lookupSymbolFeatures(re[ae.bucketInstanceId],ae.bucketIndex,ae.sourceLayerIndex,j,W,q,R);for(let le in ue){let he=Q[le]=Q[le]||[],me=ue[le];me.sort((xe,_e)=>{let ge=ae.featureSortOrder;if(ge){let Oe=ge.indexOf(xe.featureIndex);return ge.indexOf(_e.featureIndex)-Oe}return _e.featureIndex-xe.featureIndex});for(let xe of me)he.push(xe)}}for(let ae in Q)Q[ae].forEach(ue=>{let le=ue.feature,he=R[ae],me=F(he);if(!me)return;let xe=me.getFeatureState(le.layer["source-layer"],le.id);le.state=xe,n.aK(he.id)||(le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]))});return Q}(this._mergedLayers,this.getLayerSourceCache.bind(this),O.screenGeometry,y,g||[],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData)),A}querySourceFeatures(t,o){let d=o&&o.filter;d&&this._validate(Y,"querySourceFeatures.filter",d,null,o);let g=[],y=this.getOwnSourceCaches(t);for(let x of y)g=g.concat(sd(x,o));return g}addSourceType(t,o,d){return Ii.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(Ii.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,d={}){this._checkLoaded();let g=this.light.getLight(),y=!1;for(let C in t)if(!n.bi(t[C],g[C])){y=!0;break}if(!y)return;let x=this._getTransitionParameters();this.light.setLight(t,o,d),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t,g=t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){let C="terrain-dem-src";this.addSource(C,d.source),d=n.cm(d),d=n.l(d,{source:C})}let y=n.l({},d),x={};if(this.terrain&&g){y.source=this.terrain.get().source;let C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(x.style=C.serialize())}if(this._validate(Ia,"terrain",y,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&o!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,o),this.fire(new n.x("data",{dataType:"style"}))}else{let y=this.terrain,x=y.get();for(let C of Object.keys(n._.terrain))!d.hasOwnProperty(C)&&n._.terrain[C].default&&(d[C]=n._.terrain[C].default);for(let C in t)if(!n.bi(t[C],x[C])){y.set(t,this.options),this.stylesheet.terrain=t;let A=this._getTransitionParameters({duration:0});y.updateTransitions(A),this.fire(new n.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){let o=this.fog=new Vt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();let d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let o=this.fog;if(!n.bi(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();let d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}setColorTheme(t){this._checkLoaded();let o=()=>{for(let g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(let g in this._sourceCaches)this._sourceCaches[g].clearTiles()};if(this._styleColorTheme.colorTheme=t,!t)return this._styleColorTheme.lut=null,void o();let d=this._evaluateColorThemeData(t);this._loadColorTheme(d).then(()=>{this.fire(new n.x("colorthemeset")),o()}).catch(g=>{n.w(`Couldn't set color theme: ${g}`)})}_getTransitionParameters(t){return{now:n.q.now(),transition:n.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;let t=[],o=[];for(let d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):o.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){let d=this.terrain=new Fe(t,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_force3DLayerUpdate(){for(let t in this._layers){let o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(let t in this._layers){let o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,d,g,y={}){if(y&&y.validate===!1)return!1;let x=n.l({},this.serialize());return Ti(this,t.call(bi,n.l({key:o,style:x,value:d,styleSpec:n._},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(let t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){let o=this.getSourceCaches(t);for(let d of o)d.clearTiles()}clearSources(){for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){let o=this.getSourceCaches(t);for(let d of o)d.resume(),d.reload()}reloadSources(){for(let t of this.getSources())t.reload&&t.reload()}updateSources(t){let o;this.directionalLight&&(o=xu(this.directionalLight));for(let d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(t,void 0,void 0,o)}_generateCollisionBoxes(){for(let t in this._sourceCaches){let o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,d,g,y,x,C=!1){let A=!1,O=!1,R={},F={};for(let z of this._mergedOrder){let j=this._mergedLayers[z];if(j.type!=="symbol")continue;let W=n.av(j.source,j.scope),q=R[W];if(!q){let Z=this.getLayerSourceCache(j);if(!Z)continue;let Q=Z.getRenderableIds(!0).map(re=>Z.getTileByID(re));F[W]=Q.slice(),q=R[W]=Q.sort((re,ie)=>ie.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(ie.tileID)?-1:1))}let X=this.crossTileSymbolIndex.addLayer(j,q,o.center.lng,o.projection);A=A||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new n.x("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),o.zoom))&&(this.pauseablePlacement=new Xl(o,this._mergedOrder,C,d,g,y,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,R,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),O=!0),A&&this.pauseablePlacement.placement.setStale()),O||A){this._buildingIndex.onNewFrame(o.zoom);for(let z=0;z<this._mergedOrder.length;z++){let j=this._mergedLayers[this._mergedOrder[z]];if(j.type!=="symbol")continue;let W=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,R[n.av(j.source,j.scope)],z,W?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(let t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();let d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:y})=>y===t.id)!==-1)return void this.fire(new n.t(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return d.push(t),this._loadImports([t],!0);let g=d.findIndex(({id:y})=>y===o);return g===-1&&this.fire(new n.t(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,g).concat(t).concat(d.slice(g)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();let d=this.stylesheet.imports||[],g=this.getImportIndex(t);return g===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==d[g].url&&this.setImportUrl(t,o.url),n.bi(o.config,d[g].config)||this.setImportConfig(t,o.config),n.bi(o.data,d[g].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let d=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;let y=this.getImportIndex(o);if(y===-1)return this;let x=d[g],C=this.fragments[g];return d=d.filter(({id:A})=>A!==t),this.fragments=this.fragments.filter(({id:A})=>A!==t),this.stylesheet.imports=d.slice(0,y).concat(x).concat(d.slice(y)),this.fragments=this.fragments.slice(0,y).concat(C).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();let d=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;d[g].url=o;let y=this.fragments[g];return y.style=this._createFragmentStyle(d[g]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();let d=this.getImportIndex(t),g=this.stylesheet.imports||[];return d===-1?this:o?(this.fragments[d].style.setState(o),this._reloadImports(),this):(delete g[d].data,this.setImportUrl(t,g[d].url))}setImportConfig(t,o){this._checkLoaded();let d=this.getImportIndex(t),g=this.stylesheet.imports||[];if(d===-1)return this;o?g[d].config=o:delete g[d].config;let y=this.fragments[d],x=y.style.stylesheet&&y.style.stylesheet.schema;return y.config=o,y.style.updateConfig(o,x),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();let o=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(o.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){let o=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return o===-1&&this.fire(new n.t(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){let t=[];for(let o in this._mergedOtherSourceCaches){let d=this._mergedOtherSourceCaches[o];d&&t.push(d.getSource())}return t}getSource(t,o){let d=this.getSourceCache(t,o);return d&&d.getSource()}getLayerSource(t){let o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){let d=n.av(t,o);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){let o=n.av(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);let o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){let t=this._changes.getUpdatedSourceCaches();for(let o in t){let d=t[o];d==="reload"?this.reloadSource(o):d==="clear"&&this.clearSource(o)}}updateLayers(t){let o=this._changes.getUpdatedPaintProperties();for(let d of o){let g=this.getLayer(d);g&&g.updateTransitions(t)}}getImages(t,o,d){this.imageManager.getImages(o.icons,o.scope,d),this._updateTilesForChangedImages();let g=y=>{y&&y.setDependencies(o.tileID.key,o.type,o.icons)};g(this._otherSourceCaches[o.source]),g(this._symbolSourceCaches[o.source])}getGlyphs(t,o,d){this.glyphManager.getGlyphs(o.stacks,o.scope,d)}getResource(t,o,d){return n.ct(o,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){let o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){let o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new n.t(new Error(`There is no source with ID '${t}'`))),!1):o.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;let d=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(d||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ii.getSourceType=function(h){return au[h]},Ii.setSourceType=function(h,t){au[h]=t},Ii.registerForPluginStateChange=n.cd;var hm=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,vd=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,xd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Tu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",dm=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,fm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,pm=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,mm=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,bd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,gm=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Jl=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Iu=[];bs(hm,Iu),bs(xd,Iu),bs(vd,Iu);let Kl={"_prelude_fog.vertex.glsl":fm,"_prelude_terrain.vertex.glsl":dm,"_prelude_shadow.vertex.glsl":gm,"_prelude_fog.fragment.glsl":pm,"_prelude_shadow.fragment.glsl":Jl,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":mm,"_prelude_raster_particle.glsl":bd},$a={};sn("",dm),sn(pm,fm),sn(Jl,gm),sn(mm,""),sn(bd,"");let Ql=sn(vd,xd),Su=hm;var xs={background:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:sn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:sn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:sn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:sn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:sn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:sn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:sn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:sn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:sn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:sn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:sn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:sn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:sn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:sn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:sn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:sn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Tu),skyboxGradient:sn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Tu),skyboxCapture:sn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:sn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:sn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:sn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:sn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:sn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),occlusion:sn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function bs(h,t){let o=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of o)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let g=d.split(" ");for(let y of g)t.includes(y)||t.push(y)}}function sn(h,t){let o=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,g=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(O=>{let R=O.split(" ");return R[R.length-1]}),g=[...new Set(g)]);let y={},x=[],C=[];if(h=h.replace(o,(O,R)=>(C.push(R),"")),(t=t.replace(o,(O,R)=>(x.push(R),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...Iu];bs(h,A),bs(t,A);for(let O of[...x,...C])Kl[O]||console.error(`Undefined include: ${O}`),$a[O]||($a[O]=[],bs(Kl[O],$a[O])),A=[...A,...$a[O]];return{fragmentSource:h=h.replace(d,(O,R,F,z,j)=>(y[j]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${F} ${z} ${j};
#else
uniform ${F} ${z} u_${j};
#endif
`:R==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${F} ${z} ${j} = u_${j};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${z} ${j};
#endif
`:R==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(d,(O,R,F,z,j)=>{let W=z==="float"?"vec2":z,q=j.match(/color/)?"color":W;return R==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${F} ${z} a_${j};
#endif
`:y[j]?R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${W} a_${j};
out ${F} ${z} ${j};
#else
uniform ${F} ${z} u_${j};
#endif
`:R==="initialize"?q==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${F} ${z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${q}(a_${j}, u_${j}_t);
#else
    ${F} ${z} ${j} = u_${j};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${z} a_${j};
    out ${F} ${z} ${j};
#endif
`:R==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${W} a_${j};
#else
uniform ${F} ${z} u_${j};
#endif
`:R==="define-instanced"?q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${F} ${z} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${W} a_${j};
#else
uniform ${F} ${z} u_${j};
#endif
`:R==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${F} ${z} ${j} = a_${j};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${z} ${j} = a_${j};
#else
    ${F} ${z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${z} ${j} = unpack_mix_${q}(a_${j}, u_${j}_t);
#else
    ${F} ${z} ${j} = u_${j};
#endif
`}),staticAttributes:g,usedDefines:A,vertexIncludes:x,fragmentIncludes:C}}class Ga{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,d,g,y,x,C,A){this.context=t;let O=this.boundPaintVertexBuffers.length!==g.length;for(let F=0;!O&&F<g.length;F++)this.boundPaintVertexBuffers[F]!==g[F]&&(O=!0);let R=this.boundDynamicVertexBuffers.length!==C.length;for(let F=0;!R&&F<C.length;F++)this.boundDynamicVertexBuffers[F]!==C[F]&&(R=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==d||O||R||this.boundIndexBuffer!==y||this.boundVertexOffset!==x)this.freshBind(o,d,g,y,x,C,A);else{t.bindVertexArrayOES.set(this.vao);for(let F of C)F&&(F.bind(),A&&F.instanceCount&&F.setVertexAttribDivisor(t.gl,o,A));y&&y.dynamicDraw&&y.bind()}}freshBind(t,o,d,g,y,x,C){let A=t.numAttributes,O=this.context,R=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=x,o.enableAttributes(R,t),o.bind(),o.setVertexAttribPointers(R,t,y);for(let F of d)F.enableAttributes(R,t),F.bind(),F.setVertexAttribPointers(R,t,y);for(let F of x)F&&(F.enableAttributes(R,t),F.bind(),F.setVertexAttribPointers(R,t,y),C&&F.instanceCount&&F.setVertexAttribDivisor(R,t,C));g&&g.bind(),O.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ec(h,t){let o=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new n.a5(0,d/o).toLngLat().lat,new n.a5(0,(d+1)/o).toLngLat().lat]}function Du(h,t,o,d,g,y,x){let C=h.context,A=C.gl,O=o.hillshadeFBO;if(!O)return;h.prepareDrawTile();let R=h.isTileAffectedByFog(t),F=h.getOrCreateProgram("hillshade",{overrideFog:R});C.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,O.colorAttachment.get());let z=((X,Z,Q,re)=>{let ie=Q.paint.get("hillshade-shadow-color"),ae=Q.paint.get("hillshade-highlight-color"),ue=Q.paint.get("hillshade-accent-color"),le=Q.paint.get("hillshade-emissive-strength"),he=n.bC(Q.paint.get("hillshade-illumination-direction"));if(Q.paint.get("hillshade-illumination-anchor")==="viewport")he-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){let xe=X.style.directionalLight.properties.get("direction"),_e=n.c8(xe.x,xe.y,xe.z);he=n.bC(_e[1])}let me=!X.options.moving;return{u_matrix:re||X.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),me),u_image:0,u_latrange:ec(0,Z.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),he],u_shadow:ie.toRenderColor(Q.lut),u_highlight:ae.toRenderColor(Q.lut),u_emissive_strength:le,u_accent:ue.toRenderColor(Q.lut)}})(h,o,d,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(C,F,t.toUnwrapped());let{tileBoundsBuffer:j,tileBoundsIndexBuffer:W,tileBoundsSegments:q}=h.getTileBoundsBuffers(o);F.draw(h,A.TRIANGLES,g,y,x,Lt.disabled,z,d.id,j,W,q)}function tc(h,t,o){if(!t.needsDEMTextureUpload)return;let d=h.context,g=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(o.stride);let y=o.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new n.T(d,y,g.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Ha(h,t,o){let d=h.context,g=d.gl;if(!t.dem)return;let y=t.dem;if(d.activeTexture.set(g.TEXTURE1),tc(h,t,y),!t.demTexture)return;t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);let x=y.dim;d.activeTexture.set(g.TEXTURE0);let C=t.hillshadeFBO;if(!C){let z=new n.T(d,{width:x,height:x,data:null},g.RGBA8);z.bind(g.LINEAR,g.CLAMP_TO_EDGE),C=t.hillshadeFBO=d.createFramebuffer(x,x,!0,"renderbuffer"),C.colorAttachment.set(z.texture)}d.bindFramebuffer.set(C.framebuffer),d.viewport.set([0,0,x,x]);let{tileBoundsBuffer:A,tileBoundsIndexBuffer:O,tileBoundsSegments:R}=h.getMercatorTileBoundsBuffers(),F=[];h.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(h,g.TRIANGLES,It.disabled,jt.disabled,Qt.unblended,Lt.disabled,((z,j)=>{let W=j.stride,q=n.a6.mat4.create();return n.a6.mat4.ortho(q,0,n.ab,-n.ab,0,0,1),n.a6.mat4.translate(q,q,[0,-n.ab,0]),{u_matrix:q,u_image:1,u_dimension:[W,W],u_zoom:z.overscaledZ}})(t.tileID,y),o.id,A,O,R),t.needsHillshadePrepare=!1}class Vn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wd extends Vn{getDefault(){return n.bA.transparent}set(t){let o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _m extends Vn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ed extends Vn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Cu extends Vn{getDefault(){return[!0,!0,!0,!0]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class nc extends Vn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ym extends Vn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class vm extends Vn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class xm extends Vn{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class qa extends Vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class bm extends Vn{getDefault(){return[0,1]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class av extends Vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class lv extends Vn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class cv extends Vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class Td extends Vn{getDefault(){let t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Id extends Vn{getDefault(){return n.bA.transparent}set(t){let o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Sd extends Vn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Dd extends Vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class wm extends Vn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Em extends Vn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let uv=class extends Vn{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class rc extends Vn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ic extends Vn{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Tm extends Vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Si extends Vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Cd extends Vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Mu extends Vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Au extends Vn{getDefault(){return null}set(t){let o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Md extends Vn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Ad extends Vn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ru extends Vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Rd extends Vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class oc extends Vn{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Pu extends oc{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Pd extends oc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Im extends oc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Wa extends Pd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let hv=(h,t,o)=>({u_matrix:h,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:o}),Sm=(h,t,o,d,g,y,x,C,A,O,R,F,z,j,W,q)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:o,u_zoom_transition:g,u_merc_center:y,u_image0:0,u_frustum_tl:x,u_frustum_tr:C,u_frustum_br:A,u_frustum_bl:O,u_globe_pos:R,u_globe_radius:F,u_viewport:z,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:W});function Dm(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}let Za=new class{constructor(){this.operations={}}newMorphing(h,t,o,d,g){if(h in this.operations){let y=this.operations[h];y.to.tileID.key!==o.tileID.key&&(y.queued=o)}else this.operations[h]={startTime:d,phase:0,duration:g,from:t,to:o,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;let t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(let t in this.operations){let o=this.operations[t];for(o.phase=(h-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Cm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Mm(h,t,o){if(t===0)return 0;let d=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*d}function Od(h,t){let o=1<<h.z;return!t&&(h.x===0||h.x===o-1)||h.y===0||h.y===o-1}let sc=h=>({u_matrix:h});function Ou(h,t,o,d,g){if(g>0){let y=n.q.now(),x=(y-h.timeAdded)/g,C=t?(y-t.timeAdded)/g:-1,A=o.getSource(),O=d.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),R=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(h.tileID.overscaledZ-O),F=R&&h.refreshedUponExpiration?1:n.ap(R?x:1-C,0,1);return h.refreshedUponExpiration&&x>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Xa extends hi{constructor(t){let o={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new n.ce(n.cf(),null),g=lu("mock-dem",o,d,t.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class Am extends hi{constructor(t){let o=lu("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new n.ce(n.cf(),null),t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,d){if(t.freezeTileCoverage)return;this.transform=t;let g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,x)=>{if(y[x.key]="",!this._tiles[x.key]){let C=new go(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);C.state="loaded",this._tiles[x.key]=C}return y},{});for(let y in this._tiles)y in g||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){let o=this.proxyCachedFBO[t];if(o!==void 0){let d=Object.values(o);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ld extends n.aA{constructor(t,o,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=d}}class kd extends n.cE{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[d,g,y]=function(A){let O=new n.a$,R=new n.aP,F=131;O.reserve(17161),R.reserve(33800);let z=n.ab/128,j=n.ab+z/2,W=j+z;for(let X=-z;X<W;X+=z)for(let Z=-z;Z<W;Z+=z){let Q=Z<0||Z>j||X<0||X>j?24575:0,re=n.ap(Math.round(Z),0,n.ab),ie=n.ap(Math.round(X),0,n.ab);O.emplaceBack(re+Q,ie)}let q=(X,Z)=>{let Q=Z*F+X;R.emplaceBack(Q+1,Q,Q+F),R.emplaceBack(Q+F,Q+F+1,Q+1)};for(let X=1;X<129;X++)for(let Z=1;Z<129;Z++)q(Z,X);return[0,129].forEach(X=>{for(let Z=0;Z<130;Z++)q(Z,X),q(X,Z)}),[O,R,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(d,n.b1.members),this.gridIndexBuffer=x.createIndexBuffer(g),this.gridSegments=n.b2.simpleSegment(0,0,d.length,g.length),this.gridNoSkirtSegments=n.b2.simpleSegment(0,0,d.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Am(o.map),this.orthoMatrix=n.a6.mat4.create(),n.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.ab,0,n.ab,0,1);let C=x.gl;this._overlapStencilMode=new jt({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Xa(o.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,o,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);let g=t.terrain.properties,y=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();let C=t.terrain&&t.terrain.scope,A=g.get("source"),O=y?this._mockSourceCache:t.getSourceCache(A,C);if(!O)return void n.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=O,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(o):g.get("exaggeration"),!o.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;let R=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let F=this.getScaledDemTileSize();this.sourceCache.update(o,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,R(),this._initializing=!0),R(),o.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);let o=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;let g=o!=null?d-o:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;let y=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(y);let C=y-this._previousZoom,A=this._previousUpdateTimestamp,O=y;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(y-O)>.5&&(C=.5*(y-O+C)),C*g<0&&(O+=C)),this._evaluationZoom=O;let R=x.getExaggeration(O),F=R===x.getExaggeration(Math.max(0,O-.1));if(F&&Math.abs(R-this._exaggeration)<.01)return R;let z=Math.min(.1,.00375*(this._updateTimestamp-A));return(F||R<.1||Math.abs(C)<1e-4)&&(z=Math.min(.2,4*z)),n.aa(this._exaggeration,R,z)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let o=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(n.a5.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let g=this.proxyCoords=o.getIds().map(A=>{let O=o.getTileByID(A).tileID;return O.projMatrix=d.calculateProjMatrix(O.toUnwrapped()),O});(function(A,O){let R=O.transform.pointCoordinate(O.transform.getCameraPoint()),F=new n.P(R.x,R.y);A.sort((z,j)=>{if(j.overscaledZ-z.overscaledZ)return j.overscaledZ-z.overscaledZ;let W=new n.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),q=new n.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),X=F.mult(1<<z.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(W)-X.distSqr(q)})})(g,this.painter);let y=this.proxyToSource||{};this.proxyToSource={},g.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};let x=this._style._mergedSourceCaches;for(let A in x){let O=x[A];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,t[A],y),O.usedForTerrain))continue;let R=t[A];O.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[o.id]=g.map(A=>new Ld(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;let C={};this._visibleDemTiles=[];for(let A of this.proxyCoords){let O=this.terrainTileForTile[A.key];if(!O)continue;let R=O.tileID.key;R in C||(this._visibleDemTiles.push(O),C[R]=R)}}_assignTerrainTiles(t){this._initializing||t.forEach(o=>{if(this.terrainTileForTile[o.key])return;let d=this._findTileCoveringTileID(o,this.sourceCache);d&&(this.terrainTileForTile[o.key]=d)})}_prepareDEMTextures(){let t=this.painter.context,o=t.gl;for(let d in this.terrainTileForTile){let g=this.terrainTileForTile[d],y=g.dem;!y||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),tc(this.painter,g,y))}}_prepareDemTileUniforms(t,o,d,g){if(!o||o.demTexture==null)return!1;let y=t.tileID.canonical,x=Math.pow(2,o.tileID.canonical.z-y.z),C=g||"";return d[`u_dem_tl${C}`]=[y.x*x%1,y.y*x%1],d[`u_dem_scale${C}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0,o=this._visibleDemTiles.reduce((d,g)=>{if(!g.dem)return d;let y=g.dem.tree.minimums[0];return y>0&&t++,d+y},0);return t?o/t:0}_updateEmptyDEMTexture(){let t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);let d=this._getLoadedAreaMinimum(),g=new n.cF({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(g,{premultiply:!1}):y=this._emptyDEMTexture=new n.T(t,g,o.R32F,{premultiply:!1}),y}setupElevationDraw(t,o,d){let g=this.painter.context,y=g.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let C=null,A=null,O=1;if(d&&d.morphing&&this._useVertexMorphing){let j=d.morphing.srcDemTile,W=d.morphing.dstDemTile;O=d.morphing.phase,j&&W&&(this._prepareDemTileUniforms(t,j,x,"_prev")&&(A=j),this._prepareDemTileUniforms(t,W,x)&&(C=W))}let R=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST,F=null;var z;if(this.enabled?A&&C?(F=C.demTexture,g.activeTexture.set(y.TEXTURE4),A.demTexture.bind(R(A),y.CLAMP_TO_EDGE),x.u_dem_lerp=O):(C=this.terrainTileForTile[t.tileID.key],F=this._prepareDemTileUniforms(t,C,x)?C.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,g.activeTexture.set(y.TEXTURE2),F&&(x.u_dem_size=(z=F).size[0]===1?1:z.size[0]-2,F.bind(R(C),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,o,x),d&&d.useMeterToDem&&C){let j=(1<<C.tileID.canonical.z)*n.bE(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=j}if(d&&d.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),o.setTerrainUniformValues(g,x),this.painter.transform.projection.name==="globe"){let j=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);o.setGlobeUniformValues(g,j)}}globeUniformValues(t,o,d){let g=t.projection;return{u_tile_tl_up:g.upVector(o,0,0),u_tile_tr_up:g.upVector(o,n.ab,0),u_tile_br_up:g.upVector(o,n.ab,n.ab),u_tile_bl_up:g.upVector(o,0,n.ab),u_tile_up_scale:d?n.cG(1):g.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){let o=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,y,x,C,A){if(g.transform.projection.name==="globe")(function(O,R,F,z,j){let W=O.context,q=W.gl,X,Z,Q=O.transform,re=n.cx(O,W,Q),ie=(Oe,Be)=>{if(Z===Be)return;let qe=[Cm[Be],"PROJECTION_GLOBE_VIEW"];re&&qe.push("CUSTOM_ANTIALIASING");let Ke=O.isTileAffectedByFog(Oe);X=O.getOrCreateProgram("globeRaster",{defines:qe,overrideFog:Ke}),Z=Be},ae=O.colorModeForRenderPass(),ue=new It(q.LEQUAL,It.ReadWrite,O.depthRangeFor3D);Za.update(j);let le=n.cy(Q),he=[n.am(Q.center.lng),n.at(Q.center.lat)],me=O.globeSharedBuffers,xe=[Q.width*n.q.devicePixelRatio,Q.height*n.q.devicePixelRatio],_e=Float32Array.from(Q.globeMatrix),ge={useDenormalizedUpVectorScale:!0};{let Oe=O.transform,Be=Mm(Oe.zoom,R.exaggeration(),R.sourceCache._source.tileSize);Z=-1;let qe=q.TRIANGLES;for(let Ke of z){let nt=F.getTile(Ke),Se=jt.disabled,Ge=R.prevTerrainTileForTile[Ke.key],Le=R.terrainTileForTile[Ke.key];Dm(Ge,Le)&&Za.newMorphing(Ke.key,Ge,Le,j,250),W.activeTexture.set(q.TEXTURE0),nt.texture&&nt.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let He=Za.getMorphValuesForProxy(Ke.key),Ze=He?1:0;He&&n.C(ge,{morphing:{srcDemTile:He.from,dstDemTile:He.to,phase:n.cw(He.phase)}});let $e=n.cz(Ke.canonical),st=n.cA($e.getCenter().lat),yt=n.cB(Ke.canonical,$e,st,Oe.worldSize/Oe._pixelsPerMercatorPixel),bt=n.b6(n.cC(Ke.canonical)),dt=Sm(Oe.expandedFarZProjMatrix,_e,le,bt,n.a9(Oe.zoom),he,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,xe,Be,Oe._farZ,yt);if(ie(Ke,Ze),X&&(R.setupElevationDraw(nt,X,ge),O.uploadCommonUniforms(W,X,Ke.toUnwrapped()),me)){let[Tt,lt,Dt]=me.getGridBuffers(st,Be!==0);X.draw(O,qe,ue,Se,ae,Lt.backCCW,dt,"globe_raster",Tt,lt,Dt)}}}if(me&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){let Oe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Oe.push("CUSTOM_ANTIALIASING"),X=O.getOrCreateProgram("globeRaster",{defines:Oe});for(let Be of z){let{x:qe,y:Ke,z:nt}=Be.canonical,Se=Ke===0,Ge=Ke===(1<<nt)-1,[Le,He,Ze,$e]=me.getPoleBuffers(nt,!1);if($e&&(Se||Ge)){let st=F.getTile(Be);W.activeTexture.set(q.TEXTURE0),st.texture&&st.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let yt=n.cD(nt,qe,Q),bt=n.b6(n.cC(Be.canonical)),dt=(Tt,lt)=>Tt.draw(O,q.TRIANGLES,ue,jt.disabled,ae,Lt.disabled,Sm(Q.expandedFarZProjMatrix,yt,yt,bt,0,he,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,xe,0,Q._farZ),"globe_pole_raster",lt,Ze,$e);R.setupElevationDraw(st,X,ge),O.uploadCommonUniforms(W,X,Be.toUnwrapped()),Se&&O.renderDefaultNorthPole&&dt(X,Le),Ge&&O.renderDefaultSouthPole&&(yt=n.a6.mat4.scale(n.a6.mat4.create(),yt,[1,-1,1]),dt(X,He))}}}})(g,y,x,C,A);else{let O=g.context,R=O.gl,F,z,j=g.shadowRenderer,W=jo(g,g.longestCutoffRange),q=ae=>{if(z===ae)return;let ue=[];ue.push(Cm[ae]),W.shouldRenderCutoff&&ue.push("RENDER_CUTOFF"),j&&(ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&ue.push("NORMAL_OFFSET")),F=g.getOrCreateProgram("terrainRaster",{defines:ue}),z=ae},X=g.colorModeForRenderPass(),Z=new It(R.LEQUAL,It.ReadWrite,g.depthRangeFor3D);Za.update(A);let Q=g.transform,re=Mm(Q.zoom,y.exaggeration(),y.sourceCache._source.tileSize),ie=[0,0,0];if(j){let ae=g.style.directionalLight,ue=g.style.ambientLight;ae&&ue&&(ie=bu(g.style,ae,ue))}{z=-1;let ae=R.TRIANGLES,[ue,le]=[y.gridIndexBuffer,y.gridSegments];for(let he of C){let me=x.getTile(he),xe=jt.disabled,_e=y.prevTerrainTileForTile[he.key],ge=y.terrainTileForTile[he.key];Dm(_e,ge)&&Za.newMorphing(he.key,_e,ge,A,250),O.activeTexture.set(R.TEXTURE0),me.texture&&me.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE);let Oe=Za.getMorphValuesForProxy(he.key),Be=Oe?1:0,qe;Oe&&(qe={morphing:{srcDemTile:Oe.from,dstDemTile:Oe.to,phase:n.cw(Oe.phase)}});let Ke=hv(he.projMatrix,Od(he.canonical,Q.renderWorldCopies)?re/10:re,ie);if(q(Be),!F)continue;y.setupElevationDraw(me,F,qe);let nt=he.toUnwrapped();j&&j.setupShadows(nt,F),g.uploadCommonUniforms(O,F,nt,null,W),F.draw(g,ae,Z,xe,X,Lt.backCCW,Ke,"terrain_raster",y.gridBuffer,ue,le)}}}}(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;let o=this.painter,d=this.painter.context,g=this.proxySourceCache,y=this.proxiedCoords[g.id],x=this._drapedRenderBatches.shift(),C=o.style.order,A=[],O=0;for(let R of y){let F=g.getTileByID(R.proxyTileKey),z=g.proxyCachedFBO[R.key]?g.proxyCachedFBO[R.key][t]:void 0,j=z!==void 0?g.renderCache[z]:this.pool[O++],W=z!==void 0;if(F.texture=j.tex,W&&!j.dirty){A.push(F.tileID);continue}let q;d.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(d.clear({color:n.bA.transparent,stencil:0}),j.dirty=!1);for(let X=x.start;X<=x.end;++X){let Z=o.style._mergedLayers[C[X]];if(Z.isHidden(o.transform.zoom))continue;let Q=o.style.getLayerSourceCache(Z),re=Q?this.proxyToSource[R.key][Q.id]:[R];if(!re)continue;let ie=re;d.viewport.set([0,0,j.fb.width,j.fb.height]),q!==(Q?Q.id:null)&&(this._setupStencil(j,re,Z,Q),q=Q?Q.id:null),o.renderLayer(o,Q,Z,ie)}if(this._drapedRenderBatches.length===0)for(let X of this._pendingGroundEffectLayers){let Z=o.style._mergedLayers[C[X]];if(Z.isHidden(o.transform.zoom))continue;let Q=o.style.getLayerSourceCache(Z),re=Q?this.proxyToSource[R.key][Q.id]:[R];if(!re)continue;let ie=re;d.viewport.set([0,0,j.fb.width,j.fb.height]),q!==(Q?Q.id:null)&&(this._setupStencil(j,re,Z,Q),q=Q?Q.id:null),o.renderLayer(o,Q,Z,ie)}this.renderedToTile?(j.dirty=!0,A.push(F.tileID)):W||--O,O===5&&(O=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,o.width,o.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){let o=t.order.length,d=-1,g=o;for(let y=0;y<o;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?d=Math.max(d,y):g=Math.min(g,y);return g>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{t=Math.min(t,o.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,o,d){if(!this._visibleDemTiles)return null;let g=this._visibleDemTiles.filter(y=>y.dem).map(y=>{let x=y.tileID,C=1<<x.overscaledZ,{x:A,y:O}=x.canonical,R=A/C,F=(A+1)/C,z=O/C,j=(O+1)/C;return{minx:R,miny:z,maxx:F,maxy:j,t:y.dem.tree.raycastRoot(R,z,F,j,t,o,d),tile:y}});g.sort((y,x)=>(y.t!==null?y.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(let y of g){if(y.t==null)return null;let x=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,o,d);if(x!=null)return x}return null}_createFBO(){let t=this.painter.context,o=t.gl,d=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);let g=new n.T(t,{width:d[0],height:d[1],data:null},o.RGBA8);g.bind(o.LINEAR,o.CLAMP_TO_EDGE);let y=t.createFramebuffer(d[0],d[1],!0,null);return y.colorAttachment.set(g.texture),y.depthAttachment=new Wa(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{let o=this._style._mergedLayers[t],d=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!d&&o.shouldRedrape():!d&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(let d of this._style.getSources())if(d instanceof Vr){t=!0;break}if(!t)return;let o={};for(let d=0;d<this._style.order.length;++d){let g=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(g);if(y&&!o[y.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof n.a4){o[y.id]=!0;for(let x of this.proxyCoords){let C=this.proxyToSource[x.key][y.id];if(C)for(let A of C)this._clearRenderCacheForTile(y.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(let d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof gs){t=!0;break}if(!t)return;let o={};for(let d=0;d<this._style.order.length;++d){let g=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(g);if(!y||o[y.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;let x=g.paint.get("raster-fade-duration");for(let C of this.proxyCoords){let A=this.proxyToSource[C.key][y.id];if(A)for(let O of A){let R=Ou(y.getTile(O),y.findLoadedParent(O,0),y,this.painter.transform,x);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(y.id,O)}}}}_setupDrapedRenderBatches(){let t=this._style.order,o=t.length;if(o===0)return;let d=[];this._pendingGroundEffectLayers=[];let g,y=0,x=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++y<o;)x=this._style._mergedLayers[t[y]];for(;y<o;++y){let C=this._style._mergedLayers[t[y]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?g===void 0&&(g=y):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),g!==void 0&&(d.push({start:g,end:y-1}),g=void 0)))}if(g!==void 0&&d.push({start:g,end:y-1}),d.length!==0){let C=d[d.length-1];this._pendingGroundEffectLayers.every(A=>A>C.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){let o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){let x=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let C=0;C<x.length;++C){let A=Object.values(x[C]);o.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();let d=this.proxyCoords,g=this._tilesDirty;for(let x=d.length-1;x>=0;x--){let C=d[x];if(o.getTileByID(C.key),o.proxyCachedFBO[C.key]!==void 0){let A=t[C.key],O=this.proxyToSource[C.key],R=0;for(let F in O){let z=O[F],j=A[F];if(!j||j.length!==z.length||z.some((W,q)=>W!==j[q]||g[F]&&g[F].hasOwnProperty(W.key))){R=-1;break}++R}for(let F in o.proxyCachedFBO[C.key])o.renderCache[o.proxyCachedFBO[C.key][F]].dirty=R<0||R!==Object.values(A).length}}let y=[...this._drapedRenderBatches];y.sort((x,C)=>C.end-C.start-(x.end-x.start));for(let x of y)for(let C of d){if(o.proxyCachedFBO[C.key])continue;let A=o.renderCachePool.pop();A===void 0&&o.renderCache.length<50&&(A=o.renderCache.length,o.renderCache.push(this._createFBO())),A!==void 0&&(o.proxyCachedFBO[C.key]={},o.proxyCachedFBO[C.key][x.start]=A,o.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,d,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let y=this.painter.context,x=y.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let C;if(d.isTileClipped())C=o.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):jt.disabled}_renderTileClippingMasks(t,o){let d=this.painter,g=this.painter.context,y=g.gl;d._tileClippingMaskIDs={},g.setColorMode(Qt.disabled),g.setDepthMode(It.disabled);let x=d.getOrCreateProgram("clippingMask");for(let C of t){let A=d._tileClippingMaskIDs[C.key]=--o;x.draw(d,y.TRIANGLES,It.disabled,new jt({func:y.ALWAYS,mask:0},A,255,y.KEEP,y.KEEP,y.REPLACE),Qt.disabled,Lt.disabled,sc(C.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){let o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;let d=[t.x,t.y,1,1];n.a6.vec4.transformMat4(d,d,o.pixelMatrixInverse),n.a6.vec4.scale(d,d,1/d[3]),d[0]/=o.worldSize,d[1]/=o.worldSize;let g=o._camera.position,y=n.bE(1,o.center.lat),x=[g[0],g[1],g[2]/y,0],C=n.a6.vec3.subtract([],d.slice(0,3),x);n.a6.vec3.normalize(C,C);let A=this.raycast(x,C,this._exaggeration);return A!==null&&A?(n.a6.vec3.scaleAndAdd(x,x,C,A),x[3]=x[2],x[2]*=y,x):null}_setupProxiedCoordsForOrtho(t,o,d){if(t.getSource()instanceof n.aD)return this._setupProxiedCoordsForImageSource(t,o,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};let g=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let A=0;A<y.length;A++){let O=y[A],R=this._findTileCoveringTileID(O,t);if(R){let F=this._createProxiedId(O,R,d[O.key]&&d[O.key][t.id]);g.push(F),this.proxyToSource[O.key][t.id]=[F]}}let x=!1,C=new Set;for(let A=0;A<o.length;A++){let O=t.getTile(o[A]);if(!O||!O.hasData())continue;let R=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==O.tileID.canonical.z){let F=this.proxyToSource[R.tileID.key][t.id],z=this._createProxiedId(R.tileID,O,d[R.tileID.key]&&d[R.tileID.key][t.id]);F?F.splice(F.length-1,0,z):this.proxyToSource[R.tileID.key][t.id]=[z];let j=this.proxyToSource[R.tileID.key][t.id];C.has(j)||C.add(j),g.push(z),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(let A of C)A.sort((O,R)=>R.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(t,o,d){if(!t.getSource().loaded())return;let g=this.proxiedCoords[t.id]=[],y=this.proxyCoords,x=t.getSource(),C=x.tileID;if(!C)return;let A=new n.P(C.x,C.y)._div(1<<C.z),O=x.coordinates.map(n.a5.fromLngLat).reduce((F,z)=>(F.min.x=Math.min(F.min.x,z.x-A.x),F.min.y=Math.min(F.min.y,z.y-A.y),F.max.x=Math.max(F.max.x,z.x-A.x),F.max.y=Math.max(F.max.y,z.y-A.y),F),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(F,z)=>{let j=F.wrap+F.canonical.x/(1<<F.canonical.z),W=F.canonical.y/(1<<F.canonical.z),q=n.ab/(1<<F.canonical.z),X=z.wrap+z.canonical.x/(1<<z.canonical.z),Z=z.canonical.y/(1<<z.canonical.z);return j+q<X+O.min.x||j>X+O.max.x||W+q<Z+O.min.y||W>Z+O.max.y};for(let F=0;F<y.length;F++){let z=y[F];for(let j=0;j<o.length;j++){let W=t.getTile(o[j]);if(!W||!W.hasData()||R(z,W.tileID))continue;let q=this._createProxiedId(z,W,d[z.key]&&d[z.key][t.id]),X=this.proxyToSource[z.key][t.id];X?X.push(q):this.proxyToSource[z.key][t.id]=[q],g.push(q)}}}_createProxiedId(t,o,d){let g=this.orthoMatrix;if(d){let y=d.find(x=>x.key===o.tileID.key);if(y)return y}if(o.tileID.key!==t.key){let y=t.canonical.z-o.tileID.canonical.z,x,C,A;g=n.a6.mat4.create();let O=o.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(x=n.ab>>y,C=x*((o.tileID.canonical.x<<y)-t.canonical.x+O),A=x*((o.tileID.canonical.y<<y)-t.canonical.y)):(x=n.ab<<-y,C=n.ab*(o.tileID.canonical.x-(t.canonical.x+O<<-y)),A=n.ab*(o.tileID.canonical.y-(t.canonical.y<<-y))),n.a6.mat4.ortho(g,0,x,0,x,0,1),n.a6.mat4.translate(g,g,[C,A,0])}return new Ld(o.tileID,t.key,g)}_findTileCoveringTileID(t,o){let d=o.getTile(t);if(d&&d.hasData())return d;let g=this._findCoveringTileCache[o.id],y=g[t.key];if(d=y?o.getTileByID(y):null,d&&d.hasData()||y===null)return d;let x=d?d.tileID:t,C=x.overscaledZ,A=o.getSource().minzoom,O=[];if(!y){let F=o.getSource().maxzoom;if(t.canonical.z>=F){let z=t.canonical.z-F;o.getSource().reparseOverscaled?(C=Math.max(t.canonical.z+2,o.transform.tileZoom),x=new n.aA(C,t.wrap,F,t.canonical.x>>z,t.canonical.y>>z)):z!==0&&(C=F,x=new n.aA(C,t.wrap,F,t.canonical.x>>z,t.canonical.y>>z))}x.key!==t.key&&(O.push(x.key),d=o.getTile(x))}let R=F=>{O.forEach(z=>{g[z]=F}),O.length=0};for(C-=1;C>=A&&(!d||!d.hasData());C--){d&&R(d.tileID.key);let F=x.calculateScaledKey(C);if(d=o.getTileByID(F),d&&d.hasData())break;let z=g[F];if(z===null)break;z===void 0?O.push(F):d=o.getTileByID(z)}return R(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[o.key]=!0}}function Fd(h,t,o){let d=function(C,A,O){let R=n.a6.vec3.dot(A,C),F=n.a6.vec3.dot(O,[.2126,.7152,.0722]),z=(W,q,X)=>(1-X)*W+X*q,j=z(1-.3*Math.min(F,1),1,Math.min(R+1,1));return z(.92,1,Math.asin(n.ap(A[2],-1,1))/Math.PI+.5)*j}(h,[0,0,1],t),g=[0,0,0];n.a6.vec3.scale(g,o.slice(0,3),d);let y=[0,0,0];n.a6.vec3.scale(y,t.slice(0,3),h[2]);let x=[0,0,0];return n.a6.vec3.add(x,g,y),n.cc(x)}let Js=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Rm=["stars","rain_particle","snow_particle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class $o{static cacheKey(t,o,d,g){let y=`${o}${g?g.cacheKey:""}`;for(let x of d)t.usedDefines.includes(x)&&(y+=`/${x}`);return y}constructor(t,o,d,g,y,x){let C=t.gl;this.program=C.createProgram(),this.configuration=g,this.name=o,this.fixedDefines=[...x];let A=g?g.getBinderAttributes():[],O=(d.staticAttributes||[]).concat(A),R=g?g.defines():[];R=R.concat(x.map(X=>`#define ${X}`));let F=`#version 300 es
`,z=F+R.concat("precision mediump float;",Su,Ql.fragmentSource).join(`
`);for(let X of d.fragmentIncludes)z+=`
${Kl[X]}`;z+=`
${d.fragmentSource}`;let j=F+R.concat("precision highp float;",Su,Ql.vertexSource).join(`
`);for(let X of d.vertexIncludes)j+=`
${Kl[X]}`;j+=`
${d.vertexSource}`;let W=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(W,z),C.compileShader(W),C.attachShader(this.program,W);let q=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(q,j),C.compileShader(q),C.attachShader(this.program,q),this.attributes={},this.numAttributes=O.length;for(let X=0;X<this.numAttributes;X++)if(O[X]){let Z=O[X].startsWith("a_")?O[X]:`a_${O[X]}`;C.bindAttribLocation(this.program,X,Z),this.attributes[Z]=X}C.linkProgram(this.program),C.deleteShader(q),C.deleteShader(W),this.fixedUniforms=y(t),this.binderUniforms=g?g.getUniforms(t):[],(x.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(X=>({u_dem:new n.bK(X),u_dem_prev:new n.bK(X),u_dem_tl:new n.bH(X),u_dem_scale:new n.bJ(X),u_dem_tl_prev:new n.bH(X),u_dem_scale_prev:new n.bJ(X),u_dem_size:new n.bJ(X),u_dem_lerp:new n.bJ(X),u_exaggeration:new n.bJ(X),u_depth:new n.bK(X),u_depth_size_inv:new n.bH(X),u_depth_range_unpack:new n.bH(X),u_occluder_half_size:new n.bJ(X),u_occlusion_depth_offset:new n.bJ(X),u_meter_to_dem:new n.bJ(X),u_label_plane_matrix_inv:new n.bG(X)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new n.bI(X),u_tile_tr_up:new n.bI(X),u_tile_br_up:new n.bI(X),u_tile_bl_up:new n.bI(X),u_tile_up_scale:new n.bJ(X)}))(t)),x.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new n.bG(X),u_fog_range:new n.bH(X),u_fog_color:new n.c7(X),u_fog_horizon_blend:new n.bJ(X),u_fog_vertical_limit:new n.bH(X),u_fog_temporal_offset:new n.bJ(X),u_frustum_tl:new n.bI(X),u_frustum_tr:new n.bI(X),u_frustum_br:new n.bI(X),u_frustum_bl:new n.bI(X),u_globe_pos:new n.bI(X),u_globe_radius:new n.bJ(X),u_globe_transition:new n.bJ(X),u_is_globe:new n.bK(X),u_viewport:new n.bH(X)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new n.c7(X)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new n.bI(X),u_lighting_directional_dir:new n.bI(X),u_lighting_directional_color:new n.bI(X),u_ground_radiance:new n.bI(X)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new n.bG(X),u_light_matrix_1:new n.bG(X),u_fade_range:new n.bH(X),u_shadow_normal_offset:new n.bI(X),u_shadow_intensity:new n.bJ(X),u_shadow_texel_size:new n.bJ(X),u_shadow_map_resolution:new n.bJ(X),u_shadow_direction:new n.bI(X),u_shadow_bias:new n.bI(X),u_shadowmap_0:new n.bK(X),u_shadowmap_1:new n.bK(X)}))(t))}}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;let d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)d[g]&&d[g].set(this.program,g,o[g])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;let d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)d[g]&&d[g].set(this.program,g,o[g])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;let d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)d[g].set(this.program,g,o[g])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;let d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)d[g].set(this.program,g,o[g])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;let d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)d[g].set(this.program,g,o[g])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;let d=this.shadowUniforms;t.program.set(this.program);for(let g in o)d[g].set(this.program,g,o[g])}_drawDebugWireframe(t,o,d,g,y,x,C,A,O,R){let F=t.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;let z=t.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||t._terrain&&t._terrain.renderingToTexture||!Js.includes(this.name))||!(!F.layers3D||!Rm.includes(this.name))))return;let j=z.gl,W=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,z);if(!W)return;let q=[...this.fixedDefines];q.push("DEBUG_WIREFRAME");let X=t.getOrCreateProgram(this.name,{config:this.configuration,defines:q});z.program.set(X.program);let Z=(ie,ae,ue)=>{if(ae[ie]&&ue[ie])for(let le in ae[ie])ue[ie][le]&&ue[ie][le].set(ue.program,le,ae[ie][le].current)};O&&O.setUniforms(X.program,z,X.binderUniforms,C,{zoom:A}),Z("fixedUniforms",this,X),Z("terrainUniforms",this,X),Z("globeUniforms",this,X),Z("fogUniforms",this,X),Z("lightsUniforms",this,X),Z("shadowUniforms",this,X),W.bind(),z.setColorMode(new Qt([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],n.bA.transparent,[!0,!0,!0,!1])),z.setDepthMode(new It(o.func===j.LESS?j.LEQUAL:o.func,It.ReadOnly,o.range)),z.setStencilMode(jt.disabled);let Q=3*x.primitiveLength*2,re=3*x.primitiveOffset*2*2;R&&R>1?j.drawElementsInstanced(j.LINES,Q,j.UNSIGNED_SHORT,re,R):j.drawElements(j.LINES,Q,j.UNSIGNED_SHORT,re),y.bind(),z.program.set(this.program),z.setDepthMode(o),z.setStencilMode(d),z.setColorMode(g)}checkUniforms(t,o,d){if(this.fixedDefines.includes(o)){for(let g of Object.keys(d))if(!d[g].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${g} not set but required by ${o} being defined`)}}draw(t,o,d,g,y,x,C,A,O,R,F,z,j,W,q,X){let Z=t.context,Q=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(d),Z.setStencilMode(g),Z.setColorMode(y),Z.setCullFace(x);for(let ae of Object.keys(this.fixedUniforms))this.fixedUniforms[ae].set(this.program,ae,C[ae]);W&&W.setUniforms(this.program,Z,this.binderUniforms,z,{zoom:j});let re={[Q.POINTS]:1,[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[o];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);let ie=X&&X>0?1:void 0;for(let ae of F.get()){let ue=ae.vaos||(ae.vaos={});(ue[A]||(ue[A]=new Ga)).bind(Z,this,O,W?W.getPaintVertexBuffers():[],R,ae.vertexOffset,q||[],ie),X&&X>1?Q.drawElementsInstanced(o,ae.primitiveLength*re,Q.UNSIGNED_SHORT,ae.primitiveOffset*re*2,X):R?Q.drawElements(o,ae.primitiveLength*re,Q.UNSIGNED_SHORT,ae.primitiveOffset*re*2):Q.drawArrays(o,ae.vertexOffset,ae.vertexLength),o===Q.TRIANGLES&&R&&this._drawDebugWireframe(t,d,g,y,R,ae,z,j,W,X)}}}function Lu(h,t){let o=Math.pow(2,t.tileID.overscaledZ),d=t.tileSize*Math.pow(2,h.transform.tileZoom)/o,g=d*(t.tileID.canonical.x+t.tileID.wrap*o),y=d*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ak(t,1,h.transform.tileZoom),u_pixel_coord_upper:[g>>16,y>>16],u_pixel_coord_lower:[65535&g,65535&y]}}let Ks={terrain:0,flat:1},Pm=n.a6.mat4.create(),Nd=(h,t,o,d,g,y,x,C,A,O,R,F,z,j,W,q,X,Z)=>{let Q=t.style.light,re=Q.properties.get("position"),ie=[re.x,re.y,re.z],ae=n.a6.mat3.create();Q.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(ae,-t.transform.angle),n.a6.vec3.transformMat3(ie,ie,ae));let ue=Q.properties.get("color"),le=t.transform,he={u_matrix:h,u_lightpos:ie,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[ue.r,ue.g,ue.b],u_vertical_gradient:+o,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Pm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ks[O],u_base_type:Ks[R],u_ao:g,u_edge_radius:y,u_width_scale:x,u_flood_light_color:W,u_vertical_scale:q,u_flood_light_intensity:X,u_ground_shadow_factor:Z};return le.projection.name==="globe"&&(he.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],he.u_zoom_transition=F,he.u_inv_rot_matrix=j,he.u_merc_center=z,he.u_up_dir=le.projection.upVector(new n.bQ(0,0,0),z[0]*n.ab,z[1]*n.ab),he.u_height_lift=A),he},zd=(h,t,o,d,g,y)=>({u_matrix:h,u_edge_radius:t,u_width_scale:o,u_vertical_scale:d,u_height_type:Ks[g],u_base_type:Ks[y]}),Bd=(h,t,o,d,g,y,x,C,A,O,R,F,z,j,W,q,X)=>{let Z=Nd(h,t,o,d,g,y,x,C,O,R,F,z,j,W,q,X,1,[0,0,0]),Q={u_height_factor:-Math.pow(2,C.overscaledZ)/A.tileSize/8};return n.l(Z,Lu(t,A),Q)},Om=(h,t)=>({u_matrix:h,u_emissive_strength:t}),Vd=(h,t,o,d)=>n.l(Om(h,t),Lu(o,d)),ac=(h,t,o)=>({u_matrix:h,u_world:o,u_emissive_strength:t}),dv=(h,t,o,d,g)=>n.l(Vd(h,t,o,d),{u_world:g}),fv=(h,t,o,d)=>{let g=n.ab/o.tileSize;return{u_matrix:h,u_camera_to_center_distance:t.getCameraToCenterDistance(d),u_extrude_scale:[t.pixelsToGLUnits[0]/g,t.pixelsToGLUnits[1]/g]}},jd=(h,t,o=1)=>({u_matrix:h,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:o}),pv=n.a6.mat4.create(),Ud=(h,t,o,d,g,y,x)=>{let C=h.transform,A=C.projection.name==="globe",O=A?n.cI(C.zoom,t.canonical)*C._pixelsPerMercatorPixel:n.ak(o,1,y),R={u_matrix:t.projMatrix,u_extrude_scale:O,u_intensity:x,u_inv_rot_matrix:pv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){R.u_inv_rot_matrix=d,R.u_merc_center=g,R.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],R.u_zoom_transition=n.a9(C.zoom);let F=g[0]*n.ab,z=g[1]*n.ab;R.u_up_dir=C.projection.upVector(new n.bQ(0,0,0),F,z)}return R};function ku(h,[t,o,d,g],[y,x]){if(y===x)return[0,0,0,0];let C=255*(h-1)/(h*(x-y));return[t*C,o*C,d*C,g*C]}function Ya(h,t,[o,d]){return o===d?0:.5/h+(t-o)*(h-1)/(h*(d-o))}let Fu=(h,t,o,d,g,y,x,C,A,O,R,F,z,j,W,q,X,Z,Q,re,ie)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:d,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:O,u_fade_t:R.mix,u_opacity:R.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:n.cJ(F.paint.get("raster-saturation")),u_contrast_factor:n.cK(F.paint.get("raster-contrast")),u_spin_weights:lc(F.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:j,u_zoom_transition:x,u_merc_center:C,u_cutoff_params:A,u_colorization_mix:ku(n.cL,q,Z),u_colorization_offset:Ya(n.cL,X,Z),u_color_ramp:W,u_texture_offset:[re/(Q+2*re),Q/(Q+2*re)],u_texture_res:[Q+2*re,Q+2*re],u_emissive_strength:ie});function lc(h){h*=Math.PI/180;let t=Math.sin(h),o=Math.cos(h);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}let Qs=.05,Nu=(h,t,o,d,g,y,x,C,A,O,R,F)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:d,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:O,u_fade_t:R.mix,u_opacity:R.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:x,u_merc_center:C,u_cutoff_params:A}),zu=(h,t,o,d,g,y,x,C,A,O)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:d,u_color_ramp:y,u_velocity_res:g,u_max_speed:x,u_uv_offset:C,u_data_scale:[255*A[0],255*A[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qs,Qs]}),$d=(h,t,o,d,g,y,x,C,A,O)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:d,u_max_speed:g,u_speed_factor:y,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*A[0],255*A[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qs,Qs]}),Gd=n.a6.mat4.create(),Lm=(h,t,o,d,g,y,x,C,A,O,R,F,z,j,W,q,X,Z,Q,re,ie,ae)=>{let ue=g.transform,le={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ue.getCameraToCenterDistance(Q),u_rotate_symbol:+o,u_aspect_ratio:ue.width/ue.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:x,u_coord_matrix:C,u_is_text:+O,u_elevation_from_sea:A?1:0,u_pitch_with_map:+d,u_texsize:R,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Gd,u_up_vector:[0,-1,0],u_color_adj_mat:re,u_icon_transition:ie||0,u_gamma_scale:d?g.transform.getCameraToCenterDistance(Q)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:+z,u_scale_factor:ae||1};return Q.name==="globe"&&(le.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],le.u_zoom_transition=W,le.u_inv_rot_matrix=X,le.u_merc_center=q,le.u_camera_forward=ue._camera.forward(),le.u_ecef_origin=n.cM(ue.globeMatrix,j.toUnwrapped()),le.u_tile_matrix=Float32Array.from(ue.globeMatrix),le.u_up_vector=Z),le},ea=(h,t,o,d)=>({u_matrix:h,u_emissive_strength:t,u_opacity:o,u_color:d}),cc=(h,t,o,d,g,y,x,C,A)=>n.l(function(O,R,F,z,j,W){let{width:q,height:X}=z.imageManager.getPixelSize(R),Z=Math.pow(2,W.tileID.overscaledZ),Q=W.tileSize*Math.pow(2,z.transform.tileZoom)/Z,re=Q*(W.tileID.canonical.x+W.tileID.wrap*Z),ie=Q*W.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[q,X],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:j?[z.transform.width,-1*z.transform.height]:[1/n.ak(W,1,z.transform.tileZoom),1/n.ak(W,1,z.transform.tileZoom)],u_pixel_coord_upper:[re>>16,ie>>16],u_pixel_coord_lower:[65535&re,65535&ie]}}(0,y,x,d,C,A),{u_matrix:h,u_emissive_strength:t,u_opacity:o}),ht=new Float32Array(n.a6.mat4.identity([])),Bu=(h,t,o,d,g,y,x,C,A,O,R,F,z,j=[0,0,0],W)=>{let q=g.style.light,X=q.properties.get("position"),Z=[-X.x,-X.y,X.z],Q=n.a6.mat3.create();q.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(Q,-g.transform.angle),n.a6.vec3.transformMat3(Z,Z,Q));let re=R.alphaMode==="MASK",ie=q.properties.get("color").toRenderColor(null),ae=z.paint.get("model-ambient-occlusion-intensity"),ue=z.paint.get("model-color").constantOr(n.bA.white).toRenderColor(null),le=z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:d||ht,u_lightpos:Z,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ie.r,ie.g,ie.b],u_camera_pos:j,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+re,u_alphaCutoff:R.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:A,u_roughnessFactor:O,u_baseColorTexture:$r.BaseColor,u_metallicRoughnessTexture:$r.MetallicRoughness,u_normalTexture:$r.Normal,u_occlusionTexture:$r.Occlusion,u_emissionTexture:$r.Emission,u_lutTexture:$r.LUT,u_color_mix:[ue.r,ue.g,ue.b,le],u_aoIntensity:ae,u_emissive_strength:F,u_occlusionTextureTransform:W||[0,0,0,0]}},Hd=(h,t=ht,o=ht)=>({u_matrix:h,u_instance:t,u_node_matrix:o}),ta={fillExtrusion:h=>({u_matrix:new n.bG(h),u_lightpos:new n.bI(h),u_lightintensity:new n.bJ(h),u_lightcolor:new n.bI(h),u_vertical_gradient:new n.bJ(h),u_opacity:new n.bJ(h),u_edge_radius:new n.bJ(h),u_width_scale:new n.bJ(h),u_ao:new n.bH(h),u_height_type:new n.bK(h),u_base_type:new n.bK(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_up_dir:new n.bI(h),u_height_lift:new n.bJ(h),u_flood_light_color:new n.bI(h),u_vertical_scale:new n.bJ(h),u_flood_light_intensity:new n.bJ(h),u_ground_shadow_factor:new n.bI(h)}),fillExtrusionDepth:h=>({u_matrix:new n.bG(h),u_edge_radius:new n.bJ(h),u_width_scale:new n.bJ(h),u_vertical_scale:new n.bJ(h),u_height_type:new n.bK(h),u_base_type:new n.bK(h)}),fillExtrusionPattern:h=>({u_matrix:new n.bG(h),u_lightpos:new n.bI(h),u_lightintensity:new n.bJ(h),u_lightcolor:new n.bI(h),u_vertical_gradient:new n.bJ(h),u_height_factor:new n.bJ(h),u_edge_radius:new n.bJ(h),u_width_scale:new n.bJ(h),u_ao:new n.bH(h),u_height_type:new n.bK(h),u_base_type:new n.bK(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_up_dir:new n.bI(h),u_height_lift:new n.bJ(h),u_image:new n.bK(h),u_texsize:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_tile_units_to_pixels:new n.bJ(h),u_opacity:new n.bJ(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new n.bG(h),u_opacity:new n.bJ(h),u_ao_pass:new n.bJ(h),u_meter_to_tile:new n.bJ(h),u_ao:new n.bH(h),u_flood_light_intensity:new n.bJ(h),u_flood_light_color:new n.bI(h),u_attenuation:new n.bJ(h),u_edge_radius:new n.bJ(h),u_fb:new n.bK(h),u_fb_size:new n.bJ(h),u_dynamic_offset:new n.bJ(h)}),fill:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h)}),fillPattern:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_image:new n.bK(h),u_texsize:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_tile_units_to_pixels:new n.bJ(h)}),fillOutline:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_world:new n.bH(h)}),fillOutlinePattern:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_world:new n.bH(h),u_image:new n.bK(h),u_texsize:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_tile_units_to_pixels:new n.bJ(h)}),circle:n.cN,collisionBox:h=>({u_matrix:new n.bG(h),u_camera_to_center_distance:new n.bJ(h),u_extrude_scale:new n.bH(h)}),collisionCircle:h=>({u_matrix:new n.bG(h),u_inv_matrix:new n.bG(h),u_camera_to_center_distance:new n.bJ(h),u_viewport_size:new n.bH(h)}),debug:h=>({u_color:new n.cu(h),u_matrix:new n.bG(h),u_overlay:new n.bK(h),u_overlay_scale:new n.bJ(h)}),clippingMask:h=>({u_matrix:new n.bG(h)}),heatmap:h=>({u_extrude_scale:new n.bJ(h),u_intensity:new n.bJ(h),u_matrix:new n.bG(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_up_dir:new n.bI(h)}),heatmapTexture:h=>({u_image:new n.bK(h),u_color_ramp:new n.bK(h),u_opacity:new n.bJ(h)}),hillshade:h=>({u_matrix:new n.bG(h),u_image:new n.bK(h),u_latrange:new n.bH(h),u_light:new n.bH(h),u_shadow:new n.cu(h),u_highlight:new n.cu(h),u_emissive_strength:new n.bJ(h),u_accent:new n.cu(h)}),hillshadePrepare:h=>({u_matrix:new n.bG(h),u_image:new n.bK(h),u_dimension:new n.bH(h),u_zoom:new n.bJ(h)}),line:n.cO,linePattern:n.cP,raster:h=>({u_matrix:new n.bG(h),u_normalize_matrix:new n.bG(h),u_globe_matrix:new n.bG(h),u_merc_matrix:new n.bG(h),u_grid_matrix:new n.cv(h),u_tl_parent:new n.bH(h),u_scale_parent:new n.bJ(h),u_fade_t:new n.bJ(h),u_opacity:new n.bJ(h),u_image0:new n.bK(h),u_image1:new n.bK(h),u_brightness_low:new n.bJ(h),u_brightness_high:new n.bJ(h),u_saturation_factor:new n.bJ(h),u_contrast_factor:new n.bJ(h),u_spin_weights:new n.bI(h),u_perspective_transform:new n.bH(h),u_raster_elevation:new n.bJ(h),u_zoom_transition:new n.bJ(h),u_merc_center:new n.bH(h),u_cutoff_params:new n.c7(h),u_colorization_mix:new n.c7(h),u_colorization_offset:new n.bJ(h),u_color_ramp:new n.bK(h),u_texture_offset:new n.bH(h),u_texture_res:new n.bH(h),u_emissive_strength:new n.bJ(h)}),rasterParticle:h=>({u_matrix:new n.bG(h),u_normalize_matrix:new n.bG(h),u_globe_matrix:new n.bG(h),u_merc_matrix:new n.bG(h),u_grid_matrix:new n.cv(h),u_tl_parent:new n.bH(h),u_scale_parent:new n.bJ(h),u_fade_t:new n.bJ(h),u_opacity:new n.bJ(h),u_image0:new n.bK(h),u_image1:new n.bK(h),u_raster_elevation:new n.bJ(h),u_zoom_transition:new n.bJ(h),u_merc_center:new n.bH(h),u_cutoff_params:new n.c7(h)}),rasterParticleTexture:h=>({u_texture:new n.bK(h),u_opacity:new n.bJ(h)}),rasterParticleDraw:h=>({u_particle_texture:new n.bK(h),u_particle_texture_side_len:new n.bJ(h),u_tile_offset:new n.bH(h),u_velocity:new n.bK(h),u_color_ramp:new n.bK(h),u_velocity_res:new n.bH(h),u_max_speed:new n.bJ(h),u_uv_offset:new n.bH(h),u_data_scale:new n.bH(h),u_data_offset:new n.bJ(h),u_particle_pos_scale:new n.bJ(h),u_particle_pos_offset:new n.bH(h)}),rasterParticleUpdate:h=>({u_particle_texture:new n.bK(h),u_particle_texture_side_len:new n.bJ(h),u_velocity:new n.bK(h),u_velocity_res:new n.bH(h),u_max_speed:new n.bJ(h),u_speed_factor:new n.bJ(h),u_reset_rate:new n.bJ(h),u_rand_seed:new n.bJ(h),u_uv_offset:new n.bH(h),u_data_scale:new n.bH(h),u_data_offset:new n.bJ(h),u_particle_pos_scale:new n.bJ(h),u_particle_pos_offset:new n.bH(h)}),symbol:h=>({u_is_size_zoom_constant:new n.bK(h),u_is_size_feature_constant:new n.bK(h),u_size_t:new n.bJ(h),u_size:new n.bJ(h),u_camera_to_center_distance:new n.bJ(h),u_rotate_symbol:new n.bK(h),u_aspect_ratio:new n.bJ(h),u_fade_change:new n.bJ(h),u_matrix:new n.bG(h),u_label_plane_matrix:new n.bG(h),u_coord_matrix:new n.bG(h),u_is_text:new n.bK(h),u_elevation_from_sea:new n.bK(h),u_pitch_with_map:new n.bK(h),u_texsize:new n.bH(h),u_texsize_icon:new n.bH(h),u_texture:new n.bK(h),u_texture_icon:new n.bK(h),u_gamma_scale:new n.bJ(h),u_device_pixel_ratio:new n.bJ(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_camera_forward:new n.bI(h),u_tile_matrix:new n.bG(h),u_up_vector:new n.bI(h),u_ecef_origin:new n.bI(h),u_is_halo:new n.bK(h),u_icon_transition:new n.bJ(h),u_color_adj_mat:new n.bG(h),u_scale_factor:new n.bJ(h)}),background:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_opacity:new n.bJ(h),u_color:new n.cu(h)}),backgroundPattern:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_opacity:new n.bJ(h),u_image:new n.bK(h),u_pattern_tl:new n.bH(h),u_pattern_br:new n.bH(h),u_texsize:new n.bH(h),u_pattern_size:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_pattern_units_to_pixels:new n.bH(h)}),terrainRaster:h=>({u_matrix:new n.bG(h),u_image0:new n.bK(h),u_skirt_height:new n.bJ(h),u_ground_shadow_factor:new n.bI(h)}),skybox:h=>({u_matrix:new n.bG(h),u_sun_direction:new n.bI(h),u_cubemap:new n.bK(h),u_opacity:new n.bJ(h),u_temporal_offset:new n.bJ(h)}),skyboxGradient:h=>({u_matrix:new n.bG(h),u_color_ramp:new n.bK(h),u_center_direction:new n.bI(h),u_radius:new n.bJ(h),u_opacity:new n.bJ(h),u_temporal_offset:new n.bJ(h)}),skyboxCapture:h=>({u_matrix_3f:new n.cv(h),u_sun_direction:new n.bI(h),u_sun_intensity:new n.bJ(h),u_color_tint_r:new n.c7(h),u_color_tint_m:new n.c7(h),u_luminance:new n.bJ(h)}),globeRaster:h=>({u_proj_matrix:new n.bG(h),u_globe_matrix:new n.bG(h),u_normalize_matrix:new n.bG(h),u_merc_matrix:new n.bG(h),u_zoom_transition:new n.bJ(h),u_merc_center:new n.bH(h),u_image0:new n.bK(h),u_grid_matrix:new n.cv(h),u_skirt_height:new n.bJ(h),u_far_z_cutoff:new n.bJ(h),u_frustum_tl:new n.bI(h),u_frustum_tr:new n.bI(h),u_frustum_br:new n.bI(h),u_frustum_bl:new n.bI(h),u_globe_pos:new n.bI(h),u_globe_radius:new n.bJ(h),u_viewport:new n.bH(h)}),globeAtmosphere:h=>({u_frustum_tl:new n.bI(h),u_frustum_tr:new n.bI(h),u_frustum_br:new n.bI(h),u_frustum_bl:new n.bI(h),u_horizon:new n.bJ(h),u_transition:new n.bJ(h),u_fadeout_range:new n.bJ(h),u_color:new n.c7(h),u_high_color:new n.c7(h),u_space_color:new n.c7(h),u_temporal_offset:new n.bJ(h),u_horizon_angle:new n.bJ(h)}),model:h=>({u_matrix:new n.bG(h),u_lighting_matrix:new n.bG(h),u_normal_matrix:new n.bG(h),u_node_matrix:new n.bG(h),u_lightpos:new n.bI(h),u_lightintensity:new n.bJ(h),u_lightcolor:new n.bI(h),u_camera_pos:new n.bI(h),u_opacity:new n.bJ(h),u_baseColorFactor:new n.c7(h),u_emissiveFactor:new n.c7(h),u_metallicFactor:new n.bJ(h),u_roughnessFactor:new n.bJ(h),u_baseTextureIsAlpha:new n.bK(h),u_alphaMask:new n.bK(h),u_alphaCutoff:new n.bJ(h),u_baseColorTexture:new n.bK(h),u_metallicRoughnessTexture:new n.bK(h),u_normalTexture:new n.bK(h),u_occlusionTexture:new n.bK(h),u_emissionTexture:new n.bK(h),u_lutTexture:new n.bK(h),u_color_mix:new n.c7(h),u_aoIntensity:new n.bJ(h),u_emissive_strength:new n.bJ(h),u_occlusionTextureTransform:new n.c7(h)}),modelDepth:h=>({u_matrix:new n.bG(h),u_instance:new n.bG(h),u_node_matrix:new n.bG(h)}),groundShadow:h=>({u_matrix:new n.bG(h),u_ground_shadow_factor:new n.bI(h)}),stars:h=>({u_matrix:new n.bG(h),u_up:new n.bI(h),u_right:new n.bI(h),u_intensity_multiplier:new n.bJ(h)}),snowParticle:h=>({u_modelview:new n.bG(h),u_projection:new n.bG(h),u_time:new n.bJ(h),u_cam_pos:new n.bI(h),u_velocityConeAperture:new n.bJ(h),u_velocity:new n.bJ(h),u_horizontalOscillationRadius:new n.bJ(h),u_horizontalOscillationRate:new n.bJ(h),u_boxSize:new n.bJ(h),u_billboardSize:new n.bJ(h),u_simpleShapeParameters:new n.bH(h),u_screenSize:new n.bH(h),u_thinningCenterPos:new n.bH(h),u_thinningShape:new n.bI(h),u_thinningAffectedRatio:new n.bJ(h),u_thinningParticleOffset:new n.bJ(h),u_particleColor:new n.c7(h),u_direction:new n.bI(h)}),rainParticle:h=>({u_modelview:new n.bG(h),u_projection:new n.bG(h),u_time:new n.bJ(h),u_cam_pos:new n.bI(h),u_texScreen:new n.bK(h),u_velocityConeAperture:new n.bJ(h),u_velocity:new n.bJ(h),u_boxSize:new n.bJ(h),u_rainDropletSize:new n.bH(h),u_distortionStrength:new n.bJ(h),u_rainDirection:new n.bI(h),u_color:new n.c7(h),u_screenSize:new n.bH(h),u_thinningCenterPos:new n.bH(h),u_thinningShape:new n.bI(h),u_thinningAffectedRatio:new n.bJ(h),u_thinningParticleOffset:new n.bJ(h),u_shapeDirectionalPower:new n.bJ(h),u_mode:new n.bJ(h)}),occlusion:h=>({u_matrix:new n.bG(h),u_anchorPos:new n.bI(h),u_screenSizePx:new n.bH(h),u_occluderSizePx:new n.bH(h),u_color:new n.c7(h)})},ws=(()=>{class h{constructor(o,d,g,y){this.id=h.uniqueIdxCounter,h.uniqueIdxCounter++,this.context=o;let x=o.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||y||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=h.uniqueIdxCounter,h.uniqueIdxCounter++;let d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return h.uniqueIdxCounter=0,h})(),vt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qd{constructor(t,o,d,g,y,x){this.length=o.length,this.attributes=d,this.itemSize=o.bytesPerElement,this.dynamicDraw=g,this.instanceCount=x,this.context=t;let C=t.gl;this.buffer=C.createBuffer(),t.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||y||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){let o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let d=0;d<this.attributes.length;d++){let g=o.attributes[this.attributes[d].name];g!==void 0&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,o,d){for(let g=0;g<this.attributes.length;g++){let y=this.attributes[g],x=o.attributes[y.name];x!==void 0&&t.vertexAttribPointer(x,y.components,t[vt[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,o,d){for(let g=0;g<this.attributes.length;g++){let y=o.attributes[this.attributes[g].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class km{constructor(t,o,d,g,y){this.context=t,this.width=o,this.height=d;let x=this.framebuffer=t.gl.createFramebuffer();g&&(this.colorAttachment=new Pu(t,x)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Pd(t,x):new Im(t,x))}destroy(){let t=this.context.gl;if(this.colorAttachment){let o=this.colorAttachment.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{let o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class mv{constructor(t,o){this.gl=t,this.clearColor=new wd(this),this.clearDepth=new _m(this),this.clearStencil=new Ed(this),this.colorMask=new Cu(this),this.depthMask=new nc(this),this.stencilMask=new ym(this),this.stencilFunc=new vm(this),this.stencilOp=new xm(this),this.stencilTest=new qa(this),this.depthRange=new bm(this),this.depthTest=new av(this),this.depthFunc=new lv(this),this.blend=new cv(this),this.blendFunc=new Td(this),this.blendColor=new Id(this),this.blendEquation=new Sd(this),this.cullFace=new Dd(this),this.cullFaceSide=new wm(this),this.frontFace=new Em(this),this.program=new uv(this),this.activeTexture=new rc(this),this.viewport=new ic(this),this.bindFramebuffer=new Tm(this),this.bindRenderbuffer=new Si(this),this.bindTexture=new Cd(this),this.bindVertexBuffer=new Mu(this),this.bindElementBuffer=new Au(this),this.bindVertexArrayOES=new Md(this),this.pixelStoreUnpack=new Ad(this),this.pixelStoreUnpackPremultiplyAlpha=new Ru(this),this.pixelStoreUnpackFlipY=new Rd(this),this.options=o?kt({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,d){return new ws(this,t,o,d)}createVertexBuffer(t,o,d,g,y){return new qd(this,t,o,d,g,y)}createRenderbuffer(t,o,d){let g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,t,o,d),this.bindRenderbuffer.set(null),y}createFramebuffer(t,o,d,g){return new km(this,t,o,d,g)}clear({color:t,depth:o,stencil:d,colorMask:g}){let y=this.gl,x=0;t&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(g||[!0,!0,!0,!0])),o!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),d!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),y.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.bi(t.blendFunction,Qt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ja;function Wd(h,t,o,d,g,y,x){let C=h.context,A=C.gl,O=h.transform,R=h.getOrCreateProgram("collisionBox"),F=[],z=0,j=0;for(let ie=0;ie<d.length;ie++){let ae=d[ie],ue=t.getTile(ae),le=ue.getBucket(o);if(!le)continue;let he=im(ae,le,O),me=he;g[0]===0&&g[1]===0||(me=h.translatePosMatrix(he,ue,g,y));let xe=x?le.textCollisionBox:le.iconCollisionBox,_e=le.collisionCircleArray;if(_e.length>0){let ge=n.a6.mat4.create(),Oe=me;n.a6.mat4.mul(ge,le.placementInvProjMatrix,O.glCoordMatrix),n.a6.mat4.mul(ge,ge,le.placementViewportMatrix),F.push({circleArray:_e,circleOffset:j,transform:Oe,invTransform:ge,projection:le.getProjection()}),z+=_e.length/4,j=z}xe&&(h.terrain&&h.terrain.setupElevationDraw(ue,R),R.draw(h,A.LINES,It.disabled,jt.disabled,h.colorModeForRenderPass(),Lt.disabled,fv(me,O,ue,le.getProjection()),o.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,O.zoom,null,[xe.collisionVertexBuffer,xe.collisionVertexBufferExt]))}if(!x||!F.length)return;let W=h.getOrCreateProgram("collisionCircle"),q=new n.cQ;q.resize(4*z),q._trim();let X=0;for(let ie of F)for(let ae=0;ae<ie.circleArray.length/4;ae++){let ue=4*ae,le=ie.circleArray[ue+0],he=ie.circleArray[ue+1],me=ie.circleArray[ue+2],xe=ie.circleArray[ue+3];q.emplace(X++,le,he,me,xe,0),q.emplace(X++,le,he,me,xe,1),q.emplace(X++,le,he,me,xe,2),q.emplace(X++,le,he,me,xe,3)}(!Ja||Ja.length<2*z)&&(Ja=function(ie){let ae=2*ie,ue=new n.aP;ue.resize(ae),ue._trim();for(let le=0;le<ae;le++){let he=6*le;ue.uint16[he+0]=4*le+0,ue.uint16[he+1]=4*le+1,ue.uint16[he+2]=4*le+2,ue.uint16[he+3]=4*le+2,ue.uint16[he+4]=4*le+3,ue.uint16[he+5]=4*le+0}return ue}(z));let Z=C.createIndexBuffer(Ja,!0),Q=C.createVertexBuffer(q,n.cR.members,!0);for(let ie of F){let ae={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(re=O).getCameraToCenterDistance(ie.projection),u_viewport_size:[re.width,re.height]};W.draw(h,A.TRIANGLES,It.disabled,jt.disabled,h.colorModeForRenderPass(),Lt.disabled,ae,o.id,Q,Z,n.b2.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,O.zoom)}var re;Q.destroy(),Z.destroy()}let uc=n.a6.mat4.create();function Fm(h){let t=h._camera.getWorldToCamera(h.worldSize,1),o=n.a6.mat4.multiply([],t,h.globeMatrix);n.a6.mat4.invert(o,o);let d=[0,0,0],g=[0,1,0,0];return n.a6.vec4.transformMat4(g,g,o),d[0]=g[0],d[1]=g[1],d[2]=g[2],n.a6.vec3.normalize(d,d),d}function gv({width:h,height:t,anchor:o,textOffset:d,textScale:g},y){let{horizontalAlign:x,verticalAlign:C}=n.by(o),A=-(x-.5)*h,O=-(C-.5)*t,R=n.bx(o,d);return new n.P((A/g+R[0])*y,(O/g+R[1])*y)}function Zd(h,t,o,d,g,y,x,C,A,O,R){let F=h.text.placedSymbolArray,z=h.text.dynamicLayoutVertexArray,j=h.icon.dynamicLayoutVertexArray,W={},q=h.getProjection(),X=ys(C,q,y),Z=y.elevation,Q=q.upVectorScale(C.canonical,y.center.lat,y.worldSize).metersToTile;z.clear();for(let re=0;re<F.length;re++){let ie=F.get(re),{tileAnchorX:ae,tileAnchorY:ue,numGlyphs:le}=ie,he=ie.hidden||!ie.crossTileID||h.allowVerticalPlacement&&!ie.placedOrientation?null:d[ie.crossTileID];if(he){let me=0,xe=0,_e=0;if(Z){let Le=Z?Z.getAtTileOffset(C,ae,ue):0,[He,Ze,$e]=q.upVector(C.canonical,ae,ue);me=Le*He*Q,xe=Le*Ze*Q,_e=Le*$e*Q}let[ge,Oe,Be,qe]=Kr(ie.projectedAnchorX+me,ie.projectedAnchorY+xe,ie.projectedAnchorZ+_e,o?X:x),Ke=dn(y.getCameraToCenterDistance(q),qe),nt=g.evaluateSizeForFeature(h.textSizeData,O,ie)*Ke/n.br;o&&(nt*=h.tilePixelRatio/A);let Se=gv(he,nt);o?({x:ge,y:Oe,z:Be}=q.projectTilePoint(ae+Se.x,ue+Se.y,C.canonical),[ge,Oe,Be]=Kr(ge+me,Oe+xe,Be+_e,x)):(t&&Se._rotate(-y.angle),ge+=Se.x,Oe+=Se.y,Be=0);let Ge=h.allowVerticalPlacement&&ie.placedOrientation===n.bl.vertical?Math.PI/2:0;for(let Le=0;Le<le;Le++)n.bo(z,ge,Oe,Be,Ge);R&&ie.associatedIconIndex>=0&&(W[ie.associatedIconIndex]={x:ge,y:Oe,z:Be,angle:Ge})}else _o(le,z)}if(R){j.clear();let re=h.icon.placedSymbolArray;for(let ie=0;ie<re.length;ie++){let ae=re.get(ie),{numGlyphs:ue}=ae,le=W[ie];if(ae.hidden||!le)_o(ue,j);else{let{x:he,y:me,z:xe,angle:_e}=le;for(let ge=0;ge<ue;ge++)n.bo(j,he,me,xe,_e)}}h.icon.dynamicLayoutVertexBuffer.updateData(j)}h.text.dynamicLayoutVertexBuffer.updateData(z)}function hc(h,t,o,d,g,y,x={}){let C=o.paint.get("icon-translate"),A=o.paint.get("text-translate"),O=o.paint.get("icon-translate-anchor"),R=o.paint.get("text-translate-anchor"),F=o.layout.get("icon-rotation-alignment"),z=o.layout.get("text-rotation-alignment"),j=o.layout.get("icon-pitch-alignment"),W=o.layout.get("text-pitch-alignment"),q=o.layout.get("icon-keep-upright"),X=o.layout.get("text-keep-upright"),Z=o.paint.get("icon-color-saturation"),Q=o.paint.get("icon-color-contrast"),re=o.paint.get("icon-color-brightness-min"),ie=o.paint.get("icon-color-brightness-max"),ae=o.layout.get("symbol-elevation-reference")==="sea",ue=h.context,le=ue.gl,he=h.transform,me=F==="map",xe=z==="map",_e=j==="map",ge=W==="map",Oe=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,Be=!1,qe=h.depthModeForSublayer(0,It.ReadOnly),Ke=[n.am(he.center.lng),n.at(he.center.lat)],nt=o.layout.get("text-variable-anchor"),Se=he.projection.name==="globe",Ge=[],Le=[0,-1,0];for(let He of d){let Ze=t.getTile(He),$e=Ze.getBucket(o);if(!$e||$e.projection.name==="mercator"&&Se||$e.fullyClipped)continue;let st=$e.projection.name==="globe",yt=st?n.a9(he.zoom):0,bt=ys(He,$e.getProjection(),he),dt=he.calculatePixelsToTileUnitsMatrix(Ze),Tt=nt&&$e.hasTextData(),lt=$e.hasIconTextFit()&&Tt&&$e.hasIconData(),Dt=$e.getProjection().createInversionMatrix(he,He.canonical),Ut=On=>{he.depthOcclusionForSymbolsAndCircles&&(o.hasInitialOcclusionOpacityProperties||h.terrain)&&(On.push("DEPTH_D24"),On.push("DEPTH_OCCLUSION"))},tn=()=>{let On=me&&o.layout.get("symbol-placement")!=="point",Tn=[];Ut(Tn);let Qn=On||lt,Cr=o.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&_e&&Tn.push("PITCH_WITH_MAP_TERRAIN"),st&&(Tn.push("PROJECTION_GLOBE_VIEW"),Qn&&Tn.push("PROJECTED_POS_ON_VIEWPORT")),Cr>0&&Tn.push("ICON_TRANSITION"),$e.icon.zOffsetVertexBuffer&&Tn.push("Z_OFFSET"),Z===0&&Q===0&&re===0&&ie===1||Tn.push("COLOR_ADJUSTMENT"),$e.sdfIcons&&Tn.push("RENDER_SDF");let Mi=$e.icon.programConfigurations.get(o.id),Ni=h.getOrCreateProgram("symbol",{config:Mi,defines:Tn}),Rr=Ze.imageAtlasTexture?Ze.imageAtlasTexture.size:[0,0],hn=$e.iconSizeData,nn=n.bk(hn,he.zoom),wn=_e||he.pitch!==0,jn=cn(bt,Ze.tileID.canonical,_e,me,he,$e.getProjection(),dt),fr=di(bt,Ze.tileID.canonical,_e,me,he,$e.getProjection(),dt),er=h.translatePosMatrix(fr,Ze,C,O,!0),kr=h.translatePosMatrix(bt,Ze,C,O),bo=Qn?uc:jn,pi=me&&!_e&&!On,mi=Le;!Se&&!he.mercatorFromTransition||me||(mi=Fm(he));let zi=st?mi:Le,to=o.getColorAdjustmentMatrix(Z,Q,re,ie),gi=Lm(hn.kind,nn,pi,_e,h,kr,bo,er,ae,!1,Rr,[0,0],!0,He,yt,Ke,Dt,zi,$e.getProjection(),to,Cr),Jo=Ze.imageAtlasTexture?Ze.imageAtlasTexture:null,Bi=o.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear,Mn=$e.sdfIcons||h.options.rotating||h.options.zooming||Bi||wn?le.LINEAR:le.NEAREST,cl=$e.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,yf=h.terrain&&_e&&On?n.a6.mat4.invert(n.a6.mat4.create(),jn):uc;if(On&&$e.icon){let ul=he.elevation,vf=ul?ul.getAtTileOffsetFunc(He,he.center.lat,he.worldSize,$e.getProjection()):null,Tc=un(bt,Ze.tileID.canonical,_e,me,he,$e.getProjection(),dt);Ra($e,bt,h,!1,Tc,fr,_e,q,vf,He)}return{program:Ni,buffers:$e.icon,uniformValues:gi,atlasTexture:Jo,atlasTextureIcon:null,atlasInterpolation:Mn,atlasInterpolationIcon:null,isSDF:$e.sdfIcons,hasHalo:cl,tile:Ze,labelPlaneMatrixInv:yf}},zn=()=>{let On=xe&&o.layout.get("symbol-placement")!=="point",Tn=[],Qn=On||nt||lt;h.terrainRenderModeElevated()&&ge&&Tn.push("PITCH_WITH_MAP_TERRAIN"),st&&(Tn.push("PROJECTION_GLOBE_VIEW"),Qn&&Tn.push("PROJECTED_POS_ON_VIEWPORT")),$e.text.zOffsetVertexBuffer&&Tn.push("Z_OFFSET"),$e.iconsInText&&Tn.push("RENDER_TEXT_AND_SYMBOL"),Tn.push("RENDER_SDF"),Ut(Tn);let Cr=$e.text.programConfigurations.get(o.id),Mi=h.getOrCreateProgram("symbol",{config:Cr,defines:Tn}),Ni,Rr=[0,0],hn=null,nn=$e.textSizeData;$e.iconsInText&&(Rr=Ze.imageAtlasTexture?Ze.imageAtlasTexture.size:[0,0],hn=Ze.imageAtlasTexture?Ze.imageAtlasTexture:null,Ni=ge||he.pitch!==0||h.options.rotating||h.options.zooming||nn.kind==="composite"||nn.kind==="camera"?le.LINEAR:le.NEAREST);let wn=Ze.glyphAtlasTexture?Ze.glyphAtlasTexture.size:[0,0],jn=o.layout.get("text-size-scale-range"),fr=n.ap(h.scaleFactor,jn[0],jn[1]),er=n.bk(nn,he.zoom,fr),kr=cn(bt,Ze.tileID.canonical,ge,xe,he,$e.getProjection(),dt),bo=di(bt,Ze.tileID.canonical,ge,xe,he,$e.getProjection(),dt),pi=h.translatePosMatrix(bo,Ze,A,R,!0),mi=h.translatePosMatrix(bt,Ze,A,R),zi=Qn?uc:kr,to=xe&&!ge&&!On,gi=Le;!Se&&!he.mercatorFromTransition||xe||(gi=Fm(he));let Jo=Lm(nn.kind,er,to,ge,h,mi,zi,pi,ae,!0,wn,Rr,!0,He,yt,Ke,Dt,st?gi:Le,$e.getProjection(),null,null,fr),Bi=Ze.glyphAtlasTexture?Ze.glyphAtlasTexture:null,Mn=le.LINEAR,cl=o.paint.get("text-halo-width").constantOr(1)!==0,yf=h.terrain&&ge&&On?n.a6.mat4.invert(n.a6.mat4.create(),kr):uc;if(On&&$e.text){let ul=he.elevation,vf=ul?ul.getAtTileOffsetFunc(He,he.center.lat,he.worldSize,$e.getProjection()):null,Tc=un(bt,Ze.tileID.canonical,ge,xe,he,$e.getProjection(),dt);Ra($e,bt,h,!0,Tc,bo,ge,X,vf,He)}return{program:Mi,buffers:$e.text,uniformValues:Jo,atlasTexture:Bi,atlasTextureIcon:hn,atlasInterpolation:Mn,atlasInterpolationIcon:Ni,isSDF:!0,hasHalo:cl,tile:Ze,labelPlaneMatrixInv:yf}},fn=$e.icon.segments.get().length,qn=$e.text.segments.get().length,bn=fn&&!x.onlyText?tn():null,Bn=qn&&!x.onlyIcons?zn():null,Jt=o.paint.get("icon-opacity").constantOr(1),kn=o.paint.get("text-opacity").constantOr(1);if(Oe&&$e.canOverlap){Be=!0;let On=Jt&&!x.onlyText?$e.icon.segments.get():[],Tn=kn&&!x.onlyIcons?$e.text.segments.get():[];for(let Qn of On)Ge.push({segments:new n.b2([Qn]),sortKey:Qn.sortKey,state:bn});for(let Qn of Tn)Ge.push({segments:new n.b2([Qn]),sortKey:Qn.sortKey,state:Bn})}else x.onlyText||Ge.push({segments:Jt?$e.icon.segments:new n.b2([]),sortKey:0,state:bn}),x.onlyIcons||Ge.push({segments:kn?$e.text.segments:new n.b2([]),sortKey:0,state:Bn})}Be&&Ge.sort((He,Ze)=>He.sortKey-Ze.sortKey);for(let He of Ge){let Ze=He.state;if(Ze)if(h.terrain?h.terrain.setupElevationDraw(Ze.tile,Ze.program,{useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ze.labelPlaneMatrixInv}):h.setupDepthForOcclusion(he.depthOcclusionForSymbolsAndCircles,Ze.program),ue.activeTexture.set(le.TEXTURE0),Ze.atlasTexture&&Ze.atlasTexture.bind(Ze.atlasInterpolation,le.CLAMP_TO_EDGE,!0),Ze.atlasTextureIcon&&(ue.activeTexture.set(le.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,le.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,Ze.program),Ze.hasHalo){let $e=Ze.uniformValues;$e.u_is_halo=1,dc(Ze.buffers,He.segments,o,h,Ze.program,qe,g,y,$e,2),$e.u_is_halo=0}else{if(Ze.isSDF){let $e=Ze.uniformValues;Ze.hasHalo&&($e.u_is_halo=1,dc(Ze.buffers,He.segments,o,h,Ze.program,qe,g,y,$e,1)),$e.u_is_halo=0}dc(Ze.buffers,He.segments,o,h,Ze.program,qe,g,y,Ze.uniformValues,1)}}}function dc(h,t,o,d,g,y,x,C,A,O){let R=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];g.draw(d,d.context.gl.TRIANGLES,y,x,C,Lt.disabled,A,o.id,h.layoutVertexBuffer,h.indexBuffer,t,o.paint,d.transform.zoom,h.programConfigurations.get(o.id),R,O)}function Vu(h,t,o,d,g,y,x){let C=h.context.gl,A=o.paint.get("fill-pattern"),O=o.is3D(),R=O?h.stencilModeFor3D():jt.disabled,F=A&&A.constantOr(1),z,j,W,q,X;x?(j=F&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=C.LINES):(j=F?"fillPattern":"fill",z=C.TRIANGLES);for(let Z of d){let Q=t.getTile(Z);if(F&&!Q.patternsLoaded())continue;let re=Q.getBucket(o);if(!re)continue;h.prepareDrawTile();let ie=re.programConfigurations.get(o.id),ae=h.isTileAffectedByFog(Z),ue=h.getOrCreateProgram(j,{config:ie,overrideFog:ae});F&&(h.context.activeTexture.set(C.TEXTURE0),Q.imageAtlasTexture&&Q.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ie.updatePaintBuffers());let le=A.constantOr(null);if(le&&Q.imageAtlas){let xe=Q.imageAtlas.patternPositions[le.toString()];xe&&ie.setConstantPatternPositions(xe)}let he=h.translatePosMatrix(Z.projMatrix,Q,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),me=o.paint.get("fill-emissive-strength");if(x){q=re.indexBuffer2,X=re.segments2;let xe=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];W=j==="fillOutlinePattern"&&F?dv(he,me,h,Q,xe):ac(he,me,xe)}else q=re.indexBuffer,X=re.segments,W=F?Vd(he,me,h,Q):Om(he,me);h.uploadCommonUniforms(h.context,ue,Z.toUnwrapped()),ue.draw(h,z,g,O?R:h.stencilModeForClipping(Z),y,Lt.disabled,W,o.id,re.layoutVertexBuffer,q,X,o.paint,h.transform.zoom,ie,void 0)}}function Gr(h,t,o,d,g,y,x,C){o.resetLayerRenderingStats(h);let A=h.context,O=A.gl,R=h.transform,F=o.paint.get("fill-extrusion-pattern"),z=F.constantOr(1),j=o.paint.get("fill-extrusion-opacity"),W=h.style.enable3dLights(),q=o.paint.get(W&&!z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),X=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],Z=o.layout.get("fill-extrusion-edge-radius"),Q=Z>0&&!o.paint.get("fill-extrusion-rounded-roof"),re=Q?0:Z,ie=R.projection.name==="globe"?n.c_():0,ae=R.projection.name==="globe",ue=ae?n.a9(R.zoom):0,le=[n.am(R.center.lng),n.at(R.center.lat)],he=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(o.lut).toArray01().slice(0,3),me=o.paint.get("fill-extrusion-flood-light-intensity"),xe=o.paint.get("fill-extrusion-vertical-scale"),_e=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ge=o.paint.get("fill-extrusion-height-alignment"),Oe=o.paint.get("fill-extrusion-base-alignment"),Be=jo(h,o.paint.get("fill-extrusion-cutoff-fade-range")),qe=[],Ke;ae&&qe.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&qe.push("FAUX_AO"),Q&&qe.push("ZERO_ROOF_RADIUS"),C&&qe.push("HAS_CENTROID"),me>0&&qe.push("FLOOD_LIGHT"),Be.shouldRenderCutoff&&qe.push("RENDER_CUTOFF"),_e&&qe.push("RENDER_WALL_MODE");let nt=h.renderPass==="shadow",Se=h.shadowRenderer,Ge=nt&&!!Se;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let Le=[0,0,0];if(Se){let $e=h.style.directionalLight,st=h.style.ambientLight;$e&&st&&(Le=bu(h.style,$e,st)),nt||(qe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Se.useNormalOffset&&qe.push("NORMAL_OFFSET")),Ke=qe.concat(["SHADOWS_SINGLE_CASCADE"])}let He=Ge?"fillExtrusionDepth":z?"fillExtrusionPattern":"fillExtrusion",Ze=o.getLayerRenderingStats();for(let $e of d){let st=t.getTile($e),yt=st.getBucket(o);if(!yt||yt.projection.name!==R.projection.name)continue;let bt=!1;Se&&(bt=Se.getMaxCascadeForTile($e.toUnwrapped())===0);let dt=h.isTileAffectedByFog($e),Tt=yt.programConfigurations.get(o.id),lt=h.getOrCreateProgram(He,{config:Tt,defines:bt?Ke:qe,overrideFog:dt});if(h.terrain&&h.terrain.setupElevationDraw(st,lt,{useMeterToDem:!0}),!yt.centroidVertexBuffer){let bn=lt.attributes.a_centroid_pos;bn!==void 0&&O.vertexAttrib2f(bn,0,0)}!nt&&Se&&Se.setupShadows(st.tileID.toUnwrapped(),lt,"vector-tile",st.tileID.overscaledZ),z&&(h.context.activeTexture.set(O.TEXTURE0),st.imageAtlasTexture&&st.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Tt.updatePaintBuffers());let Dt=F.constantOr(null);if(Dt&&st.imageAtlas){let bn=st.imageAtlas.patternPositions[Dt.toString()];bn&&Tt.setConstantPatternPositions(bn)}let Ut=o.paint.get("fill-extrusion-vertical-gradient"),tn=1/yt.tileToMeter,zn;if(nt&&Se){if(zm(st.tileID,yt,h))continue;let bn=Se.calculateShadowPassMatrixFromTile(st.tileID.toUnwrapped());zn=zd(bn,re,tn,xe,ge,Oe)}else{let bn=h.translatePosMatrix($e.expandedProjMatrix,st,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Bn=R.projection.createInversionMatrix(R,$e.canonical);zn=z?Bd(bn,h,Ut,j,X,re,tn,$e,st,ie,ge,Oe,ue,le,Bn,he,xe):Nd(bn,h,Ut,j,X,re,tn,$e,ie,ge,Oe,ue,le,Bn,he,xe,me,Le)}h.uploadCommonUniforms(A,lt,$e.toUnwrapped(),null,Be);let fn=yt.segments;if(R.projection.name==="mercator"&&!nt&&(fn=yt.getVisibleSegments(st.tileID,h.terrain,h.transform.getFrustum(0)),!fn.get().length))continue;if(Ze)if(nt)for(let bn of fn.get())Ze.numRenderedVerticesInShadowPass+=bn.primitiveLength;else for(let bn of fn.get())Ze.numRenderedVerticesInTransparentPass+=bn.primitiveLength;let qn=[];(h.terrain||C)&&qn.push(yt.centroidVertexBuffer),ae&&qn.push(yt.layoutVertexExtBuffer),_e&&qn.push(yt.wallVertexBuffer),lt.draw(h,A.gl.TRIANGLES,g,y,x,Lt.backCCW,zn,o.id,yt.layoutVertexBuffer,yt.indexBuffer,fn,o.paint,h.transform.zoom,Tt,qn)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function Di(h,t,o,d,g,y,x,C,A,O,R,F,z,j,W,q,X,Z,Q){let re=h.context,ie=re.gl,ae=h.transform,ue=h.transform.zoom,le=[],he=jo(h,o.paint.get("fill-extrusion-cutoff-fade-range"));O==="clear"?(le.push("CLEAR_SUBPASS"),Q&&(le.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(ie.TEXTURE0),Q.bind(ie.LINEAR,ie.CLAMP_TO_EDGE))):O==="sdf"&&le.push("SDF_SUBPASS"),X&&le.push("HAS_CENTROID"),he.shouldRenderCutoff&&le.push("RENDER_CUTOFF");let me=o.layout.get("fill-extrusion-edge-radius"),xe=(_e,ge,Oe,Be,qe)=>{let Ke=ge.programConfigurations.get(o.id),nt=h.isTileAffectedByFog(_e),Se=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ke,defines:le,overrideFog:nt}),Ge=((He,Ze,$e,st,yt,bt,dt,Tt,lt,Dt,Ut)=>({u_matrix:Ze,u_opacity:$e,u_ao_pass:st?1:0,u_meter_to_tile:yt,u_ao:bt,u_flood_light_intensity:dt,u_flood_light_color:Tt,u_attenuation:lt,u_edge_radius:Dt,u_fb:0,u_fb_size:Ut,u_dynamic_offset:1}))(0,Be,R,A,qe,[F,z*qe],j,W,q,ue>=17?0:me*qe,Q?Q.size[0]:0),Le=[];X&&Le.push(ge.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(re,Se,_e.toUnwrapped(),null,he),Se.draw(h,re.gl.TRIANGLES,g,y,x,C,Ge,o.id,ge.vertexBuffer,ge.indexBuffer,Oe,o.paint,ue,Ke,Le)};for(let _e of d){let ge=t.getTile(_e),Oe=ge.getBucket(o);if(!Oe||Oe.projection.name!==ae.projection.name||!Oe.groundEffect||Oe.groundEffect&&!Oe.groundEffect.hasData())continue;let Be=Oe.groundEffect,qe=1/Oe.tileToMeter;{let Ke=h.translatePosMatrix(_e.projMatrix,ge,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),nt=Be.getDefaultSegment();xe(_e,Be,nt,Ke,qe)}if(Z)for(let Ke=0;Ke<4;Ke++){let nt=n.c$[Ke](_e),Se=t.getTile(nt);if(!Se)continue;let Ge=Se.getBucket(o);if(!Ge||Ge.projection.name!==ae.projection.name||!Ge.groundEffect||Ge.groundEffect&&!Ge.groundEffect.hasData())continue;let Le=Ge.groundEffect,He,Ze;Ke===0?(He=[-n.ab,0,0],Ze=1):Ke===1?(He=[n.ab,0,0],Ze=0):Ke===2?(He=[0,-n.ab,0],Ze=3):(He=[0,n.ab,0],Ze=2);let $e=Le.regionSegments[Ze];if(!$e)continue;let st=new Float32Array(16);n.a6.mat4.translate(st,_e.projMatrix,He),xe(_e,Le,$e,h.translatePosMatrix(st,ge,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),qe)}}}function Nm(h,t,o,d,g,y,x){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();let C=y?y.findDEMTileFor(o):null;if(!(C&&C.dem||x))return;let A=Z=>new n.P(Math.ceil((Z+n.d2)*n.d3),0),O=Z=>{let Q=t.getSource().minzoom,re=ae=>{let ue=t.getTileByID(ae);if(ue&&ue.hasData())return ue.getBucket(g)},ie=[0,-1,1];for(let ae of ie){if(Z.overscaledZ+ae<Q)continue;let ue=re(Z.calculateScaledKey(Z.overscaledZ+ae));if(ue)return ue}},R=[0,0,0],F=(Z,Q)=>(R[0]=Math.min(Z.min.y,Q.min.y),R[1]=Math.max(Z.max.y,Q.max.y),R[2]=n.ab-Q.min.x>Z.max.x?Q.min.x-n.ab:Z.max.x,R),z=(Z,Q)=>(R[0]=Math.min(Z.min.x,Q.min.x),R[1]=Math.max(Z.max.x,Q.max.x),R[2]=n.ab-Q.min.y>Z.max.y?Q.min.y-n.ab:Z.max.y,R),j=[(Z,Q)=>F(Z,Q),(Z,Q)=>F(Q,Z),(Z,Q)=>z(Z,Q),(Z,Q)=>z(Q,Z)],W=(Z,Q,re,ie,ae,ue,le)=>{if(!y)return 0;let he=[[ue?re:Z,ue?Z:re,0],[ue?re:Q,ue?Q:re,0]],me=le<0?n.ab+le:le,xe=[ue?me:(Z+Q)/2,ue?(Z+Q)/2:me,0];return re===0&&le<0||re!==0&&le>0?y.getForTilePoints(ae,[xe],!0,ie):he.push(xe),y.getForTilePoints(o,he,!0,C),Math.max(he[0][2],he[1][2],xe[2])/y.exaggeration()};for(let Z=0;Z<4;Z++){let Q=d.borderFeatureIndices[Z];if(Q.length===0)continue;let re=n.c$[Z](o),ie=O(re);if(!(ie&&ie instanceof n.d0)||d.borderDoneWithNeighborZ[Z]===ie.canonical.z)continue;ie.centroidVertexArray.length===0&&ie.createCentroidsBuffer();let ae=y?y.findDEMTileFor(re):null;if(!(ae&&ae.dem||x))continue;let ue=(Z<2?1:5)-Z,le=ie.borderDoneWithNeighborZ[ue]!==d.canonical.z,he=ie.borderFeatureIndices[ue],me=0;if(d.canonical.z!==ie.canonical.z){for(let xe of Q)d.showCentroid(d.featuresOnBorder[xe]);if(le)for(let xe of he)ie.showCentroid(ie.featuresOnBorder[xe]);d.borderDoneWithNeighborZ[Z]=ie.canonical.z,ie.borderDoneWithNeighborZ[ue]=d.canonical.z}for(let xe of Q){let _e=d.featuresOnBorder[xe],ge=d.centroidData[_e.centroidDataIndex],Oe=_e.borders[Z],Be;for(;me<he.length;){Be=ie.featuresOnBorder[he[me]];let qe=Be.borders[ue];if(qe[1]>Oe[0]+3||qe[0]>Oe[0]-3)break;ie.showCentroid(Be),me++}if(Be&&me<he.length){let qe=me,Ke=0;for(;!(Be.borders[ue][0]>Oe[1]-3)&&(Ke++,++me!==he.length);)Be=ie.featuresOnBorder[he[me]];Be=ie.featuresOnBorder[he[qe]];let nt=!1;if(Ke>=1){let Le=Be.borders[ue];Math.abs(Oe[0]-Le[0])<3&&Math.abs(Oe[1]-Le[1])<3&&(Ke=1,nt=!0,me=qe+1)}else if(Ke===0){d.showCentroid(_e);continue}let Se=ie.centroidData[Be.centroidDataIndex];x&&nt&&(((q=ge).flags|(X=Se).flags)&n.d1?(q.flags|=n.d1,X.flags|=n.d1):(q.flags&=~n.d1,X.flags&=~n.d1));let Ge=_e.intersectsCount()>1||Be.intersectsCount()>1;if(Ke>1)me=qe,ge.centroidXY=Se.centroidXY=new n.P(0,0);else if(ae&&ae.dem&&!Ge){let Le=j[Z](ge,Se),He=Z%2?n.ab-1:0,Ze=W(Le[0],Math.min(n.ab-1,Le[1]),He,ae,re,Z<2,Le[2]);ge.centroidXY=Se.centroidXY=A(Ze)}else Ge?ge.centroidXY=Se.centroidXY=new n.P(0,0):(ge.centroidXY=d.encodeBorderCentroid(_e),Se.centroidXY=ie.encodeBorderCentroid(Be));d.writeCentroidToBuffer(ge),ie.writeCentroidToBuffer(Se)}else d.showCentroid(_e)}d.borderDoneWithNeighborZ[Z]=ie.canonical.z,ie.borderDoneWithNeighborZ[ue]=d.canonical.z}var q,X;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}let Xd=[1,0,0],Yd=[0,1,0],Jd=[0,0,1];function zm(h,t,o){let d=o.transform,g=o.shadowRenderer;if(!g)return!0;let y=h.toUnwrapped(),x=d.tileSize*g._cascades[o.currentShadowCascade].scale,C=t.maxHeight;if(d.elevation){let q=d.elevation.getMinMaxForTile(h);q&&(C+=q.max)}let A=[...g.shadowDirection];A[2]=-A[2];let O=g.computeSimplifiedTileShadowVolume(y,C,x,A);if(!O)return!1;let R=[Xd,Yd,Jd,A,[A[0],0,A[2]],[0,A[1],A[2]]],F=d.projection.name==="globe",z=d.scaleZoom(x),j=n.bO.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,z,!F),W=g.getCurrentCascadeFrustum();return j.intersectsPrecise(O.vertices,O.planes,R)===0||W.intersectsPrecise(O.vertices,O.planes,R)===0}function Ci(h){return[h[0]*n.d4,h[1]*n.d4,h[2]*n.d4,0]}function ar(h,t,o,d,g,y,x,C,A){let O=d.getSource(),R=o.globeSharedBuffers;if(!R)return;let F,z,j;if(t&&(F=d.getTile(t)),O instanceof n.aD?(z=O.texture,j=n.cD(0,0,o.transform)):F&&t&&(z=F.texture,j=n.cD(t.canonical.z,t.canonical.x,o.transform)),!z||!j)return;h||(j=n.a6.mat4.scale(n.a6.mat4.create(),j,[1,-1,1]));let W=o.context,q=W.gl,X=g.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR,Z=o.colorModeForDrapableLayerRenderPass(y),Q=x.defines;Q.push("GLOBE_POLES");let re=new It(q.LEQUAL,It.ReadWrite,o.depthRangeFor3D),ie=Float32Array.from(o.transform.expandedFarZProjMatrix),ae=Float32Array.from(n.b6(n.cC(new n.bQ(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),W.activeTexture.set(q.TEXTURE0),z.bind(X,q.CLAMP_TO_EDGE),W.activeTexture.set(q.TEXTURE1),z.bind(X,q.CLAMP_TO_EDGE),z.useMipmap&&W.extTextureFilterAnisotropic&&o.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);let[ue,le,he,me]=t?R.getPoleBuffers(t.canonical.z,!1):R.getPoleBuffers(0,!0),xe=g.paint.get("raster-elevation"),_e;h?(_e=ue,o.renderDefaultNorthPole=xe!==0):(_e=le,o.renderDefaultSouthPole=xe!==0);let ge=Ci(x.mix),Oe=((qe,Ke,nt,Se,Ge,Le,He,Ze,$e,st,yt,bt,dt)=>Fu(qe,Ke,nt,new Float32Array(16),new Float32Array(9),[0,0],Se,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Le,[0,0],Ze,2,st,yt,bt,1,0,dt))(ie,ae,j,n.a9(o.transform.zoom),0,g,0,xe,0,ge,x.offset,x.range,y),Be=o.getOrCreateProgram("raster",{defines:Q});o.uploadCommonUniforms(W,Be,null),Be.draw(o,q.TRIANGLES,re,A,Z,C,Oe,g.id,_e,he,me)}function ju(h){let t=h._nearZ,o=h.projection.farthestPixelDistance(h),d=o-t,g=.2*h.height,y=t+g;return[t,o,(y-g-t)/d,(y-t)/d]}function Kd(h,t,o,d){if(h)return t instanceof po&&h instanceof uu?t.getTextureDescriptor(h,o,!0):{texture:h.texture,mix:Ci(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Bm=n.d5([{name:"a_index",type:"Int16",components:1}]);class Vm{constructor(t,o,d,g){let y={width:d[0],height:d[1],data:null},x=t.gl;this.targetColorTexture=new n.T(t,y,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,y,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,g),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let d=this.context.gl,g=o.width*o.height;this.particleTexture0=new n.T(this.context,o,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,o,d.RGBA8,{premultiply:!1,useMipmap:!1});let y=new n.d6;y.reserve(g);for(let x=0;x<g;x++)y.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(y,Bm.members,!0),this.particleSegment=n.b2.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function jm(h,t,o){if(!h)return null;let d=t.getTextureDescriptor(h,o,!0);if(!d)return null;let{texture:g,mix:y,offset:x,tileSize:C,buffer:A,format:O}=d;if(!g||!O)return null;let R=!1;return O==="uint32"&&(R=!0,y[3]=0,y=ku(n.d7,y,[0,o.paint.get("raster-particle-max-speed")]),x=Ya(n.d7,x,[0,o.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[A/(C+2*A),C/(C+2*A)],tileSize:C,scalarData:R,scale:y,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function _v(h){let t=h._nearZ,o=h.projection.farthestPixelDistance(h),d=o-t,g=.2*h.height,y=t+g;return[t,o,(y-g-t)/d,(y-t)/d]}let Ka=new n.bA(1,0,0,1),Qa=new n.bA(0,1,0,1),tt=new n.bA(0,0,1,1),xt=new n.bA(1,0,1,1),el=new n.bA(0,1,1,1);function Zn(h,t,o,d,g,y,x){let C=h.context,A=h.transform,O=C.gl,R=A.projection.name==="globe",F=R?["PROJECTION_GLOBE_VIEW"]:[],z=n.a6.mat4.clone(o.projMatrix);if(R&&n.a9(A.zoom)>0){let ge=n.b5(o.canonical,A),Oe=n.d8(ge);z=n.a6.mat4.multiply(new Float32Array(16),A.globeMatrix,Oe),n.a6.mat4.multiply(z,A.projMatrix,z)}let j=n.a6.mat4.create();j[12]+=2*g/(n.q.devicePixelRatio*A.width),j[13]+=2*y/(n.q.devicePixelRatio*A.height),n.a6.mat4.multiply(z,j,z);let W=h.getOrCreateProgram("debug",{defines:F}),q=t.getTileByID(o.key);h.terrain&&h.terrain.setupElevationDraw(q,W);let X=It.disabled,Z=jt.disabled,Q=h.colorModeForRenderPass(),re="$debug";C.activeTexture.set(O.TEXTURE0),h.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),R?q._makeGlobeTileDebugBuffers(h.context,A):q._makeDebugTileBoundsBuffers(h.context,A.projection);let ie=q._tileDebugBuffer||h.debugBuffer,ae=q._tileDebugIndexBuffer||h.debugIndexBuffer,ue=q._tileDebugSegments||h.debugSegments;if(W.draw(h,O.LINE_STRIP,X,Z,Q,Lt.disabled,jd(z,d),re,ie,ae,ue,null,null,null,[q._globeTileDebugBorderBuffer]),x){let ge=q.latestRawTileData,Oe=Math.floor((ge&&ge.byteLength||0)/1024),Be=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Be+=` => ${o.overscaledZ}`),Be+=` ${q.state}`,Be+=` ${Oe}kb`,function(qe,Ke){qe.initDebugOverlayCanvas();let nt=qe.debugOverlayCanvas,Se=qe.context.gl,Ge=qe.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,nt.width,nt.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(Ke,5,5),Ge.strokeText(Ke,5,5),qe.debugOverlayTexture.update(nt),qe.debugOverlayTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}(h,Be)}let le=t.getTile(o).tileSize,he=512/Math.min(le,512)*(o.overscaledZ/A.zoom)*.5,me=q._tileDebugTextBuffer||h.debugBuffer,xe=q._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,_e=q._tileDebugTextSegments||h.debugSegments;W.draw(h,O.TRIANGLES,X,Z,Qt.alphaBlended,Lt.disabled,jd(z,n.bA.transparent,he),re,me,xe,_e,null,null,null,[q._globeTileDebugTextBuffer])}function Ae(h,t,o,d){na(h,0,t+o/2,h.transform.width,o,d)}function Qd(h,t,o,d){na(h,t-o/2,0,o,h.transform.height,d)}function na(h,t,o,d,g,y){let x=h.context,C=x.gl;C.enable(C.SCISSOR_TEST),C.scissor(t*n.q.devicePixelRatio,o*n.q.devicePixelRatio,d*n.q.devicePixelRatio,g*n.q.devicePixelRatio),x.clear({color:y}),C.disable(C.SCISSOR_TEST)}let ef=n.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Uu}=ef;function Go(h,t,o,d){h.emplaceBack(t,o,d)}class tf{constructor(t){this.vertexArray=new n.d9,this.indices=new n.aP,Go(this.vertexArray,-1,-1,1),Go(this.vertexArray,1,-1,1),Go(this.vertexArray,-1,1,1),Go(this.vertexArray,1,1,1),Go(this.vertexArray,-1,-1,-1),Go(this.vertexArray,1,-1,-1),Go(this.vertexArray,-1,1,-1),Go(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Uu),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.b2.simpleSegment(0,0,36,12)}}function Qi(h,t,o,d,g,y){let x=h.context.gl,C=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),O=t.paint.get("sky-atmosphere-sun-intensity"),R=((F,z,j,W,q)=>({u_matrix_3f:F,u_sun_direction:z,u_sun_intensity:j,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[q.r,q.g,q.b,q.a],u_luminance:5e-5}))(n.a6.mat3.fromMat4(n.a6.mat3.create(),d),g,O,C,A);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),o.draw(h,x.TRIANGLES,It.disabled,jt.disabled,Qt.unblended,Lt.frontCW,R,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}let yv=n.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class vv{constructor(t){let o=new n.da;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);let d=new n.aP;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,yv.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=n.b2.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Um=n.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class $u{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class nf{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Qt([1,Ei,1,Ei],n.bA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Qt([1,0,1,0],n.bA.transparent,[!1,!1,!1,!0]),this.params=new $u,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){let o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new vv(o);let d=this.params.sizeRange,g=this.params.intensityRange,y=function(R){let F=n.dd(30),z=[];for(let j=0;j<R;++j){let W=2*Math.PI*F(),q=Math.acos(1-2*F())-.5*Math.PI;z.push(n.a6.vec3.fromValues(Math.cos(q)*Math.cos(W),Math.cos(q)*Math.sin(W),Math.sin(q)))}return z}(this.params.starsCount),x=n.dd(300),C=new n.db,A=new n.aP,O=0;for(let R=0;R<y.length;++R){let F=n.a6.vec3.scale([],y[R],200),z=Math.max(0,1+.01*d*(1*x()-.5)),j=Math.max(0,1+.01*g*(1*x()-.5));C.emplaceBack(F[0],F[1],F[2],-1,-1,z,j),C.emplaceBack(F[0],F[1],F[2],1,-1,z,j),C.emplaceBack(F[0],F[1],F[2],1,1,z,j),C.emplaceBack(F[0],F[1],F[2],-1,1,z,j),A.emplaceBack(O+0,O+1,O+2),A.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=o.createVertexBuffer(C,Um.members),this.starsIdx=o.createIndexBuffer(A),this.starsSegments=n.b2.simpleSegment(0,0,C.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){let d=t.context,g=d.gl,y=t.transform,x=new It(g.LEQUAL,It.ReadOnly,[0,1]),C=n.a9(y.zoom),A=t.style.getLut(o.scope),O=o.properties.get("color").toRenderColor(A).toArray01(),R=o.properties.get("high-color").toRenderColor(A).toArray01(),F=o.properties.get("space-color").toRenderColor(A).toArray01PremultipliedAlpha(),z=5e-4,j=n.dc(o.properties.get("horizon-blend"),0,1,z,.25),W=n.cx(t,d,y)&&j===z?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,q=t.frameCounter/1e3%1,X=n.a6.vec3.length(y.globeCenterInViewSpace),Z=Math.sqrt(Math.pow(X,2)-Math.pow(W,2)),Q=Math.acos(Z/X),re=ie=>{let ae=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ie&&ae.push("ALPHA_PASS");let ue=t.getOrCreateProgram("globeAtmosphere",{defines:ae}),le=((me,xe,_e,ge,Oe,Be,qe,Ke,nt,Se,Ge,Le)=>({u_frustum_tl:me,u_frustum_tr:xe,u_frustum_br:_e,u_frustum_bl:ge,u_horizon:Oe,u_transition:Be,u_fadeout_range:qe,u_color:Ke,u_high_color:nt,u_space_color:Se,u_temporal_offset:Ge,u_horizon_angle:Le}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,C,j,O,R,F,q,Q);t.uploadCommonUniforms(d,ue);let he=this.atmosphereBuffer;he&&ue.draw(t,g.TRIANGLES,x,jt.disabled,ie?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Lt.backCW,le,ie?"atmosphere_glow_alpha":"atmosphere_glow",he.vertexBuffer,he.indexBuffer,he.segments)};re(!1),re(!0)}drawStars(t,o){let d=n.ap(o.properties.get("star-intensity"),0,1);if(d===0)return;let g=t.context,y=g.gl,x=t.transform,C=t.getOrCreateProgram("stars"),A=n.a6.quat.identity([]);n.a6.quat.rotateX(A,A,-x._pitch),n.a6.quat.rotateZ(A,A,-x.angle),n.a6.quat.rotateX(A,A,n.bC(x._center.lat)),n.a6.quat.rotateY(A,A,-n.bC(x._center.lng));let O=n.a6.mat4.fromQuat(new Float32Array(16),A),R=n.a6.mat4.multiply([],x.starsProjMatrix,O),F=n.a6.mat3.fromMat4([],O),z=n.a6.mat3.invert([],F),j=[0,1,0];n.a6.vec3.transformMat3(j,j,z),n.a6.vec3.scale(j,j,this.params.sizeMultiplier);let W=[1,0,0];n.a6.vec3.transformMat3(W,W,z),n.a6.vec3.scale(W,W,this.params.sizeMultiplier);let q=(X=j,Z=W,Q=d,{u_matrix:Float32Array.from(R),u_up:X,u_right:Z,u_intensity_multiplier:Q});var X,Z,Q;t.uploadCommonUniforms(g,C),this.starsVx&&this.starsIdx&&C.draw(t,y.TRIANGLES,It.disabled,jt.disabled,this.colorModeAlphaBlendedWriteRGB,Lt.disabled,q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function rf(h,t){let o=[...h],d=t.cameraWorldSizeForFog/t.worldSize,g=n.a6.mat4.identity([]);return n.a6.mat4.scale(g,g,[d,d,1]),n.a6.mat4.multiply(o,g,o),n.a6.mat4.multiply(o,t.worldToFogMatrix,o),o}function Gu(h,t,o,d,g){let y=o.material,x=d.context,{baseColorTexture:C,metallicRoughnessTexture:A}=y.pbrMetallicRoughness,{normalTexture:O,occlusionTexture:R,emissionTexture:F}=y;function z(W,q,X){if(W&&(h.push(q),x.activeTexture.set(x.gl.TEXTURE0+X),W.gfxTexture)){let{minFilter:Z,magFilter:Q,wrapS:re,wrapT:ie}=W.sampler;W.gfxTexture.bindExtraParam(Z,Q,re,ie)}}z(C,"HAS_TEXTURE_u_baseColorTexture",$r.BaseColor),z(A,"HAS_TEXTURE_u_metallicRoughnessTexture",$r.MetallicRoughness),z(O,"HAS_TEXTURE_u_normalTexture",$r.Normal),z(R,"HAS_TEXTURE_u_occlusionTexture",$r.Occlusion),z(F,"HAS_TEXTURE_u_emissionTexture",$r.Emission),g&&(g.texture||(g.texture=new n.df(d.context,g.image,[g.image.height,g.image.height,g.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+$r.LUT),g.texture&&g.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(h.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||h.push("DIFFUSE_SHADED"),h.push("USE_STANDARD_DERIVATIVES");let j=d.shadowRenderer;j&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&h.push("NORMAL_OFFSET"))}function ra(h,t,o,d,g,y){let x=o.paint.get("model-opacity"),C=t.context,A=new It(t.context.gl.LEQUAL,It.ReadWrite,t.depthRangeFor3D),O=t.transform,R=h.mesh,F=R.material,z=F.pbrMetallicRoughness,j=t.style.fog,W;W=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:n.a6.mat4.multiply([],d.zScaleMatrix,h.nodeModelMatrix),n.a6.mat4.multiply(W,d.negCameraPosMatrix,W);let q=n.a6.mat4.invert([],W);n.a6.mat4.transpose(q,q);let X=o.paint.get("model-emissive-strength").constantOr(0),Z=Bu(new Float32Array(h.worldViewProjection),new Float32Array(W),new Float32Array(q),null,t,x,z.baseColorFactor.toRenderColor(null),F.emissiveFactor,z.metallicFactor,z.roughnessFactor,F,X,o),Q={defines:[]},re=[],ie=t.shadowRenderer;ie&&(ie.useNormalOffset=!1),Gu(Q.defines,re,R,t,o.lut);let ae=null;if(j){let he=rf(h.nodeModelMatrix,t.transform);if(ae=new Float32Array(he),O.projection.name!=="globe"){let me=R.aabb.min,xe=R.aabb.max,[_e,ge]=j.getOpacityForBounds(he,me[0],me[1],xe[0],xe[1]);Q.overrideFog=_e>=Qe||ge>=Qe}}let ue=jo(t,o.paint.get("model-cutoff-fade-range"));ue.shouldRenderCutoff&&Q.defines.push("RENDER_CUTOFF");let le=t.getOrCreateProgram("model",Q);t.uploadCommonUniforms(C,le,null,ae,ue),t.renderPass!=="shadow"&&ie&&ie.setupShadowsFromMatrix(h.nodeModelMatrix,le),le.draw(t,C.gl.TRIANGLES,A,g,y,R.material.doubleSided?Lt.disabled:Lt.backCCW,Z,o.id,R.vertexBuffer,R.indexBuffer,R.segments,o.paint,t.transform.zoom,void 0,re)}function fc(h,t,o,d,g,y,x){let C;C=h.projection.name==="globe"?n.dg(o,h):[...o],n.a6.mat4.multiply(C,C,t.matrix);let A=n.a6.mat4.multiply([],d,C);if(t.meshes)for(let O of t.meshes){if(O.material.alphaMode!=="BLEND"){x.push({mesh:O,depth:0,modelIndex:g,worldViewProjection:A,nodeModelMatrix:C});continue}let R=n.a6.vec3.transformMat4([],O.centroid,A);R[2]>0&&y.push({mesh:O,depth:R[2],modelIndex:g,worldViewProjection:A,nodeModelMatrix:C})}if(t.children)for(let O of t.children)fc(h,O,o,d,g,y,x)}function Hu(h,t,o,d){let g=o.shadowRenderer;if(!g)return;let y=g.getShadowPassDepthMode(),x=g.getShadowPassColorMode(),C=g.calculateShadowPassMatrixFromMatrix(t),A=Hd(C);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,y,jt.disabled,x,Lt.backCCW,A,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,o.transform.zoom,void 0,void 0)}function $m(h,t,o){let d=t.updateZoomBasedPaintProperties(),g=function(y,x,C){let A,O,R,F=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&F>0){let z=y.terrain,j=z.findDEMTileFor(C);j&&j.dem?A=n.di.create(z,C,j):F=0}if(F===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),F===x.validForExaggeration&&(F===0||A&&A._demTile&&A._demTile.tileID===x.validForDEMTile.id&&A._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(let z in x.instancesPerModel){let j=x.instancesPerModel[z];for(let W=0;W<j.instancedDataArray.length;++W){let q=(A?F*A.getElevationAt(0|j.instancedDataArray.float32[16*W],0|j.instancedDataArray.float32[16*W+1],!0,!0):0)+j.instancesEvaluatedElevation[W];j.instancedDataArray.float32[16*W+6]=q,O=O?Math.min(x.terrainElevationMin,q):q,R=R?Math.max(x.terrainElevationMax,q):q}}return x.terrainElevationMin=O||0,x.terrainElevationMax=R||0,x.validForExaggeration=F,x.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,t,o);(d||g)&&(t.uploaded=!1,t.upload(h.context))}let yo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.ca([0,0,0],[n.ab,n.ab,0])};function oi(h,t){let o=1<<h.canonical.z,d=t.getFreeCameraOptions().position,g=t.elevation,y=h.canonical.x/o,x=(h.canonical.x+1)/o,C=h.canonical.y/o,A=(h.canonical.y+1)/o,O=t._centerAltitude;if(g){let j=g.getMinMaxForTile(h);j&&j.max>O&&(O=j.max)}let R=n.ap(d.x,y,x)-d.x,F=n.ap(d.y,C,A)-d.y,z=n.bE(O,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(R*R+F*F+z*z))}function Gm(h,t,o,d,g,y,x){let C=h.context,A=h.renderPass==="shadow",O=h.shadowRenderer,R=A&&O?O.getShadowPassDepthMode():new It(C.gl.LEQUAL,It.ReadWrite,h.depthRangeFor3D),F=h.isTileAffectedByFog(y);if(o.meshes)for(let z of o.meshes){let j=["MODEL_POSITION_ON_GPU"],W=[],q,X,Z;d.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");let Q=jo(h,t.paint.get("model-cutoff-fade-range"));if(Q.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),A&&O)q=h.getOrCreateProgram("modelDepth",{defines:j}),X=Hd(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(o.matrix)),Z=O.getShadowPassColorMode();else{Gu(j,W,z,h,t.lut),q=h.getOrCreateProgram("model",{defines:j,overrideFog:F});let ie=z.material,ae=ie.pbrMetallicRoughness,ue=t.paint.get("model-opacity"),le=t.paint.get("model-emissive-strength").constantOr(0);X=Bu(y.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,h,ue,ae.baseColorFactor.toRenderColor(null),ie.emissiveFactor,ae.metallicFactor,ae.roughnessFactor,ie,le,t,g),O&&(x.shadowUniformsInitialized?q.setShadowUniformValues(C,O.getShadowUniformValues()):(O.setupShadows(y.toUnwrapped(),q,"model-tile",y.overscaledZ),x.shadowUniformsInitialized=!0)),Z=Q.shouldRenderCutoff||ue<1||ie.alphaMode!=="OPAQUE"?Qt.alphaBlended:Qt.unblended}h.uploadCommonUniforms(C,q,y.toUnwrapped(),null,Q);let re=z.material.doubleSided?Lt.disabled:Lt.backCCW;if(d.instancedDataArray.length>20)W.push(d.instancedDataBuffer),q.draw(h,C.gl.TRIANGLES,R,jt.disabled,Z,re,X,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,h.transform.zoom,void 0,W,d.instancedDataArray.length);else{let ie=A?"u_instance":"u_normal_matrix";for(let ae=0;ae<d.instancedDataArray.length;++ae)X[ie]=new Float32Array(d.instancedDataArray.arrayBuffer,64*ae,16),q.draw(h,C.gl.TRIANGLES,R,jt.disabled,Z,re,X,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,h.transform.zoom,void 0,W)}}if(o.children)for(let z of o.children)Gm(h,t,z,d,g,y,x)}let pc=[1,-1,1];function Xn(h,t,o,d){if(!o.modelManager)return!0;let g=o.modelManager;if(!o.shadowRenderer)return!0;let y=o.shadowRenderer,x=t.aabb,C=!0,A=h.maxHeight;if(A===0){let R=0;for(let F in h.instancesPerModel){let z=g.getModel(F,d);z?R=Math.max(R,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):C=!1}A=h.maxScale*R*1.41+h.maxVerticalOffset,C&&(h.maxHeight=A)}x.max[2]=A,x.min[2]+=h.terrainElevationMin,x.max[2]+=h.terrainElevationMax,n.a6.vec3.transformMat4(x.min,x.min,t.tileMatrix),n.a6.vec3.transformMat4(x.max,x.max,t.tileMatrix);let O=x.intersects(y.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=O===2),O===0}function gn(h,t){let o=h.uniformValues.u_cutoff_params[0],d=h.uniformValues.u_cutoff_params[1],g=h.uniformValues.u_cutoff_params[2],y=h.uniformValues.u_cutoff_params[3];return d===o||y===g?1:n.ap(((t-o)/(d-o)-g)/(y-g),0,1)}function Hm(h,t,o,d){if(t.pitch<20)return 1;let g=t.getWorldToCameraMatrix();n.a6.mat4.multiply(g,g,h);let y=n.a6.vec4.fromValues(o.min[0],o.min[1],o.min[2],1),x=n.a6.vec4.transformMat4(n.a6.vec4.create(),y,g),C=x,A=x;y[1]=o.max[1],x=n.a6.vec4.transformMat4(n.a6.vec4.create(),y,g),C=x[1]<C[1]?x:C,A=x[1]>A[1]?x:A,y[0]=o.max[0],x=n.a6.vec4.transformMat4(n.a6.vec4.create(),y,g),C=x[1]<C[1]?x:C,A=x[1]>A[1]?x:A,y[1]=o.min[1],x=n.a6.vec4.transformMat4(n.a6.vec4.create(),y,g),C=x[1]<C[1]?x:C,A=x[1]>A[1]?x:A;let O=n.ap(d[0],0,1),R=100*t.pixelsPerMeter*n.ap(d[1],0,1),F=n.ap(d[2],0,1),z=n.a6.vec4.lerp(n.a6.vec4.create(),C,A,O),j=Math.tan(.5*t.fovX),W=-z[2]*j;if(R===0)return z[1]<-Math.abs(W)?F:1;let q=(-Math.abs(W)-z[1])/R,X=(Q,re,ie)=>(1-ie)*Q+ie*re,Z=n.ap(X(1,F,q),F,1);return X(1,Z,n.ap((t.pitch-20)/20,0,1))}class Es{}class qu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,d){{let F=this._storage.get(o.id);if(F)return F.lastUsedFrameIdx=t,F.buf}let g=d.gl,y=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),x=new ArrayBuffer(y),C=new Int16Array(x);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));let A=new n.dk;for(let F=0;F<y/2;F+=3){let z=C[F],j=C[F+1],W=C[F+2];A.emplaceBack(z,j),A.emplaceBack(j,W),A.emplaceBack(W,z)}let O=d.bindVertexArrayOES.current,R=new Es;return R.buf=new ws(d,A),R.lastUsedFrameIdx=t,this._storage.set(o.id,R),d.bindVertexArrayOES.set(O),R.buf}update(t){for(let[o,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(o))}destroy(){for(let[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class tl{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}class of{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let mc={symbol:function(h,t,o,d,g){if(h.renderPass!=="translucent")return;let y=jt.disabled,x=h.colorModeForRenderPass(),C=o.layout.get("text-variable-anchor"),A=o.layout.get("text-size-scale-range"),O=n.ap(h.scaleFactor,A[0],A[1]);C&&function(z,j,W,q,X,Z,Q,re){let ie=j.transform,ae=X==="map",ue=Z==="map";for(let le of z){let he=q.getTile(le),me=he.getBucket(W);if(!me||!me.text||!me.text.segments.get().length)continue;let xe=n.bk(me.textSizeData,ie.zoom,re),_e=ys(le,me.getProjection(),ie),ge=ie.calculatePixelsToTileUnitsMatrix(he),Oe=cn(_e,he.tileID.canonical,ue,ae,ie,me.getProjection(),ge),Be=me.hasIconTextFit()&&me.hasIconData();if(xe){let qe=Math.pow(2,ie.zoom-he.tileID.overscaledZ);Zd(me,ae,ue,Q,n.cS,ie,Oe,le,qe,xe,Be)}}}(d,h,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),g,O);let R=o.paint.get("icon-opacity").constantOr(1)!==0,F=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(R||F)?hc(h,t,o,d,y,x):(R&&hc(h,t,o,d,y,x,{onlyIcons:!0}),F&&hc(h,t,o,d,y,x,{onlyText:!0})),t.map.showCollisionBoxes&&(Wd(h,t,o,d,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Wd(h,t,o,d,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,o,d){if(h.renderPass!=="translucent")return;let g=o.paint.get("circle-opacity"),y=o.paint.get("circle-stroke-width"),x=o.paint.get("circle-stroke-opacity"),C=o.layout.get("circle-sort-key").constantOr(1)!==void 0,A=o.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(y.constantOr(1)===0||x.constantOr(1)===0))return;let O=h.context,R=O.gl,F=h.transform,z=h.depthModeForSublayer(0,It.ReadOnly),j=jt.disabled,W=h.colorModeForDrapableLayerRenderPass(A),q=F.projection.name==="globe",X=[n.am(F.center.lng),n.at(F.center.lat)],Z=[];for(let re=0;re<d.length;re++){let ie=d[re],ae=t.getTile(ie),ue=ae.getBucket(o);if(!ue||ue.projection.name!==F.projection.name)continue;let le=ue.programConfigurations.get(o.id),he=n.cT(o),me=h.isTileAffectedByFog(ie);q&&he.push("PROJECTION_GLOBE_VIEW"),he.push("DEPTH_D24"),h.terrain&&F.depthOcclusionForSymbolsAndCircles&&he.push("DEPTH_OCCLUSION");let xe=h.getOrCreateProgram("circle",{config:le,defines:he,overrideFog:me}),_e=ue.layoutVertexBuffer,ge=ue.globeExtVertexBuffer,Oe=ue.indexBuffer,Be=F.projection.createInversionMatrix(F,ie.canonical),qe={programConfiguration:le,program:xe,layoutVertexBuffer:_e,globeExtVertexBuffer:ge,indexBuffer:Oe,uniformValues:n.cU(h,ie,ae,Be,X,o),tile:ae};if(C){let Ke=ue.segments.get();for(let nt of Ke)Z.push({segments:new n.b2([nt]),sortKey:nt.sortKey,state:qe})}else Z.push({segments:ue.segments,sortKey:0,state:qe})}C&&Z.sort((re,ie)=>re.sortKey-ie.sortKey);let Q={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(let re of Z){let{programConfiguration:ie,program:ae,layoutVertexBuffer:ue,globeExtVertexBuffer:le,indexBuffer:he,uniformValues:me,tile:xe}=re.state,_e=re.segments;h.terrain&&h.terrain.setupElevationDraw(xe,ae,Q),h.uploadCommonUniforms(O,ae,xe.tileID.toUnwrapped()),ae.draw(h,R.TRIANGLES,z,j,W,Lt.disabled,me,o.id,ue,he,_e,o.paint,F.zoom,ie,[le])}},heatmap:function(h,t,o,d){if(o.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){let g=h.context,y=g.gl,x=jt.disabled,C=new Qt([y.ONE,y.ONE,y.ONE,y.ONE],n.bA.transparent,[!0,!0,!0,!0]);(function(j,W,q,X){let Z=j.gl,Q=W.width*X,re=W.height*X;j.activeTexture.set(Z.TEXTURE1),j.viewport.set([0,0,Q,re]);let ie=q.heatmapFbo;if(!ie||ie&&(ie.width!==Q||ie.height!==re)){ie&&ie.destroy();let ae=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,ae),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),ie=q.heatmapFbo=j.createFramebuffer(Q,re,!0,null),function(ue,le,he,me,xe,_e){let ge=ue.gl;ge.texImage2D(ge.TEXTURE_2D,0,ue.extRenderToTextureHalfFloat?ge.RGBA16F:ge.RGBA,xe,_e,0,ge.RGBA,ue.extRenderToTextureHalfFloat?ge.HALF_FLOAT:ge.UNSIGNED_BYTE,null),me.colorAttachment.set(he)}(j,0,ae,ie,Q,re)}else Z.bindTexture(Z.TEXTURE_2D,ie.colorAttachment.get()),j.bindFramebuffer.set(ie.framebuffer)})(g,h,o,h.transform.projection.name==="globe"?.5:.25),g.clear({color:n.bA.transparent});let A=h.transform,O=A.projection.name==="globe",R=O?["PROJECTION_GLOBE_VIEW"]:[],F=O?Lt.frontCCW:Lt.disabled,z=[n.am(A.center.lng),n.at(A.center.lat)];for(let j=0;j<d.length;j++){let W=d[j];if(t.hasRenderableParent(W))continue;let q=t.getTile(W),X=q.getBucket(o);if(!X||X.projection.name!==A.projection.name)continue;let Z=h.isTileAffectedByFog(W),Q=X.programConfigurations.get(o.id),re=h.getOrCreateProgram("heatmap",{config:Q,defines:R,overrideFog:Z}),{zoom:ie}=h.transform;h.terrain&&h.terrain.setupElevationDraw(q,re),h.uploadCommonUniforms(g,re,W.toUnwrapped());let ae=A.projection.createInversionMatrix(A,W.canonical);re.draw(h,y.TRIANGLES,It.disabled,x,C,F,Ud(h,W,q,ae,z,ie,o.paint.get("heatmap-intensity")),o.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,o.paint,h.transform.zoom,Q,O?[X.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,y){let x=g.context,C=x.gl,A=y.heatmapFbo;if(!A)return;x.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,A.colorAttachment.get()),x.activeTexture.set(C.TEXTURE1);let O=y.colorRampTexture;O||(O=y.colorRampTexture=new n.T(x,y.colorRamp,C.RGBA8)),O.bind(C.LINEAR,C.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,C.TRIANGLES,It.disabled,jt.disabled,g.colorModeForRenderPass(),Lt.disabled,((R,F,z,j)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,y),y.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,y.paint,g.transform.zoom)}(h,o))},line:function(h,t,o,d){if(h.renderPass!=="translucent")return;let g=o.paint.get("line-opacity"),y=o.paint.get("line-width");if(g.constantOr(1)===0||y.constantOr(1)===0)return;let x=o.paint.get("line-emissive-strength"),C=o.paint.get("line-occlusion-opacity"),A=o.layout.get("line-elevation-reference")==="sea",O=h.context,R=O.gl,F=!o.isDraped();if(F&&h.transform.projection.name==="globe")return;let z=o.layout.get("line-cross-slope"),j=z!==void 0,W=z<1,q=F?new It(h.depthOcclusion?R.GREATER:R.LEQUAL,It.ReadOnly,h.depthRangeFor3D):h.depthModeForSublayer(0,It.ReadOnly),X=h.colorModeForDrapableLayerRenderPass(x),Z=h.terrain&&h.terrain.renderingToTexture,Q=Z?1:n.q.devicePixelRatio,re=o.paint.get("line-dasharray"),ie=re.constantOr(1),ae=o.layout.get("line-cap"),ue=re.constantOr(null),le=ae.constantOr(null),he=o.paint.get("line-pattern"),me=he.constantOr(1),xe=he.constantOr(null),_e=o.paint.get("line-opacity").constantOr(1),ge=!me&&_e!==1||h.depthOcclusion&&C>0&&C<1,Oe=o.paint.get("line-gradient"),Be=me?"linePattern":"line",qe=n.cV(o),Ke;if(Z&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(ge=!1),C!==0&&h.depthOcclusion){let Se=o.paint._values["line-opacity"];Se&&Se.value&&Se.value.kind==="constant"?Ke=Se.value:n.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}if(F&&(h.forceTerrainMode=!0),!F&&C!==0&&h.terrain&&!Z)return void n.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`);let nt=ge&&F?h.stencilModeFor3D():jt.disabled;F&&(qe.push("ELEVATED"),j&&qe.push(W?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),A&&qe.push("ELEVATION_REFERENCE_SEA"));for(let Se of d){let Ge=t.getTile(Se);if(me&&!Ge.patternsLoaded())continue;let Le=Ge.getBucket(o);if(!Le)continue;h.prepareDrawTile();let He=Le.programConfigurations.get(o.id),Ze=h.isTileAffectedByFog(Se),$e=h.getOrCreateProgram(Be,{config:He,defines:qe,overrideFog:Ze,overrideRtt:!F&&void 0});if(xe&&Ge.imageAtlas){let lt=Ge.imageAtlas.patternPositions[xe.toString()];lt&&He.setConstantPatternPositions(lt)}if(!me&&ue&&le&&Ge.lineAtlas){let lt=Ge.lineAtlas.getDash(ue,le);lt&&He.setConstantPatternPositions(lt)}let[st,yt]=o.paint.get("line-trim-offset");(le==="round"||le==="square")&&st!==yt&&(st===0&&(st-=1),yt===1&&(yt+=1));let bt=Z?Se.projMatrix:null,dt=me?n.cW(h,Ge,o,bt,Q,[st,yt]):n.cX(h,Ge,o,bt,Le.lineClipsArray.length,Q,[st,yt]);if(Oe){let lt=Le.gradients[o.id],Dt=lt.texture;if(o.gradientVersion!==lt.version){let Ut=256;if(o.stepInterpolant){let tn=t.getSource().maxzoom,zn=Se.canonical.z===tn?Math.ceil(1<<h.transform.maxZoom-Se.canonical.z):1;Ut=n.ap(n.cY(Le.maxLineLength/n.ab*1024*zn),256,O.maxTextureSize)}lt.gradient=n.cZ({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Ut,image:lt.gradient||void 0,clips:Le.lineClipsArray}),lt.texture?lt.texture.update(lt.gradient):lt.texture=new n.T(O,lt.gradient,R.RGBA8),lt.version=o.gradientVersion,Dt=lt.texture}O.activeTexture.set(R.TEXTURE1),Dt.bind(o.stepInterpolant?R.NEAREST:R.LINEAR,R.CLAMP_TO_EDGE)}ie&&(O.activeTexture.set(R.TEXTURE0),Ge.lineAtlasTexture&&Ge.lineAtlasTexture.bind(R.LINEAR,R.REPEAT),He.updatePaintBuffers()),me&&(O.activeTexture.set(R.TEXTURE0),Ge.imageAtlasTexture&&Ge.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),He.updatePaintBuffers()),F&&!A&&h.terrain.setupElevationDraw(Ge,$e),h.uploadCommonUniforms(O,$e,Se.toUnwrapped());let Tt=lt=>{Ke!=null&&(Ke.value=_e*C),$e.draw(h,R.TRIANGLES,q,lt,X,Lt.disabled,dt,o.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,o.paint,h.transform.zoom,He,[Le.layoutVertexBuffer2,Le.patternVertexBuffer,Le.zOffsetVertexBuffer]),Ke!=null&&(Ke.value=_e)};if(ge&&!F){let lt=h.stencilModeForClipping(Se).ref;lt===0&&Z&&O.clear({stencil:0});let Dt={func:R.EQUAL,mask:255};dt.u_alpha_discard_threshold=.8,Tt(new jt(Dt,lt,255,R.KEEP,R.KEEP,R.INVERT)),dt.u_alpha_discard_threshold=0,Tt(new jt(Dt,lt,255,R.KEEP,R.KEEP,R.KEEP))}else ge&&F&&(dt.u_alpha_discard_threshold=.001),Tt(F?nt:h.stencilModeForClipping(Se))}F&&(h.forceTerrainMode=!1),ge&&(h.resetStencilClippingMasks(),Z&&O.clear({stencil:0})),C===0||h.depthOcclusion||Z||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,o,d){let g=o.paint.get("fill-color"),y=o.paint.get("fill-opacity"),x=o.is3D(),C=new It(h.context.gl.LEQUAL,It.ReadWrite,h.depthRangeFor3D);if(y.constantOr(1)===0)return;let A=o.paint.get("fill-emissive-strength"),O=h.colorModeForDrapableLayerRenderPass(A),R=o.paint.get("fill-pattern"),F=h.opaquePassEnabledForLayer()&&!R.constantOr(1)&&g.constantOr(n.bA.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===F){let z=x?C:h.depthModeForSublayer(1,h.renderPass==="opaque"?It.ReadWrite:It.ReadOnly);Vu(h,t,o,d,z,O,!1)}if(!x&&h.renderPass==="translucent"&&o.paint.get("fill-antialias")){let z=x?C:h.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,It.ReadOnly);Vu(h,t,o,d,z,O,!0)}},"fill-extrusion":function(h,t,o,d){let g=o.paint.get("fill-extrusion-opacity"),y=h.context,x=y.gl,C=h.terrain,A=C&&C.renderingToTexture;if(g===0)return;let O=h.conflationActive&&h.style.isLayerClipped(o,t.getSource()),R=h.style.order.indexOf(o.fqid);if(O&&function(F,z,j,W,q){for(let X of W){let Z=z.getTile(X).getBucket(j);Z&&(Z.updateReplacement(X,F.replacementSource,q),Z.uploadCentroid(F.context))}}(h,t,o,d,R),C||O)for(let F of d){let z=t.getTile(F).getBucket(o);z&&Nm(h.context,t,F,z,o,C,O)}if(h.renderPass==="shadow"&&h.shadowRenderer){let F=h.shadowRenderer;if(C&&g<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.a4)return;let z=F.getShadowPassDepthMode(),j=F.getShadowPassColorMode();Gr(h,t,o,d,z,jt.disabled,j,O)}else if(h.renderPass==="translucent"){let F=!o.paint.get("fill-extrusion-pattern").constantOr(1),z=o.paint.get("fill-extrusion-color").constantOr(n.bA.white);if(!A&&z.a!==0){let j=new It(h.context.gl.LEQUAL,It.ReadWrite,h.depthRangeFor3D);g===1&&F?Gr(h,t,o,d,j,jt.disabled,Qt.unblended,O):(Gr(h,t,o,d,j,jt.disabled,Qt.disabled,O),Gr(h,t,o,d,j,h.stencilModeFor3D(),h.colorModeForRenderPass(),O),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&F&&(!C&&h.transform.projection.name!=="globe"||A)){let j=o.paint.get("fill-extrusion-opacity"),W=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=o.paint.get("fill-extrusion-flood-light-intensity"),Z=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(o.lut).toArray01().slice(0,3),Q=W>0&&q>0,re=X>0,ie=(ue,le,he)=>(1-he)*ue+he*le,ae=ue=>{let le=h.depthModeForSublayer(1,It.ReadOnly,x.LEQUAL,!0),he=o.paint.get(ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),me=ie(.1,3,he),xe=h._showOverdrawInspector;if(!xe){let _e=new jt({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),ge=new Qt([x.ONE,x.ONE,x.ONE,x.ONE],n.bA.transparent,[!1,!1,!1,!0],x.MIN);Di(h,t,o,d,le,_e,ge,Lt.disabled,ue,"sdf",j,W,q,X,Z,me,O,!1)}{let _e=xe?jt.disabled:new jt({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),ge=xe?h.colorModeForRenderPass():new Qt([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],n.bA.transparent,[!0,!0,!0,!0]);Di(h,t,o,d,le,_e,ge,Lt.disabled,ue,"color",j,W,q,X,Z,me,O,!1)}};if(A){let ue=(le,he,me)=>{let xe=h.depthModeForSublayer(1,It.ReadOnly,x.LEQUAL,!1),_e=o.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ge=ie(.1,3,_e);{let Oe=new Qt([x.ONE,x.ONE,x.ONE,x.ONE],n.bA.transparent,[!1,!1,!1,!0]);Di(h,t,o,d,xe,jt.disabled,Oe,Lt.disabled,le,"clear",j,W,q,X,Z,ge,O,he)}{let Oe=new jt({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Be=new Qt([x.ONE,x.ONE,x.ONE,x.ONE],n.bA.transparent,[!1,!1,!1,!0],x.MIN);Di(h,t,o,d,xe,Oe,Be,Lt.disabled,le,"sdf",j,W,q,X,Z,ge,O,he)}{let Oe=le?x.ZERO:x.ONE_MINUS_DST_ALPHA,Be=new jt({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),qe=new Qt([Oe,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],n.bA.transparent,[!0,!0,!0,!0]);Di(h,t,o,d,xe,Be,qe,Lt.disabled,le,"color",j,W,q,X,Z,ge,O,he)}{let Oe=new Qt([x.ONE,x.ONE,x.ONE,le?x.ZERO:x.ONE],n.bA.transparent,[!1,!1,!1,!0],le?x.FUNC_ADD:x.MAX);Di(h,t,o,d,xe,jt.disabled,Oe,Lt.disabled,le,"clear",j,W,q,X,Z,ge,O,he,me)}};if(Q||re){let le;if(h.prepareDrawTile(),C){let he=C.drapeBufferSize[0],me=C.drapeBufferSize[1];le=C.framebufferCopyTexture,le&&(!le||le.size[0]===he&&le.size[1]===me)||(le&&le.destroy(),le=C.framebufferCopyTexture=new n.T(y,new n.r({width:he,height:me}),x.RGBA8)),le.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,he,me)}Q&&ue(!0,!1,le),re&&ue(!1,!0,le)}}else Q&&ae(!0),re&&ae(!1),(Q||re)&&h.resetStencilClippingMasks()}}},hillshade:function(h,t,o,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;let g=h.context,y=h.terrain&&h.terrain.renderingToTexture,[x,C]=h.renderPass!=="translucent"||y?[{},d]:h.stencilConfigForOverlap(d);for(let A of C){let O=t.getTile(A);if(O.needsHillshadePrepare&&h.renderPass==="offscreen")Ha(h,O,o);else if(h.renderPass==="translucent"){let R=h.depthModeForSublayer(0,It.ReadOnly),F=o.paint.get("hillshade-emissive-strength"),z=h.colorModeForDrapableLayerRenderPass(F),j=y&&h.terrain?h.terrain.stencilModeForRTTOverlap(A):x[A.overscaledZ];Du(h,A,O,o,R,j,z)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,o,d,g,y){if(h.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;let x=h.transform.projection.name==="globe",C=o.paint.get("raster-elevation")!==0,A=C&&x;if(h.renderElevatedRasterBackface&&!A)return;let O=h.context,R=O.gl,F=t.getSource(),z=function(ue,le,he,me){let xe=le.paint.get("raster-color"),_e=ue.type==="raster-array",ge=[],Oe=le.paint.get("raster-resampling"),Be=le.paint.get("raster-color-mix"),qe=le.paint.get("raster-color-range"),Ke=[Be[0],Be[1],Be[2],0],nt=Be[3],Se=Oe==="nearest"?me.NEAREST:me.LINEAR;if(_e&&(ge.push("RASTER_ARRAY"),xe||ge.push("RASTER_COLOR"),Oe==="linear"&&ge.push("RASTER_ARRAY_LINEAR"),Se=me.NEAREST,!qe&&ue.rasterLayers)){let Ge=ue.rasterLayers.find(({id:Le})=>Le===le.sourceLayer);Ge&&Ge.fields&&Ge.fields.range&&(qe=Ge.fields.range)}if(qe=qe||[0,1],xe){ge.push("RASTER_COLOR"),he.activeTexture.set(me.TEXTURE2),le.updateColorRamp(qe);let Ge=le.colorRampTexture;Ge||(Ge=le.colorRampTexture=new n.T(he,le.colorRamp,me.RGBA8)),Ge.bind(me.LINEAR,me.CLAMP_TO_EDGE)}return{mix:Ke,range:qe,offset:nt,defines:ge,resampling:Se}}(F,o,O,R);if(F instanceof n.aD&&!d.length&&!x)return;let j=o.paint.get("raster-emissive-strength"),W=h.colorModeForDrapableLayerRenderPass(j),q=h.terrain&&h.terrain.renderingToTexture,X=!h.options.moving,Z=o.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;if(F instanceof n.aD&&!d.length&&(F.onNorthPole||F.onSouthPole)){let ue=C?h.stencilModeFor3D():jt.disabled;return void ar(!!F.onNorthPole,null,h,t,o,j,z,Lt.disabled,ue)}if(!d.length)return;let[Q,re]=F instanceof n.aD||q?[{},d]:h.stencilConfigForOverlap(d),ie=re[re.length-1].overscaledZ;A&&z.defines.push("PROJECTION_GLOBE_VIEW"),C&&z.defines.push("RENDER_CUTOFF");let ae=(ue,le,he)=>{for(let me of ue){let xe=me.toUnwrapped(),_e=t.getTile(me);if(q&&(!_e||!_e.hasData()))continue;O.activeTexture.set(R.TEXTURE0);let ge=Kd(_e,F,o,z);if(!ge||!ge.texture)continue;let{texture:Oe,mix:Be,offset:qe,tileSize:Ke,buffer:nt}=ge,Se,Ge;q?(Se=It.disabled,Ge=me.projMatrix):C?(Se=new It(R.LEQUAL,It.ReadWrite,h.depthRangeFor3D),Ge=x?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(xe,X)):(Se=h.depthModeForSublayer(me.overscaledZ-ie,o.paint.get("raster-opacity")===1?It.ReadWrite:It.ReadOnly,R.LESS),Ge=h.transform.calculateProjMatrix(xe,X));let Le=h.terrain&&q?h.terrain.stencilModeForRTTOverlap(me):Q[me.overscaledZ],He=y?0:o.paint.get("raster-fade-duration");_e.registerFadeDuration(He);let Ze=t.findLoadedParent(me,0),$e=Ou(_e,Ze,t,h.transform,He),st,yt;h.terrain&&h.terrain.prepareDrawTile(),O.activeTexture.set(R.TEXTURE0),Oe.bind(Z,R.CLAMP_TO_EDGE),O.activeTexture.set(R.TEXTURE1),Ze?(Ze.texture&&Ze.texture.bind(Z,R.CLAMP_TO_EDGE),st=Math.pow(2,Ze.tileID.overscaledZ-_e.tileID.overscaledZ),yt=[_e.tileID.canonical.x*st%1,_e.tileID.canonical.y*st%1]):Oe.bind(Z,R.CLAMP_TO_EDGE),Oe.useMipmap&&O.extTextureFilterAnisotropic&&h.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);let bt=h.transform,dt,Tt=C?ju(bt):[0,0,0,0],lt,Dt,Ut,tn,zn,fn=0;if(A&&F instanceof n.aD&&F.coordinates.length>3)lt=Float32Array.from(n.b6(n.cC(new n.bQ(0,0,0)))),Dt=Float32Array.from(bt.globeMatrix),Ut=Float32Array.from(n.cy(bt)),tn=[n.am(bt.center.lng),n.at(bt.center.lat)],dt=F.elevatedGlobePerspectiveTransform,zn=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){let Jt=n.cz(me.canonical);fn=n.cA(Jt.getCenter().lat),lt=Float32Array.from(n.b6(n.cC(me.canonical))),Dt=Float32Array.from(bt.globeMatrix),Ut=Float32Array.from(n.cy(bt)),tn=[n.am(bt.center.lng),n.at(bt.center.lat)],dt=[0,0],zn=Float32Array.from(n.cB(me.canonical,Jt,fn,bt.worldSize/bt._pixelsPerMercatorPixel))}else dt=F instanceof n.aD?F.perspectiveTransform:[0,0],lt=new Float32Array(16),Dt=new Float32Array(9),Ut=new Float32Array(16),tn=[0,0],zn=new Float32Array(9);let qn=Fu(Ge,lt,Dt,Ut,zn,yt||[0,0],n.a9(h.transform.zoom),tn,Tt,st||1,$e,o,dt,C?o.paint.get("raster-elevation"):0,2,Be,qe,z.range,Ke,nt,j),bn=h.isTileAffectedByFog(me),Bn=h.getOrCreateProgram("raster",{defines:z.defines,overrideFog:bn});if(h.uploadCommonUniforms(O,Bn,xe),F instanceof n.aD){let Jt=F.elevatedGlobeVertexBuffer,kn=F.elevatedGlobeIndexBuffer;if(q||!x)F.boundsBuffer&&F.boundsSegments&&Bn.draw(h,R.TRIANGLES,Se,jt.disabled,W,Lt.disabled,qn,o.id,F.boundsBuffer,h.quadTriangleIndexBuffer,F.boundsSegments);else if(Jt&&kn){let On=bt.zoom<=n.c3?F.elevatedGlobeSegments:F.getSegmentsForLongitude(bt.center.lng);On&&Bn.draw(h,R.TRIANGLES,Se,jt.disabled,W,le,qn,o.id,Jt,kn,On)}}else if(A){Se=new It(R.LEQUAL,It.ReadOnly,h.depthRangeFor3D);let Jt=h.globeSharedBuffers;if(Jt){let[kn,On,Tn]=Jt.getGridBuffers(fn,!1);Bn.draw(h,R.TRIANGLES,Se,he||Le,h.colorModeForRenderPass(),le,qn,o.id,kn,On,Tn)}}else{let{tileBoundsBuffer:Jt,tileBoundsIndexBuffer:kn,tileBoundsSegments:On}=h.getTileBoundsBuffers(_e);Bn.draw(h,R.TRIANGLES,Se,Le,W,Lt.disabled,qn,o.id,Jt,kn,On)}}if(!(F instanceof n.aD)&&A)for(let me of ue){let xe=me.canonical.y===(1<<me.canonical.z)-1;me.canonical.y===0&&ar(!0,me,h,t,o,j,z,le,he||jt.disabled),xe&&ar(!1,me,h,t,o,j,z,le===Lt.frontCW?Lt.backCW:Lt.frontCW,he||jt.disabled)}};A?ae(re,h.renderElevatedRasterBackface?Lt.backCW:Lt.frontCW,h.stencilModeFor3D()):ae(re,Lt.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,o,d,g,y){h.renderPass==="offscreen"&&function(x,C,A,O){if(!O.length)return;let R=x.context,F=R.gl,z=C.getSource();if(!(z instanceof po))return;let j=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count"))),W=A.particlePositionRGBAImage;if(!W||W.width!==j){let re=function(ie){let ae=ie*ie,ue=new Uint8Array(4*ae),le=function(me){return me|=0,me=Math.imul(2747636419^me,2654435769),me=Math.imul(me^me>>>16,2654435769),((me=Math.imul(me^me>>>16,2654435769))>>>0)/4294967296},he=1/1.1;for(let me=0;me<ae;me++){let xe=he*(le(2*me+0)+Qs),_e=he*(le(2*me+1)+Qs),ge=255*xe%1,Oe=255*_e%1,Be=ge,qe=_e-Oe/255,Ke=Oe;ue[4*me+0]=255*(xe-ge/255),ue[4*me+1]=255*Be,ue[4*me+2]=255*qe,ue[4*me+3]=255*Ke}return ue}(j);W=A.particlePositionRGBAImage=new n.r({width:j,height:j},re)}let q=A.particleFramebuffer;q?q.width!==j&&(q.destroy(),q=A.particleFramebuffer=R.createFramebuffer(j,j,!0,null)):q=A.particleFramebuffer=R.createFramebuffer(j,j,!0,null);let X=[];for(let re of O){let ie=C.getTile(re);if(!(ie instanceof uu))continue;let ae=jm(ie,z,A);if(!ae)continue;let ue=[ie.tileSize,ie.tileSize],le=A.tileFramebuffer;le||(le=A.tileFramebuffer=R.createFramebuffer(ue[0],ue[1],!0,null));let he=ie.rasterParticleState;he||(he=ie.rasterParticleState=new Vm(R,re,ue,W));let me=he.update(A.lastInvalidatedAt);he.particleTextureDimension!==j&&he.updateParticleTexture(re,W);let xe=he.targetColorTexture;he.targetColorTexture=he.backgroundColorTexture,he.backgroundColorTexture=xe;let _e=he.particleTexture0;he.particleTexture0=he.particleTexture1,he.particleTexture1=_e,X.push([re,ae,he,me])}if(X.length===0)return;let Z=n.q.now(),Q=A.previousDrawTimestamp?.001*(Z-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=Z,A.hasColorMap()){R.activeTexture.set(F.TEXTURE0+2);let re=A.colorRampTexture;re||(re=A.colorRampTexture=new n.T(R,A.colorRamp,F.RGBA8)),re.bind(F.LINEAR,F.CLAMP_TO_EDGE)}R.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(re,ie,ae){let ue=re.context,le=ue.gl,he=ie.tileFramebuffer;ue.activeTexture.set(le.TEXTURE0);let me={u_texture:0,u_opacity:1.05*(_e=ie.paint.get("raster-particle-fade-opacity-factor"))/(_e+.05)},xe=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var _e;for(let ge of ae){let[,,Oe,Be]=ge;he.colorAttachment.set(Oe.targetColorTexture.texture),ue.viewport.set([0,0,he.width,he.height]),ue.clear({color:n.bA.transparent}),Be&&(Oe.backgroundColorTexture.bind(le.NEAREST,le.CLAMP_TO_EDGE),xe.draw(re,le.TRIANGLES,It.disabled,jt.disabled,Qt.alphaBlended,Lt.disabled,me,ie.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}}(x,A,X),function(re,ie,ae,ue){let le=re.context,he=le.gl,me=ae.tileFramebuffer,xe=re.transform.projection.name==="globe",_e=ae.paint.get("raster-particle-max-speed");for(let ge of ue){let[Oe,Be,qe]=ge;le.activeTexture.set(he.TEXTURE0+0),Be.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),me.colorAttachment.set(qe.targetColorTexture.texture);let Ke=re.getOrCreateProgram("rasterParticleDraw",{defines:Be.defines,overrideFog:!1});le.activeTexture.set(he.TEXTURE0+1);let nt=Be.scalarData?[]:[0,1,2,3].map(Le=>n.c$[Le](Oe));nt.push(Oe);let Se=Oe.canonical.x,Ge=Oe.canonical.y;for(let Le of nt){let He=ie.getTile(xe?Le.wrapped():Le);if(!He)continue;let Ze=He.rasterParticleState;if(!Ze)continue;let $e=Le.canonical.x+(1<<Le.canonical.z)*(Le.wrap-Oe.wrap),st=Le.canonical.y;Ze.particleTexture0.bind(he.NEAREST,he.CLAMP_TO_EDGE);let yt=zu(1,Ze.particleTexture0.size[0],[$e-Se,st-Ge],0,Be.texture.size,2,_e,Be.textureOffset,Be.scale,Be.offset);Ke.draw(re,he.POINTS,It.disabled,jt.disabled,Qt.alphaBlended,Lt.disabled,yt,ae.id,Ze.particleIndexBuffer,void 0,Ze.particleSegment)}}}(x,C,A,X),R.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(re,ie,ae,ue){let le=re.context,he=le.gl,me=ie.paint.get("raster-particle-max-speed"),xe=ue*ie.paint.get("raster-particle-speed-factor")*.15,_e=function(Oe){return Math.pow(Oe,6)}(.01+1*ie.paint.get("raster-particle-reset-rate-factor")),ge=ie.particleFramebuffer;le.viewport.set([0,0,ge.width,ge.height]);for(let Oe of ae){let[,Be,qe]=Oe;le.activeTexture.set(he.TEXTURE0+0),Be.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),le.activeTexture.set(he.TEXTURE0+1);let Ke=qe.particleTexture0;Ke.bind(he.NEAREST,he.CLAMP_TO_EDGE);let nt=$d(1,Ke.size[0],0,Be.texture.size,me,xe,_e,Be.textureOffset,Be.scale,Be.offset);ge.colorAttachment.set(qe.particleTexture1.texture),le.clear({color:n.bA.transparent}),re.getOrCreateProgram("rasterParticleUpdate",{defines:Be.defines}).draw(re,he.TRIANGLES,It.disabled,jt.disabled,Qt.unblended,Lt.disabled,nt,ie.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments)}}(x,A,X,Q)}(h,t,o,d),h.renderPass==="translucent"&&(function(x,C,A,O,R){let F=x.context,z=F.gl,j=C.getSource().tileSize,W=5*(1-n.a7(n.bV,n.bV+1,x.transform.zoom))*j+A.paint.get("raster-particle-elevation"),q=!x.options.moving,X=x.transform.projection.name==="globe";if(!O.length)return;let[Z,Q]=x.stencilConfigForOverlap(O),re=[];X&&re.push("PROJECTION_GLOBE_VIEW");let ie=x.stencilModeFor3D();for(let ae of Q){let ue=ae.toUnwrapped(),le=C.getTile(ae);if(!le.rasterParticleState)continue;let he=le.rasterParticleState,me=100;le.registerFadeDuration(me);let xe=C.findLoadedParent(ae,0),_e=Ou(le,xe,C,x.transform,me),ge,Oe;x.terrain&&x.terrain.prepareDrawTile(),F.activeTexture.set(z.TEXTURE0),he.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),F.activeTexture.set(z.TEXTURE1),xe&&xe.rasterParticleState?(xe.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ge=Math.pow(2,xe.tileID.overscaledZ-le.tileID.overscaledZ),Oe=[le.tileID.canonical.x*ge%1,le.tileID.canonical.y*ge%1]):he.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);let Be=X?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(ue,q),qe=x.transform,Ke=_v(qe),nt=n.cz(ae.canonical),Se=n.cA(nt.getCenter().lat),Ge,Le,He,Ze,$e;X?(Ge=Float32Array.from(n.b6(n.cC(ae.canonical))),Le=Float32Array.from(qe.globeMatrix),He=Float32Array.from(n.cy(qe)),Ze=[n.am(qe.center.lng),n.at(qe.center.lat)],$e=Float32Array.from(n.cB(ae.canonical,nt,Se,qe.worldSize/qe._pixelsPerMercatorPixel))):(Ge=new Float32Array(16),Le=new Float32Array(9),He=new Float32Array(16),Ze=[0,0],$e=new Float32Array(9));let st=Nu(Be,Ge,Le,He,$e,Oe||[0,0],n.a9(x.transform.zoom),Ze,Ke,ge||1,_e,W),yt=x.isTileAffectedByFog(ae),bt=x.getOrCreateProgram("rasterParticle",{defines:re,overrideFog:yt});if(x.uploadCommonUniforms(F,bt,ue),X){let dt=new It(z.LEQUAL,It.ReadOnly,x.depthRangeFor3D),Tt=0,lt=x.globeSharedBuffers;if(lt){let[Dt,Ut,tn]=lt.getGridBuffers(Se,Tt!==0);bt.draw(x,z.TRIANGLES,dt,ie,Qt.alphaBlended,x.renderElevatedRasterBackface?Lt.frontCCW:Lt.backCCW,st,A.id,Dt,Ut,tn)}}else{let dt=x.depthModeForSublayer(0,It.ReadOnly),Tt=Z[ae.overscaledZ],{tileBoundsBuffer:lt,tileBoundsIndexBuffer:Dt,tileBoundsSegments:Ut}=x.getTileBoundsBuffers(le);bt.draw(x,z.TRIANGLES,dt,Tt,Qt.alphaBlended,Lt.disabled,st,A.id,lt,Dt,Ut)}}x.resetStencilClippingMasks()}(h,t,o,d),h.style.map.triggerRepaint())},background:function(h,t,o,d){let g=o.paint.get("background-color"),y=o.paint.get("background-opacity"),x=o.paint.get("background-emissive-strength"),C=o.paint.get("background-pitch-alignment")==="viewport";if(y===0)return;let A=h.context,O=A.gl,R=h.transform,F=R.tileSize,z=o.paint.get("background-pattern"),j;if(z!==void 0&&(z===null||(j=h.imageManager.getPattern(z.toString(),o.scope,h.style.getLut(o.scope)),!j)))return;let W=!z&&g.a===1&&y===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==W)return;let q=jt.disabled,X=h.depthModeForSublayer(0,W==="opaque"?It.ReadWrite:It.ReadOnly),Z=h.colorModeForDrapableLayerRenderPass(x),Q=z?"backgroundPattern":"background",re,ie=d;if(ie||(re=h.getBackgroundTiles(),ie=Object.values(re).map(ae=>ae.tileID)),z&&(A.activeTexture.set(O.TEXTURE0),h.imageManager.bind(h.context,o.scope)),C){let ae=h.getOrCreateProgram(Q,{overrideFog:!1,overrideRtt:!0}),ue=new Float32Array(n.a6.mat4.identity([])),le=new n.aA(0,0,0,0,0),he=z?cc(ue,x,y,h,0,o.scope,j,C,{tileID:le,tileSize:F}):ea(ue,x,y,g.toRenderColor(o.lut));ae.draw(h,O.TRIANGLES,X,q,Z,Lt.disabled,he,o.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(let ae of ie){let ue=h.isTileAffectedByFog(ae),le=h.getOrCreateProgram(Q,{overrideFog:ue}),he=ae.toUnwrapped(),me=d?ae.projMatrix:h.transform.calculateProjMatrix(he);h.prepareDrawTile();let xe=t?t.getTile(ae):re?re[ae.key]:new go(ae,F,R.zoom,h),_e=z?cc(me,x,y,h,0,o.scope,j,C,{tileID:ae,tileSize:F}):ea(me,x,y,g.toRenderColor(o.lut));h.uploadCommonUniforms(A,le,he);let{tileBoundsBuffer:ge,tileBoundsIndexBuffer:Oe,tileBoundsSegments:Be}=h.getTileBoundsBuffers(xe);le.draw(h,O.TRIANGLES,X,q,Z,Lt.disabled,_e,o.id,ge,Oe,Be)}},sky:function(h,t,o){let d=h._atmosphere?n.a9(h.transform.zoom):1,g=o.paint.get("sky-opacity")*d;if(g===0)return;let y=h.context,x=o.paint.get("sky-type"),C=new It(y.gl.LEQUAL,It.ReadOnly,[0,1]),A=h.frameCounter/1e3%1;x==="atmosphere"?h.renderPass==="offscreen"?o.needsSkyboxCapture(h)&&(function(O,R,F,z){let j=O.context,W=j.gl,q=R.skyboxFbo;if(!q){q=R.skyboxFbo=j.createFramebuffer(32,32,!0,null),R.skyboxGeometry=new tf(j),R.skyboxTexture=j.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,R.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let re=0;re<6;++re)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(q.framebuffer),j.viewport.set([0,0,32,32]);let X=R.getCenter(O,!0),Z=O.getOrCreateProgram("skyboxCapture"),Q=new Float64Array(16);n.a6.mat4.identity(Q),n.a6.mat4.rotateY(Q,Q,.5*-Math.PI),Qi(O,R,Z,Q,X,0),n.a6.mat4.identity(Q),n.a6.mat4.rotateY(Q,Q,.5*Math.PI),Qi(O,R,Z,Q,X,1),n.a6.mat4.identity(Q),n.a6.mat4.rotateX(Q,Q,.5*-Math.PI),Qi(O,R,Z,Q,X,2),n.a6.mat4.identity(Q),n.a6.mat4.rotateX(Q,Q,.5*Math.PI),Qi(O,R,Z,Q,X,3),n.a6.mat4.identity(Q),Qi(O,R,Z,Q,X,4),n.a6.mat4.identity(Q),n.a6.mat4.rotateY(Q,Q,Math.PI),Qi(O,R,Z,Q,X,5),j.viewport.set([0,0,O.width,O.height])}(h,o),o.markSkyboxValid(h)):h.renderPass==="sky"&&function(O,R,F,z,j){let W=O.context,q=W.gl,X=O.transform,Z=O.getOrCreateProgram("skybox");W.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,R.skyboxTexture);let Q=((re,ie,ae,ue,le)=>({u_matrix:re,u_sun_direction:ie,u_cubemap:0,u_opacity:ue,u_temporal_offset:le}))(X.skyboxMatrix,R.getCenter(O,!1),0,z,j);O.uploadCommonUniforms(W,Z),Z.draw(O,q.TRIANGLES,F,jt.disabled,O.colorModeForRenderPass(),Lt.backCW,Q,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,o,C,g,A):x==="gradient"&&h.renderPass==="sky"&&function(O,R,F,z,j){let W=O.context,q=W.gl,X=O.transform,Z=O.getOrCreateProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new tf(W)),W.activeTexture.set(q.TEXTURE0);let Q=R.colorRampTexture;Q||(Q=R.colorRampTexture=new n.T(W,R.colorRamp,q.RGBA8)),Q.bind(q.LINEAR,q.CLAMP_TO_EDGE);let re=((ie,ae,ue,le,he)=>({u_matrix:ie,u_color_ramp:0,u_center_direction:ae,u_radius:n.bC(ue),u_opacity:le,u_temporal_offset:he}))(X.skyboxMatrix,R.getCenter(O,!1),R.paint.get("sky-gradient-radius"),z,j);O.uploadCommonUniforms(W,Z),Z.draw(O,q.TRIANGLES,F,jt.disabled,O.colorModeForRenderPass(),Lt.backCW,re,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,o,C,g,A)},debug:function(h,t,o,d,g,y){for(let x=0;x<o.length;x++)if(g){let O=new n.bA(d.r*.8,d.g*.8,d.b*.8,1);Zn(h,t,o[x],d,-1,-1,y),Zn(h,t,o[x],d,-1,1,y),Zn(h,t,o[x],d,1,1,y),Zn(h,t,o[x],d,1,-1,y),Zn(h,t,o[x],O,0,0,y)}else Zn(h,t,o[x],d,0,0,y)},custom:function(h,t,o,d){let g=h.context,y=o.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&o.isDraped(t)){if(h.renderPass==="offscreen"){let x=y.prerender;if(x){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){let C=h.transform.pointMerc;x.call(y,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.a9(h.transform.zoom),[C.x,C.y],h.transform.pixelsPerMeterRatio)}else x.call(y,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){let C=y.renderToTile;if(C){let A=d[0].canonical,O=new n.a5(A.x+d[0].wrap*(1<<A.z),A.y,A.z);g.setDepthMode(It.disabled),g.setStencilMode(jt.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),C.call(y,g.gl,O),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(jt.disabled);let x=y.renderingMode==="3d"?new It(h.context.gl.LEQUAL,It.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,It.ReadOnly);if(g.setDepthMode(x),h.transform.projection.name==="globe"){let C=h.transform.pointMerc;y.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.a9(h.transform.zoom),[C.x,C.y],h.transform.pixelsPerMeterRatio)}else y.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,o,d){if(h.renderPass==="opaque")return;let g=o.paint.get("model-opacity");if(g===0)return;let y=o.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!y||h.terrain&&g<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof n.a4))return;let x=h.shadowRenderer,C=o.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,C||(x.enabled=!1));let A=()=>{x&&(x.useNormalOffset=!0,C||(x.enabled=!0))},O=t.getSource();if(h.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(Z,Q,re,ie,ae){let ue=Z.transform;if(ue.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${ue.projection.name} projection is not yet implemented`);let le=ue.getFreeCameraOptions().position;if(!Z.modelManager)return;let he=Z.modelManager;re.modelManager=he;let me=Z.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let xe=re._unevaluatedLayout._values["model-id"],_e=kt({},re.layout.get("model-id").parameters),ge=Z.style.order.indexOf(re.fqid);for(let Oe of ie){let Be=Q.getTile(Oe).getBucket(re);if(!Be||Be.projection.name!==ue.projection.name)continue;let qe=Be.getModelUris();qe&&!Be.modelsRequested&&(he.addModelsFromBucket(qe,ae),Be.modelsRequested=!0);let Ke=oi(Oe,ue);_e.zoom=Ke;let nt=xe.possiblyEvaluate(_e);if($m(Z,Be,Oe),yo.shadowUniformsInitialized=!1,yo.useSingleShadowCascade=!!me&&me.getMaxCascadeForTile(Oe.toUnwrapped())===0,Z.renderPass==="shadow"&&me){if(Z.currentShadowCascade===1&&Be.isInsideFirstShadowMapFrustum)continue;let Le=ue.calculatePosMatrix(Oe.toUnwrapped(),ue.worldSize);if(yo.tileMatrix.set(Le),yo.shadowTileMatrix=Float32Array.from(me.calculateShadowPassMatrixFromMatrix(Le)),yo.aabb.min.fill(0),yo.aabb.max[0]=yo.aabb.max[1]=n.ab,yo.aabb.max[2]=0,Xn(Be,yo,Z,re.scope))continue}let Se=1<<Oe.canonical.z,Ge=[((le.x-Oe.wrap)*Se-Oe.canonical.x)*n.ab,(le.y*Se-Oe.canonical.y)*n.ab,le.z*Se*n.ab];Z.conflationActive&&Object.keys(Be.instancesPerModel).length>0&&Z.style.isLayerClipped(re,Q.getSource())&&Be.updateReplacement(Oe,Z.replacementSource,ge,ae)&&(Be.uploaded=!1,Be.upload(Z.context));for(let Le in Be.instancesPerModel){let He=Be.instancesPerModel[Le];He.features.length>0&&(Le=nt.evaluate(He.features[0].feature,{}));let Ze=he.getModel(Le,ae);if(Ze&&Ze.uploaded)for(let $e of Ze.nodes)Gm(Z,re,$e,He,Ge,Oe,yo)}}}(h,t,o,d,O.type==="vector"?o.scope:""),void A();if(!O.loaded())return;if(O.type==="batched-model")return function(Z,Q,re,ie){re.resetLayerRenderingStats(Z);let ae=Z.context,ue=Z.transform,le=Z.style.fog,he=Z.shadowRenderer;if(ue.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${ue.projection.name} projection is not yet implemented`);let me=Z.transform.getFreeCameraOptions().position,xe=n.a6.vec3.scale([],[me.x,me.y,me.z],Z.transform.worldSize),_e=n.a6.vec3.negate([],xe),ge=n.a6.mat4.identity([]),Oe=n.de(ue.center.lat,ue.zoom),Be=n.a6.mat4.fromScaling([],[1,1,1/Oe]);n.a6.mat4.translate(ge,ge,_e);let qe=re.paint.get("model-opacity"),Ke=new It(ae.gl.LEQUAL,It.ReadWrite,Z.depthRangeFor3D),nt=new It(ae.gl.LEQUAL,It.ReadOnly,Z.depthRangeFor3D),Se=new n.ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ge=Z.renderPass==="shadow",Le=Ge&&he?he.getCurrentCascadeFrustum():ue.getFrustum(ue.scaleZoom(ue.worldSize)),He=re.paint.get("model-front-cutoff"),Ze=He[2]<1,$e=jo(Z,re.paint.get("model-cutoff-fade-range")),st=re.getLayerRenderingStats();(function(yt,bt,dt,Tt){let lt=yt.terrain?yt.terrain.exaggeration():0,Dt=yt.transform.zoom;for(let Ut of Tt){let tn=bt.getTile(Ut).getBucket(dt);tn&&(yt.conflationActive&&tn.updateReplacement(Ut,yt.replacementSource),tn.evaluateScale(yt,dt),yt.terrain&&lt>0&&tn.elevationUpdate(yt.terrain,lt,Ut,dt.source),tn.needsReEvaluation(yt,Dt,dt)&&tn.evaluate(dt))}})(Z,Q,re,ie),function(){let yt,bt,dt;Ze?(yt=ie.length-1,bt=-1,dt=-1):(yt=0,bt=ie.length,dt=1);let Tt=new Float64Array(16),lt=n.a6.vec3.create(),Dt=new n.P(0,0);for(let Ut=yt;Ut!==bt;Ut+=dt){let tn=ie[Ut],zn=Q.getTile(tn).getBucket(re);if(!zn||!zn.uploaded)continue;let fn=!1;he&&(fn=he.getMaxCascadeForTile(tn.toUnwrapped())===0);let qn=ue.calculatePosMatrix(tn.toUnwrapped(),ue.worldSize),bn=zn.modelTraits;!Ge&&Ze&&(n.a6.mat4.invert(Tt,qn),n.a6.vec3.transformMat4(lt,xe,Tt),Dt.x=lt[0],Dt.y=lt[1]);let Bn=[];for(let Jt of zn.getNodesInfo()){if(Jt.hiddenByReplacement||!Jt.node.meshes)continue;let kn=Jt.node,On=0;Z.terrain&&kn.elevation&&(On=kn.elevation*Z.terrain.exaggeration());let Tn=(()=>{let fr=Jt.aabb;return Se.min=[...fr.min],Se.max=[...fr.max],Se.min[2]+=On,Se.max[2]+=On,n.a6.vec3.transformMat4(Se.min,Se.min,qn),n.a6.vec3.transformMat4(Se.max,Se.max,qn),Se})(),Qn=Jt.evaluatedScale;if(Qn[0]<=1&&Qn[1]<=1&&Qn[2]<=1&&Tn.intersects(Le)===0)continue;if(!Ge&&Ze){let fr=.16666666666666666;Jt.cameraCollisionOpacity=xe[0]>Tn.min[0]&&xe[0]<Tn.max[0]&&xe[1]>Tn.min[1]&&xe[1]<Tn.max[1]&&xe[2]*Oe<Tn.max[2]&&kn.footprint&&n.bv(Dt,kn.footprint)?Math.max(Jt.cameraCollisionOpacity-fr,0):Math.min(1,Jt.cameraCollisionOpacity+fr)}let Cr=[...qn],Mi=kn.anchor?kn.anchor[0]:0,Ni=kn.anchor?kn.anchor[1]:0;n.a6.mat4.translate(Cr,Cr,[Mi*(Qn[0]-1),Ni*(Qn[1]-1),On]),n.a6.vec3.exactEquals(Qn,n.dh)||n.a6.mat4.scale(Cr,Cr,Qn);let Rr=n.a6.mat4.multiply([],Cr,kn.matrix),hn=n.a6.mat4.multiply([],ue.expandedFarZProjMatrix,Rr),nn=n.a6.mat4.multiply([],ue.expandedFarZProjMatrix,Cr),wn=n.a6.vec4.transformMat4([],[Mi,Ni,On,1],hn)[2];kn.hidden=!1;let jn=qe;Ge||(Ze&&(jn*=Jt.cameraCollisionOpacity,jn*=Hm(Cr,ue,Jt.aabb,He)),jn*=gn($e,wn)),jn!==0?Bn.push({nodeInfo:Jt,depth:wn,opacity:jn,wvpForNode:hn,wvpForTile:nn,nodeModelMatrix:Rr,tileModelMatrix:Cr}):kn.hidden=!0}Ge||Bn.sort((Jt,kn)=>!Ze||Jt.opacity===1&&kn.opacity===1?Jt.depth<kn.depth?-1:1:Jt.opacity===1?-1:kn.opacity===1?1:Jt.depth>kn.depth?-1:1);for(let Jt of Bn){let kn=Jt.nodeInfo,On=kn.node,Tn=n.a6.mat4.multiply([],Be,Jt.tileModelMatrix);n.a6.mat4.multiply(Tn,ge,Tn);let Qn=n.a6.mat4.invert([],Tn);n.a6.mat4.transpose(Qn,Qn),n.a6.mat4.scale(Qn,Qn,pc),Tn=n.a6.mat4.multiply(Tn,Tn,On.matrix);let Cr=Z.renderPass==="light-beam",Mi=bn&n.dj.HasMapboxMeshFeatures,Ni=Mi?0:kn.evaluatedRMEA[0][2];for(let Rr=0;Rr<On.meshes.length;++Rr){let hn=On.meshes[Rr],nn=Rr===On.lightMeshIndex,wn=Jt.wvpForNode;if(nn){if(!Cr&&!Z.terrain&&Z.shadowRenderer){Z.currentLayer<Z.firstLightBeamLayer&&(Z.firstLightBeamLayer=Z.currentLayer);continue}wn=Jt.wvpForTile}else if(Cr)continue;let jn={defines:[]},fr=[];if(!Ge&&he&&(he.useNormalOffset=!!hn.normalBuffer),Gu(jn.defines,fr,hn,Z,re.lut),Mi||jn.defines.push("DIFFUSE_SHADED"),fn&&jn.defines.push("SHADOWS_SINGLE_CASCADE"),st&&(Ge?st.numRenderedVerticesInShadowPass+=hn.vertexArray.length:st.numRenderedVerticesInTransparentPass+=hn.vertexArray.length),Ge){Hu(hn,Jt.nodeModelMatrix,Z,re);continue}let er=null;if(le){let to=rf(Jt.nodeModelMatrix,Z.transform);if(er=new Float32Array(to),ue.projection.name!=="globe"){let gi=hn.aabb.min,Jo=hn.aabb.max,[Bi,Mn]=le.getOpacityForBounds(to,gi[0],gi[1],Jo[0],Jo[1]);jn.overrideFog=Bi>=Qe||Mn>=Qe}}let kr=hn.material,bo;kr.occlusionTexture&&kr.occlusionTexture.offsetScale&&(bo=kr.occlusionTexture.offsetScale,jn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let pi=Z.getOrCreateProgram("model",jn);!Ge&&he&&he.setupShadowsFromMatrix(Jt.tileModelMatrix,pi,he.useNormalOffset),Z.uploadCommonUniforms(ae,pi,null,er);let mi=kr.pbrMetallicRoughness;mi.metallicFactor=.9,mi.roughnessFactor=.5;let zi=Bu(new Float32Array(wn),new Float32Array(Tn),new Float32Array(Qn),new Float32Array(On.matrix),Z,Jt.opacity,mi.baseColorFactor.toRenderColor(null),kr.emissiveFactor,mi.metallicFactor,mi.roughnessFactor,kr,Ni,re,[0,0,0],bo);!nn&&(kn.hasTranslucentParts||Jt.opacity<1)&&pi.draw(Z,ae.gl.TRIANGLES,Ke,jt.disabled,Qt.disabled,Lt.backCCW,zi,re.id,hn.vertexBuffer,hn.indexBuffer,hn.segments,re.paint,Z.transform.zoom,void 0,fr),pi.draw(Z,ae.gl.TRIANGLES,nn?nt:Ke,jt.disabled,nn||Jt.opacity<1||kn.hasTranslucentParts?Qt.alphaBlended:Qt.unblended,Lt.backCCW,zi,re.id,hn.vertexBuffer,hn.indexBuffer,hn.segments,re.paint,Z.transform.zoom,void 0,fr)}}}}()}(h,t,o,d),void A();if(O.type!=="model")return;let R=O.getModels(),F=[],z=h.transform.getFreeCameraOptions().position,j=n.a6.vec3.scale([],[z.x,z.y,z.z],h.transform.worldSize);n.a6.vec3.negate(j,j);let W=[],q=[],X=0;for(let Z of R){let Q=o.paint.get("model-rotation").constantOr(null),re=o.paint.get("model-scale").constantOr(null),ie=o.paint.get("model-translation").constantOr(null);Z.computeModelMatrix(h,Q,re,ie,!0,!0,!1);let ae=n.a6.mat4.identity([]),ue=n.de(Z.position.lat,h.transform.zoom),le=n.a6.mat4.fromScaling([],[1,1,1/ue]);n.a6.mat4.translate(ae,ae,j),F.push({zScaleMatrix:le,negCameraPosMatrix:ae});for(let he of Z.nodes)fc(h.transform,he,Z.matrix,h.transform.expandedFarZProjMatrix,X,W,q);X++}if(W.sort((Z,Q)=>Q.depth-Z.depth),h.renderPass!=="shadow"){if(g===1)for(let Z of q)ra(Z,h,o,F[Z.modelIndex],jt.disabled,h.colorModeForRenderPass());else{for(let Z of q)ra(Z,h,o,F[Z.modelIndex],jt.disabled,Qt.disabled);for(let Z of q)ra(Z,h,o,F[Z.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(let Z of W)ra(Z,h,o,F[Z.modelIndex],jt.disabled,h.colorModeForRenderPass());A()}else{for(let Z of q)Hu(Z.mesh,Z.nodeModelMatrix,h,o);for(let Z of W)Hu(Z.mesh,Z.nodeModelMatrix,h,o);A()}}},Ho={model:function(h,t,o){let d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,d.type==="vector"?h.scope:""));if(d.type==="batched-model"||d.type!=="model")return;let g=d.getModels();for(let y of g)y.upload(o.context)},raster:function(h,t,o){let d=t.getSource();if(!(d instanceof po&&d.loaded()))return;let g=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!g)return;let y=h.paint.get("raster-array-band")||d.getInitialBand(g);if(y==null)return;let x=t.getIds().map(C=>t.getTileByID(C));for(let C of x)C.updateNeeded(g,y)&&d.prepareTile(C,g,y)},"raster-particle":function(h,t,o){let d=t.getSource();if(!(d instanceof po&&d.loaded()))return;let g=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!g)return;let y=h.paint.get("raster-particle-array-band")||d.getInitialBand(g);if(y==null)return;let x=t.getIds().map(C=>t.getTileByID(C));for(let C of x)C.updateNeeded(g,y)&&d.prepareTile(C,g,y)}};class Ts{constructor(t,o,d,g,y){this.context=new mv(t,o),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let A of x)this._debugParams.enabledLayers[A]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let A of x)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],A);this.occlusionParams=new tl(y),this.setup(),this.numSublayers=hi.maxUnderzooming+hi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new lm(this),this._wireframeDebugCache=new qu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let C=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,C,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g}updateTerrain(t,o){let d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new kd(this,t));let g=this._terrain;this.transform.elevation=d?g:null,g.update(t,this.transform,o),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(t){let o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[d,g]=o.getFovAdjustedRange(this.transform._fov);if(d>g)return void(this.transform.fogCullDistSq=null);let y=d+.78*(g-d);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new kd(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*n.q.devicePixelRatio,this.height=o*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let d of this.style.order)this.style._mergedLayers[d].resize()}setup(){let t=this.context,o=new n.a$;o.emplaceBack(0,0),o.emplaceBack(n.ab,0),o.emplaceBack(0,n.ab),o.emplaceBack(n.ab,n.ab),this.tileExtentBuffer=t.createVertexBuffer(o,n.b1.members),this.tileExtentSegments=n.b2.simpleSegment(0,0,4,2);let d=new n.a$;d.emplaceBack(0,0),d.emplaceBack(n.ab,0),d.emplaceBack(0,n.ab),d.emplaceBack(n.ab,n.ab),this.debugBuffer=t.createVertexBuffer(d,n.b1.members),this.debugSegments=n.b2.simpleSegment(0,0,4,5);let g=new n.a$;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,n.b1.members),this.viewportSegments=n.b2.simpleSegment(0,0,4,2);let y=new n.aO;y.emplaceBack(0,0,0,0),y.emplaceBack(n.ab,0,n.ab,0),y.emplaceBack(0,n.ab,0,n.ab),y.emplaceBack(n.ab,n.ab,n.ab,n.ab),this.mercatorBoundsBuffer=t.createVertexBuffer(y,n.b4.members),this.mercatorBoundsSegments=n.b2.simpleSegment(0,0,4,2);let x=new n.aP;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);let C=new n.b0;for(let O of[0,1,3,2,0])C.emplaceBack(O);this.debugIndexBuffer=t.createIndexBuffer(C),this.emptyTexture=new n.T(t,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.a6.mat4.create();let A=this.context.gl;this.stencilClearMode=new jt({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,It.disabled,this.stencilClearMode,Qt.disabled,Lt.disabled,sc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,d){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(let A of d)if(this._tileClippingMaskIDs[A.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=o.id;let g=this.context,y=g.gl;this.nextStencilID+d.length>256&&this.clearStencil(),g.setColorMode(Qt.disabled),g.setDepthMode(It.disabled);let x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let C of d){let A=o.getTile(C),O=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:F,tileBoundsSegments:z}=this.getTileBoundsBuffers(A);x.draw(this,y.TRIANGLES,It.disabled,new jt({func:y.ALWAYS,mask:0},O,255,y.KEEP,y.KEEP,y.REPLACE),Qt.disabled,Lt.disabled,sc(C.projMatrix),"$clipping",R,F,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,o=this.context.gl;return new jt({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);let o=this.context.gl;return new jt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){let o=this.context.gl,d=t.sort((x,C)=>C.overscaledZ-x.overscaledZ),g=d[d.length-1].overscaledZ,y=d[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();let x={};for(let C=0;C<y;C++)x[C+g]=new jt({func:o.GEQUAL,mask:255},C+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[x,d]}return[{[g]:jt.disabled},d]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new Qt([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.bA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Qt.unblended:Qt.alphaBlended}colorModeForDrapableLayerRenderPass(t){let o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Qt([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new n.bA(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,o,d,g=!1){if(this.depthOcclusion)return new It(this.context.gl.GREATER,It.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return It.disabled;let y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new It(d||this.context.gl.LEQUAL,o,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let t=this.context.gl,o=Math.ceil(this.width),d=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&d!==0&&(this.depthFBO=new km(this.context,o,d,!1,"texture"),this.depthTexture=new n.T(this.context,{width:o,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,d,0,0,o,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,o)=>t+o/this._fpsHistory.length,0))}render(t,o){let d=n.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;let g=this.style._mergedLayers,y=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(_e=>{let ge=g[_e];return!(ge.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ge.type]}),x=!1,C=!1;for(let _e of y){let ge=g[_e];ge.type==="circle"&&(x=!0),ge.type==="symbol"&&(ge.hasInitialOcclusionOpacityProperties?C=!0:x=!0)}let A=y.map(_e=>g[_e]),O=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let R=0,F=!1;for(let _e in O){let ge=O[_e];ge.used&&(ge.prepare(this.context),ge.getSource().usedInConflation&&++R)}let z=!1;for(let _e of A)_e.isHidden(this.transform.zoom)||(_e.type==="clip"&&(z=!0),this.prepareLayer(_e));let j={},W={},q={},X={},Z={};for(let _e in O){let ge=O[_e];j[_e]=ge.getVisibleCoordinates(),W[_e]=j[_e].slice().reverse(),q[_e]=ge.getVisibleCoordinates(!0).reverse(),X[_e]=ge.getShadowCasterCoordinates(),Z[_e]=ge.sortCoordinatesByDistance(j[_e])}let Q=_e=>{let ge=this.style.getLayerSourceCache(_e);return ge&&ge.used?ge.getSource():null};if(R||z||this._clippingActiveLastFrame){let _e=[],ge=[],Oe=0;for(let Be of A)this.isSourceForClippingOrConflation(Be,Q(Be))&&(_e.push(Be),ge.push(Oe)),Oe++;if(_e&&(z||_e.length>1)||this._clippingActiveLastFrame){z=!1;let Be=[];for(let qe=0;qe<_e.length;qe++){let Ke=_e[qe],nt=ge[qe],Se=this.style.getLayerSourceCache(Ke);if(!Se||!Se.used||!Se.getSource().usedInConflation&&Ke.type!=="clip")continue;let Ge=n.dn,Le=n.bt.None,He=[],Ze=!0;if(Ke.type==="clip"){Ge=nt;for(let $e of Ke.layout.get("clip-layer-types"))Le|=$e==="model"?n.bt.Model:$e==="symbol"?n.bt.Symbol:n.bt.FillExtrusion;for(let $e of Ke.layout.get("clip-layer-scope"))He.push($e);Ke.isHidden(this.transform.zoom)?Ze=!1:z=!0}Ze&&Be.push({layer:Ke.fqid,cache:Se,order:Ge,clipMask:Le,clipScope:He})}this.replacementSource.setSources(Be),F=!0}}this._clippingActiveLastFrame=z,F||this.replacementSource.clear(),this.conflationActive=F,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let _e=0;_e<A.length;_e++){let ge=A[_e],Oe=ge.cutoffRange();if(this.longestCutoffRange=Math.max(Oe,this.longestCutoffRange),Oe>0){let Be=Q(ge);Be&&(this.minCutoffZoom=Math.max(Be.minzoom,this.minCutoffZoom)),ge.minzoom&&(this.minCutoffZoom=Math.max(ge.minzoom,this.minCutoffZoom))}ge.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=_e),this._lastOcclusionLayer=_e)}let re=this.style&&this.style.fog;re?(this._fogVisible=re.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=re.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(q),this.opaquePassCutoff=0);let ie=this._shadowRenderer;if(ie){ie.updateShadowParameters(this.transform,this.style.directionalLight);for(let _e in O)for(let ge of j[_e]){let Oe={min:0,max:0};this.terrain&&(Oe=this.terrain.getMinMaxForTile(ge)||Oe),ie.addShadowReceiver(ge.toUnwrapped(),Oe.min,Oe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new nf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Fo.has(this.context.gl))return;this.renderPass="offscreen";for(let _e of A){let ge=t.getLayerSourceCache(_e);if(!_e.hasOffscreenPass()||_e.isHidden(this.transform.zoom))continue;let Oe=ge?W[ge.id]:void 0;(_e.type==="custom"||_e.type==="raster"||_e.type==="raster-particle"||_e.isSky()||Oe&&Oe.length)&&this.renderLayer(this,ge,_e,Oe)}this.depthRangeFor3D=[0,1-(A.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,X)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ue=(()=>{if(o.showOverdrawInspector)return n.bA.black;let _e=this.style.fog;if(_e&&this.transform.projection.supportsFog){let ge=this.style.getLut(_e.scope);if(!ae){let Oe=_e.properties.get("color").toRenderColor(ge).toArray01();return new n.bA(...Oe)}if(ae){let Oe=_e.properties.get("space-color").toRenderColor(ge).toArray01();return new n.bA(...Oe)}}return n.bA.transparent})();if(this.context.clear({color:ue,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){let _e=A[this.currentLayer],ge=t.getLayerSourceCache(_e);if(_e.isSky())continue;let Oe=ge?(_e.is3D()?Z:W)[ge.id]:void 0;this._renderTileClippingMasks(_e,ge,Oe),this.renderLayer(this,ge,_e,Oe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){let _e=A[this.currentLayer],ge=t.getLayerSourceCache(_e);_e.isSky()&&this.renderLayer(this,ge,_e,ge?W[ge.id]:void 0)}function le(_e,ge){let Oe;return ge&&(Oe=(_e.type==="symbol"?q:_e.is3D()?Z:W)[ge.id]),Oe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<y.length;){let _e=A[this.currentLayer];if(_e.type==="raster"||_e.type==="raster-particle"){let ge=t.getLayerSourceCache(_e);this.renderLayer(this,ge,_e,le(_e,ge))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let he=0;ie&&(he=ie.getShadowCastingLayerCount());let me=!1,xe=-1;for(let _e=0;_e<y.length;++_e){let ge=A[_e];ge.isHidden(this.transform.zoom)||ge.is3D()&&(xe=_e)}for(C&&xe===-1&&(x=!0);this.currentLayer<y.length;){let _e=A[this.currentLayer],ge=t.getLayerSourceCache(_e);if(_e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(_e)){if(_e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(x&&!me&&this.terrain&&!this.transform.isOrthographic&&(me=!0,this.blitDepth()),C&&xe!==-1&&this.currentLayer===xe+1&&!this.transform.isOrthographic&&this.blitDepth(),_e.is3D()||this.terrain||this._renderTileClippingMasks(_e,ge,ge?j[ge.id]:void 0),this.renderLayer(this,ge,_e,le(_e,ge)),!this.terrain&&ie&&he>0&&_e.hasShadowPass()&&--he==0&&(ie.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let Oe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Oe;this.currentLayer++){let Be=A[this.currentLayer];if(!Be.hasLightBeamPass())continue;let qe=t.getLayerSourceCache(Be);this.renderLayer(this,qe,Be,qe?W[qe.id]:void 0)}this.currentLayer=Oe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Oe=this.currentLayer;this.depthOcclusion=!0;for(let Be of this.layersWithOcclusionOpacity){this.currentLayer=Be;let qe=A[this.currentLayer],Ke=t.getLayerSourceCache(qe),nt=Ke?W[Ke.id]:void 0;qe.is3D()||this.terrain||this._renderTileClippingMasks(qe,Ke,Ke?j[Ke.id]:void 0),this.renderLayer(this,Ke,qe,nt)}this.depthOcclusion=!1,this.currentLayer=Oe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let _e=null;A.forEach(ge=>{let Oe=t.getLayerSourceCache(ge);Oe&&!ge.isHidden(this.transform.zoom)&&Oe.getVisibleCoordinates().length&&(!_e||_e.getSource().maxzoom<Oe.getSource().maxzoom)&&(_e=Oe)}),_e&&this.options.showTileBoundaries&&mc.debug(this,_e,_e.getVisibleCoordinates(),n.bA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&mc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.bA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(_e){let ge=_e.transform.padding;Ae(_e,_e.transform.height-(ge.top||0),3,Ka),Ae(_e,ge.bottom||0,3,Qa),Qd(_e,ge.left||0,3,tt),Qd(_e,_e.transform.width-(ge.right||0),3,xt);let Oe=_e.transform.centerPoint;(function(Be,qe,Ke,nt){na(Be,qe-1,Ke-10,2,20,nt),na(Be,qe-10,Ke-1,20,2,nt)})(_e,Oe.x,_e.transform.height-Oe.y,el)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),F||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);let{unsupportedLayers:o}=this.transform.projection,d=!o||!o.includes(t.type);if(Ho[t.type]&&(d||this.terrain&&t.type==="custom")){let g=this.style.getLayerSourceCache(t);Ho[t.type](t,g,this)}this.gpuTimingEnd()}renderLayer(t,o,d,g){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||g&&g.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||mc[d.type](t,o,d,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;let o=this.context.extTimerQuery,d=this.context.gl,g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),g.calls++,d.beginQuery(o.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let t=this.context.extTimerQuery,o=this.context.gl,d=o.createQuery();this.deferredRenderGpuTimeQueries.push(d),o.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){let t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){let o={};for(let d in t){let g=t[d],y=this.context.extTimerQuery,x=y.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(g.query),o[d]=x}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;let o=this.context.gl,d=0;for(let g of t)d+=o.getQueryParameter(g,o.QUERY_RESULT)/1e6,o.deleteQuery(g);return d}translatePosMatrix(t,o,d,g,y){if(!d[0]&&!d[1])return t;let x=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(x){let O=Math.sin(x),R=Math.cos(x);d=[d[0]*R-d[1]*O,d[0]*O+d[1]*R]}let C=[y?d[0]:n.ak(o,d[0],this.transform.zoom),y?d[1]:n.ak(o,d[1],this.transform.zoom),0],A=new Float32Array(16);return n.a6.mat4.translate(A,t,C),A}saveTileTexture(t){let o=t.size[0],d=this._tileTextures[o];d?d.push(t):this._tileTextures[o]=[t]}getTileTexture(t){let o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,d){let g=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||g||o!==void 0&&!o||y.push("FOG","FOG_DITHERING"),g&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,o){this.cache=this.cache||{};let d=o&&o.defines||[],g=o&&o.config,y=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(d),x=$o.cacheKey(xs[t],t,y,g);return this.cache[x]||(this.cache[x]=new $o(this.context,t,xs[t],g,ta[t],y)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){let d=this.style.directionalLight,g=this.style.ambientLight;if(d&&g){let y=((x,C,A)=>{let O=x.properties.get("direction"),R=x.properties.get("color").toRenderColor(A.getLut(x.scope)).toArray01(),F=x.properties.get("intensity"),z=C.properties.get("color").toRenderColor(A.getLut(C.scope)).toArray01(),j=C.properties.get("intensity"),W=[O.x,O.y,O.z],q=n.cH(z,j),X=n.cH(R,F);return{u_lighting_ambient_color:q,u_lighting_directional_dir:W,u_lighting_directional_color:X,u_ground_radiance:Fd(W,X,q)}})(d,g,this.style);o.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,o,d,g,y){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;let x=this.style.fog;if(x){let C=x.getOpacity(this.transform.pitch),A=((O,R,F,z,j,W,q,X,Z,Q,re,ie)=>{let ae=O.transform,ue=R.properties.get("color").toRenderColor(O.style.getLut(R.scope)).toArray01();ue[3]=z;let le=O.frameCounter/1e3%1,[he,me]=R.properties.get("vertical-range");return{u_fog_matrix:F?ae.calculateFogTileMatrix(F):ie||O.identityMat,u_fog_range:R.getFovAdjustedRange(ae._fov),u_fog_color:ue,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,me),me],u_fog_temporal_offset:le,u_frustum_tl:j,u_frustum_tr:W,u_frustum_br:q,u_frustum_bl:X,u_globe_pos:Z,u_globe_radius:Q,u_viewport:re,u_globe_transition:n.a9(ae.zoom),u_is_globe:+(ae.projection.name==="globe")}})(this,x,d,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],g);o.setFogUniformValues(t,A)}y&&o.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){let t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){let t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let t=this._backgroundTiles,o=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(let g of d)o[g.key]=t[g.key]||new go(g,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=Qe||o[1]>=Qe}setupDepthForOcclusion(t,o,d){let g=this.context,y=g.gl,x=!!d;var C;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),g.activeTexture.set(y.TEXTURE0),x||o.setTerrainUniformValues(g,d)}}function qo(h,t){let o=!1,d=null,g=()=>{d=null,o&&(h(),d=setTimeout(g,t),o=!1)};return()=>(o=!0,d||g(),d)}class Wu{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=qo(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let t=this._map;if(!t)return"";let o=gc(t);if(this._hashName){let d=this._hashName,g=!1,y=location.hash.slice(1).split("&").map(x=>{let C=x.split("=")[0];return C===d?(g=!0,`${C}=${o}`):x}).filter(x=>x);return g||y.push(`${d}=${o}`),`#${y.join("&")}`}return`#${o}`}_getCurrentHash(){let t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(o=d)}),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){let t=this._map;if(!t)return!1;let o=this._getCurrentHash();if(o.length>=3&&!o.some(d=>isNaN(d))){let d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:d,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function gc(h,t){let o=h.getCenter(),d=Math.round(100*h.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),x=Math.round(o.lng*y)/y,C=Math.round(o.lat*y)/y,A=h.getBearing(),O=h.getPitch(),R=t?`/${x}/${C}/${d}`:`${d}/${C}/${x}`;return(A||O)&&(R+="/"+Math.round(10*A)/10),O&&(R+=`/${Math.round(O)}`),R}let nl={linearity:.3,easing:n.dp(0,0,.3,1)},sf=n.l({deceleration:2500,maxSpeed:1400},nl),af=n.l({deceleration:20,maxSpeed:1400},nl),Is=n.l({deceleration:1e3,maxSpeed:360},nl),lf=n.l({deceleration:1e3,maxSpeed:90},nl);class Zu{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,o=n.q.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let o={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);let d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(o.pan.mag()){let y=il(o.pan.mag(),d,n.l({},sf,t||{}));g.offset=o.pan.mult(y.amount/o.pan.mag()),g.center=this._map.transform.center,rl(g,y)}if(o.zoom){let y=il(o.zoom,d,af);g.zoom=this._map.transform.zoom+y.amount,rl(g,y)}if(o.bearing){let y=il(o.bearing,d,Is);g.bearing=this._map.transform.bearing+n.ap(y.amount,-179,179),rl(g,y)}if(o.pitch){let y=il(o.pitch,d,lf);g.pitch=this._map.transform.pitch+y.amount,rl(g,y)}if(g.zoom||g.bearing){let y=o.pinchAround===void 0?o.around:o.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function rl(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function il(h,t,o){let{maxSpeed:d,linearity:g,deceleration:y}=o,x=n.ap(h*g/(t/1e3),-d,d),C=Math.abs(x)/(y*g);return{easing:o.easing,duration:1e3*C,amount:x*(C/2)}}class ir extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,d,g={}){let y=xn(o.getCanvasContainer(),d),x=o.unproject(y);super(t,n.l({point:y,lngLat:x,originalEvent:d},g)),this._defaultPrevented=!1,this.target=o}}class ol extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,d){let g=t==="touchend"?d.changedTouches:d.touches,y=xr(o.getCanvasContainer(),g),x=y.map(A=>o.unproject(A)),C=y.reduce((A,O,R,F)=>A.add(O.div(F.length)),new n.P(0,0));super(t,{points:y,point:C,lngLats:x,lngLat:o.unproject(C),originalEvent:d}),this._defaultPrevented=!1}}class cf extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class sl{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new cf(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new ir(t.type,this._map,t))}mouseup(t){this._map.fire(new ir(t.type,this._map,t))}preclick(t){let o=n.l({},t);o.type="preclick",this._map.fire(new ir(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new ir(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new ir(t.type,this._map,t))}mouseover(t){this._map.fire(new ir(t.type,this._map,t))}mouseout(t){this._map.fire(new ir(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ol(t.type,this._map,t))}touchmove(t){this._map.fire(new ol(t.type,this._map,t))}touchend(t){this._map.fire(new ol(t.type,this._map,t))}touchcancel(t){this._map.fire(new ol(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ia{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new ir(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ir(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uf{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ft(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;let d=o,g=this._startPos,y=this._lastPos;if(!g||!y||y.equals(d)||!this._box&&d.dist(g)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=We("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));let x=Math.min(g.x,d.x),C=Math.max(g.x,d.x),A=Math.min(g.y,d.y),O=Math.max(g.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${A}px)`,this._box.style.width=C-x+"px",this._box.style.height=O-A+"px")})}mouseupWindow(t,o){if(!this._active)return;let d=this._startPos,g=o;if(d&&t.button===0){if(this.reset(),St(),d.x!==g.x||d.y!==g.y)return this._map.fire(new n.x("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(d,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),mr(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new n.x(t,{originalEvent:o}))}}function Xu(h,t){let o={};for(let d=0;d<h.length;d++)o[h[d].identifier]=t[d];return o}class qm{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){let y=new n.P(0,0);for(let x of g)y._add(x);return y.div(g.length)}(o),this.touches=Xu(d,o)))}touchmove(t,o,d){if(this.aborted||!this.centroid)return;let g=Xu(d,o);for(let y in this.touches){let x=g[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,o,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){let g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class _c{constructor(t){this.singleTap=new qm(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,d){this.singleTap.touchstart(t,o,d)}touchmove(t,o,d){this.singleTap.touchmove(t,o,d)}touchend(t,o,d){let g=this.singleTap.touchend(t,o,d);if(g){let y=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(g)<30;if(y&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class hf{constructor(){this._zoomIn=new _c({numTouches:1,numTaps:2}),this._zoomOut=new _c({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,d){this._zoomIn.touchstart(t,o,d),this._zoomOut.touchstart(t,o,d)}touchmove(t,o,d){this._zoomIn.touchmove(t,o,d),this._zoomOut.touchmove(t,o,d)}touchend(t,o,d){let g=this._zoomIn.touchend(t,o,d),y=this._zoomOut.touchend(t,o,d);return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(g)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let yc={0:1,2:2};class vc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;let d=Ct(t);this._correctButton(t,d)&&(this._lastPoint=o,this._eventButton=d)}mousemoveWindow(t,o){let d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(g,y){let x=yc[y];return g.buttons===void 0||(g.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(d,o)}}mouseupWindow(t){this._lastPoint&&Ct(t)===this._eventButton&&(this._moved&&St(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yu extends vc{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class Ju extends vc{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){let d=.8*(o.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){t.preventDefault()}}class Ku extends vc{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){let d=-.5*(o.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){t.preventDefault()}}class Wm{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),n.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,o,d){return this._calculateTransform(t,o,d)}touchmove(t,o,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!n.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,d)}}touchend(t,o,d){this._calculateTransform(t,o,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,d){d.length>0&&(this._active=!0);let g=Xu(d,o),y=new n.P(0,0),x=new n.P(0,0),C=0;for(let O in g){let R=g[O],F=this._touches[O];F&&(y._add(R),x._add(R.sub(F)),C++,g[O]=R)}if(this._touches=g,C<this._minTouches||!x.mag())return;let A=x.div(C);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(C),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=We("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Qu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,d){return{}}touchstart(t,o,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,d){let g=this._firstTwoTouches;if(!g)return;t.preventDefault();let[y,x]=g,C=xc(d,o,y),A=xc(d,o,x);if(!C||!A)return;let O=this._aroundCenter?null:C.add(A).div(2);return this._move([C,A],O,t)}touchend(t,o,d){if(!this._firstTwoTouches)return;let[g,y]=this._firstTwoTouches,x=xc(d,o,g),C=xc(d,o,y);x&&C||(this._active&&St(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xc(h,t,o){for(let d=0;d<h.length;d++)if(h[d].identifier===o)return t[d]}function df(h,t){return Math.log(h/t)/Math.LN2}class Zm extends Qu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){let d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(df(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:df(this._distance,d),pinchAround:o}}}function ff(h,t){return 180*h.angleWith(t)/Math.PI}class Xm extends Qu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){let d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ff(this._vector,d),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let o=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;let g=ff(t,d);return Math.abs(g)<o}}function eh(h){return Math.abs(h.y)>Math.abs(h.x)}class Ym extends Qu{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,eh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,d){let g=this._lastPoints;if(!g)return;let y=t[0].sub(g[0]),x=t[1].sub(g[1]);return this._map._cooperativeGestures&&!n.dq()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(y,x,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5})}gestureBeginsVertically(t,o,d){if(this._valid!==void 0)return this._valid;let g=t.mag()>=2,y=o.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;let x=t.y>0==o.y>0;return eh(t)&&eh(o)&&x}}let Jm={panStep:100,bearingStep:15,pitchStep:10};class Km{constructor(){let t=Jm;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,d=0,g=0,y=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:C=>{let A=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Qm,zoom:o?Math.round(A)+o*(t.shiftKey?2:1):A,bearing:C.getBearing()+d*this._bearingStep,pitch:C.getPitch()+g*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:C.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qm(h){return h*(2-h)}let pf=4.000244140625,xv=1/450;class bv{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=xv,n.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,d=n.q.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,o!==0&&o%pf==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let o=xn(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){let O=this._type==="wheel"&&Math.abs(this._delta)>pf?this._wheelZoomRate:this._defaultZoomRate,R=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&R!==0&&(R=1/R);let F=o(),z=Math.pow(2,F),j=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(j*R))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let d=typeof this._targetZoom=="number"?this._targetZoom:o(),g=this._startZoom,y=this._easing,x,C=!1;if(this._type==="wheel"&&g&&y){let O=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),R=y(O);x=n.aa(g,d,R),O<1?this._frameId||(this._frameId=!0):C=!0}else x=d,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=x-o();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=n.dr;if(this._prevEase){let d=this._prevEase,g=(n.q.now()-d.start)/d.duration,y=d.easing(g+.01)-d.easing(g),x=.27/Math.sqrt(y*y+1e-4)*.01,C=Math.sqrt(.0729-x*x);o=n.dp(x,C,.25,1)}return this._prevEase={start:n.q.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=We("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class dr{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class eg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wv{constructor(){this._tap=new _c({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=o[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,o,d))}touchmove(t,o,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;let g=o[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,o,d)}touchend(t,o,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,o,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ev{constructor(t,o,d){this._el=t,this._mousePan=o,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bc{constructor(t,o,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tg{constructor(t,o,d,g){this._el=t,this._touchZoom=o,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let al=h=>h.zoom||h.drag||h.pitch||h.rotate;class th extends n.x{}class Wo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){let d=n.a6.vec3.sub([],o,t);this.radius=n.a6.vec3.length(d[2]<0?n.a6.vec3.div([],d,this.constants):[d[0],d[1],0])}projectRay(t){n.a6.vec3.div(t,t,this.constants),n.a6.vec3.normalize(t,t),n.a6.vec3.mul(t,t,this.constants);let o=n.a6.vec3.scale([],t,this.radius);if(o[2]>0){let d=n.a6.vec3.scale([],[0,0,1],n.a6.vec3.dot(o,[0,0,1])),g=n.a6.vec3.scale([],n.a6.vec3.normalize([],[o[0],o[1],0]),this.radius),y=n.a6.vec3.add([],o,n.a6.vec3.scale([],n.a6.vec3.sub([],n.a6.vec3.add([],g,d),o),2));o[0]=y[0],o[1]=y[1]}return o}}function oa(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Ar{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zu(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),n.aJ(["handleEvent","handleWindowEvent"],this);let d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(let[g,y,x]of this._listeners){let C=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(y,C,x)}}destroy(){for(let[t,o,d]of this._listeners){let g=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,g,d)}}_addDefaultHandlers(t){let o=this._map,d=o.getCanvasContainer();this._add("mapEvent",new sl(o,t));let g=o.boxZoom=new uf(o,t);this._add("boxZoom",g);let y=new hf,x=new eg;o.doubleClickZoom=new dr(x,y),this._add("tapZoom",y),this._add("clickZoom",x);let C=new wv;this._add("tapDragZoom",C);let A=o.touchPitch=new Ym(o);this._add("touchPitch",A);let O=new Ju(t),R=new Ku(t);o.dragRotate=new bc(t,O,R),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);let F=new Yu(t),z=new Wm(o,t);o.dragPan=new Ev(d,F,z),this._add("mousePan",F),this._add("touchPan",z,["touchZoom","touchRotate"]);let j=new Xm,W=new Zm;o.touchZoomRotate=new tg(d,W,j,C),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ia(o));let q=o.scrollZoom=new bv(o,this);this._add("scrollZoom",q,["mousePan"]);let X=o.keyboard=new Km;this._add("keyboard",X);for(let Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Z]&&o[Z].enable(t[Z])}_add(t,o,d){this._handlers.push({handlerName:t,handler:o,allowed:d}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(let{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!al(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,d){for(let g in t)if(g!==d&&(!o||o.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){let o=[];for(let d of t)this._el.contains(d.target)&&o.push(d);return o}handleEvent(t,o){this._updatingCamera=!0;let d=t.type==="renderFrame",g=d?void 0:t,y={needsRenderFrame:!1},x={},C={},A=t.touches?this._getMapTouches(t.touches):void 0,O=A?xr(this._el,A):d?void 0:xn(this._el,t);for(let{handlerName:z,handler:j,allowed:W}of this._handlers){if(!j.isEnabled())continue;let q;this._blockedByActive(C,W,z)?j.reset():j[o||t.type]&&(q=j[o||t.type](t,O,A),this.mergeHandlerResult(y,x,q,z,g),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||j.isActive())&&(C[z]=j)}let R={};for(let z in this._previousActiveHandlers)C[z]||(R[z]=g);this._previousActiveHandlers=C,(Object.keys(R).length||oa(y))&&(this._changes.push([y,x,R]),this._triggerRenderFrame()),(Object.keys(C).length||oa(y))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=y;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,o,d,g,y){if(!d)return;n.l(t,d);let x={handlerName:g,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(o.zoom=x),d.panDelta!==void 0&&(o.drag=x),d.pitchDelta!==void 0&&(o.pitch=x),d.bearingDelta!==void 0&&(o.rotate=x)}_applyChanges(){let t={},o={},d={};for(let[g,y,x]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.aroundCoord!==void 0&&(t.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),n.l(o,y),n.l(d,x);this._updateMapTransform(t,o,d),this._changes=[]}_updateMapTransform(t,o,d){let g=this._map,y=g.transform,x=Q=>[Q.x,Q.y,Q.z];if((Q=>{let re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!oa(t)){let Q=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),Q!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&g._stop(!0),!oa(t))return void this._fireEvents(o,d,!0);let{panDelta:C,zoomDelta:A,bearingDelta:O,pitchDelta:R,around:F,aroundCoord:z,pinchAround:j}=t;y._isCameraConstrained&&(A>0&&(A=0),y._isCameraConstrained=!1),j!==void 0&&(F=j),(A||(Q=>o[Q]&&!this._eventsInProgress[Q])("drag"))&&F&&(this._dragOrigin=x(y.pointCoordinate3D(F)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",g._stop(!0),F=F||g.transform.centerPoint,O&&(y.bearing+=O),R&&(y.pitch+=R),y._updateCameraState();let W=[0,0,0];if(C)if(y.projection.name==="mercator"){let Q=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F).dir),re=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F.sub(C)).dir);W[0]=re[0]-Q[0],W[1]=re[1]-Q[1]}else{let Q=y.pointCoordinate(F);if(y.projection.name==="globe"){C=C.rotate(-y.angle);let re=y._pixelsPerMercatorPixel/y.worldSize;W[0]=-C.x*n.ds(n.aN(Q.y))*re,W[1]=-C.y*n.ds(y.center.lat)*re}else{let re=y.pointCoordinate(F.sub(C));Q&&re&&(W[0]=re.x-Q.x,W[1]=re.y-Q.y)}}let q=y.zoom,X=[0,0,0];if(A){let Q=x(z||y.pointCoordinate3D(F)),re={dir:n.a6.vec3.normalize([],n.a6.vec3.sub([],Q,y._camera.position))};if(re.dir[2]<0){let ie=y.zoomDeltaToMovement(Q,A);n.a6.vec3.scale(X,re.dir,ie)}}let Z=n.a6.vec3.add(W,W,X);y._translateCameraConstrained(Z),A&&Math.abs(y.zoom-q)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,d,!0)}_fireEvents(t,o,d){let g=al(this._eventsInProgress),y=al(t),x={};for(let R in t){let{originalEvent:F}=t[R];this._eventsInProgress[R]||(x[`${R}start`]=F),this._eventsInProgress[R]=t[R]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(let R in x)this._fireEvent(R,x[R]);y&&this._fireEvent("move",y.originalEvent);for(let R in t){let{originalEvent:F}=t[R];this._fireEvent(R,F)}let C={},A;for(let R in this._eventsInProgress){let{handlerName:F,originalEvent:z}=this._eventsInProgress[R];this._handlersById[F].isActive()||(delete this._eventsInProgress[R],A=o[F]||z,C[`${R}end`]=A)}for(let R in C)this._fireEvent(R,C[R]);let O=al(this._eventsInProgress);if(d&&(g||y)&&!O){this._updatingCamera=!0;let R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;R?(F(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:A})):(this._map.fire(new n.x("moveend",{originalEvent:A})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new n.x(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new th("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let vo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class mf extends n.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,n.aJ(["_renderFrameCallback"],this)}getCenter(){return new n.bL(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,d){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,n.l({offset:t},o),d)}panTo(t,o,d){return this.easeTo(n.l({center:t},o),d)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,d){return this.easeTo(n.l({zoom:t},o),d)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,d){return this.easeTo(n.l({bearing:t},o),d)}resetNorth(t,o){return this.rotateTo(0,n.l({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(n.l({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=n.as.convert(t);let d=o&&o.bearing||0,g=o&&o.pitch||0,y=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,y,x,d,g,o)}_extendPadding(t){let o={top:0,right:0,bottom:0,left:0};return t==null?n.l({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:n.l({},o,t)}_extendCameraOptions(t){return(t=n.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){let d=o.max[0]-o.min[0],g=o.max[1]-o.min[1];return d/g>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,d,g,y,x){let C=t.clone(),A=this._extendCameraOptions(x);C.bearing=g,C.pitch=y;let O=n.bL.convert(o),R=n.bL.convert(d),F=.5*(O.lat+R.lat),z=.5*(O.lng+R.lng),j=n.dt(F,z),W=n.a6.vec3.normalize([],j),q=n.a6.vec3.normalize([],n.a6.vec3.cross([],W,[0,1,0])),X=n.a6.vec3.cross([],q,W),Z=[q[0],q[1],q[2],0,X[0],X[1],X[2],0,W[0],W[1],W[2],0,0,0,0,1],Q=[j,n.dt(O.lat,O.lng),n.dt(R.lat,O.lng),n.dt(R.lat,R.lng),n.dt(O.lat,R.lng),n.dt(F,O.lng),n.dt(F,R.lng),n.dt(O.lat,z),n.dt(R.lat,z)],re=n.ca.fromPoints(Q.map(Le=>[n.a6.vec3.dot(q,Le),n.a6.vec3.dot(X,Le),n.a6.vec3.dot(W,Le)])),ie=n.a6.vec3.transformMat4([],re.center,Z);n.a6.vec3.squaredLength(ie)===0&&n.a6.vec3.set(ie,0,0,1),n.a6.vec3.normalize(ie,ie),n.a6.vec3.scale(ie,ie,n.aq),C.center=n.du(ie);let ae=C.getWorldToCameraMatrix(),ue=n.a6.mat4.invert(new Float64Array(16),ae);re=n.ca.applyTransform(re,n.a6.mat4.multiply([],ae,Z));let le=this._extendAABB(re,C,A,g);if(!le)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=le,n.a6.vec3.transformMat4(ie,ie,ae);let he=.5*(re.max[2]-re.min[2]),me=this._minimumAABBFrustumDistance(C,re),xe=n.a6.vec3.scale([],[0,0,1],he),_e=n.a6.vec3.add(xe,ie,xe),ge=me+(C.pitch===0?0:n.a6.vec3.distance(ie,_e)),Oe=C.globeCenterInViewSpace,Be=n.a6.vec3.sub([],ie,[Oe[0],Oe[1],Oe[2]]);n.a6.vec3.normalize(Be,Be),n.a6.vec3.scale(Be,Be,ge);let qe=n.a6.vec3.add([],ie,Be);n.a6.vec3.transformMat4(qe,qe,ue);let Ke=n.dw/n.aq,nt=n.a6.vec3.length(qe),Se=n.bE(Math.max(nt*Ke-n.dw,Number.EPSILON),0),Ge=Math.min(C.zoomFromMercatorZAdjusted(Se),A.maxZoom);return Ge>.5*(n.c3+n.bV)?(C.setProjection({name:"mercator"}),C.zoom=Ge,this._cameraForBounds(C,o,d,g,y,x)):{center:C.center,zoom:Ge,bearing:g,pitch:y}}_extendAABB(t,o,d,g){let y=.5*((d.padding.left||0)+(d.padding.right||0)),x=.5*((d.padding.top||0)+(d.padding.bottom||0)),C=x,A=y,O=y,R=x,F=o.width-(A+O),z=o.height-(C+R),j=n.a6.vec3.sub([],t.max,t.min),W=Math.min(F/j[0],z/j[1]),q=Math.min(o.scaleZoom(o.scale*W),d.maxZoom);if(isNaN(q))return null;let X=o.scale/o.zoomScale(q),Z=new n.ca([t.min[0]-A*X,t.min[1]-R*X,t.min[2]],[t.max[0]+O*X,t.max[1]+C*X,t.max[2]]),Q=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new n.P(d.offset.x,d.offset.y):n.P.convert(d.offset)).rotate(-n.bC(g));return Z.center[0]-=Q.x*X,Z.center[1]+=Q.y*X,Z}queryTerrainElevation(t,o){let d=this.transform.elevation;return d?(o=n.l({},{exaggerated:!0},o),d.getAtPoint(n.a5.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,d,g,y,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,d,g,y,x);let C=t.clone(),A=this._extendCameraOptions(x);C.bearing=g,C.pitch=y;let O=n.bL.convert(o),R=n.bL.convert(d),F=new n.bL(O.lng,R.lat),z=new n.bL(R.lng,O.lat),j=C.project(O),W=C.project(R),q=this.queryTerrainElevation(O),X=this.queryTerrainElevation(R),Z=this.queryTerrainElevation(F),Q=this.queryTerrainElevation(z),re=[[j.x,j.y,Math.min(q||0,X||0,Z||0,Q||0)],[W.x,W.y,Math.max(q||0,X||0,Z||0,Q||0)]],ie=n.ca.fromPoints(re),ae=C.getWorldToCameraMatrix(),ue=n.a6.mat4.invert(new Float64Array(16),ae);ie=n.ca.applyTransform(ie,ae);let le=this._extendAABB(ie,C,A,g);if(!le)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ie=le;let he=.5*n.a6.vec3.sub([],ie.max,ie.min)[2],me=this._minimumAABBFrustumDistance(C,ie),xe=[0,0,1,0];n.a6.vec4.transformMat4(xe,xe,ae),n.a6.vec4.normalize(xe,xe);let _e=n.a6.vec3.scale([],xe,me+he),ge=n.a6.vec3.add([],ie.center,_e);n.a6.vec3.transformMat4(ie.center,ie.center,ue),n.a6.vec3.transformMat4(ge,ge,ue);let Oe=C.unproject(new n.P(ie.center[0],ie.center[1])),Be=n.dv(C.projection,Oe),qe=Math.pow(2,Be),Ke=Math.min(C._zoomFromMercatorZ(ge[2]*C.pixelsPerMeter*qe/C.worldSize),A.maxZoom);return C.mercatorFromTransition&&Ke<.5*(n.c3+n.bV)?(C.setProjection({name:"globe"}),C.zoom=Ke,this._cameraForBounds(C,o,d,g,y,x)):{center:Oe,zoom:Ke,bearing:g,pitch:y}}fitBounds(t,o,d){let g=this.cameraForBounds(t,o);return this._fitInternal(g,o,d)}fitScreenCoordinates(t,o,d,g,y){let x=n.P.convert(t),C=n.P.convert(o),A=new n.P(Math.min(x.x,C.x),Math.min(x.y,C.y)),O=new n.P(Math.max(x.x,C.x),Math.max(x.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,C))return this;let R=this.transform.pointLocation3D(A),F=this.transform.pointLocation3D(O),z=this.transform.pointLocation3D(new n.P(A.x,O.y)),j=this.transform.pointLocation3D(new n.P(O.x,A.y)),W=[Math.min(R.lng,F.lng,z.lng,j.lng),Math.min(R.lat,F.lat,z.lat,j.lat)],q=[Math.max(R.lng,F.lng,z.lng,j.lng),Math.max(R.lat,F.lat,z.lat,j.lat)],X=g&&g.pitch?g.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,W,q,d,X,g);return this._fitInternal(Z,g,y)}_fitInternal(t,o,d){return t?(o=n.l(t,o)).linear?this.easeTo(o,d):this.flyTo(o,d):this}jumpTo(t,o){this.stop();let d=t.preloadOnly?this.transform.clone():this.transform,g=!1,y=!1,x=!1;"zoom"in t&&d.zoom!==+t.zoom&&(g=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=n.bL.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(y=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(x=!0,d.pitch=+t.pitch);let C=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(C))if(t.retainPadding===!1){let A=d.clone();A.padding=C,d.setLocationAtPoint(d.center,A.centerPoint)}else d.padding=C;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new n.x("movestart",o)).fire(new n.x("move",o)),g&&this.fire(new n.x("zoomstart",o)).fire(new n.x("zoom",o)).fire(new n.x("zoomend",o)),y&&this.fire(new n.x("rotatestart",o)).fire(new n.x("rotate",o)).fire(new n.x("rotateend",o)),x&&this.fire(new n.x("pitchstart",o)).fire(new n.x("pitch",o)).fire(new n.x("pitchend",o)),this.fire(new n.x("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(vo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){let d=this.transform;if(!d.projection.supportsFreeCamera)return n.w(vo),this;this.stop();let g=d.zoom,y=d.pitch,x=d.bearing;d.setFreeCameraOptions(t);let C=g!==d.zoom,A=y!==d.pitch,O=x!==d.bearing;return this.fire(new n.x("movestart",o)).fire(new n.x("move",o)),C&&this.fire(new n.x("zoomstart",o)).fire(new n.x("zoom",o)).fire(new n.x("zoomend",o)),O&&this.fire(new n.x("rotatestart",o)).fire(new n.x("rotate",o)).fire(new n.x("rotateend",o)),A&&this.fire(new n.x("pitchstart",o)).fire(new n.x("pitch",o)).fire(new n.x("pitchend",o)),this.fire(new n.x("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=n.l({offset:[0,0],duration:500,easing:n.dr},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);let d=this.transform,g=this.getZoom(),y=this.getBearing(),x=this.getPitch(),C=this.getPadding(),A="zoom"in t?+t.zoom:g,O="bearing"in t?this._normalizeBearing(t.bearing,y):y,R="pitch"in t?+t.pitch:x,F=this._extendPadding(t.padding),z=n.P.convert(t.offset),j,W,q;if(d.projection.name==="globe"){let xe=n.a5.fromLngLat(d.center),_e=z.rotate(-d.angle);xe.x+=_e.x/d.worldSize,xe.y+=_e.y/d.worldSize;let ge=xe.toLngLat(),Oe=n.bL.convert(t.center||ge);this._normalizeCenter(Oe),j=d.centerPoint.add(_e),W=new n.P(xe.x,xe.y).mult(d.worldSize),q=new n.P(n.am(Oe.lng),n.at(Oe.lat)).mult(d.worldSize).sub(W)}else{j=d.centerPoint.add(z);let xe=d.pointLocation(j),_e=n.bL.convert(t.center||xe);this._normalizeCenter(_e),W=d.project(xe),q=d.project(_e).sub(W)}let X=d.zoomScale(A-g),Z,Q;t.around&&(Z=n.bL.convert(t.around),Q=d.locationPoint(Z));let re=this._zooming||A!==g,ie=this._rotating||y!==O,ae=this._pitching||R!==x,ue=!d.isPaddingEqual(F),le=t.retainPadding===!1?d.clone():d,he=xe=>_e=>{if(re&&(xe.zoom=n.aa(g,A,_e)),ie&&(xe.bearing=n.aa(y,O,_e)),ae&&(xe.pitch=n.aa(x,R,_e)),ue&&(le.interpolatePadding(C,F,_e),j=le.centerPoint.add(z)),Z)xe.setLocationAtPoint(Z,Q);else{let ge=xe.zoomScale(xe.zoom-g),Oe=A>g?Math.min(2,X):Math.max(.5,X),Be=Math.pow(Oe,1-_e),qe=xe.unproject(W.add(q.mult(_e*Be)).mult(ge));xe.setLocationAtPoint(xe.renderWorldCopies?qe.wrap():qe,j)}return t.preloadOnly||this._fireMoveEvents(o),xe};if(t.preloadOnly){let xe=this._emulate(he,t.duration,d);return this._preloadTiles(xe),this}let me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ie,this._pitching=ae,this._padding=ue,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,me),this._ease(he(d),xe=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(o,xe)},t),this}_prepareEase(t,o,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||d.moving||this.fire(new n.x("movestart",t)),this._zooming&&!d.zooming&&this.fire(new n.x("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new n.x("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new n.x("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.x("move",t)),this._zooming&&this.fire(new n.x("zoom",t)),this._rotating&&this.fire(new n.x("rotate",t)),this._pitching&&this.fire(new n.x("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let d=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new n.x("zoomend",t)),g&&this.fire(new n.x("rotateend",t)),y&&this.fire(new n.x("pitchend",t)),this.fire(new n.x("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){let Le=n.ar(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Le,o)}this.stop(),t=n.l({offset:[0,0],speed:1.2,curve:1.42,easing:n.dr},t);let d=this.transform,g=this.getZoom(),y=this.getBearing(),x=this.getPitch(),C=this.getPadding(),A="zoom"in t?n.ap(+t.zoom,d.minZoom,d.maxZoom):g,O="bearing"in t?this._normalizeBearing(t.bearing,y):y,R="pitch"in t?+t.pitch:x,F=this._extendPadding(t.padding),z=d.zoomScale(A-g),j=n.P.convert(t.offset),W=d.centerPoint.add(j),q=d.pointLocation(W),X=n.bL.convert(t.center||q);this._normalizeCenter(X);let Z=d.project(q),Q=d.project(X).sub(Z),re=t.curve,ie=Math.max(d.width,d.height),ae=ie/z,ue=Q.mag();if("minZoom"in t){let Le=n.ap(Math.min(t.minZoom,g,A),d.minZoom,d.maxZoom),He=ie/d.zoomScale(Le-g);re=Math.sqrt(He/ue*2)}let le=re*re;function he(Le){let He=(ae*ae-ie*ie+(Le?-1:1)*le*le*ue*ue)/(2*(Le?ae:ie)*le*ue);return Math.log(Math.sqrt(He*He+1)-He)}function me(Le){return(Math.exp(Le)-Math.exp(-Le))/2}function xe(Le){return(Math.exp(Le)+Math.exp(-Le))/2}let _e=he(0),ge=function(Le){return xe(_e)/xe(_e+re*Le)},Oe=function(Le){return ie*((xe(_e)*(me(He=_e+re*Le)/xe(He))-me(_e))/le)/ue;var He},Be=(he(1)-_e)/re;if(Math.abs(ue)<1e-6||!isFinite(Be)){if(Math.abs(ie-ae)<1e-6)return this.easeTo(t,o);let Le=ae<ie?-1:1;Be=Math.abs(Math.log(ae/ie))/re,Oe=function(){return 0},ge=function(He){return Math.exp(Le*re*He)}}t.duration="duration"in t?+t.duration:1e3*Be/("screenSpeed"in t?+t.screenSpeed/re:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);let qe=y!==O,Ke=R!==x,nt=!d.isPaddingEqual(F),Se=t.retainPadding===!1?d.clone():d,Ge=Le=>He=>{let Ze=He*Be,$e=1/ge(Ze);Le.zoom=He===1?A:g+Le.scaleZoom($e),qe&&(Le.bearing=n.aa(y,O,He)),Ke&&(Le.pitch=n.aa(x,R,He)),nt&&(Se.interpolatePadding(C,F,He),W=Se.centerPoint.add(j));let st=He===1?X:Le.unproject(Z.add(Q.mult(Oe(Ze))).mult($e));return Le.setLocationAtPoint(Le.renderWorldCopies?st.wrap():st,W),Le._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),Le};if(t.preloadOnly){let Le=this._emulate(Ge,t.duration,d);return this._preloadTiles(Le),this}return this._zooming=!0,this._rotating=qe,this._pitching=Ke,this._padding=nt,this._prepareEase(o,!1),this._ease(Ge(d),()=>this._afterEase(o),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,o)}if(!t){let d=this.handlers;d&&d.stop(!1)}return this}_ease(t,o,d){d.animate===!1||d.duration===0?(t(1),o()):(this._easeStart=n.q.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let t=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=n.bB(t,-180,180);let d=Math.abs(t-o);return Math.abs(t-360-o)<d&&(t-=360),Math.abs(t+360-o)<d&&(t+=360),t}_normalizeCenter(t){let o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;let d=t.lng-o.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,d){let g=Math.ceil(15*o/1e3),y=[],x=t(d.clone());for(let C=0;C<=g;C++){let A=x(C/g);y.push(A.clone())}return y}_preloadTiles(t,o){}}class nh{constructor(t={}){this.options=t,n.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){let o=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=We("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=We("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);let g=We("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",d),this._innerContainer=We("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));let o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){let d=o.reduce((g,y,x)=>(y.value&&(g+=`${y.key}=${y.value}${x<o.length-1?"&":""}`),g),"?");t.href=`${n.e.FEEDBACK_URL}/${d}#${gc(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){let g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}let o=this._map.style._mergedSourceCaches;for(let g in o){let y=o[g];if(y.used){let x=y.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((g,y)=>g.length-y.length),t=t.filter((g,y)=>{for(let x=y+1;x<t.length;x++)if(t[x].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));let d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class gf{constructor(){n.aJ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=We("div","mapboxgl-ctrl");let o=We("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(let o in t){let d=t[o].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){let t=this._container.children;if(t.length){let o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class ng{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){let o=this._currentlyRunning,d=o?this._queue.concat(o):this._queue;for(let g of d)if(g.id===t)return void(g.cancelled=!0)}run(t=0){let o=this._currentlyRunning=this._queue;this._queue=[];for(let d of o)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class wc{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;let o=n.cw((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,d){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+d}}let Tv={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},rg=["mouseenter","mouseover","mouseleave","mouseout"];class rh extends n.x{constructor(t,o,d,g){let{point:y,lngLat:x,originalEvent:C,target:A}=t;super(t.type,{point:y,lngLat:x,originalEvent:C,target:A}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=d,this.feature=g}}class _f{constructor(t){this.map=t,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);let{type:d,filter:g}=o;if(g){let x=n.M(g,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(x.result==="error")throw new Error(x.value.map(C=>`${C.key}: ${C.message}`).join(", "));this.filters.set(t,x.value)}let y=this.interactionsByType.get(d)||new Map;y.size===0&&(rg.includes(d)?this.map.on(d,o.featureset,this.handleType):this.map.on(d,this.handleType),this.interactionsByType.set(d,y)),y.set(t,o),this.typeById.set(t,d)}remove(t){let o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);let d=this.interactionsByType.get(o);d&&(d.delete(t),d.size===0&&this.map.off(o,this.handleType))}handleType(t){let o=this.interactionsByType.get(t.type),d=Array.from(o).reverse(),g=[];for(let[,C]of d)C.featureset&&g.push({featureset:C.featureset,filter:C.filter,radius:C.radius});let y=this.map.style.queryRenderedFeaturesForInteractions(t.point,g,this.map.transform);!y.length&&rg.includes(t.type)&&(y=[null]);let x=!1;for(let C of y){for(let[A,O]of d){let{handler:R,featureset:F}=O;if(F&&(C==null||n.bi(C.featureset,F))&&R(new rh(t,A,O,C))!==!1){x=!0;break}}if(x)break}if(!x)for(let[C,A]of d){let{handler:O,featureset:R}=A;if(!R&&O(new rh(t,C,A,null))!==!1)break}}}function Ec(h,t){if(Array.isArray(h)&&Array.isArray(t)){let o=new Set(h),d=new Set(t);return o.size===d.size&&h.every(g=>d.has(g))}return n.bi(h,t)}let ll={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1},Zo={showCompass:!0,showZoom:!0,visualizePitch:!1};class eo{constructor(t,o,d=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Ju({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new Ku({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),Ft()}move(t,o){let d=this.map,g=this.mouseRotate.mousemoveWindow(t,o),y=g&&g.bearingDelta;if(y&&d.setBearing(d.getBearing()+y),this.mousePitch){let x=this.mousePitch.mousemoveWindow(t,o),C=x&&x.pitchDelta;C&&d.setPitch(d.getPitch()+C)}}off(){let t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){mr(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(n.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),xn(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,xn(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=xr(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=xr(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Xo(h,t,o){if(h=new n.bL(h.lng,h.lat),t){let d=new n.bL(h.lng-360,h.lat),g=new n.bL(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-o.center.lng)/360),x=o.locationPoint(h).distSqr(t),C=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint(d).distSqr(t)<x&&(C||Math.abs(d.lng-o.center.lng)<y)?h=d:o.locationPoint(g).distSqr(t)<x&&(C||Math.abs(g.lng-o.center.lng)<y)&&(h=g)}for(;Math.abs(h.lng-o.center.lng)>180;){let d=o.locationPoint(h);if(d.x>=0&&d.y>=0&&d.x<=o.width&&d.y<=o.height)break;h.lng>o.center.lng?h.lng-=360:h.lng+=360}return h}let Yo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class xo extends n.E{constructor(t,o){if(super(),(t instanceof HTMLElement||o)&&(t=n.l({element:t},o)),n.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=We("div");let y=41,x=27,C=pt("svg",{display:"block",height:y*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${y}`},this._element),A=pt("radialGradient",{id:"shadowGradient"},pt("defs",{},C));pt("stop",{offset:"10%","stop-opacity":.4},A),pt("stop",{offset:"100%","stop-opacity":.05},A),pt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),pt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),pt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),pt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=n.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});let d=this._element.classList;for(let y in Yo)d.remove(`mapboxgl-marker-anchor-${y}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);let g=t&&t.className?t.className.trim().split(/\s+/):[];d.add(...g),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){let t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.bL.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){let o=t.code,d=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){let o=t.originalEvent.target,d=this._element;this._popup&&(o===d||d.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let t=this._map,o=this._pos;if(!t||!o)return!1;let d=t.unproject(o),g=t.getFreeCameraOptions();if(!g.position)return!1;let y=g.position.toLngLat();return y.distanceTo(d)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){let t=this._map;if(!t)return;let o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();let d=t.unproject(o),g;t._showingGlobe()&&n.dz(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let t=this._pos;if(!t||!this._map)return;let o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Yo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){let t=this._pos,o=this._map,d=this.getPitchAlignment();if(!o||!t||d!=="map")return"";if(!o._showingGlobe()){let A=o.getPitch();return A?`rotateX(${A}deg)`:""}let g=n.c1(n.dA(o.transform,this._lngLat)),y=t.sub(n.dB(o.transform)),x=Math.abs(y.x)+Math.abs(y.y);if(x===0)return"";let C=g/x;return`rotateX(${-y.y*C}deg) rotateY(${y.x*C}deg)`}_calculateZTransform(){let t=this._pos,o=this._map;if(!o||!t)return"";let d=0,g=this.getRotationAlignment();if(g==="map")if(o._showingGlobe()){let y=o.project(new n.bL(this._lngLat.lng,this._lngLat.lat+.001)),x=o.project(new n.bL(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);d=n.c1(Math.atan2(x.y,x.x))-90}else d=-o.getBearing();else if(g==="horizon"){let y=n.a7(4,6,o.getZoom()),x=n.dB(o.transform);x.y+=y*o.transform.height;let C=t.sub(x),A=n.c1(Math.atan2(C.y,C.x));d=(A>90?A-270:A+90)*(1-y)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);let o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Xo(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){let o=this._map;if(!o)return;let d=this._pointerdownPos,g=this._positionDelta;if(d&&g){if(!this._isDragging){let y=this._clickTolerance||o._clickTolerance;if(t.point.dist(d)<y)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.x("dragstart"))),this.fire(new n.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.x("dragend")),this._state="inactive"}_addDragHandler(t){let o=this._map,d=this._pos;o&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;let o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Iv={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Sv={maxWidth:100,unit:"metric"},Dv={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Cv={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ig=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hr(h=new n.P(0,0),t="bottom"){if(typeof h=="number"){let o=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new n.P(0,h);case"top-left":return new n.P(o,o);case"top-right":return new n.P(-o,o);case"bottom":return new n.P(0,-h);case"bottom-left":return new n.P(o,-o);case"bottom-right":return new n.P(-o,-o);case"left":return new n.P(h,0);case"right":return new n.P(-h,0)}return new n.P(0,0)}return h instanceof n.P||Array.isArray(h)?n.P.convert(h):n.P.convert(h[t]||[0,0])}return{version:P,supported:Ye.supported,setRTLTextPlugin:n.dC,getRTLTextPluginStatus:n.dD,Map:class extends mf{constructor(h){$.mark(U.create);let t=h;if((h=n.l({},ll,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&n.dx(window)&&(h.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new vu(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new ng,this._domRenderTaskQueue=new ng,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.aQ(),this._locale=n.l({},Tv,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new wc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new ou(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?kt({},h.contextCreateOptions):{},typeof h.container=="string"){let o=document.getElementById(h.container);if(!o)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=o}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),n.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new of),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ar(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||n.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new Wu(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});let o=h.bounds;o&&(this.resize(),this.fitBounds(o,n.l({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new nh({customAttribution:h.customAttribution})),this._logoControl=new gf,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new n.x(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new n.x(`${o.dataType}dataloading`,o))}),this._interactions=new _f(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new n.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let o=h.onAdd(this);this._controls.push(h);let d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(o,d.firstChild):d.appendChild(o),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new n.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let t=!this._moving;return t&&this.fire(new n.x("movestart",h)).fire(new n.x("move",h)),this.fire(new n.x("resize",h)),t&&this.fire(new n.x("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(n.as.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(t=>t==="auto"?navigator.language:t):h}setLanguage(h){let t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(let o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let h=this.transform,t=h.projection.name,o;t==="globe"&&h.zoom>=n.bV?(h.setMercatorFromTransition(),o=!0):t==="mercator"&&h.zoom<n.bV&&(h.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;return t=h.name==="globe"&&this.transform.zoom>=n.bV?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(n.bL.convert(h))}unproject(h){return this.transform.pointLocation3D(n.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,o){let d=g=>{let y=[];if(Array.isArray(t)){let x=t.filter(C=>this.getLayer(C));y=x.length?this.queryRenderedFeatures(g,{layers:x}):[]}else y=this.queryRenderedFeatures(g,{featureset:t});return y};if(h==="mouseenter"||h==="mouseover"){let g=!1;return{listener:o,targets:t,delegates:{mousemove:x=>{let C=d(x.point);C.length?g||(g=!0,o.call(this,new ir(h,this,x.originalEvent,{features:C}))):g=!1},mouseout:()=>{g=!1}}}}if(h==="mouseleave"||h==="mouseout"){let g=!1;return{listener:o,targets:t,delegates:{mousemove:C=>{d(C.point).length?g=!0:g&&(g=!1,o.call(this,new ir(h,this,C.originalEvent)))},mouseout:C=>{g&&(g=!1,o.call(this,new ir(h,this,C.originalEvent)))}}}}{let g=y=>{let x=d(y.point);x.length&&(y.features=x,o.call(this,y),delete y.features)};return{listener:o,targets:t,delegates:{[h]:g}}}}on(h,t,o){if(typeof t=="function"||o===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let d=this._createDelegatedListener(h,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(let g in d.delegates)this.on(g,d.delegates[g]);return this}once(h,t,o){if(typeof t=="function"||o===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let d=this._createDelegatedListener(h,t,o);for(let g in d.delegates)this.once(g,d.delegates[g]);return this}off(h,t,o){if(typeof t=="function"||o===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let d=this._delegatedListeners?this._delegatedListeners[h]:void 0;return d&&(g=>{for(let y=0;y<g.length;y++){let x=g[y];if(x.listener===o&&Ec(x.targets,t)){for(let C in x.delegates)this.off(C,x.delegates[C]);return g.splice(y,1),this}}})(d),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(t!==void 0||h===void 0||h instanceof n.P||Array.isArray(h)||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],"featureset"in(t=t||{}))return this._isFeaturesetDescriptorValid(t.featureset)?this.style.queryRenderedFeaturesForInteractions(h,[t],this.transform):[];if(t.layers&&Array.isArray(t.layers)){for(let o of t.layers)if(!this._isValidId(o))return[]}return this.style.queryRenderedFeatures(h,t,this.transform)}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}isPointOnSurface(h){let{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}setStyle(h,t){return t=n.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,(o,d)=>{o?(n.w(`Unable to perform style diff: ${String(o.message||o.error||o)}. Rebuilding the style from scratch.`),this._updateStyle(h,t)):d&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){let t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){let o=n.l({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new Ii(this,o).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ii(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new n.t(new Error("IDs can't be empty."))),!1):!n.aK(h)||(this.fire(new n.t(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isFeaturesetDescriptorValid(h){return"featuresetId"in h?this._isValidId(h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(let t of h)if(!this._isValidId(t))return!1;return!0}return this._isFeaturesetDescriptorValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,o)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:o=1,sdf:d=!1,stretchX:g,stretchY:y,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){let{width:C,height:A,data:O}=n.q.getImageData(t);this.style.addImage(h,{data:new n.r({width:C,height:A},O),pixelRatio:o,stretchX:g,stretchY:y,content:x,sdf:d,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new n.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:C,height:A}=t,O=t;this.style.addImage(h,{data:new n.r({width:C,height:A},new Uint8Array(O.data)),pixelRatio:o,stretchX:g,stretchY:y,content:x,sdf:d,version:0,userImage:O}),O.onAdd&&O.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();let o=this.style.getImage(h);if(!o)return void this.fire(new n.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let d=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.q.getImageData(t):t,{width:g,height:y,data:x}=d;if(g===void 0||y===void 0)return void this.fire(new n.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==o.data.width||y!==o.data.height)return void this.fire(new n.t(new Error(`The width and height of the updated image (${g}, ${y})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));let C=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);o.data.replace(x,C),this.style.updateImage(h,o)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new n.t(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){n.o(this._requestManager.transformRequest(h,n.R.Image),(o,d)=>{t(o,d instanceof HTMLImageElement?n.q.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new n.t(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){let t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;let t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,o){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,o),this._update(!0)):this}setFilter(h,t,o={}){return this._isValidId(h)?(this.style.setFilter(h,t,o),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,o,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,o,d),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,o,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,o,d),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,o){return this.style.setConfigProperty(h,t,o),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){let t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.bL.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;let h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300,o,d,g,y=this._container;for(;y&&(!d||!g);){let x=window.getComputedStyle(y).transform;x&&x!=="none"&&(o=x.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(d=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(g=o[3])),y=y.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=We("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();let t=this._canvasContainer=We("div","mapboxgl-canvas-container",h);this._canvas=We("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let o=this._controlContainer=We("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{d[g]=We("div",`mapboxgl-ctrl-${g}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){let o=n.q.devicePixelRatio||1;this._canvas.width=o*Math.ceil(h),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){let t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){let t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){let h=n.l({},Ye.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(ps(t,!0),this.painter=new Ts(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.m.testSupport(t)):this.fire(new n.t(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.x("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new n.x("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new n.x("renderstart")),++this._frameId;let o=this.painter.context.extTimerQuery,d=n.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=g.createQuery(),g.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();let y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let O=this.transform.zoom,R=this.transform.pitch,F=n.q.now(),z=new n.a3(O,{now:F,fadeDuration:y,pitch:R,transition:this.style.transition});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(d);let C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,$.mark(U.load),this.fire(new n.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){let O=n.q.now()-d;g.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{let R=g.getQueryParameter(t,g.QUERY_RESULT)/1e6;g.deleteQuery(t),this.fire(new n.x("gpu-timing-frame",{cpuTime:O,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){let O=this.painter.collectGpuTimers();setTimeout(()=>{let R=this.painter.queryGpuTimers(O);this.fire(new n.x("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){let O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let R=this.painter.queryGpuTimeDeferredRender(O);this.fire(new n.x("gpu-timing-deferred-render",{gpuTime:R}))},50)}let A=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(A||this._repaint)this.triggerRepaint();else{let O=this.idle();if(O&&(x=this._updateAverageElevation(d,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new n.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let R=this._calculateSpeedIndex();this.fire(new n.x("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,$.mark(U.fullLoad),this._performanceMetricsCollection&&zl(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(let t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(let t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){let o=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);let d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){let g=this.transform.averageElevation,y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=h;let x=Math.abs(g-y);if(x>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(y),o(y);this._averageElevation.easeTo(y,h,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),o(y)}return!!this._averageElevation.isEasing(h)&&o(this._averageElevation.getValue(h))}_authenticate(){we(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===fs||h.status===401)){let t=this.painter.context.gl;ps(t,!1),this._logoControl instanceof gf&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Nl(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Li(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){let h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());let o=this.painter.context.gl,d=o.createFramebuffer();function g(y){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,y,0);let x=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,x),x}return o.bindFramebuffer(o.FRAMEBUFFER,d),this._canvasPixelComparison(g(h),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(h,t,o){let d=o[1]-o[0],g=h.length/4;for(let y=0;y<t.length;y++){let x=t[y],C=0;for(let A=0;A<x.length;A+=4)x[A]===h[A]&&x[A+1]===h[A+1]&&x[A+2]===h[A+2]&&x[A+3]===h[A+3]&&(C+=1);d+=(o[y+2]-o[y+1])*(1-C/g)}return d}remove(){this._hash&&this._hash.remove();for(let t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Fo.delete(this.painter.context.gl),Vs.remove(),Gt.remove(),this._removed=!0,this.fire(new n.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=n.q.frame(t=>{let o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)}))}_preloadTiles(h){let t=this.style?this.style.getSourceCaches():[];return n.bg(t,(o,d)=>o._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,t){n.dy(h,t)}get version(){return P}},NavigationControl:class{constructor(h={}){this.options=n.l({},Zo,h),this._container=We("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),We("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),We("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{let o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))}),this._compassIcon=We("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let h=this._map;if(!h)return;let t=h.getZoom(),o=t===h.getMaxZoom(),d=t===h.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){let h=this._map;if(!h)return;let t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new eo(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){let h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){let o=We("button",h,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(h,t){if(!this._map)return;let o=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",o),h.firstElementChild&&h.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends n.E{constructor(h={}){super();let t=navigator.geolocation;this.options=n.l({geolocation:t},Iv,h),n.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=qo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=We("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){let t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,h(o)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>t(o.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(h){let t=this._map.getMaxBounds(),o=h.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new n.x("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("geolocate",h)),this._finish()}}_updateCamera(h){let t=new n.bL(h.coords.longitude,h.coords.latitude),o=h.coords.accuracy,d=this._map.getBearing(),g=n.l({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),g,{geolocateSource:!0})}_updateMarker(h){if(h){let t=new n.bL(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let h=this._map.transform,t=n.bE(1,h._center.lat)*h.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=We("button","mapboxgl-ctrl-geolocate",this._container),We("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{let t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=We("div","mapboxgl-user-location"),this._dotElement.appendChild(We("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(We("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new xo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=We("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.x("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:nh,ScaleControl:class{constructor(h={}){this.options=n.l({},Sv,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let h=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,d=t._containerWidth/2-h/2,g=t.unproject([d,o]),y=t.unproject([d+h,o]),x=g.distanceTo(y);if(this.options.unit==="imperial"){let C=3.2808*x;C>5280?this._setScale(h,C/5280,"mile"):this._setScale(h,C,"foot")}else this.options.unit==="nautical"?this._setScale(h,x/1852,"nautical-mile"):x>=1e3?this._setScale(h,x/1e3,"kilometer"):this._setScale(h,x,"meter")}_setScale(h,t,o){this._map._requestDomTask(()=>{let d=function(y){let x=Math.pow(10,`${Math.floor(y)}`.length-1),C=y/x;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(A){let O=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*O)/O}(C),x*C}(t),g=d/t;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(d):`${d}&nbsp;${Dv[o]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=We("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:n.w("Full screen control 'container' must be a DOM element.")),n.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=We("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let h=this._fullscreenButton=We("button","mapboxgl-ctrl-fullscreen",this._controlContainer);We("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(h){super(),this.options=n.l(Object.create(Cv),h),n.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new n.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new n.x("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=n.bL.convert(h),this._pos=null,this._trackPointer=!1,this._update();let t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){let t=document.createDocumentFragment(),o=document.createElement("body"),d;for(o.innerHTML=h;d=o.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=We("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){let o=this._closeButton=We("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;let t=this._map,o=this._container,d=this._pos;if(!t||!o||!d)return"bottom";let g=o.offsetWidth,y=o.offsetHeight,x=d.x<g/2,C=d.x>t.transform.width-g/2;if(d.y+h<y)return x?"top-left":C?"top-right":"top";if(d.y>t.transform.height-y){if(x)return"bottom-left";if(C)return"bottom-right"}return x?"left":C?"right":"bottom"}_updateClassList(){let h=this._container;if(!h)return;let t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){let t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let d=this._container;if(d||(d=this._container=We("div","mapboxgl-popup",t.getContainer()),this._tip=We("div","mapboxgl-popup-tip",d),d.appendChild(o)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xo(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){let g=this._pos=this._trackPointer&&h instanceof n.P?h:t.project(this._lngLat),y=Hr(this.options.offset),x=this._anchor=this._getAnchor(y.y),C=Hr(this.options.offset,x),A=g.add(C).round();t._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${Yo[x]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._showingGlobe()){let g=n.dz(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let h=this._container.querySelector(ig);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:xo,Style:Ii,LngLat:n.bL,LngLatBounds:n.as,Point:n.P,MercatorCoordinate:n.a5,FreeCameraOptions:vs,Evented:n.E,config:n.e,prewarm:n.dE,clearPrewarmedResources:n.dF,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(h){n.e.ACCESS_TOKEN=h},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(h){n.e.API_URL=h},get workerCount(){return n.dG.workerCount},set workerCount(h){n.dG.workerCount=h},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){n.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){n.dH(h)},get workerUrl(){return n.dI.workerUrl},set workerUrl(h){n.dI.workerUrl=h},get workerClass(){return n.dI.workerClass},set workerClass(h){n.dI.workerClass=h},get workerParams(){return n.dI.workerParams},set workerParams(h){n.dI.workerParams=h},get dracoUrl(){return n.dJ()},set dracoUrl(h){n.dK(h)},get meshoptUrl(){return n.dL()},set meshoptUrl(h){n.dM(h)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var b=c;return b})});var nu=$n((WW,WA)=>{"use strict";WA.exports=k5;var L5=Object.prototype.hasOwnProperty;function k5(){for(var i={},a=0;a<arguments.length;a++){var c=arguments[a];for(var m in c)L5.call(c,m)&&(i[m]=c[m])}return i}});var YA=$n((ZA,XA)=>{"use strict";(function(){var i=this,a={};typeof ZA<"u"?XA.exports=a:i.fuzzy=a,a.simpleFilter=function(c,m){return m.filter(function(b){return a.test(c,b)})},a.test=function(c,m){return a.match(c,m)!==null},a.match=function(c,m,b){b=b||{};var n=0,P=[],U=m.length,$=0,se=0,Te=b.pre||"",Pe=b.post||"",Ye=b.caseSensitive&&m||m.toLowerCase(),We;c=b.caseSensitive&&c||c.toLowerCase();for(var pt=0;pt<U;pt++)We=m[pt],Ye[pt]===c[n]?(We=Te+We+Pe,n+=1,se+=1+se):se=0,$+=se,P[P.length]=We;return n===c.length?($=Ye===c?1/0:$,{rendered:P.join(""),score:$}):null},a.filter=function(c,m,b){return!m||m.length===0?[]:typeof c!="string"?m:(b=b||{},m.reduce(function(n,P,U,$){var se=P;b.extract&&(se=b.extract(P));var Te=a.match(c,se,b);return Te!=null&&(n[n.length]={string:Te.rendered,score:Te.score,index:U,original:P}),n},[]).sort(function(n,P){var U=P.score-n.score;return U||n.index-P.index}))}})()});var KA=$n((ZW,JA)=>{"use strict";var Gi=function(i){return this.component=i,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,i.el.parentNode.insertBefore(this.wrapper,i.el.nextSibling),this};Gi.prototype.show=function(){this.element.style.display="block"};Gi.prototype.hide=function(){this.element.style.display="none"};Gi.prototype.add=function(i){this.items.push(i)};Gi.prototype.clear=function(){this.items=[],this.active=0};Gi.prototype.isEmpty=function(){return!this.items.length};Gi.prototype.isVisible=function(){return this.element.style.display==="block"};Gi.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var i=0;i<this.items.length;i++)this.drawItem(this.items[i],this.active===i);this.show()};Gi.prototype.drawItem=function(i,a){var c=document.createElement("li"),m=document.createElement("a");a&&(c.className+=" active"),m.innerHTML=i.string,c.appendChild(m),this.element.appendChild(c),c.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),c.addEventListener("mouseup",function(){this.handleMouseUp.call(this,i)}.bind(this))};Gi.prototype.handleMouseUp=function(i){this.selectingListItem=!1,this.component.value(i.original),this.clear(),this.draw()};Gi.prototype.move=function(i){this.active=i,this.draw()};Gi.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Gi.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Gi.prototype.drawError=function(i){var a=document.createElement("li");a.innerHTML=i,this.element.appendChild(a),this.show()};JA.exports=Gi});var e2=$n((XW,QA)=>{"use strict";var F5=nu(),N5=YA(),z5=KA(),yi=function(i,a,c){return c=c||{},this.options=F5({minLength:2,limit:5,filter:!0,hideOnBlur:!0},c),this.el=i,this.data=a||[],this.list=new z5(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(m){this.handleKeyUp(m.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(m){this.handleKeyDown(m)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(m){this.handlePaste(m)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};yi.prototype.handleKeyUp=function(i){i===40||i===38||i===27||i===13||i===9||this.handleInputChange(this.el.value)};yi.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};yi.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};yi.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var a=this;setTimeout(function(){a.handleInputChange(i.target.value)},100)}};yi.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(a){for(var c=0;c<a.length&&(this.list.add(a[c]),c!==this.options.limit-1);c++);this.list.draw()}.bind(this))};yi.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};yi.prototype.update=function(i){this.data=i,this.handleKeyUp()};yi.prototype.clear=function(){this.data=[],this.list.clear()};yi.prototype.normalize=function(i){return i=i.toLowerCase(),i};yi.prototype.match=function(i,a){return i.indexOf(a)>-1};yi.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i),document.createEvent){var a=document.createEvent("HTMLEvents");a.initEvent("change",!0,!1),this.el.dispatchEvent(a)}else this.el.fireEvent("onchange")};yi.prototype.getCandidates=function(i){var a={pre:"<strong>",post:"</strong>",extract:function(m){return this.getItemValue(m)}.bind(this)},c;this.options.filter?(c=N5.filter(this.query,this.data,a),c=c.map(function(m){return{original:m.original,string:this.render(m.original,m.string)}}.bind(this))):c=this.data.map(function(m){var b=this.render(m);return{original:m,string:b}}.bind(this)),i(c)};yi.prototype.getItemValue=function(i){return i};yi.prototype.render=function(i,a){if(a)return a;for(var c=i.original?this.getItemValue(i.original):this.getItemValue(i),m=this.normalize(c),b=m.lastIndexOf(this.query);b>-1;){var n=b+this.query.length;c=c.slice(0,b)+"<strong>"+c.slice(b,n)+"</strong>"+c.slice(n),b=m.slice(0,b).lastIndexOf(this.query)}return c};yi.prototype.renderError=function(i){this.list.drawError(i)};QA.exports=yi});var r2=$n((YW,n2)=>{"use strict";var t2=e2();n2.exports=t2;typeof window<"u"&&(window.Suggestions=t2)});var a2=$n((JW,s2)=>{"use strict";var B5="Expected a function",i2=NaN,V5="[object Symbol]",j5=/^\s+|\s+$/g,U5=/^[-+]0x[0-9a-f]+$/i,$5=/^0b[01]+$/i,G5=/^0o[0-7]+$/i,H5=parseInt,q5=typeof global=="object"&&global&&global.Object===Object&&global,W5=typeof self=="object"&&self&&self.Object===Object&&self,Z5=q5||W5||Function("return this")(),X5=Object.prototype,Y5=X5.toString,J5=Math.max,K5=Math.min,J1=function(){return Z5.Date.now()};function Q5(i,a,c){var m,b,n,P,U,$,se=0,Te=!1,Pe=!1,Ye=!0;if(typeof i!="function")throw new TypeError(B5);a=o2(a)||0,K1(c)&&(Te=!!c.leading,Pe="maxWait"in c,n=Pe?J5(o2(c.maxWait)||0,a):n,Ye="trailing"in c?!!c.trailing:Ye);function We(xn){var xr=m,Ct=b;return m=b=void 0,se=xn,P=i.apply(Ct,xr),P}function pt(xn){return se=xn,U=setTimeout(an,a),Te?We(xn):P}function _t(xn){var xr=xn-$,Ct=xn-se,Rt=a-xr;return Pe?K5(Rt,n-Ct):Rt}function on(xn){var xr=xn-$,Ct=xn-se;return $===void 0||xr>=a||xr<0||Pe&&Ct>=n}function an(){var xn=J1();if(on(xn))return Ft(xn);U=setTimeout(an,_t(xn))}function Ft(xn){return U=void 0,Ye&&m?We(xn):(m=b=void 0,P)}function mr(){U!==void 0&&clearTimeout(U),se=0,m=$=b=U=void 0}function Dn(){return U===void 0?P:Ft(J1())}function St(){var xn=J1(),xr=on(xn);if(m=arguments,b=this,$=xn,xr){if(U===void 0)return pt($);if(Pe)return U=setTimeout(an,a),We($)}return U===void 0&&(U=setTimeout(an,a)),P}return St.cancel=mr,St.flush=Dn,St}function K1(i){var a=typeof i;return!!i&&(a=="object"||a=="function")}function eV(i){return!!i&&typeof i=="object"}function tV(i){return typeof i=="symbol"||eV(i)&&Y5.call(i)==V5}function o2(i){if(typeof i=="number")return i;if(tV(i))return i2;if(K1(i)){var a=typeof i.valueOf=="function"?i.valueOf():i;i=K1(a)?a+"":a}if(typeof i!="string")return i===0?i:+i;i=i.replace(j5,"");var c=$5.test(i);return c||G5.test(i)?H5(i.slice(2),c?2:8):U5.test(i)?i2:+i}s2.exports=Q5});var y2=$n((KW,Q1)=>{"use strict";var nd=typeof Reflect=="object"?Reflect:null,l2=nd&&typeof nd.apply=="function"?nd.apply:function(a,c,m){return Function.prototype.apply.call(a,c,m)},Hy;nd&&typeof nd.ownKeys=="function"?Hy=nd.ownKeys:Object.getOwnPropertySymbols?Hy=function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:Hy=function(a){return Object.getOwnPropertyNames(a)};function nV(i){console&&console.warn&&console.warn(i)}var u2=Number.isNaN||function(a){return a!==a};function pr(){pr.init.call(this)}Q1.exports=pr;Q1.exports.once=sV;pr.EventEmitter=pr;pr.prototype._events=void 0;pr.prototype._eventsCount=0;pr.prototype._maxListeners=void 0;var c2=10;function qy(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(pr,"defaultMaxListeners",{enumerable:!0,get:function(){return c2},set:function(i){if(typeof i!="number"||i<0||u2(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");c2=i}});pr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};pr.prototype.setMaxListeners=function(a){if(typeof a!="number"||a<0||u2(a))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+a+".");return this._maxListeners=a,this};function h2(i){return i._maxListeners===void 0?pr.defaultMaxListeners:i._maxListeners}pr.prototype.getMaxListeners=function(){return h2(this)};pr.prototype.emit=function(a){for(var c=[],m=1;m<arguments.length;m++)c.push(arguments[m]);var b=a==="error",n=this._events;if(n!==void 0)b=b&&n.error===void 0;else if(!b)return!1;if(b){var P;if(c.length>0&&(P=c[0]),P instanceof Error)throw P;var U=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw U.context=P,U}var $=n[a];if($===void 0)return!1;if(typeof $=="function")l2($,this,c);else for(var se=$.length,Te=g2($,se),m=0;m<se;++m)l2(Te[m],this,c);return!0};function d2(i,a,c,m){var b,n,P;if(qy(c),n=i._events,n===void 0?(n=i._events=Object.create(null),i._eventsCount=0):(n.newListener!==void 0&&(i.emit("newListener",a,c.listener?c.listener:c),n=i._events),P=n[a]),P===void 0)P=n[a]=c,++i._eventsCount;else if(typeof P=="function"?P=n[a]=m?[c,P]:[P,c]:m?P.unshift(c):P.push(c),b=h2(i),b>0&&P.length>b&&!P.warned){P.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(a)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=i,U.type=a,U.count=P.length,nV(U)}return i}pr.prototype.addListener=function(a,c){return d2(this,a,c,!1)};pr.prototype.on=pr.prototype.addListener;pr.prototype.prependListener=function(a,c){return d2(this,a,c,!0)};function rV(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f2(i,a,c){var m={fired:!1,wrapFn:void 0,target:i,type:a,listener:c},b=rV.bind(m);return b.listener=c,m.wrapFn=b,b}pr.prototype.once=function(a,c){return qy(c),this.on(a,f2(this,a,c)),this};pr.prototype.prependOnceListener=function(a,c){return qy(c),this.prependListener(a,f2(this,a,c)),this};pr.prototype.removeListener=function(a,c){var m,b,n,P,U;if(qy(c),b=this._events,b===void 0)return this;if(m=b[a],m===void 0)return this;if(m===c||m.listener===c)--this._eventsCount===0?this._events=Object.create(null):(delete b[a],b.removeListener&&this.emit("removeListener",a,m.listener||c));else if(typeof m!="function"){for(n=-1,P=m.length-1;P>=0;P--)if(m[P]===c||m[P].listener===c){U=m[P].listener,n=P;break}if(n<0)return this;n===0?m.shift():iV(m,n),m.length===1&&(b[a]=m[0]),b.removeListener!==void 0&&this.emit("removeListener",a,U||c)}return this};pr.prototype.off=pr.prototype.removeListener;pr.prototype.removeAllListeners=function(a){var c,m,b;if(m=this._events,m===void 0)return this;if(m.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):m[a]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete m[a]),this;if(arguments.length===0){var n=Object.keys(m),P;for(b=0;b<n.length;++b)P=n[b],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(c=m[a],typeof c=="function")this.removeListener(a,c);else if(c!==void 0)for(b=c.length-1;b>=0;b--)this.removeListener(a,c[b]);return this};function p2(i,a,c){var m=i._events;if(m===void 0)return[];var b=m[a];return b===void 0?[]:typeof b=="function"?c?[b.listener||b]:[b]:c?oV(b):g2(b,b.length)}pr.prototype.listeners=function(a){return p2(this,a,!0)};pr.prototype.rawListeners=function(a){return p2(this,a,!1)};pr.listenerCount=function(i,a){return typeof i.listenerCount=="function"?i.listenerCount(a):m2.call(i,a)};pr.prototype.listenerCount=m2;function m2(i){var a=this._events;if(a!==void 0){var c=a[i];if(typeof c=="function")return 1;if(c!==void 0)return c.length}return 0}pr.prototype.eventNames=function(){return this._eventsCount>0?Hy(this._events):[]};function g2(i,a){for(var c=new Array(a),m=0;m<a;++m)c[m]=i[m];return c}function iV(i,a){for(;a+1<i.length;a++)i[a]=i[a+1];i.pop()}function oV(i){for(var a=new Array(i.length),c=0;c<a.length;++c)a[c]=i[c].listener||i[c];return a}function sV(i,a){return new Promise(function(c,m){function b(P){i.removeListener(a,n),m(P)}function n(){typeof i.removeListener=="function"&&i.removeListener("error",b),c([].slice.call(arguments))}_2(i,a,n,{once:!0}),a!=="error"&&aV(i,b,{once:!0})})}function aV(i,a,c){typeof i.on=="function"&&_2(i,"error",a,c)}function _2(i,a,c,m){if(typeof i.on=="function")m.once?i.once(a,c):i.on(a,c);else if(typeof i.addEventListener=="function")i.addEventListener(a,function b(n){m.once&&i.removeEventListener(a,b),c(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}});var x2=$n((QW,v2)=>{"use strict";v2.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}});var w2=$n((eZ,b2)=>{"use strict";function lV(i){var a=i.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return a?{key:a[1],value:a[2]}:null}function cV(i){var a=i.match(/<?([^>]*)>(.*)/);if(!a)return null;var c=a[1],m=a[2].split(";"),b=null,n=m.reduce(function(P,U){var $=lV(U);return $?$.key==="rel"?(b||(b=$.value),P):(P[$.key]=$.value,P):P},{});return b?{url:c,rel:b,params:n}:null}function uV(i){return i?i.split(/,\s*</).reduce(function(a,c){var m=cV(c);if(!m)return a;var b=m.rel.split(/\s+/);return b.forEach(function(n){a[n]||(a[n]={url:m.url,params:m.params})}),a},{}):{}}b2.exports=uV});var T2=$n((tZ,E2)=>{"use strict";var hV=w2();function ew(i,a){this.request=i,this.headers=a.headers,this.rawBody=a.body,this.statusCode=a.statusCode;try{this.body=JSON.parse(a.body||"{}")}catch{this.body=a.body}this.links=hV(this.headers.link)}ew.prototype.hasNextPage=function(){return!!this.links.next};ew.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};E2.exports=ew});var Qp=$n((nZ,I2)=>{"use strict";I2.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}});var C2=$n((rZ,D2)=>{"use strict";var S2=Qp();function dV(i){var a=i.type||S2.ERROR_HTTP,c;if(i.body)try{c=JSON.parse(i.body)}catch{c=i.body}else c=null;var m=i.message||null;m||(typeof c=="string"?m=c:c&&typeof c.message=="string"?m=c.message:a===S2.ERROR_REQUEST_ABORTED&&(m="Request aborted")),this.message=m,this.type=a,this.statusCode=i.statusCode||null,this.request=i.request,this.body=c}D2.exports=dV});var A2=$n((iZ,M2)=>{"use strict";function fV(i){var a=i.indexOf(":"),c=i.substring(0,a).trim().toLowerCase(),m=i.substring(a+1).trim();return{name:c,value:m}}function pV(i){var a={};return i&&i.trim().split(/[\r|\n]+/).forEach(function(c){var m=fV(c);a[m.name]=m.value}),a}M2.exports=pV});var F2=$n((oZ,k2)=>{"use strict";var mV=T2(),R2=C2(),tw=Qp(),gV=A2(),Wy={};function _V(i){var a=Wy[i.id];a&&(a.abort(),delete Wy[i.id])}function yV(i,a){return new mV(i,{body:a.response,headers:gV(a.getAllResponseHeaders()),statusCode:a.status})}function P2(i){var a=i.total,c=i.loaded,m=100*c/a;return{total:a,transferred:c,percent:m}}function O2(i,a){return new Promise(function(c,m){a.onprogress=function(P){i.emitter.emit(tw.EVENT_PROGRESS_DOWNLOAD,P2(P))};var b=i.file;b&&(a.upload.onprogress=function(P){i.emitter.emit(tw.EVENT_PROGRESS_UPLOAD,P2(P))}),a.onerror=function(P){m(P)},a.onabort=function(){var P=new R2({request:i,type:tw.ERROR_REQUEST_ABORTED});m(P)},a.onload=function(){if(delete Wy[i.id],a.status<200||a.status>=400){var P=new R2({request:i,body:a.response,statusCode:a.status});m(P);return}c(a)};var n=i.body;typeof n=="string"?a.send(n):n?a.send(JSON.stringify(n)):b?a.send(b):a.send(),Wy[i.id]=a}).then(function(c){return yV(i,c)})}function L2(i,a){var c=i.url(a),m=new window.XMLHttpRequest;return m.open(i.method,c),Object.keys(i.headers).forEach(function(b){m.setRequestHeader(b,i.headers[b])}),m}function vV(i){return Promise.resolve().then(function(){var a=L2(i,i.client.accessToken);return O2(i,a)})}k2.exports={browserAbort:_V,sendRequestXhr:O2,browserSend:vV,createRequestXhr:L2}});var N2=$n((Zy,em)=>{"use strict";(function(i){var a=typeof Zy=="object"&&Zy,c=typeof em=="object"&&em&&em.exports==a&&em,m=typeof global=="object"&&global;(m.global===m||m.window===m)&&(i=m);var b=function(Ye){this.message=Ye};b.prototype=new Error,b.prototype.name="InvalidCharacterError";var n=function(Ye){throw new b(Ye)},P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=/[\t\n\f\r ]/g,$=function(Ye){Ye=String(Ye).replace(U,"");var We=Ye.length;We%4==0&&(Ye=Ye.replace(/==?$/,""),We=Ye.length),(We%4==1||/[^+a-zA-Z0-9/]/.test(Ye))&&n("Invalid character: the string to be decoded is not correctly encoded.");for(var pt=0,_t,on,an="",Ft=-1;++Ft<We;)on=P.indexOf(Ye.charAt(Ft)),_t=pt%4?_t*64+on:on,pt++%4&&(an+=String.fromCharCode(255&_t>>(-2*pt&6)));return an},se=function(Ye){Ye=String(Ye),/[^\0-\xFF]/.test(Ye)&&n("The string to be encoded contains characters outside of the Latin1 range.");for(var We=Ye.length%3,pt="",_t=-1,on,an,Ft,mr,Dn,St=Ye.length-We;++_t<St;)on=Ye.charCodeAt(_t)<<16,an=Ye.charCodeAt(++_t)<<8,Ft=Ye.charCodeAt(++_t),Dn=on+an+Ft,pt+=P.charAt(Dn>>18&63)+P.charAt(Dn>>12&63)+P.charAt(Dn>>6&63)+P.charAt(Dn&63);return We==2?(on=Ye.charCodeAt(_t)<<8,an=Ye.charCodeAt(++_t),Dn=on+an,pt+=P.charAt(Dn>>10)+P.charAt(Dn>>4&63)+P.charAt(Dn<<2&63)+"="):We==1&&(Dn=Ye.charCodeAt(_t),pt+=P.charAt(Dn>>2)+P.charAt(Dn<<4&63)+"=="),pt},Te={encode:se,decode:$,version:"0.1.0"};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd)define(function(){return Te});else if(a&&!a.nodeType)if(c)c.exports=Te;else for(var Pe in Te)Te.hasOwnProperty(Pe)&&(a[Pe]=Te[Pe]);else i.base64=Te})(Zy)});var rw=$n((sZ,z2)=>{"use strict";var xV=N2(),nw={};function bV(i){if(nw[i])return nw[i];var a=i.split("."),c=a[0],m=a[1];if(!m)throw new Error("Invalid token");var b=wV(m),n={usage:c,user:b.u};return ru(b,"a")&&(n.authorization=b.a),ru(b,"exp")&&(n.expires=b.exp*1e3),ru(b,"iat")&&(n.created=b.iat*1e3),ru(b,"scopes")&&(n.scopes=b.scopes),ru(b,"client")&&(n.client=b.client),ru(b,"ll")&&(n.lastLogin=b.ll),ru(b,"iu")&&(n.impersonator=b.iu),nw[i]=n,n}function wV(i){try{return JSON.parse(xV.decode(i))}catch{throw new Error("Invalid token")}}function ru(i,a){return Object.prototype.hasOwnProperty.call(i,a)}z2.exports=bV});var V2=$n((aZ,iw)=>{"use strict";var EV=Object.prototype.hasOwnProperty,Oi="~";function tm(){}Object.create&&(tm.prototype=Object.create(null),new tm().__proto__||(Oi=!1));function TV(i,a,c){this.fn=i,this.context=a,this.once=c||!1}function B2(i,a,c,m,b){if(typeof c!="function")throw new TypeError("The listener must be a function");var n=new TV(c,m||i,b),P=Oi?Oi+a:a;return i._events[P]?i._events[P].fn?i._events[P]=[i._events[P],n]:i._events[P].push(n):(i._events[P]=n,i._eventsCount++),i}function Xy(i,a){--i._eventsCount===0?i._events=new tm:delete i._events[a]}function vi(){this._events=new tm,this._eventsCount=0}vi.prototype.eventNames=function(){var a=[],c,m;if(this._eventsCount===0)return a;for(m in c=this._events)EV.call(c,m)&&a.push(Oi?m.slice(1):m);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(c)):a};vi.prototype.listeners=function(a){var c=Oi?Oi+a:a,m=this._events[c];if(!m)return[];if(m.fn)return[m.fn];for(var b=0,n=m.length,P=new Array(n);b<n;b++)P[b]=m[b].fn;return P};vi.prototype.listenerCount=function(a){var c=Oi?Oi+a:a,m=this._events[c];return m?m.fn?1:m.length:0};vi.prototype.emit=function(a,c,m,b,n,P){var U=Oi?Oi+a:a;if(!this._events[U])return!1;var $=this._events[U],se=arguments.length,Te,Pe;if($.fn){switch($.once&&this.removeListener(a,$.fn,void 0,!0),se){case 1:return $.fn.call($.context),!0;case 2:return $.fn.call($.context,c),!0;case 3:return $.fn.call($.context,c,m),!0;case 4:return $.fn.call($.context,c,m,b),!0;case 5:return $.fn.call($.context,c,m,b,n),!0;case 6:return $.fn.call($.context,c,m,b,n,P),!0}for(Pe=1,Te=new Array(se-1);Pe<se;Pe++)Te[Pe-1]=arguments[Pe];$.fn.apply($.context,Te)}else{var Ye=$.length,We;for(Pe=0;Pe<Ye;Pe++)switch($[Pe].once&&this.removeListener(a,$[Pe].fn,void 0,!0),se){case 1:$[Pe].fn.call($[Pe].context);break;case 2:$[Pe].fn.call($[Pe].context,c);break;case 3:$[Pe].fn.call($[Pe].context,c,m);break;case 4:$[Pe].fn.call($[Pe].context,c,m,b);break;default:if(!Te)for(We=1,Te=new Array(se-1);We<se;We++)Te[We-1]=arguments[We];$[Pe].fn.apply($[Pe].context,Te)}}return!0};vi.prototype.on=function(a,c,m){return B2(this,a,c,m,!1)};vi.prototype.once=function(a,c,m){return B2(this,a,c,m,!0)};vi.prototype.removeListener=function(a,c,m,b){var n=Oi?Oi+a:a;if(!this._events[n])return this;if(!c)return Xy(this,n),this;var P=this._events[n];if(P.fn)P.fn===c&&(!b||P.once)&&(!m||P.context===m)&&Xy(this,n);else{for(var U=0,$=[],se=P.length;U<se;U++)(P[U].fn!==c||b&&!P[U].once||m&&P[U].context!==m)&&$.push(P[U]);$.length?this._events[n]=$.length===1?$[0]:$:Xy(this,n)}return this};vi.prototype.removeAllListeners=function(a){var c;return a?(c=Oi?Oi+a:a,this._events[c]&&Xy(this,c)):(this._events=new tm,this._eventsCount=0),this};vi.prototype.off=vi.prototype.removeListener;vi.prototype.addListener=vi.prototype.on;vi.prefixed=Oi;vi.EventEmitter=vi;typeof iw<"u"&&(iw.exports=vi)});var G2=$n((lZ,$2)=>{"use strict";function IV(i){return i.map(encodeURIComponent).join(",")}function j2(i){return Array.isArray(i)?IV(i):encodeURIComponent(String(i))}function U2(i,a,c){if(c===!1||c===null)return i;var m=/\?/.test(i)?"&":"?",b=encodeURIComponent(a);return c!==void 0&&c!==""&&c!==!0&&(b+="="+j2(c)),""+i+m+b}function SV(i,a){if(!a)return i;var c=i;return Object.keys(a).forEach(function(m){var b=a[m];b!==void 0&&(Array.isArray(b)&&(b=b.filter(function(n){return n!=null}).join(",")),c=U2(c,m,b))}),c}function DV(i,a){if(!a||i.slice(0,4)==="http")return i;var c=i[0]==="/"?"":"/";return""+a.replace(/\/$/,"")+c+i}function CV(i,a){return a?i.replace(/\/:([a-zA-Z0-9]+)/g,function(c,m){var b=a[m];if(b===void 0)throw new Error("Unspecified route parameter "+m);var n=j2(b);return"/"+n}):i}$2.exports={appendQueryObject:SV,appendQueryParam:U2,prependOrigin:DV,interpolateRouteParams:CV}});var W2=$n((cZ,q2)=>{"use strict";var MV=rw(),ow=nu(),AV=V2(),Yy=G2(),H2=Qp(),RV=1;function Ol(i,a){if(!i)throw new Error("MapiRequest requires a client");if(!a||!a.path||!a.method)throw new Error("MapiRequest requires an options object with path and method properties");var c={};a.body&&(c["content-type"]="application/json");var m=ow(c,a.headers),b=Object.keys(m).reduce(function(n,P){return n[P.toLowerCase()]=m[P],n},{});this.id=RV++,this._options=a,this.emitter=new AV,this.client=i,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=a.path,this.method=a.method,this.origin=a.origin||i.origin,this.query=a.query||{},this.params=a.params||{},this.body=a.body||null,this.file=a.file||null,this.encoding=a.encoding||"utf8",this.sendFileAs=a.sendFileAs||null,this.headers=b}Ol.prototype.url=function(a){var c=Yy.prependOrigin(this.path,this.origin);c=Yy.appendQueryObject(c,this.query);var m=this.params,b=a??this.client.accessToken;if(b){c=Yy.appendQueryParam(c,"access_token",b);var n=MV(b).user;m=ow({ownerId:n},m)}return c=Yy.interpolateRouteParams(c,m),c};Ol.prototype.send=function(){var a=this;if(a.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return a.sent=!0,a.client.sendRequest(a).then(function(c){return a.response=c,a.emitter.emit(H2.EVENT_RESPONSE,c),c},function(c){throw a.error=c,a.emitter.emit(H2.EVENT_ERROR,c),c})};Ol.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Ol.prototype.eachPage=function(a){var c=this;function m(P){function U(){delete c._nextPageRequest;var $=P.nextPage();$&&(c._nextPageRequest=$,n($))}a(null,P,U)}function b(P){a(P,null,function(){})}function n(P){P.send().then(m,b)}n(this)};Ol.prototype.clone=function(){return this._extend()};Ol.prototype._extend=function(a){var c=ow(this._options,a);return new Ol(this.client,c)};q2.exports=Ol});var sw=$n((uZ,X2)=>{"use strict";var PV=rw(),OV=W2(),LV=Qp();function Z2(i){if(!i||!i.accessToken)throw new Error("Cannot create a client without an access token");PV(i.accessToken),this.accessToken=i.accessToken,this.origin=i.origin||LV.API_ORIGIN}Z2.prototype.createRequest=function(a){return new OV(this,a)};X2.exports=Z2});var aw=$n((hZ,K2)=>{"use strict";var Y2=F2(),J2=sw();function rd(i){J2.call(this,i)}rd.prototype=Object.create(J2.prototype);rd.prototype.constructor=rd;rd.prototype.sendRequest=Y2.browserSend;rd.prototype.abortRequest=Y2.browserAbort;function kV(i){return new rd(i)}K2.exports=kV});var eR=$n((dZ,Q2)=>{"use strict";var FV=aw();Q2.exports=FV});var nR=$n((fZ,tR)=>{"use strict";var NV=Object.prototype.toString;tR.exports=function(i){var a;return NV.call(i)==="[object Object]"&&(a=Object.getPrototypeOf(i),a===null||a===Object.getPrototypeOf({}))}});var lR=$n((pZ,aR)=>{"use strict";var zV=nR(),BV=nu(),rR="value",lw=`
  `,wr={};wr.assert=function(i,a){return a=a||{},function(c){var m=Ll(i,c);if(m){var b=cw(m,a);throw a.apiName&&(b=a.apiName+": "+b),new Error(b)}}};wr.shape=function(a){var c=$V(a);return function(b){var n=Ll(wr.plainObject,b);if(n)return n;for(var P,U,$=[],se=0;se<c.length;se++)P=c[se].key,U=c[se].value,n=Ll(U,b[P]),n&&$.push([P].concat(n));return $.length<2?$[0]:function(Te){$=$.map(function(We){var pt=We[0],_t=cw(We,Te).split(`
`).join(lw);return"- "+pt+": "+_t});var Pe=Te.path.join("."),Ye=Pe===rR?"":" of "+Pe;return"The following properties"+Ye+" have invalid values:"+lw+$.join(lw)}}};wr.strictShape=function(a){var c=wr.shape(a);return function(b){var n=c(b);if(n)return n;var P=Object.keys(b).reduce(function(U,$){return a[$]===void 0&&U.push($),U},[]);if(P.length!==0)return function(){return"The following keys are invalid: "+P.join(", ")}}};wr.arrayOf=function(a){return iR(a)};wr.tuple=function(){var a=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return iR(a)};function iR(i){var a=Array.isArray(i),c=function(m){return a?i[m]:i};return function(b){var n=Ll(wr.plainArray,b);if(n)return n;if(a&&b.length!==i.length)return"an array with "+i.length+" items";for(var P=0;P<b.length;P++)if(n=Ll(c(P),b[P]),n)return[P].concat(n)}}wr.required=function(a){function c(m){return m==null?function(b){return oR(b,sR(b.path)?"cannot be undefined/null.":"is required.")}:a.apply(this,arguments)}return c.__required=!0,c};wr.oneOfType=function(){var a=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(m){var b=a.map(function(n){return Ll(n,m)}).filter(Boolean);if(b.length===a.length)return b.every(function(n){return n.length===1&&typeof n[0]=="string"})?VV(b.map(function(n){return n[0]})):b.reduce(function(n,P){return P.length>n.length?P:n})}};wr.equal=function(a){return function(m){if(m!==a)return JSON.stringify(a)}};wr.oneOf=function(){var a=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),c=a.map(function(m){return wr.equal(m)});return wr.oneOfType.apply(this,c)};wr.range=function(a){var c=a[0],m=a[1];return function(n){var P=Ll(wr.number,n);if(P||n<c||n>m)return"number between "+c+" & "+m+" (inclusive)"}};wr.any=function(){};wr.boolean=function(a){if(typeof a!="boolean")return"boolean"};wr.number=function(a){if(typeof a!="number")return"number"};wr.plainArray=function(a){if(!Array.isArray(a))return"array"};wr.plainObject=function(a){if(!zV(a))return"object"};wr.string=function(a){if(typeof a!="string")return"string"};wr.func=function(a){if(typeof a!="function")return"function"};function Ll(i,a){if(!(a==null&&!i.hasOwnProperty("__required"))){var c=i(a);if(c)return Array.isArray(c)?c:[c]}}function cw(i,a){var c=i.length,m=i[c-1],b=i.slice(0,c-1);return b.length===0&&(b=[rR]),a=BV(a,{path:b}),typeof m=="function"?m(a):oR(a,jV(m))}function VV(i){return i.length<2?i[0]:i.length===2?i.join(" or "):i.slice(0,-1).join(", ")+", or "+i.slice(-1)}function jV(i){return"must be "+UV(i)+"."}function UV(i){return/^an? /.test(i)?i:/^[aeiou]/i.test(i)?"an "+i:/^[a-z]/i.test(i)?"a "+i:i}function oR(i,a){var c=sR(i.path),m=i.path.join(".")+" "+a,b=c?"Item at position ":"";return b+m}function sR(i){return typeof i[i.length-1]=="number"||typeof i[0]=="number"}function $V(i){return Object.keys(i||{}).map(function(a){return{key:a,value:i[a]}})}wr.validate=Ll;wr.processMessage=cw;aR.exports=wr});var uR=$n((mZ,cR)=>{"use strict";var GV=nu(),id=lR();function HV(i){if(typeof window<"u")return i instanceof global.Blob||i instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof i=="string"||i.pipe!==void 0))return"Filename or Readable stream"}function qV(i,a){return id.assert(id.strictShape(i),a)}function WV(i){var a="date";if(typeof i=="boolean")return a;try{var c=new Date(i);if(c.getTime&&isNaN(c.getTime()))return a}catch{return a}}function ZV(i){return id.tuple(id.number,id.number)(i)}cR.exports=GV(id,{file:HV,date:WV,coordinates:ZV,assertShape:qV})});var dR=$n((gZ,hR)=>{"use strict";function XV(i,a){var c=function(m,b){return a.indexOf(m)!==-1&&b!==void 0};return typeof a=="function"&&(c=a),Object.keys(i).filter(function(m){return c(m,i[m])}).reduce(function(m,b){return m[b]=i[b],m},{})}hR.exports=XV});var pR=$n((_Z,fR)=>{"use strict";function YV(i,a){return Object.keys(i).reduce(function(c,m){return c[m]=a(m,i[m]),c},{})}fR.exports=YV});var gR=$n((yZ,mR)=>{"use strict";var JV=pR();function KV(i){return JV(i,function(a,c){return typeof c=="boolean"?JSON.stringify(c):c})}mR.exports=KV});var yR=$n((vZ,_R)=>{"use strict";var QV=sw(),ej=aw();function tj(i){return function(a){var c;QV.prototype.isPrototypeOf(a)?c=a:c=ej(a);var m=Object.create(i);return m.client=c,m}}_R.exports=tj});var ER=$n((xZ,wR)=>{"use strict";var vR=nu(),Hn=uR(),Jy=dR(),xR=gR(),nj=yR(),uw={},bR=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];uw.forwardGeocode=function(i){Hn.assertShape({query:Hn.required(Hn.string),mode:Hn.oneOf("mapbox.places","mapbox.places-permanent"),countries:Hn.arrayOf(Hn.string),proximity:Hn.oneOf(Hn.coordinates,"ip"),types:Hn.arrayOf(Hn.oneOf(bR)),autocomplete:Hn.boolean,bbox:Hn.arrayOf(Hn.number),limit:Hn.number,language:Hn.arrayOf(Hn.string),routing:Hn.boolean,fuzzyMatch:Hn.boolean,worldview:Hn.string,session_token:Hn.string})(i),i.mode=i.mode||"mapbox.places";var a=xR(vR({country:i.countries},Jy(i,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Jy(i,["mode","query"]),query:a})};uw.reverseGeocode=function(i){Hn.assertShape({query:Hn.required(Hn.coordinates),mode:Hn.oneOf("mapbox.places","mapbox.places-permanent"),countries:Hn.arrayOf(Hn.string),types:Hn.arrayOf(Hn.oneOf(bR)),bbox:Hn.arrayOf(Hn.number),limit:Hn.number,language:Hn.arrayOf(Hn.string),reverseMode:Hn.oneOf("distance","score"),routing:Hn.boolean,worldview:Hn.string,session_token:Hn.string})(i),i.mode=i.mode||"mapbox.places";var a=xR(vR({country:i.countries},Jy(i,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Jy(i,["mode","query"]),query:a})};wR.exports=nj(uw)});var TR,IR=OI(()=>{"use strict";TR="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"});var CR={};OL(CR,{customAlphabet:()=>rj,customRandom:()=>DR,nanoid:()=>ij,random:()=>SR,urlAlphabet:()=>TR});var SR,DR,rj,ij,MR=OI(()=>{"use strict";IR();SR=i=>crypto.getRandomValues(new Uint8Array(i)),DR=(i,a,c)=>{let m=(2<<Math.log(i.length-1)/Math.LN2)-1,b=-~(1.6*m*a/i.length);return(n=a)=>{let P="";for(;;){let U=c(b),$=b;for(;$--;)if(P+=i[U[$]&m]||"",P.length===n)return P}}},rj=(i,a=21)=>DR(i,a,SR),ij=(i=21)=>crypto.getRandomValues(new Uint8Array(i)).reduce((a,c)=>(c&=63,c<36?a+=c.toString(36):c<62?a+=(c-26).toString(36).toUpperCase():c>62?a+="-":a+="_",a),"")});var PR=$n((EZ,RR)=>{"use strict";var oj=(MR(),LL(CR)).nanoid;function AR(i){this.origin=i.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=i.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=i,this.send=this.send.bind(this),this.countries=i.countries?i.countries.split(","):null,this.types=i.types?i.types.split(","):null,this.bbox=i.bbox?i.bbox:null,this.language=i.language?i.language.split(","):null,this.limit=i.limit?+i.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(i),this.eventQueue=new Array,this.flushInterval=i.flushInterval||1e3,this.maxQueueSize=i.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}AR.prototype={select:function(i,a){var c=this.getEventPayload("search.select",a,{selectedFeature:i});if(c&&!(c.resultIndex===this.lastSentIndex&&c.queryString===this.lastSentInput||c.resultIndex==-1))return this.lastSentIndex=c.resultIndex,this.lastSentInput=c.queryString,this.push(c)},start:function(i){var a=this.getEventPayload("search.start",i);if(a)return this.push(a)},keyevent:function(i,a){if(i.key&&!(i.metaKey||[9,27,37,39,13,38,40].indexOf(i.keyCode)!==-1)){var c=this.getEventPayload("search.keystroke",a,{key:i.key});if(c)return this.push(c)}},send:function(i,a){if(!this.enableEventLogging)return a?a():void 0;var c=this.getRequestOptions(i);this.request(c,function(m){if(m)return this.handleError(m,a);if(a)return a()}.bind(this))},getRequestOptions:function(i){Array.isArray(i)||(i=[i]);var a={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)};return a},getEventPayload:function(i,a,c={}){if(i==="search.select"&&!c.selectedFeature||i==="search.keystroke"&&!c.key)return null;var m;if(!a.options.proximity)m=null;else if(typeof a.options.proximity=="object")m=[a.options.proximity.longitude,a.options.proximity.latitude];else if(a.options.proximity==="ip"){var b=a._headers?a._headers["ip-proximity"]:null;b&&typeof b=="string"?m=b.split(",").map(parseFloat):m=[999,999]}else m=a.options.proximity;var n=a._map?a._map.getZoom():void 0,P={event:i,version:this.getEventSchemaVersion(i),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:a.options.autocomplete,fuzzyMatch:a.options.fuzzyMatch,proximity:m,limit:a.options.limit,routing:a.options.routing,worldview:a.options.worldview,mapZoom:n,keyboardLocale:this.locale};if(i==="search.select"?P.queryString=a.inputString:i!="search.select"&&a._inputEl?P.queryString=a._inputEl.value:P.queryString=a.inputString,["search.keystroke","search.select"].includes(i)&&(P.path="geocoding/v5/mapbox.places"),i==="search.keystroke"&&c.key)P.lastAction=c.key;else if(i==="search.select"&&c.selectedFeature){var U=c.selectedFeature,$=this.getSelectedIndex(U,a);if(P.resultIndex=$,P.resultPlaceName=U.place_name,P.resultId=U.id,U.properties&&(P.resultMapboxId=U.properties.mapbox_id),a._typeahead){var se=a._typeahead.data;se&&se.length>0&&(P.suggestionIds=this.getSuggestionIds(se),P.suggestionNames=this.getSuggestionNames(se),P.suggestionTypes=this.getSuggestionTypes(se),P.suggestionSources=this.getSuggestionSources(se))}}return this.validatePayload(P)?P:null},request:function(i,a){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(this.readyState==4)return this.status==204?a(null):a(this.statusText)},c.open(i.method,i.host+"/"+i.path,!0);for(var m in i.headers){var b=i.headers[m];c.setRequestHeader(m,b)}c.send(i.body)},handleError:function(i,a){if(a)return a(i)},generateSessionID:function(){return oj()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(i,a){if(a._typeahead){var c=a._typeahead.data,m=i.id,b=c.map(function(P){return P.id}),n=b.indexOf(m);return n}},getSuggestionIds:function(i){return i.map(function(a){return a.properties?a.properties.mapbox_id||"":a.id||""})},getSuggestionNames:function(i){return i.map(function(a){return a.place_name||""})},getSuggestionTypes:function(i){return i.map(function(a){return a.place_type&&Array.isArray(a.place_type)&&a.place_type[0]||""})},getSuggestionSources:function(i){return i.map(function(a){return a._source||""})},getEventSchemaVersion:function(i){return["search.keystroke","search.select"].includes(i)?"2.2":"2.0"},validatePayload:function(i){if(!i||!i.event)return!1;var a=["event","created","sessionIdentifier","queryString"],c=["event","created","sessionIdentifier","queryString","lastAction"],m=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],b=i.event;return b==="search.start"?this.objectHasRequiredProps(i,a):b==="search.keystroke"?this.objectHasRequiredProps(i,c):b==="search.select"?this.objectHasRequiredProps(i,m):!0},objectHasRequiredProps:function(i,a){return a.every(function(c){return c==="queryString"?typeof i[c]=="string"&&i[c].length>0:i[c]!==void 0})},shouldEnableLogging:function(i){return!(i.enableEventLogging===!1||i.origin&&i.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(i,a){this.eventQueue.push(i),(this.eventQueue.length>=this.maxQueueSize||a)&&this.flush()},remove:function(){this.flush()}};RR.exports=AR});var LR=$n((TZ,OR)=>{"use strict";var sj={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"};OR.exports={placeholder:sj}});var FR=$n((kR,Ky)=>{"use strict";(function(i,a,c){typeof Ky<"u"&&Ky.exports?Ky.exports=c():i[a]=c()})(kR,"subtag",function(){var i="",a=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function c(U){return U.match(a)||[]}function m(U){return c(U).filter(function($,se){return $&&se})}function b(U){return U=c(U),{language:U[1]||i,extlang:U[2]||i,script:U[3]||i,region:U[4]||i}}function n(U,$,se){Object.defineProperty(U,$,{value:se,enumerable:!0})}function P(U,$,se){function Te(Pe){return c(Pe)[U]||i}n(Te,"pattern",$),n(b,se,Te)}return P(1,/^[a-zA-Z]{2,3}$/,"language"),P(2,/^[a-zA-Z]{3}$/,"extlang"),P(3,/^[a-zA-Z]{4}$/,"script"),P(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),n(b,"split",m),b})});var BR=$n((IZ,zR)=>{"use strict";function NR(){}NR.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){let i={enableHighAccuracy:!0};return new Promise(function(a,c){window.navigator.geolocation.getCurrentPosition(a,c,i)})}};zR.exports=NR});var UR=$n((SZ,jR)=>{"use strict";function aj(i,a){let c=VR(i),m=["address","street","place","country"];var b;if(typeof a=="function")return a(c);let n=m.indexOf(a);return n===-1?b=m:b=m.slice(n),b.reduce(function(P,U){return c[U]?(P!==""&&(P=P+", "),P+c[U]):P},"")}function VR(i){let a=i.address||"",c=i.text||"",m=i.place_name||"",n={address:m.split(",")[0],houseNumber:a,street:c,placeName:m};return i.context.forEach(function(P){let U=P.id.split(".")[0];n[U]=P.text}),n}var lj=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;jR.exports={transformFeatureToGeolocationText:aj,getAddressInfo:VR,REVERSE_GEOCODE_COORD_RGX:lj}});var WR=$n((DZ,qR)=>{"use strict";var cj=r2(),uj=a2(),iu=nu(),hj=y2().EventEmitter,$R=x2(),hw=eR(),dw=ER(),dj=PR(),fj=LR(),pj=FR(),mj=BR(),GR=UR(),kl={FORWARD:0,LOCAL:1,REVERSE:2};function gj(){var i=document.createElement("div");return i.className="mapboxgl-ctrl-geocoder--powered-by",i.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',i}function HR(i){this._eventEmitter=new hj,this.options=iu({},this.options,i),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new mj}HR.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(i){return i.place_name},render:function(i){var a=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+a[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+a.splice(1,a.length).join(",")+"</div></div>"}},_headers:{},addTo:function(i){function a(c,m){if(!document.body.contains(m))throw new Error("Element provided to #addTo() exists, but is not in the DOM");let b=c.onAdd();m.appendChild(b)}if(i._controlContainer)i.addControl(this);else if(i instanceof HTMLElement)a(this,i);else if(typeof i=="string"){let c=document.querySelectorAll(i);if(c.length===0)throw new Error("Element ",i,"not found.");if(c.length>1)throw new Error("Geocoder can only be added to a single html element");a(this,c[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(i){if(i&&typeof i!="string"&&(this._map=i),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=dw(hw({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new dj(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var a=this.container=document.createElement("div");a.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var c=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",uj(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(se){this.eventManager.keyevent(se,this)}.bind(this));var m=document.createElement("div");m.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var b=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(b),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),m.appendChild(this._clearEl),m.appendChild(this._loadingEl),a.appendChild(c),a.appendChild(this._inputEl),a.appendChild(m),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var n=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(n),m.appendChild(this._geolocateEl),this._showGeolocateButton()}var P=this._typeahead=new cj(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),P.getItemValue=this.options.getItemValue;var U=P.list.draw,$=this._footerNode=gj();return P.list.draw=function(){U.call(this),$.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),$.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild($)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),a},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(i){this._hideLoadingIcon();let a={geometry:{type:"Point",coordinates:[i.coords.longitude,i.coords.latitude]}};this._handleMarker(a),this._fly(a),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(a),this._showClearButton(),this.fresh=!1;let c={limit:1,language:[this.options.language],query:a.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){let m=a.geometry.coordinates[0]+","+a.geometry.coordinates[1];this._setInputValue(m),this._eventEmitter.emit("result",{result:a})}else this.geocoderService.reverseGeocode(c).send().then(function(m){let b=m.body.features[0];if(b){let n=GR.transformFeatureToGeolocationText(b,this.options.addressAccuracy);this._setInputValue(n),b.user_coordinates=a.geometry.coordinates,this._eventEmitter.emit("result",{result:b})}else this._eventEmitter.emit("result",{result:{user_coordinates:a.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(i){i.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(i,a){var c=document.createElementNS("http://www.w3.org/2000/svg","svg");return c.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+i),c.setAttribute("viewBox","0 0 18 18"),c.setAttribute("xml:space","preserve"),c.setAttribute("width",18),c.setAttribute("height",18),c.innerHTML=a,c},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(i){this._inputEl.value=i,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(i){var a=(i.clipboardData||window.clipboardData).getData("text");a.length>=this.options.minLength&&this._geocode(a)},_onKeyDown:function(i){var a=27,c=9;if(i.keyCode===a&&this.options.clearAndBlurOnEsc)return this._clear(i),this._inputEl.blur();var m=i.target&&i.target.shadowRoot?i.target.shadowRoot.activeElement:i.target,b=m?m.value:"";if(!b)return this.fresh=!0,i.keyCode!==c&&this.clear(i),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(i.metaKey||[c,a,37,39,13,38,40].indexOf(i.keyCode)!==-1)&&m.value.length>=this.options.minLength&&this._geocode(m.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(i){this.options.clearOnBlur&&this._clearOnBlur(i),this.options.collapsed&&this._collapse()},_onChange:function(){var i=this._typeahead.selected;i&&JSON.stringify(i)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(i),this.options.marker&&this._mapboxgl&&this._handleMarker(i),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(i),this._eventEmitter.emit("result",{result:i}),this.eventManager.select(i,this))},_fly:function(i){var a;if(i.properties&&$R[i.properties.short_code])a=iu({},this.options.flyTo),this._map&&this._map.fitBounds($R[i.properties.short_code].bbox,a);else if(i.bbox){var c=i.bbox;a=iu({},this.options.flyTo),this._map&&this._map.fitBounds([[c[0],c[1]],[c[2],c[3]]],a)}else{var m={zoom:this.options.zoom};a=iu({},m,this.options.flyTo),i.center?a.center=i.center:i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(a.center=i.geometry.coordinates),this._map&&this._map.flyTo(a)}},_requestType:function(i,a){var c;return i.localGeocoderOnly?c=kl.LOCAL:i.reverseGeocode&&GR.REVERSE_GEOCODE_COORD_RGX.test(a)?c=kl.REVERSE:c=kl.FORWARD,c},_setupConfig:function(i,a){let c=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],m=/[\s,]+/;var b=this,n=c.reduce(function(U,$){if(b.options[$]===void 0||b.options[$]===null)return U;["countries","types","language"].indexOf($)>-1?U[$]=b.options[$].split(m):U[$]=b.options[$];let se=typeof b.options[$].longitude=="number"&&typeof b.options[$].latitude=="number";if($==="proximity"&&se){let Te=b.options[$].longitude,Pe=b.options[$].latitude;U[$]=[Te,Pe]}return U},{});switch(i){case kl.REVERSE:{var P=a.split(m).map(function(U){return parseFloat(U,10)});b.options.flipCoordinates||P.reverse(),n.types&&n.types[0],n=iu(n,{query:P,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(U){U in n&&delete n[U]})}break;case kl.FORWARD:{let U=a.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(U)&&(a=a.replace(/,/g," ")),n=iu(n,{query:a})}break}return n.session_token=this.eventManager.getSessionId(),n},_geocode:function(i){this.inputString=i,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:i});let a=this._requestType(this.options,i),c=this._setupConfig(a,i);var m;switch(a){case kl.LOCAL:m=Promise.resolve();break;case kl.FORWARD:m=this.geocoderService.forwardGeocode(c).send();break;case kl.REVERSE:m=this.geocoderService.reverseGeocode(c).send();break}var b=this.options.localGeocoder?this.options.localGeocoder(i)||[]:[],n=[],P=null;return m.catch(function(U){P=U}.bind(this)).then(function(U){this._hideLoadingIcon();var $={};return U?U.statusCode=="200"&&($=U.body,$.request=U.request,$.headers=U.headers,this._headers=U.headers):$={type:"FeatureCollection",features:[]},$.config=c,this.fresh&&(this.eventManager.start(this),this.fresh=!1),$.features&&$.features.length&&$.features.map(function(se){se._source="mapbox"}),$.features=$.features?b.concat($.features):b,this.options.externalGeocoder?(n=this.options.externalGeocoder(i,$.features)||Promise.resolve([]),n.then(function(se){return $.features=$.features?se.concat($.features):se,$},function(){return $})):$}.bind(this)).then(function(U){if(P)throw P;this.options.filter&&U.features.length&&(U.features=U.features.filter(this.options.filter)),U.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",U),this._typeahead.update(U.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",U))}.bind(this)).catch(function(U){this._hideLoadingIcon(),this._hideAttribution(),b.length&&this.options.localGeocoder||n.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(b)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:b}),this._eventEmitter.emit("error",{error:U})}.bind(this)),m},_clear:function(i){i&&i.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(i){this._clear(i),this._inputEl.focus()},_clearOnBlur:function(i){var a=this;i.relatedTarget&&a._clear(i)},_onQueryResult:function(i){var a=i.body;if(a.features.length){var c=a.features[0];this._typeahead.selected=c,this._inputEl.value=c.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var i=this._map.getCenter().wrap();this.setProximity({longitude:i.lng,latitude:i.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(i){return this._geocode(i).then(this._onQueryResult),this},_renderError:function(){var i="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(i)},_renderLocationError:function(){var i="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(i)},_renderNoResults:function(){var i="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(i)},_renderUserDeniedGeolocationError:function(){var i="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(i)},_renderMessage:function(i){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(i)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var i=this.options.language.split(",")[0],a=pj.language(i),c=fj.placeholder[a];if(c)return c}return"Search"},setInput:function(i,a){return a===void 0&&(a=!1),this._inputEl.value=i,this._typeahead.selected=null,this._typeahead.clear(),i.length>=this.options.minLength&&(a?this._geocode(i):this._onChange()),this},setProximity:function(i,a=!0){return this.options.proximity=i,a&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(i){return i&&typeof i=="function"&&(this._typeahead.render=i),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(i){var a=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=i||this.options.language||a,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(i){return this.options.zoom=i,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(i){return this.options.flyTo=i,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(i){return this.options.placeholder=i||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(i){return this.options.bbox=i,this},getCountries:function(){return this.options.countries},setCountries:function(i){return this.options.countries=i,this},getTypes:function(){return this.options.types},setTypes:function(i){return this.options.types=i,this},getMinLength:function(){return this.options.minLength},setMinLength:function(i){return this.options.minLength=i,this._typeahead&&(this._typeahead.options.minLength=i),this},getLimit:function(){return this.options.limit},setLimit:function(i){return this.options.limit=i,this._typeahead&&(this._typeahead.options.limit=i),this},getFilter:function(){return this.options.filter},setFilter:function(i){return this.options.filter=i,this},setOrigin:function(i){return this.options.origin=i,this.geocoderService=dw(hw({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(i){return this.options.accessToken=i,this.geocoderService=dw(hw({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(i){return this.options.autocomplete=i,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(i){return this.options.fuzzyMatch=i,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(i){return this.options.routing=i,this},getRouting:function(){return this.options.routing},setWorldview:function(i){return this.options.worldview=i,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(i){if(this._map){this._removeMarker();var a={color:"#4668F2"},c=iu({},a,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(c),i.center?this.mapMarker.setLngLat(i.center).addTo(this._map):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&this.mapMarker.setLngLat(i.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(i,a){return this._eventEmitter.on(i,a),this},off:function(i,a){return this._eventEmitter.removeListener(i,a),this.eventManager.remove(),this}};qR.exports=HR});var G0=null;var $0=1,FI=Symbol("SIGNAL");function or(i){let a=G0;return G0=i,a}function NI(){return G0}var H0={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function kL(i){if(!(Y0(i)&&!i.dirty)&&!(!i.dirty&&i.lastCleanEpoch===$0)){if(!i.producerMustRecompute(i)&&!W0(i)){i.dirty=!1,i.lastCleanEpoch=$0;return}i.producerRecomputeValue(i),i.dirty=!1,i.lastCleanEpoch=$0}}function q0(i){return i&&(i.nextProducerIndex=0),or(i)}function zI(i,a){if(or(a),!(!i||i.producerNode===void 0||i.producerIndexOfThis===void 0||i.producerLastReadVersion===void 0)){if(Y0(i))for(let c=i.nextProducerIndex;c<i.producerNode.length;c++)X0(i.producerNode[c],i.producerIndexOfThis[c]);for(;i.producerNode.length>i.nextProducerIndex;)i.producerNode.pop(),i.producerLastReadVersion.pop(),i.producerIndexOfThis.pop()}}function W0(i){J0(i);for(let a=0;a<i.producerNode.length;a++){let c=i.producerNode[a],m=i.producerLastReadVersion[a];if(m!==c.version||(kL(c),m!==c.version))return!0}return!1}function Z0(i){if(J0(i),Y0(i))for(let a=0;a<i.producerNode.length;a++)X0(i.producerNode[a],i.producerIndexOfThis[a]);i.producerNode.length=i.producerLastReadVersion.length=i.producerIndexOfThis.length=0,i.liveConsumerNode&&(i.liveConsumerNode.length=i.liveConsumerIndexOfThis.length=0)}function X0(i,a){if(FL(i),i.liveConsumerNode.length===1&&NL(i))for(let m=0;m<i.producerNode.length;m++)X0(i.producerNode[m],i.producerIndexOfThis[m]);let c=i.liveConsumerNode.length-1;if(i.liveConsumerNode[a]=i.liveConsumerNode[c],i.liveConsumerIndexOfThis[a]=i.liveConsumerIndexOfThis[c],i.liveConsumerNode.length--,i.liveConsumerIndexOfThis.length--,a<i.liveConsumerNode.length){let m=i.liveConsumerIndexOfThis[a],b=i.liveConsumerNode[a];J0(b),b.producerIndexOfThis[m]=a}}function Y0(i){return i.consumerIsAlwaysLive||(i?.liveConsumerNode?.length??0)>0}function J0(i){i.producerNode??=[],i.producerIndexOfThis??=[],i.producerLastReadVersion??=[]}function FL(i){i.liveConsumerNode??=[],i.liveConsumerIndexOfThis??=[]}function NL(i){return i.producerNode!==void 0}function zL(){throw new Error}var BL=zL;function BI(i){BL=i}function Sn(i){return typeof i=="function"}function _h(i){let c=i(m=>{Error.call(m),m.stack=new Error().stack});return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c}var Wg=_h(i=>function(c){i(this),this.message=c?`${c.length} errors occurred during unsubscription:
${c.map((m,b)=>`${b+1}) ${m.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=c});function np(i,a){if(i){let c=i.indexOf(a);0<=c&&i.splice(c,1)}}var jr=class i{constructor(a){this.initialTeardown=a,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let a;if(!this.closed){this.closed=!0;let{_parentage:c}=this;if(c)if(this._parentage=null,Array.isArray(c))for(let n of c)n.remove(this);else c.remove(this);let{initialTeardown:m}=this;if(Sn(m))try{m()}catch(n){a=n instanceof Wg?n.errors:[n]}let{_finalizers:b}=this;if(b){this._finalizers=null;for(let n of b)try{VI(n)}catch(P){a=a??[],P instanceof Wg?a=[...a,...P.errors]:a.push(P)}}if(a)throw new Wg(a)}}add(a){var c;if(a&&a!==this)if(this.closed)VI(a);else{if(a instanceof i){if(a.closed||a._hasParent(this))return;a._addParent(this)}(this._finalizers=(c=this._finalizers)!==null&&c!==void 0?c:[]).push(a)}}_hasParent(a){let{_parentage:c}=this;return c===a||Array.isArray(c)&&c.includes(a)}_addParent(a){let{_parentage:c}=this;this._parentage=Array.isArray(c)?(c.push(a),c):c?[c,a]:a}_removeParent(a){let{_parentage:c}=this;c===a?this._parentage=null:Array.isArray(c)&&np(c,a)}remove(a){let{_finalizers:c}=this;c&&np(c,a),a instanceof i&&a._removeParent(this)}};jr.EMPTY=(()=>{let i=new jr;return i.closed=!0,i})();var K0=jr.EMPTY;function Zg(i){return i instanceof jr||i&&"closed"in i&&Sn(i.remove)&&Sn(i.add)&&Sn(i.unsubscribe)}function VI(i){Sn(i)?i():i.unsubscribe()}var is={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var yh={setTimeout(i,a,...c){let{delegate:m}=yh;return m?.setTimeout?m.setTimeout(i,a,...c):setTimeout(i,a,...c)},clearTimeout(i){let{delegate:a}=yh;return(a?.clearTimeout||clearTimeout)(i)},delegate:void 0};function Xg(i){yh.setTimeout(()=>{let{onUnhandledError:a}=is;if(a)a(i);else throw i})}function rp(){}var jI=Q0("C",void 0,void 0);function UI(i){return Q0("E",void 0,i)}function $I(i){return Q0("N",i,void 0)}function Q0(i,a,c){return{kind:i,value:a,error:c}}var Lc=null;function vh(i){if(is.useDeprecatedSynchronousErrorHandling){let a=!Lc;if(a&&(Lc={errorThrown:!1,error:null}),i(),a){let{errorThrown:c,error:m}=Lc;if(Lc=null,c)throw m}}else i()}function GI(i){is.useDeprecatedSynchronousErrorHandling&&Lc&&(Lc.errorThrown=!0,Lc.error=i)}var kc=class extends jr{constructor(a){super(),this.isStopped=!1,a?(this.destination=a,Zg(a)&&a.add(this)):this.destination=UL}static create(a,c,m){return new xh(a,c,m)}next(a){this.isStopped?tx($I(a),this):this._next(a)}error(a){this.isStopped?tx(UI(a),this):(this.isStopped=!0,this._error(a))}complete(){this.isStopped?tx(jI,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(a){this.destination.next(a)}_error(a){try{this.destination.error(a)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},VL=Function.prototype.bind;function ex(i,a){return VL.call(i,a)}var nx=class{constructor(a){this.partialObserver=a}next(a){let{partialObserver:c}=this;if(c.next)try{c.next(a)}catch(m){Yg(m)}}error(a){let{partialObserver:c}=this;if(c.error)try{c.error(a)}catch(m){Yg(m)}else Yg(a)}complete(){let{partialObserver:a}=this;if(a.complete)try{a.complete()}catch(c){Yg(c)}}},xh=class extends kc{constructor(a,c,m){super();let b;if(Sn(a)||!a)b={next:a??void 0,error:c??void 0,complete:m??void 0};else{let n;this&&is.useDeprecatedNextContext?(n=Object.create(a),n.unsubscribe=()=>this.unsubscribe(),b={next:a.next&&ex(a.next,n),error:a.error&&ex(a.error,n),complete:a.complete&&ex(a.complete,n)}):b=a}this.destination=new nx(b)}};function Yg(i){is.useDeprecatedSynchronousErrorHandling?GI(i):Xg(i)}function jL(i){throw i}function tx(i,a){let{onStoppedNotification:c}=is;c&&yh.setTimeout(()=>c(i,a))}var UL={closed:!0,next:rp,error:jL,complete:rp};var bh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function io(i){return i}function rx(...i){return ix(i)}function ix(i){return i.length===0?io:i.length===1?i[0]:function(c){return i.reduce((m,b)=>b(m),c)}}var hr=(()=>{class i{constructor(c){c&&(this._subscribe=c)}lift(c){let m=new i;return m.source=this,m.operator=c,m}subscribe(c,m,b){let n=GL(c)?c:new xh(c,m,b);return vh(()=>{let{operator:P,source:U}=this;n.add(P?P.call(n,U):U?this._subscribe(n):this._trySubscribe(n))}),n}_trySubscribe(c){try{return this._subscribe(c)}catch(m){c.error(m)}}forEach(c,m){return m=HI(m),new m((b,n)=>{let P=new xh({next:U=>{try{c(U)}catch($){n($),P.unsubscribe()}},error:n,complete:b});this.subscribe(P)})}_subscribe(c){var m;return(m=this.source)===null||m===void 0?void 0:m.subscribe(c)}[bh](){return this}pipe(...c){return ix(c)(this)}toPromise(c){return c=HI(c),new c((m,b)=>{let n;this.subscribe(P=>n=P,P=>b(P),()=>m(n))})}}return i.create=a=>new i(a),i})();function HI(i){var a;return(a=i??is.Promise)!==null&&a!==void 0?a:Promise}function $L(i){return i&&Sn(i.next)&&Sn(i.error)&&Sn(i.complete)}function GL(i){return i&&i instanceof kc||$L(i)&&Zg(i)}function ox(i){return Sn(i?.lift)}function nr(i){return a=>{if(ox(a))return a.lift(function(c){try{return i(c,this)}catch(m){this.error(m)}});throw new TypeError("Unable to lift unknown Observable type")}}function rr(i,a,c,m,b){return new sx(i,a,c,m,b)}var sx=class extends kc{constructor(a,c,m,b,n,P){super(a),this.onFinalize=n,this.shouldUnsubscribe=P,this._next=c?function(U){try{c(U)}catch($){a.error($)}}:super._next,this._error=b?function(U){try{b(U)}catch($){a.error($)}finally{this.unsubscribe()}}:super._error,this._complete=m?function(){try{m()}catch(U){a.error(U)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var a;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:c}=this;super.unsubscribe(),!c&&((a=this.onFinalize)===null||a===void 0||a.call(this))}}};function wh(){return nr((i,a)=>{let c=null;i._refCount++;let m=rr(a,void 0,void 0,void 0,()=>{if(!i||i._refCount<=0||0<--i._refCount){c=null;return}let b=i._connection,n=c;c=null,b&&(!n||b===n)&&b.unsubscribe(),a.unsubscribe()});i.subscribe(m),m.closed||(c=i.connect())})}var Eh=class extends hr{constructor(a,c){super(),this.source=a,this.subjectFactory=c,this._subject=null,this._refCount=0,this._connection=null,ox(a)&&(this.lift=a.lift)}_subscribe(a){return this.getSubject().subscribe(a)}getSubject(){let a=this._subject;return(!a||a.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:a}=this;this._subject=this._connection=null,a?.unsubscribe()}connect(){let a=this._connection;if(!a){a=this._connection=new jr;let c=this.getSubject();a.add(this.source.subscribe(rr(c,void 0,()=>{this._teardown(),c.complete()},m=>{this._teardown(),c.error(m)},()=>this._teardown()))),a.closed&&(this._connection=null,a=jr.EMPTY)}return a}refCount(){return wh()(this)}};var qI=_h(i=>function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ri=(()=>{class i extends hr{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(c){let m=new Jg(this,this);return m.operator=c,m}_throwIfClosed(){if(this.closed)throw new qI}next(c){vh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let m of this.currentObservers)m.next(c)}})}error(c){vh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=c;let{observers:m}=this;for(;m.length;)m.shift().error(c)}})}complete(){vh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:c}=this;for(;c.length;)c.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var c;return((c=this.observers)===null||c===void 0?void 0:c.length)>0}_trySubscribe(c){return this._throwIfClosed(),super._trySubscribe(c)}_subscribe(c){return this._throwIfClosed(),this._checkFinalizedStatuses(c),this._innerSubscribe(c)}_innerSubscribe(c){let{hasError:m,isStopped:b,observers:n}=this;return m||b?K0:(this.currentObservers=null,n.push(c),new jr(()=>{this.currentObservers=null,np(n,c)}))}_checkFinalizedStatuses(c){let{hasError:m,thrownError:b,isStopped:n}=this;m?c.error(b):n&&c.complete()}asObservable(){let c=new hr;return c.source=this,c}}return i.create=(a,c)=>new Jg(a,c),i})(),Jg=class extends Ri{constructor(a,c){super(),this.destination=a,this.source=c}next(a){var c,m;(m=(c=this.destination)===null||c===void 0?void 0:c.next)===null||m===void 0||m.call(c,a)}error(a){var c,m;(m=(c=this.destination)===null||c===void 0?void 0:c.error)===null||m===void 0||m.call(c,a)}complete(){var a,c;(c=(a=this.destination)===null||a===void 0?void 0:a.complete)===null||c===void 0||c.call(a)}_subscribe(a){var c,m;return(m=(c=this.source)===null||c===void 0?void 0:c.subscribe(a))!==null&&m!==void 0?m:K0}};var ai=class extends Ri{constructor(a){super(),this._value=a}get value(){return this.getValue()}_subscribe(a){let c=super._subscribe(a);return!c.closed&&a.next(this._value),c}getValue(){let{hasError:a,thrownError:c,_value:m}=this;if(a)throw c;return this._throwIfClosed(),m}next(a){super.next(this._value=a)}};var oo=new hr(i=>i.complete());function WI(i){return i&&Sn(i.schedule)}function ZI(i){return i[i.length-1]}function XI(i){return Sn(ZI(i))?i.pop():void 0}function bl(i){return WI(ZI(i))?i.pop():void 0}function JI(i,a,c,m){function b(n){return n instanceof c?n:new c(function(P){P(n)})}return new(c||(c=Promise))(function(n,P){function U(Te){try{se(m.next(Te))}catch(Pe){P(Pe)}}function $(Te){try{se(m.throw(Te))}catch(Pe){P(Pe)}}function se(Te){Te.done?n(Te.value):b(Te.value).then(U,$)}se((m=m.apply(i,a||[])).next())})}function YI(i){var a=typeof Symbol=="function"&&Symbol.iterator,c=a&&i[a],m=0;if(c)return c.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&m>=i.length&&(i=void 0),{value:i&&i[m++],done:!i}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fc(i){return this instanceof Fc?(this.v=i,this):new Fc(i)}function KI(i,a,c){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=c.apply(i,a||[]),b,n=[];return b=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),U("next"),U("throw"),U("return",P),b[Symbol.asyncIterator]=function(){return this},b;function P(We){return function(pt){return Promise.resolve(pt).then(We,Pe)}}function U(We,pt){m[We]&&(b[We]=function(_t){return new Promise(function(on,an){n.push([We,_t,on,an])>1||$(We,_t)})},pt&&(b[We]=pt(b[We])))}function $(We,pt){try{se(m[We](pt))}catch(_t){Ye(n[0][3],_t)}}function se(We){We.value instanceof Fc?Promise.resolve(We.value.v).then(Te,Pe):Ye(n[0][2],We)}function Te(We){$("next",We)}function Pe(We){$("throw",We)}function Ye(We,pt){We(pt),n.shift(),n.length&&$(n[0][0],n[0][1])}}function QI(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=i[Symbol.asyncIterator],c;return a?a.call(i):(i=typeof YI=="function"?YI(i):i[Symbol.iterator](),c={},m("next"),m("throw"),m("return"),c[Symbol.asyncIterator]=function(){return this},c);function m(n){c[n]=i[n]&&function(P){return new Promise(function(U,$){P=i[n](P),b(U,$,P.done,P.value)})}}function b(n,P,U,$){Promise.resolve($).then(function(se){n({value:se,done:U})},P)}}var Kg=i=>i&&typeof i.length=="number"&&typeof i!="function";function Qg(i){return Sn(i?.then)}function e_(i){return Sn(i[bh])}function t_(i){return Symbol.asyncIterator&&Sn(i?.[Symbol.asyncIterator])}function n_(i){return new TypeError(`You provided ${i!==null&&typeof i=="object"?"an invalid object":`'${i}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function HL(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var r_=HL();function i_(i){return Sn(i?.[r_])}function o_(i){return KI(this,arguments,function*(){let c=i.getReader();try{for(;;){let{value:m,done:b}=yield Fc(c.read());if(b)return yield Fc(void 0);yield yield Fc(m)}}finally{c.releaseLock()}})}function s_(i){return Sn(i?.getReader)}function ei(i){if(i instanceof hr)return i;if(i!=null){if(e_(i))return qL(i);if(Kg(i))return WL(i);if(Qg(i))return ZL(i);if(t_(i))return eS(i);if(i_(i))return XL(i);if(s_(i))return YL(i)}throw n_(i)}function qL(i){return new hr(a=>{let c=i[bh]();if(Sn(c.subscribe))return c.subscribe(a);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function WL(i){return new hr(a=>{for(let c=0;c<i.length&&!a.closed;c++)a.next(i[c]);a.complete()})}function ZL(i){return new hr(a=>{i.then(c=>{a.closed||(a.next(c),a.complete())},c=>a.error(c)).then(null,Xg)})}function XL(i){return new hr(a=>{for(let c of i)if(a.next(c),a.closed)return;a.complete()})}function eS(i){return new hr(a=>{JL(i,a).catch(c=>a.error(c))})}function YL(i){return eS(o_(i))}function JL(i,a){var c,m,b,n;return JI(this,void 0,void 0,function*(){try{for(c=QI(i);m=yield c.next(),!m.done;){let P=m.value;if(a.next(P),a.closed)return}}catch(P){b={error:P}}finally{try{m&&!m.done&&(n=c.return)&&(yield n.call(c))}finally{if(b)throw b.error}}a.complete()})}function Ui(i,a,c,m=0,b=!1){let n=a.schedule(function(){c(),b?i.add(this.schedule(null,m)):this.unsubscribe()},m);if(i.add(n),!b)return n}function a_(i,a=0){return nr((c,m)=>{c.subscribe(rr(m,b=>Ui(m,i,()=>m.next(b),a),()=>Ui(m,i,()=>m.complete(),a),b=>Ui(m,i,()=>m.error(b),a)))})}function l_(i,a=0){return nr((c,m)=>{m.add(i.schedule(()=>c.subscribe(m),a))})}function tS(i,a){return ei(i).pipe(l_(a),a_(a))}function nS(i,a){return ei(i).pipe(l_(a),a_(a))}function rS(i,a){return new hr(c=>{let m=0;return a.schedule(function(){m===i.length?c.complete():(c.next(i[m++]),c.closed||this.schedule())})})}function iS(i,a){return new hr(c=>{let m;return Ui(c,a,()=>{m=i[r_](),Ui(c,a,()=>{let b,n;try{({value:b,done:n}=m.next())}catch(P){c.error(P);return}n?c.complete():c.next(b)},0,!0)}),()=>Sn(m?.return)&&m.return()})}function c_(i,a){if(!i)throw new Error("Iterable cannot be null");return new hr(c=>{Ui(c,a,()=>{let m=i[Symbol.asyncIterator]();Ui(c,a,()=>{m.next().then(b=>{b.done?c.complete():c.next(b.value)})},0,!0)})})}function oS(i,a){return c_(o_(i),a)}function sS(i,a){if(i!=null){if(e_(i))return tS(i,a);if(Kg(i))return rS(i,a);if(Qg(i))return nS(i,a);if(t_(i))return c_(i,a);if(i_(i))return iS(i,a);if(s_(i))return oS(i,a)}throw n_(i)}function Ur(i,a){return a?sS(i,a):ei(i)}function En(...i){let a=bl(i);return Ur(i,a)}function Th(i,a){let c=Sn(i)?i:()=>i,m=b=>b.error(c());return new hr(a?b=>a.schedule(m,0,b):m)}function ax(i){return!!i&&(i instanceof hr||Sn(i.lift)&&Sn(i.subscribe))}var la=_h(i=>function(){i(this),this.name="EmptyError",this.message="no elements in sequence"});function Wn(i,a){return nr((c,m)=>{let b=0;c.subscribe(rr(m,n=>{m.next(i.call(a,n,b++))}))})}var{isArray:KL}=Array;function QL(i,a){return KL(a)?i(...a):i(a)}function aS(i){return Wn(a=>QL(i,a))}var{isArray:ek}=Array,{getPrototypeOf:tk,prototype:nk,keys:rk}=Object;function lS(i){if(i.length===1){let a=i[0];if(ek(a))return{args:a,keys:null};if(ik(a)){let c=rk(a);return{args:c.map(m=>a[m]),keys:c}}}return{args:i,keys:null}}function ik(i){return i&&typeof i=="object"&&tk(i)===nk}function cS(i,a){return i.reduce((c,m,b)=>(c[m]=a[b],c),{})}function u_(...i){let a=bl(i),c=XI(i),{args:m,keys:b}=lS(i);if(m.length===0)return Ur([],a);let n=new hr(ok(m,a,b?P=>cS(b,P):io));return c?n.pipe(aS(c)):n}function ok(i,a,c=io){return m=>{uS(a,()=>{let{length:b}=i,n=new Array(b),P=b,U=b;for(let $=0;$<b;$++)uS(a,()=>{let se=Ur(i[$],a),Te=!1;se.subscribe(rr(m,Pe=>{n[$]=Pe,Te||(Te=!0,U--),U||m.next(c(n.slice()))},()=>{--P||m.complete()}))},m)},m)}}function uS(i,a,c){i?Ui(c,i,a):a()}function hS(i,a,c,m,b,n,P,U){let $=[],se=0,Te=0,Pe=!1,Ye=()=>{Pe&&!$.length&&!se&&a.complete()},We=_t=>se<m?pt(_t):$.push(_t),pt=_t=>{n&&a.next(_t),se++;let on=!1;ei(c(_t,Te++)).subscribe(rr(a,an=>{b?.(an),n?We(an):a.next(an)},()=>{on=!0},void 0,()=>{if(on)try{for(se--;$.length&&se<m;){let an=$.shift();P?Ui(a,P,()=>pt(an)):pt(an)}Ye()}catch(an){a.error(an)}}))};return i.subscribe(rr(a,We,()=>{Pe=!0,Ye()})),()=>{U?.()}}function Zr(i,a,c=1/0){return Sn(a)?Zr((m,b)=>Wn((n,P)=>a(m,n,b,P))(ei(i(m,b))),c):(typeof a=="number"&&(c=a),nr((m,b)=>hS(m,b,i,c)))}function lx(i=1/0){return Zr(io,i)}function dS(){return lx(1)}function Ih(...i){return dS()(Ur(i,bl(i)))}function h_(i){return new hr(a=>{ei(i()).subscribe(a)})}function Io(i,a){return nr((c,m)=>{let b=0;c.subscribe(rr(m,n=>i.call(a,n,b++)&&m.next(n)))})}function wl(i){return nr((a,c)=>{let m=null,b=!1,n;m=a.subscribe(rr(c,void 0,void 0,P=>{n=ei(i(P,wl(i)(a))),m?(m.unsubscribe(),m=null,n.subscribe(c)):b=!0})),b&&(m.unsubscribe(),m=null,n.subscribe(c))})}function fS(i,a,c,m,b){return(n,P)=>{let U=c,$=a,se=0;n.subscribe(rr(P,Te=>{let Pe=se++;$=U?i($,Te,Pe):(U=!0,Te),m&&P.next($)},b&&(()=>{U&&P.next($),P.complete()})))}}function Nc(i,a){return Sn(a)?Zr(i,a,1):Zr(i,1)}function El(i){return nr((a,c)=>{let m=!1;a.subscribe(rr(c,b=>{m=!0,c.next(b)},()=>{m||c.next(i),c.complete()}))})}function ca(i){return i<=0?()=>oo:nr((a,c)=>{let m=0;a.subscribe(rr(c,b=>{++m<=i&&(c.next(b),i<=m&&c.complete())}))})}function cx(i){return Wn(()=>i)}function d_(i=sk){return nr((a,c)=>{let m=!1;a.subscribe(rr(c,b=>{m=!0,c.next(b)},()=>m?c.complete():c.error(i())))})}function sk(){return new la}function Sh(i){return nr((a,c)=>{try{a.subscribe(c)}finally{c.add(i)}})}function os(i,a){let c=arguments.length>=2;return m=>m.pipe(i?Io((b,n)=>i(b,n,m)):io,ca(1),c?El(a):d_(()=>new la))}function Dh(i){return i<=0?()=>oo:nr((a,c)=>{let m=[];a.subscribe(rr(c,b=>{m.push(b),i<m.length&&m.shift()},()=>{for(let b of m)c.next(b);c.complete()},void 0,()=>{m=null}))})}function ux(i,a){let c=arguments.length>=2;return m=>m.pipe(i?Io((b,n)=>i(b,n,m)):io,Dh(1),c?El(a):d_(()=>new la))}function hx(i,a){return nr(fS(i,a,arguments.length>=2,!0))}function dx(...i){let a=bl(i);return nr((c,m)=>{(a?Ih(i,c,a):Ih(i,c)).subscribe(m)})}function So(i,a){return nr((c,m)=>{let b=null,n=0,P=!1,U=()=>P&&!b&&m.complete();c.subscribe(rr(m,$=>{b?.unsubscribe();let se=0,Te=n++;ei(i($,Te)).subscribe(b=rr(m,Pe=>m.next(a?a($,Pe,Te,se++):Pe),()=>{b=null,U()}))},()=>{P=!0,U()}))})}function fx(i){return nr((a,c)=>{ei(i).subscribe(rr(c,()=>c.complete(),rp)),!c.closed&&a.subscribe(c)})}function Xr(i,a,c){let m=Sn(i)||a||c?{next:i,error:a,complete:c}:i;return m?nr((b,n)=>{var P;(P=m.subscribe)===null||P===void 0||P.call(m);let U=!0;b.subscribe(rr(n,$=>{var se;(se=m.next)===null||se===void 0||se.call(m,$),n.next($)},()=>{var $;U=!1,($=m.complete)===null||$===void 0||$.call(m),n.complete()},$=>{var se;U=!1,(se=m.error)===null||se===void 0||se.call(m,$),n.error($)},()=>{var $,se;U&&(($=m.unsubscribe)===null||$===void 0||$.call(m)),(se=m.finalize)===null||se===void 0||se.call(m)}))}):io}var rn=class extends Error{constructor(a,c){super(W_(a,c)),this.code=a}};function W_(i,a){return`${`NG0${Math.abs(i)}`}${a?": "+a:""}`}function gp(i){return{toString:i}.toString()}var f_="__parameters__";function ak(i){return function(...c){if(i){let m=i(...c);for(let b in m)this[b]=m[b]}}}function KS(i,a,c){return gp(()=>{let m=ak(a);function b(...n){if(this instanceof b)return m.apply(this,n),this;let P=new b(...n);return U.annotation=P,U;function U($,se,Te){let Pe=$.hasOwnProperty(f_)?$[f_]:Object.defineProperty($,f_,{value:[]})[f_];for(;Pe.length<=Te;)Pe.push(null);return(Pe[Te]=Pe[Te]||[]).push(P),$}}return c&&(b.prototype=Object.create(c.prototype)),b.prototype.ngMetadataName=i,b.annotationCls=b,b})}function vr(i){for(let a in i)if(i[a]===vr)return a;throw Error("Could not find renamed property on target object.")}function so(i){if(typeof i=="string")return i;if(Array.isArray(i))return"["+i.map(so).join(", ")+"]";if(i==null)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;let a=i.toString();if(a==null)return""+a;let c=a.indexOf(`
`);return c===-1?a:a.substring(0,c)}function pS(i,a){return i==null||i===""?a===null?"":a:a==null||a===""?i:i+" "+a}var lk=vr({__forward_ref__:vr});function QS(i){return i.__forward_ref__=QS,i.toString=function(){return so(this())},i}function Co(i){return eD(i)?i():i}function eD(i){return typeof i=="function"&&i.hasOwnProperty(lk)&&i.__forward_ref__===QS}function vn(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function Z_(i){return{providers:i.providers||[],imports:i.imports||[]}}function X_(i){return mS(i,nD)||mS(i,rD)}function tD(i){return X_(i)!==null}function mS(i,a){return i.hasOwnProperty(a)?i[a]:null}function ck(i){let a=i&&(i[nD]||i[rD]);return a||null}function gS(i){return i&&(i.hasOwnProperty(_S)||i.hasOwnProperty(uk))?i[_S]:null}var nD=vr({\u0275prov:vr}),_S=vr({\u0275inj:vr}),rD=vr({ngInjectableDef:vr}),uk=vr({ngInjectorDef:vr}),yn=class{constructor(a,c){this._desc=a,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof c=="number"?this.__NG_ELEMENT_ID__=c:c!==void 0&&(this.\u0275prov=vn({token:this,providedIn:c.providedIn||"root",factory:c.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function iD(i){return i&&!!i.\u0275providers}var hk=vr({\u0275cmp:vr}),dk=vr({\u0275dir:vr}),fk=vr({\u0275pipe:vr}),pk=vr({\u0275mod:vr}),E_=vr({\u0275fac:vr}),sp=vr({__NG_ELEMENT_ID__:vr}),yS=vr({__NG_ENV_ID__:vr});function oD(i){return typeof i=="string"?i:i==null?"":String(i)}function mk(i){return typeof i=="function"?i.name||i.toString():typeof i=="object"&&i!=null&&typeof i.type=="function"?i.type.name||i.type.toString():oD(i)}function gk(i,a){let c=a?`. Dependency path: ${a.join(" > ")} > ${i}`:"";throw new rn(-200,i)}function cb(i,a){throw new rn(-201,!1)}var Nn=function(i){return i[i.Default=0]="Default",i[i.Host=1]="Host",i[i.Self=2]="Self",i[i.SkipSelf=4]="SkipSelf",i[i.Optional=8]="Optional",i}(Nn||{}),Tx;function sD(){return Tx}function Do(i){let a=Tx;return Tx=i,a}function aD(i,a,c){let m=X_(i);if(m&&m.providedIn=="root")return m.value===void 0?m.value=m.factory():m.value;if(c&Nn.Optional)return null;if(a!==void 0)return a;cb(i,"Injector")}var _k={},ap=_k,Ix="__NG_DI_FLAG__",T_="ngTempTokenPath",yk="ngTokenPath",vk=/\n/gm,xk="\u0275",vS="__source",Rh;function bk(){return Rh}function Tl(i){let a=Rh;return Rh=i,a}function wk(i,a=Nn.Default){if(Rh===void 0)throw new rn(-203,!1);return Rh===null?aD(i,void 0,a):Rh.get(i,a&Nn.Optional?null:void 0,a)}function Jn(i,a=Nn.Default){return(sD()||wk)(Co(i),a)}function Et(i,a=Nn.Default){return Jn(i,Y_(a))}function Y_(i){return typeof i>"u"||typeof i=="number"?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function Sx(i){let a=[];for(let c=0;c<i.length;c++){let m=Co(i[c]);if(Array.isArray(m)){if(m.length===0)throw new rn(900,!1);let b,n=Nn.Default;for(let P=0;P<m.length;P++){let U=m[P],$=Ek(U);typeof $=="number"?$===-1?b=U.token:n|=$:b=U}a.push(Jn(b,n))}else a.push(Jn(m))}return a}function lD(i,a){return i[Ix]=a,i.prototype[Ix]=a,i}function Ek(i){return i[Ix]}function Tk(i,a,c,m){let b=i[T_];throw a[vS]&&b.unshift(a[vS]),i.message=Ik(`
`+i.message,b,c,m),i[yk]=b,i[T_]=null,i}function Ik(i,a,c,m=null){i=i&&i.charAt(0)===`
`&&i.charAt(1)==xk?i.slice(2):i;let b=so(a);if(Array.isArray(a))b=a.map(so).join(" -> ");else if(typeof a=="object"){let n=[];for(let P in a)if(a.hasOwnProperty(P)){let U=a[P];n.push(P+":"+(typeof U=="string"?JSON.stringify(U):so(U)))}b=`{${n.join(", ")}}`}return`${c}${m?"("+m+")":""}[${b}]: ${i.replace(vk,`
  `)}`}var ub=lD(KS("Optional"),8);var cD=lD(KS("SkipSelf"),4);function Oh(i,a){let c=i.hasOwnProperty(E_);return c?i[E_]:null}function hb(i,a){i.forEach(c=>Array.isArray(c)?hb(c,a):a(c))}function uD(i,a,c){a>=i.length?i.push(c):i.splice(a,0,c)}function I_(i,a){return a>=i.length-1?i.pop():i.splice(a,1)[0]}var lp={},as=[],Bc=new yn(""),hD=new yn("",-1),dD=new yn(""),S_=class{get(a,c=ap){if(c===ap){let m=new Error(`NullInjectorError: No provider for ${so(a)}!`);throw m.name="NullInjectorError",m}return c}},fD=function(i){return i[i.OnPush=0]="OnPush",i[i.Default=1]="Default",i}(fD||{}),Ps=function(i){return i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",i}(Ps||{}),Sl=function(i){return i[i.None=0]="None",i[i.SignalBased=1]="SignalBased",i[i.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",i}(Sl||{});function Sk(i,a,c){let m=i.length;for(;;){let b=i.indexOf(a,c);if(b===-1)return b;if(b===0||i.charCodeAt(b-1)<=32){let n=a.length;if(b+n===m||i.charCodeAt(b+n)<=32)return b}c=b+1}}function Dx(i,a,c){let m=0;for(;m<c.length;){let b=c[m];if(typeof b=="number"){if(b!==0)break;m++;let n=c[m++],P=c[m++],U=c[m++];i.setAttribute(a,P,U,n)}else{let n=b,P=c[++m];Ck(n)?i.setProperty(a,n,P):i.setAttribute(a,n,P),m++}}return m}function Dk(i){return i===3||i===4||i===6}function Ck(i){return i.charCodeAt(0)===64}function db(i,a){if(!(a===null||a.length===0))if(i===null||i.length===0)i=a.slice();else{let c=-1;for(let m=0;m<a.length;m++){let b=a[m];typeof b=="number"?c=b:c===0||(c===-1||c===2?xS(i,c,b,null,a[++m]):xS(i,c,b,null,null))}}return i}function xS(i,a,c,m,b){let n=0,P=i.length;if(a===-1)P=-1;else for(;n<i.length;){let U=i[n++];if(typeof U=="number"){if(U===a){P=-1;break}else if(U>a){P=n-1;break}}}for(;n<i.length;){let U=i[n];if(typeof U=="number")break;if(U===c){if(m===null){b!==null&&(i[n+1]=b);return}else if(m===i[n+1]){i[n+2]=b;return}}n++,m!==null&&n++,b!==null&&n++}P!==-1&&(i.splice(P,0,a),n=P+1),i.splice(n++,0,c),m!==null&&i.splice(n++,0,m),b!==null&&i.splice(n++,0,b)}var pD="ng-template";function Mk(i,a,c,m){let b=0;if(m){for(;b<a.length&&typeof a[b]=="string";b+=2)if(a[b]==="class"&&Sk(a[b+1].toLowerCase(),c,0)!==-1)return!0}else if(fb(i))return!1;if(b=a.indexOf(1,b),b>-1){let n;for(;++b<a.length&&typeof(n=a[b])=="string";)if(n.toLowerCase()===c)return!0}return!1}function fb(i){return i.type===4&&i.value!==pD}function Ak(i,a,c){let m=i.type===4&&!c?pD:i.value;return a===m}function Rk(i,a,c){let m=4,b=i.attrs,n=b!==null?Lk(b):0,P=!1;for(let U=0;U<a.length;U++){let $=a[U];if(typeof $=="number"){if(!P&&!ss(m)&&!ss($))return!1;if(P&&ss($))continue;P=!1,m=$|m&1;continue}if(!P)if(m&4){if(m=2|m&1,$!==""&&!Ak(i,$,c)||$===""&&a.length===1){if(ss(m))return!1;P=!0}}else if(m&8){if(b===null||!Mk(i,b,$,c)){if(ss(m))return!1;P=!0}}else{let se=a[++U],Te=Pk($,b,fb(i),c);if(Te===-1){if(ss(m))return!1;P=!0;continue}if(se!==""){let Pe;if(Te>n?Pe="":Pe=b[Te+1].toLowerCase(),m&2&&se!==Pe){if(ss(m))return!1;P=!0}}}}return ss(m)||P}function ss(i){return(i&1)===0}function Pk(i,a,c,m){if(a===null)return-1;let b=0;if(m||!c){let n=!1;for(;b<a.length;){let P=a[b];if(P===i)return b;if(P===3||P===6)n=!0;else if(P===1||P===2){let U=a[++b];for(;typeof U=="string";)U=a[++b];continue}else{if(P===4)break;if(P===0){b+=4;continue}}b+=n?1:2}return-1}else return kk(a,i)}function Ok(i,a,c=!1){for(let m=0;m<a.length;m++)if(Rk(i,a[m],c))return!0;return!1}function Lk(i){for(let a=0;a<i.length;a++){let c=i[a];if(Dk(c))return a}return i.length}function kk(i,a){let c=i.indexOf(4);if(c>-1)for(c++;c<i.length;){let m=i[c];if(typeof m=="number")return-1;if(m===a)return c;c++}return-1}function bS(i,a){return i?":not("+a.trim()+")":a}function Fk(i){let a=i[0],c=1,m=2,b="",n=!1;for(;c<i.length;){let P=i[c];if(typeof P=="string")if(m&2){let U=i[++c];b+="["+P+(U.length>0?'="'+U+'"':"")+"]"}else m&8?b+="."+P:m&4&&(b+=" "+P);else b!==""&&!ss(P)&&(a+=bS(n,b),b=""),m=P,n=n||!ss(m);c++}return b!==""&&(a+=bS(n,b)),a}function Nk(i){return i.map(Fk).join(",")}function zk(i){let a=[],c=[],m=1,b=2;for(;m<i.length;){let n=i[m];if(typeof n=="string")b===2?n!==""&&a.push(n,i[++m]):b===8&&c.push(n);else{if(!ss(b))break;b=n}m++}return{attrs:a,classes:c}}function Vh(i){return gp(()=>{let a=vD(i),c=Sr(kt({},a),{decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===fD.OnPush,directiveDefs:null,pipeDefs:null,dependencies:a.standalone&&i.dependencies||null,getStandaloneInjector:null,signals:i.signals??!1,data:i.data||{},encapsulation:i.encapsulation||Ps.Emulated,styles:i.styles||as,_:null,schemas:i.schemas||null,tView:null,id:""});xD(c);let m=i.dependencies;return c.directiveDefs=ES(m,!1),c.pipeDefs=ES(m,!0),c.id=jk(c),c})}function Bk(i){return Vc(i)||mD(i)}function Vk(i){return i!==null}function J_(i){return gp(()=>({type:i.type,bootstrap:i.bootstrap||as,declarations:i.declarations||as,imports:i.imports||as,exports:i.exports||as,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function wS(i,a){if(i==null)return lp;let c={};for(let m in i)if(i.hasOwnProperty(m)){let b=i[m],n,P,U=Sl.None;Array.isArray(b)?(U=b[0],n=b[1],P=b[2]??n):(n=b,P=b),a?(c[n]=U!==Sl.None?[m,U]:m,a[n]=P):c[n]=m}return c}function K_(i){return gp(()=>{let a=vD(i);return xD(a),a})}function Vc(i){return i[hk]||null}function mD(i){return i[dk]||null}function gD(i){return i[fk]||null}function _D(i){let a=Vc(i)||mD(i)||gD(i);return a!==null?a.standalone:!1}function yD(i,a){let c=i[pk]||null;if(!c&&a===!0)throw new Error(`Type ${so(i)} does not have '\u0275mod' property.`);return c}function vD(i){let a={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:a,inputTransforms:null,inputConfig:i.inputs||lp,exportAs:i.exportAs||null,standalone:i.standalone===!0,signals:i.signals===!0,selectors:i.selectors||as,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:wS(i.inputs,a),outputs:wS(i.outputs),debugInfo:null}}function xD(i){i.features?.forEach(a=>a(i))}function ES(i,a){if(!i)return null;let c=a?gD:Bk;return()=>(typeof i=="function"?i():i).map(m=>c(m)).filter(Vk)}function jk(i){let a=0,c=[i.selectors,i.ngContentSelectors,i.hostVars,i.hostAttrs,i.consts,i.vars,i.decls,i.encapsulation,i.standalone,i.signals,i.exportAs,JSON.stringify(i.inputs),JSON.stringify(i.outputs),Object.getOwnPropertyNames(i.type.prototype),!!i.contentQueries,!!i.viewQuery].join("|");for(let b of c)a=Math.imul(31,a)+b.charCodeAt(0)<<0;return a+=2147483648,"c"+a}function Hc(i){return{\u0275providers:i}}function Uk(...i){return{\u0275providers:bD(!0,i),\u0275fromNgModule:!0}}function bD(i,...a){let c=[],m=new Set,b,n=P=>{c.push(P)};return hb(a,P=>{let U=P;Cx(U,n,[],m)&&(b||=[],b.push(U))}),b!==void 0&&wD(b,n),c}function wD(i,a){for(let c=0;c<i.length;c++){let{ngModule:m,providers:b}=i[c];pb(b,n=>{a(n,m)})}}function Cx(i,a,c,m){if(i=Co(i),!i)return!1;let b=null,n=gS(i),P=!n&&Vc(i);if(!n&&!P){let $=i.ngModule;if(n=gS($),n)b=$;else return!1}else{if(P&&!P.standalone)return!1;b=i}let U=m.has(b);if(P){if(U)return!1;if(m.add(b),P.dependencies){let $=typeof P.dependencies=="function"?P.dependencies():P.dependencies;for(let se of $)Cx(se,a,c,m)}}else if(n){if(n.imports!=null&&!U){m.add(b);let se;try{hb(n.imports,Te=>{Cx(Te,a,c,m)&&(se||=[],se.push(Te))})}finally{}se!==void 0&&wD(se,a)}if(!U){let se=Oh(b)||(()=>new b);a({provide:b,useFactory:se,deps:as},b),a({provide:dD,useValue:b,multi:!0},b),a({provide:Bc,useValue:()=>Jn(b),multi:!0},b)}let $=n.providers;if($!=null&&!U){let se=i;pb($,Te=>{a(Te,se)})}}else return!1;return b!==i&&i.providers!==void 0}function pb(i,a){for(let c of i)iD(c)&&(c=c.\u0275providers),Array.isArray(c)?pb(c,a):a(c)}var $k=vr({provide:String,useValue:vr});function ED(i){return i!==null&&typeof i=="object"&&$k in i}function Gk(i){return!!(i&&i.useExisting)}function Hk(i){return!!(i&&i.useFactory)}function Mx(i){return typeof i=="function"}var Q_=new yn(""),y_={},qk={},px;function mb(){return px===void 0&&(px=new S_),px}var Ao=class{},cp=class extends Ao{get destroyed(){return this._destroyed}constructor(a,c,m,b){super(),this.parent=c,this.source=m,this.scopes=b,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Rx(a,P=>this.processProvider(P)),this.records.set(hD,Ch(void 0,this)),b.has("environment")&&this.records.set(Ao,Ch(void 0,this));let n=this.records.get(Q_);n!=null&&typeof n.value=="string"&&this.scopes.add(n.value),this.injectorDefTypes=new Set(this.get(dD,as,Nn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let a=or(null);try{for(let m of this._ngOnDestroyHooks)m.ngOnDestroy();let c=this._onDestroyHooks;this._onDestroyHooks=[];for(let m of c)m()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),or(a)}}onDestroy(a){return this.assertNotDestroyed(),this._onDestroyHooks.push(a),()=>this.removeOnDestroy(a)}runInContext(a){this.assertNotDestroyed();let c=Tl(this),m=Do(void 0),b;try{return a()}finally{Tl(c),Do(m)}}get(a,c=ap,m=Nn.Default){if(this.assertNotDestroyed(),a.hasOwnProperty(yS))return a[yS](this);m=Y_(m);let b,n=Tl(this),P=Do(void 0);try{if(!(m&Nn.SkipSelf)){let $=this.records.get(a);if($===void 0){let se=Kk(a)&&X_(a);se&&this.injectableDefInScope(se)?$=Ch(Ax(a),y_):$=null,this.records.set(a,$)}if($!=null)return this.hydrate(a,$)}let U=m&Nn.Self?mb():this.parent;return c=m&Nn.Optional&&c===ap?null:c,U.get(a,c)}catch(U){if(U.name==="NullInjectorError"){if((U[T_]=U[T_]||[]).unshift(so(a)),n)throw U;return Tk(U,a,"R3InjectorError",this.source)}else throw U}finally{Do(P),Tl(n)}}resolveInjectorInitializers(){let a=or(null),c=Tl(this),m=Do(void 0),b;try{let n=this.get(Bc,as,Nn.Self);for(let P of n)P()}finally{Tl(c),Do(m),or(a)}}toString(){let a=[],c=this.records;for(let m of c.keys())a.push(so(m));return`R3Injector[${a.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new rn(205,!1)}processProvider(a){a=Co(a);let c=Mx(a)?a:Co(a&&a.provide),m=Zk(a);if(!Mx(a)&&a.multi===!0){let b=this.records.get(c);b||(b=Ch(void 0,y_,!0),b.factory=()=>Sx(b.multi),this.records.set(c,b)),c=a,b.multi.push(a)}this.records.set(c,m)}hydrate(a,c){let m=or(null);try{return c.value===y_&&(c.value=qk,c.value=c.factory()),typeof c.value=="object"&&c.value&&Jk(c.value)&&this._ngOnDestroyHooks.add(c.value),c.value}finally{or(m)}}injectableDefInScope(a){if(!a.providedIn)return!1;let c=Co(a.providedIn);return typeof c=="string"?c==="any"||this.scopes.has(c):this.injectorDefTypes.has(c)}removeOnDestroy(a){let c=this._onDestroyHooks.indexOf(a);c!==-1&&this._onDestroyHooks.splice(c,1)}};function Ax(i){let a=X_(i),c=a!==null?a.factory:Oh(i);if(c!==null)return c;if(i instanceof yn)throw new rn(204,!1);if(i instanceof Function)return Wk(i);throw new rn(204,!1)}function Wk(i){if(i.length>0)throw new rn(204,!1);let c=ck(i);return c!==null?()=>c.factory(i):()=>new i}function Zk(i){if(ED(i))return Ch(void 0,i.useValue);{let a=Xk(i);return Ch(a,y_)}}function Xk(i,a,c){let m;if(Mx(i)){let b=Co(i);return Oh(b)||Ax(b)}else if(ED(i))m=()=>Co(i.useValue);else if(Hk(i))m=()=>i.useFactory(...Sx(i.deps||[]));else if(Gk(i))m=()=>Jn(Co(i.useExisting));else{let b=Co(i&&(i.useClass||i.provide));if(Yk(i))m=()=>new b(...Sx(i.deps));else return Oh(b)||Ax(b)}return m}function Ch(i,a,c=!1){return{factory:i,value:a,multi:c?[]:void 0}}function Yk(i){return!!i.deps}function Jk(i){return i!==null&&typeof i=="object"&&typeof i.ngOnDestroy=="function"}function Kk(i){return typeof i=="function"||typeof i=="object"&&i instanceof yn}function Rx(i,a){for(let c of i)Array.isArray(c)?Rx(c,a):c&&iD(c)?Rx(c.\u0275providers,a):a(c)}function Ls(i,a){i instanceof cp&&i.assertNotDestroyed();let c,m=Tl(i),b=Do(void 0);try{return a()}finally{Tl(m),Do(b)}}function Qk(){return sD()!==void 0||bk()!=null}function eF(i){return typeof i=="function"}var lo=0,Gn=1,_n=2,_i=3,ls=4,us=5,Os=6,D_=7,ua=8,Lh=9,ha=10,Yr=11,up=12,TS=13,_p=14,Ro=15,kh=16,Mh=17,Fh=18,ey=19,TD=20,Il=21,mx=22,Mo=23,$i=25,ID=1,hp=6,da=7,C_=8,M_=9,ao=10,A_=function(i){return i[i.None=0]="None",i[i.HasTransplantedViews=2]="HasTransplantedViews",i}(A_||{});function Rs(i){return Array.isArray(i)&&typeof i[ID]=="object"}function ks(i){return Array.isArray(i)&&i[ID]===!0}function SD(i){return(i.flags&4)!==0}function yp(i){return i.componentOffset>-1}function gb(i){return(i.flags&1)===1}function vp(i){return!!i.template}function R_(i){return(i[_n]&512)!==0}var Px=class{constructor(a,c,m){this.previousValue=a,this.currentValue=c,this.firstChange=m}isFirstChange(){return this.firstChange}};function DD(i,a,c,m){a!==null?a.applyValueToInputSignal(a,m):i[c]=m}function ty(){return CD}function CD(i){return i.type.prototype.ngOnChanges&&(i.setInput=nF),tF}ty.ngInherit=!0;function tF(){let i=AD(this),a=i?.current;if(a){let c=i.previous;if(c===lp)i.previous=a;else for(let m in a)c[m]=a[m];i.current=null,this.ngOnChanges(a)}}function nF(i,a,c,m,b){let n=this.declaredInputs[m],P=AD(i)||rF(i,{previous:lp,current:null}),U=P.current||(P.current={}),$=P.previous,se=$[n];U[n]=new Px(se&&se.currentValue,c,$===lp),DD(i,a,b,c)}var MD="__ngSimpleChanges__";function AD(i){return i[MD]||null}function rF(i,a){return i[MD]=a}var IS=null;var Ms=function(i,a,c){IS?.(i,a,c)},iF="svg",oF="math";function cs(i){for(;Array.isArray(i);)i=i[lo];return i}function sF(i,a){return cs(a[i])}function Po(i,a){return cs(a[i.index])}function RD(i,a){return i.data[a]}function qc(i,a){let c=a[i];return Rs(c)?c:c[lo]}function _b(i){return(i[_n]&128)===128}function aF(i){return ks(i[_i])}function P_(i,a){return a==null?null:i[a]}function PD(i){i[Mh]=0}function OD(i){i[_n]&1024||(i[_n]|=1024,_b(i)&&ry(i))}function ny(i){return!!(i[_n]&9216||i[Mo]?.dirty)}function Ox(i){i[ha].changeDetectionScheduler?.notify(8),i[_n]&64&&(i[_n]|=1024),ny(i)&&ry(i)}function ry(i){i[ha].changeDetectionScheduler?.notify(0);let a=jc(i);for(;a!==null&&!(a[_n]&8192||(a[_n]|=8192,!_b(a)));)a=jc(a)}function LD(i,a){if((i[_n]&256)===256)throw new rn(911,!1);i[Il]===null&&(i[Il]=[]),i[Il].push(a)}function lF(i,a){if(i[Il]===null)return;let c=i[Il].indexOf(a);c!==-1&&i[Il].splice(c,1)}function jc(i){let a=i[_i];return ks(a)?a[_i]:a}var sr={lFrame:GD(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var kD=!1;function cF(){return sr.lFrame.elementDepthCount}function uF(){sr.lFrame.elementDepthCount++}function hF(){sr.lFrame.elementDepthCount--}function FD(){return sr.bindingsEnabled}function xp(){return sr.skipHydrationRootTNode!==null}function dF(i){return sr.skipHydrationRootTNode===i}function fF(i){sr.skipHydrationRootTNode=i}function pF(){sr.skipHydrationRootTNode=null}function li(){return sr.lFrame.lView}function Wc(){return sr.lFrame.tView}function hs(){let i=ND();for(;i!==null&&i.type===64;)i=i.parent;return i}function ND(){return sr.lFrame.currentTNode}function mF(){let i=sr.lFrame,a=i.currentTNode;return i.isParent?a:a.parent}function bp(i,a){let c=sr.lFrame;c.currentTNode=i,c.isParent=a}function zD(){return sr.lFrame.isParent}function gF(){sr.lFrame.isParent=!1}function BD(){return kD}function SS(i){kD=i}function _F(i){return sr.lFrame.bindingIndex=i}function VD(){return sr.lFrame.bindingIndex++}function yF(){return sr.lFrame.inI18n}function vF(i,a){let c=sr.lFrame;c.bindingIndex=c.bindingRootIndex=i,Lx(a)}function xF(){return sr.lFrame.currentDirectiveIndex}function Lx(i){sr.lFrame.currentDirectiveIndex=i}function jD(i){sr.lFrame.currentQueryIndex=i}function bF(i){let a=i[Gn];return a.type===2?a.declTNode:a.type===1?i[us]:null}function UD(i,a,c){if(c&Nn.SkipSelf){let b=a,n=i;for(;b=b.parent,b===null&&!(c&Nn.Host);)if(b=bF(n),b===null||(n=n[_p],b.type&10))break;if(b===null)return!1;a=b,i=n}let m=sr.lFrame=$D();return m.currentTNode=a,m.lView=i,!0}function yb(i){let a=$D(),c=i[Gn];sr.lFrame=a,a.currentTNode=c.firstChild,a.lView=i,a.tView=c,a.contextLView=i,a.bindingIndex=c.bindingStartIndex,a.inI18n=!1}function $D(){let i=sr.lFrame,a=i===null?null:i.child;return a===null?GD(i):a}function GD(i){let a={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return i!==null&&(i.child=a),a}function HD(){let i=sr.lFrame;return sr.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}var qD=HD;function vb(){let i=HD();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function xb(){return sr.lFrame.selectedIndex}function Uc(i){sr.lFrame.selectedIndex=i}function wF(){let i=sr.lFrame;return RD(i.tView,i.selectedIndex)}function WD(){return sr.lFrame.currentNamespace}var ZD=!0;function bb(){return ZD}function Cl(i){ZD=i}function EF(i,a,c){let{ngOnChanges:m,ngOnInit:b,ngDoCheck:n}=a.type.prototype;if(m){let P=CD(a);(c.preOrderHooks??=[]).push(i,P),(c.preOrderCheckHooks??=[]).push(i,P)}b&&(c.preOrderHooks??=[]).push(0-i,b),n&&((c.preOrderHooks??=[]).push(i,n),(c.preOrderCheckHooks??=[]).push(i,n))}function wb(i,a){for(let c=a.directiveStart,m=a.directiveEnd;c<m;c++){let n=i.data[c].type.prototype,{ngAfterContentInit:P,ngAfterContentChecked:U,ngAfterViewInit:$,ngAfterViewChecked:se,ngOnDestroy:Te}=n;P&&(i.contentHooks??=[]).push(-c,P),U&&((i.contentHooks??=[]).push(c,U),(i.contentCheckHooks??=[]).push(c,U)),$&&(i.viewHooks??=[]).push(-c,$),se&&((i.viewHooks??=[]).push(c,se),(i.viewCheckHooks??=[]).push(c,se)),Te!=null&&(i.destroyHooks??=[]).push(c,Te)}}function v_(i,a,c){XD(i,a,3,c)}function x_(i,a,c,m){(i[_n]&3)===c&&XD(i,a,c,m)}function gx(i,a){let c=i[_n];(c&3)===a&&(c&=16383,c+=1,i[_n]=c)}function XD(i,a,c,m){let b=m!==void 0?i[Mh]&65535:0,n=m??-1,P=a.length-1,U=0;for(let $=b;$<P;$++)if(typeof a[$+1]=="number"){if(U=a[$],m!=null&&U>=m)break}else a[$]<0&&(i[Mh]+=65536),(U<n||n==-1)&&(TF(i,c,a,$),i[Mh]=(i[Mh]&4294901760)+$+2),$++}function DS(i,a){Ms(4,i,a);let c=or(null);try{a.call(i)}finally{or(c),Ms(5,i,a)}}function TF(i,a,c,m){let b=c[m]<0,n=c[m+1],P=b?-c[m]:c[m],U=i[P];b?i[_n]>>14<i[Mh]>>16&&(i[_n]&3)===a&&(i[_n]+=16384,DS(U,n)):DS(U,n)}var Ph=-1,dp=class{constructor(a,c,m){this.factory=a,this.resolving=!1,this.canSeeViewProviders=c,this.injectImpl=m}};function IF(i){return i instanceof dp}function SF(i){return(i.flags&8)!==0}function DF(i){return(i.flags&16)!==0}var _x={},kx=class{constructor(a,c){this.injector=a,this.parentInjector=c}get(a,c,m){m=Y_(m);let b=this.injector.get(a,_x,m);return b!==_x||c===_x?b:this.parentInjector.get(a,c,m)}};function YD(i){return i!==Ph}function O_(i){return i&32767}function CF(i){return i>>16}function L_(i,a){let c=CF(i),m=a;for(;c>0;)m=m[_p],c--;return m}var Fx=!0;function CS(i){let a=Fx;return Fx=i,a}var MF=256,JD=MF-1,KD=5,AF=0,As={};function RF(i,a,c){let m;typeof c=="string"?m=c.charCodeAt(0)||0:c.hasOwnProperty(sp)&&(m=c[sp]),m==null&&(m=c[sp]=AF++);let b=m&JD,n=1<<b;a.data[i+(b>>KD)]|=n}function QD(i,a){let c=eC(i,a);if(c!==-1)return c;let m=a[Gn];m.firstCreatePass&&(i.injectorIndex=a.length,yx(m.data,i),yx(a,null),yx(m.blueprint,null));let b=Eb(i,a),n=i.injectorIndex;if(YD(b)){let P=O_(b),U=L_(b,a),$=U[Gn].data;for(let se=0;se<8;se++)a[n+se]=U[P+se]|$[P+se]}return a[n+8]=b,n}function yx(i,a){i.push(0,0,0,0,0,0,0,0,a)}function eC(i,a){return i.injectorIndex===-1||i.parent&&i.parent.injectorIndex===i.injectorIndex||a[i.injectorIndex+8]===null?-1:i.injectorIndex}function Eb(i,a){if(i.parent&&i.parent.injectorIndex!==-1)return i.parent.injectorIndex;let c=0,m=null,b=a;for(;b!==null;){if(m=oC(b),m===null)return Ph;if(c++,b=b[_p],m.injectorIndex!==-1)return m.injectorIndex|c<<16}return Ph}function PF(i,a,c){RF(i,a,c)}function tC(i,a,c){if(c&Nn.Optional||i!==void 0)return i;cb(a,"NodeInjector")}function nC(i,a,c,m){if(c&Nn.Optional&&m===void 0&&(m=null),!(c&(Nn.Self|Nn.Host))){let b=i[Lh],n=Do(void 0);try{return b?b.get(a,m,c&Nn.Optional):aD(a,m,c&Nn.Optional)}finally{Do(n)}}return tC(m,a,c)}function rC(i,a,c,m=Nn.Default,b){if(i!==null){if(a[_n]&2048&&!(m&Nn.Self)){let P=NF(i,a,c,m,As);if(P!==As)return P}let n=iC(i,a,c,m,As);if(n!==As)return n}return nC(a,c,m,b)}function iC(i,a,c,m,b){let n=kF(c);if(typeof n=="function"){if(!UD(a,i,m))return m&Nn.Host?tC(b,c,m):nC(a,c,m,b);try{let P;if(P=n(m),P==null&&!(m&Nn.Optional))cb(c);else return P}finally{qD()}}else if(typeof n=="number"){let P=null,U=eC(i,a),$=Ph,se=m&Nn.Host?a[Ro][us]:null;for((U===-1||m&Nn.SkipSelf)&&($=U===-1?Eb(i,a):a[U+8],$===Ph||!AS(m,!1)?U=-1:(P=a[Gn],U=O_($),a=L_($,a)));U!==-1;){let Te=a[Gn];if(MS(n,U,Te.data)){let Pe=OF(U,a,c,P,m,se);if(Pe!==As)return Pe}$=a[U+8],$!==Ph&&AS(m,a[Gn].data[U+8]===se)&&MS(n,U,a)?(P=Te,U=O_($),a=L_($,a)):U=-1}}return b}function OF(i,a,c,m,b,n){let P=a[Gn],U=P.data[i+8],$=m==null?yp(U)&&Fx:m!=P&&(U.type&3)!==0,se=b&Nn.Host&&n===U,Te=LF(U,P,c,$,se);return Te!==null?fp(a,P,Te,U):As}function LF(i,a,c,m,b){let n=i.providerIndexes,P=a.data,U=n&1048575,$=i.directiveStart,se=i.directiveEnd,Te=n>>20,Pe=m?U:U+Te,Ye=b?U+Te:se;for(let We=Pe;We<Ye;We++){let pt=P[We];if(We<$&&c===pt||We>=$&&pt.type===c)return We}if(b){let We=P[$];if(We&&vp(We)&&We.type===c)return $}return null}function fp(i,a,c,m){let b=i[c],n=a.data;if(IF(b)){let P=b;P.resolving&&gk(mk(n[c]));let U=CS(P.canSeeViewProviders);P.resolving=!0;let $,se=P.injectImpl?Do(P.injectImpl):null,Te=UD(i,m,Nn.Default);try{b=i[c]=P.factory(void 0,n,i,m),a.firstCreatePass&&c>=m.directiveStart&&EF(c,n[c],a)}finally{se!==null&&Do(se),CS(U),P.resolving=!1,qD()}}return b}function kF(i){if(typeof i=="string")return i.charCodeAt(0)||0;let a=i.hasOwnProperty(sp)?i[sp]:void 0;return typeof a=="number"?a>=0?a&JD:FF:a}function MS(i,a,c){let m=1<<i;return!!(c[a+(i>>KD)]&m)}function AS(i,a){return!(i&Nn.Self)&&!(i&Nn.Host&&a)}var zc=class{constructor(a,c){this._tNode=a,this._lView=c}get(a,c,m){return rC(this._tNode,this._lView,a,Y_(m),c)}};function FF(){return new zc(hs(),li())}function Tb(i){return gp(()=>{let a=i.prototype.constructor,c=a[E_]||Nx(a),m=Object.prototype,b=Object.getPrototypeOf(i.prototype).constructor;for(;b&&b!==m;){let n=b[E_]||Nx(b);if(n&&n!==c)return n;b=Object.getPrototypeOf(b)}return n=>new n})}function Nx(i){return eD(i)?()=>{let a=Nx(Co(i));return a&&a()}:Oh(i)}function NF(i,a,c,m,b){let n=i,P=a;for(;n!==null&&P!==null&&P[_n]&2048&&!(P[_n]&512);){let U=iC(n,P,c,m|Nn.Self,As);if(U!==As)return U;let $=n.parent;if(!$){let se=P[TD];if(se){let Te=se.get(c,As,m);if(Te!==As)return Te}$=oC(P),P=P[_p]}n=$}return b}function oC(i){let a=i[Gn],c=a.type;return c===2?a.declTNode:c===1?i[us]:null}function RS(i,a=null,c=null,m){let b=sC(i,a,c,m);return b.resolveInjectorInitializers(),b}function sC(i,a=null,c=null,m,b=new Set){let n=[c||as,Uk(i)];return m=m||(typeof i=="object"?void 0:so(i)),new cp(n,a||mb(),m||null,b)}var fa=class i{static{this.THROW_IF_NOT_FOUND=ap}static{this.NULL=new S_}static create(a,c){if(Array.isArray(a))return RS({name:""},c,a,"");{let m=a.name??"";return RS({name:m},a.parent,a.providers,m)}}static{this.\u0275prov=vn({token:i,providedIn:"any",factory:()=>Jn(hD)})}static{this.__NG_ELEMENT_ID__=-1}};var zF=new yn("");zF.__NG_ELEMENT_ID__=i=>{let a=hs();if(a===null)throw new rn(204,!1);if(a.type&2)return a.value;if(i&Nn.Optional)return null;throw new rn(204,!1)};var BF="ngOriginalError";function vx(i){return i[BF]}var aC=!0,lC=(()=>{class i{static{this.__NG_ELEMENT_ID__=VF}static{this.__NG_ENV_ID__=c=>c}}return i})(),zx=class extends lC{constructor(a){super(),this._lView=a}onDestroy(a){return LD(this._lView,a),()=>lF(this._lView,a)}};function VF(){return new zx(li())}var Zc=(()=>{class i{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ai(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let c=this.taskId++;return this.pendingTasks.add(c),c}remove(c){this.pendingTasks.delete(c),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275prov=vn({token:i,providedIn:"root",factory:()=>new i})}}return i})();var Bx=class extends Ri{constructor(a=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=a,Qk()&&(this.destroyRef=Et(lC,{optional:!0})??void 0,this.pendingTasks=Et(Zc,{optional:!0})??void 0)}emit(a){let c=or(null);try{super.next(a)}finally{or(c)}}subscribe(a,c,m){let b=a,n=c||(()=>null),P=m;if(a&&typeof a=="object"){let $=a;b=$.next?.bind($),n=$.error?.bind($),P=$.complete?.bind($)}this.__isAsync&&(n=this.wrapInTimeout(n),b&&(b=this.wrapInTimeout(b)),P&&(P=this.wrapInTimeout(P)));let U=super.subscribe({next:b,error:n,complete:P});return a instanceof jr&&a.add(U),U}wrapInTimeout(a){return c=>{let m=this.pendingTasks?.add();setTimeout(()=>{a(c),m!==void 0&&this.pendingTasks?.remove(m)})}}},Pi=Bx;function k_(...i){}function cC(i){let a,c;function m(){i=k_;try{c!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(c),a!==void 0&&clearTimeout(a)}catch{}}return a=setTimeout(()=>{i(),m()}),typeof requestAnimationFrame=="function"&&(c=requestAnimationFrame(()=>{i(),m()})),()=>m()}function PS(i){return queueMicrotask(()=>i()),()=>{i=k_}}var Ib="isAngularZone",F_=Ib+"_ID",jF=0,Nr=class i{constructor(a){this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Pi(!1),this.onMicrotaskEmpty=new Pi(!1),this.onStable=new Pi(!1),this.onError=new Pi(!1);let{enableLongStackTrace:c=!1,shouldCoalesceEventChangeDetection:m=!1,shouldCoalesceRunChangeDetection:b=!1,scheduleInRootZone:n=aC}=a;if(typeof Zone>"u")throw new rn(908,!1);Zone.assertZonePatched();let P=this;P._nesting=0,P._outer=P._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(P._inner=P._inner.fork(new Zone.TaskTrackingZoneSpec)),c&&Zone.longStackTraceZoneSpec&&(P._inner=P._inner.fork(Zone.longStackTraceZoneSpec)),P.shouldCoalesceEventChangeDetection=!b&&m,P.shouldCoalesceRunChangeDetection=b,P.callbackScheduled=!1,P.scheduleInRootZone=n,GF(P)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(Ib)===!0}static assertInAngularZone(){if(!i.isInAngularZone())throw new rn(909,!1)}static assertNotInAngularZone(){if(i.isInAngularZone())throw new rn(909,!1)}run(a,c,m){return this._inner.run(a,c,m)}runTask(a,c,m,b){let n=this._inner,P=n.scheduleEventTask("NgZoneEvent: "+b,a,UF,k_,k_);try{return n.runTask(P,c,m)}finally{n.cancelTask(P)}}runGuarded(a,c,m){return this._inner.runGuarded(a,c,m)}runOutsideAngular(a){return this._outer.run(a)}},UF={};function Sb(i){if(i._nesting==0&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function $F(i){if(i.isCheckStableRunning||i.callbackScheduled)return;i.callbackScheduled=!0;function a(){cC(()=>{i.callbackScheduled=!1,Vx(i),i.isCheckStableRunning=!0,Sb(i),i.isCheckStableRunning=!1})}i.scheduleInRootZone?Zone.root.run(()=>{a()}):i._outer.run(()=>{a()}),Vx(i)}function GF(i){let a=()=>{$F(i)},c=jF++;i._inner=i._inner.fork({name:"angular",properties:{[Ib]:!0,[F_]:c,[F_+c]:!0},onInvokeTask:(m,b,n,P,U,$)=>{if(HF($))return m.invokeTask(n,P,U,$);try{return OS(i),m.invokeTask(n,P,U,$)}finally{(i.shouldCoalesceEventChangeDetection&&P.type==="eventTask"||i.shouldCoalesceRunChangeDetection)&&a(),LS(i)}},onInvoke:(m,b,n,P,U,$,se)=>{try{return OS(i),m.invoke(n,P,U,$,se)}finally{i.shouldCoalesceRunChangeDetection&&!i.callbackScheduled&&!qF($)&&a(),LS(i)}},onHasTask:(m,b,n,P)=>{m.hasTask(n,P),b===n&&(P.change=="microTask"?(i._hasPendingMicrotasks=P.microTask,Vx(i),Sb(i)):P.change=="macroTask"&&(i.hasPendingMacrotasks=P.macroTask))},onHandleError:(m,b,n,P)=>(m.handleError(n,P),i.runOutsideAngular(()=>i.onError.emit(P)),!1)})}function Vx(i){i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&i.callbackScheduled===!0?i.hasPendingMicrotasks=!0:i.hasPendingMicrotasks=!1}function OS(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function LS(i){i._nesting--,Sb(i)}var jx=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Pi,this.onMicrotaskEmpty=new Pi,this.onStable=new Pi,this.onError=new Pi}run(a,c,m){return a.apply(c,m)}runGuarded(a,c,m){return a.apply(c,m)}runOutsideAngular(a){return a()}runTask(a,c,m,b){return a.apply(c,m)}};function HF(i){return uC(i,"__ignore_ng_zone__")}function qF(i){return uC(i,"__scheduler_tick__")}function uC(i,a){return!Array.isArray(i)||i.length!==1?!1:i[0]?.data?.[a]===!0}var pa=class{constructor(){this._console=console}handleError(a){let c=this._findOriginalError(a);this._console.error("ERROR",a),c&&this._console.error("ORIGINAL ERROR",c)}_findOriginalError(a){let c=a&&vx(a);for(;c&&vx(c);)c=vx(c);return c||null}},WF=new yn("",{providedIn:"root",factory:()=>{let i=Et(Nr),a=Et(pa);return c=>i.runOutsideAngular(()=>a.handleError(c))}});function ZF(){return iy(hs(),li())}function iy(i,a){return new oy(Po(i,a))}var oy=(()=>{class i{constructor(c){this.nativeElement=c}static{this.__NG_ELEMENT_ID__=ZF}}return i})();var XF="ngSkipHydration",YF="ngskiphydration";function hC(i){let a=i.mergedAttrs;if(a===null)return!1;for(let c=0;c<a.length;c+=2){let m=a[c];if(typeof m=="number")return!1;if(typeof m=="string"&&m.toLowerCase()===YF)return!0}return!1}function dC(i){return i.hasAttribute(XF)}function N_(i){return(i.flags&128)===128}function JF(i){if(N_(i))return!0;let a=i.parent;for(;a;){if(N_(i)||hC(a))return!0;a=a.parent}return!1}var fC=new Map,KF=0;function QF(){return KF++}function e3(i){fC.set(i[ey],i)}function Ux(i){fC.delete(i[ey])}var kS="__ngContext__";function $c(i,a){Rs(a)?(i[kS]=a[ey],e3(a)):i[kS]=a}function pC(i){return gC(i[up])}function mC(i){return gC(i[ls])}function gC(i){for(;i!==null&&!ks(i);)i=i[ls];return i}var $x;function _C(i){$x=i}function sy(){if($x!==void 0)return $x;if(typeof document<"u")return document;throw new rn(210,!1)}var ay=new yn("",{providedIn:"root",factory:()=>t3}),t3="ng",Db=new yn(""),Oo=new yn("",{providedIn:"platform",factory:()=>"unknown"});var Cb=new yn("",{providedIn:"root",factory:()=>sy().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function n3(){let i=new jh;return Et(Oo)==="browser"&&(i.store=r3(sy(),Et(ay))),i}var jh=(()=>{class i{constructor(){this.store={},this.onSerializeCallbacks={}}static{this.\u0275prov=vn({token:i,providedIn:"root",factory:n3})}get(c,m){return this.store[c]!==void 0?this.store[c]:m}set(c,m){this.store[c]=m}remove(c){delete this.store[c]}hasKey(c){return this.store.hasOwnProperty(c)}get isEmpty(){return Object.keys(this.store).length===0}onSerialize(c,m){this.onSerializeCallbacks[c]=m}toJson(){for(let c in this.onSerializeCallbacks)if(this.onSerializeCallbacks.hasOwnProperty(c))try{this.store[c]=this.onSerializeCallbacks[c]()}catch(m){console.warn("Exception in onSerialize callback: ",m)}return JSON.stringify(this.store).replace(/</g,"\\u003C")}}return i})();function r3(i,a){let c=i.getElementById(a+"-state");if(c?.textContent)try{return JSON.parse(c.textContent)}catch(m){console.warn("Exception while restoring TransferState for app "+a,m)}return{}}var yC="h",vC="b",Gx=function(i){return i.FirstChild="f",i.NextSibling="n",i}(Gx||{}),i3="e",o3="t",Mb="c",xC="x",z_="r",s3="i",a3="n",bC="d";var l3="__nghData__",wC=l3,xx="ngh",c3="nghm",EC=()=>null;function u3(i,a,c=!1){let m=i.getAttribute(xx);if(m==null)return null;let[b,n]=m.split("|");if(m=c?n:b,!m)return null;let P=n?`|${n}`:"",U=c?b:P,$={};if(m!==""){let Te=a.get(jh,null,{optional:!0});Te!==null&&($=Te.get(wC,[])[Number(m)])}let se={data:$,firstChild:i.firstChild??null};return c&&(se.firstChild=i,ly(se,0,i.nextSibling)),U?i.setAttribute(xx,U):i.removeAttribute(xx),se}function h3(){EC=u3}function Ab(i,a,c=!1){return EC(i,a,c)}function d3(i){let a=i._lView;return a[Gn].type===2?null:(R_(a)&&(a=a[$i]),a)}function f3(i){return i.textContent?.replace(/\s/gm,"")}function p3(i){let a=sy(),c=a.createNodeIterator(i,NodeFilter.SHOW_COMMENT,{acceptNode(n){let P=f3(n);return P==="ngetn"||P==="ngtns"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),m,b=[];for(;m=c.nextNode();)b.push(m);for(let n of b)n.textContent==="ngetn"?n.replaceWith(a.createTextNode("")):n.remove()}function ly(i,a,c){i.segmentHeads??={},i.segmentHeads[a]=c}function Hx(i,a){return i.segmentHeads?.[a]??null}function m3(i,a){let c=i.data,m=c[i3]?.[a]??null;return m===null&&c[Mb]?.[a]&&(m=Rb(i,a)),m}function TC(i,a){return i.data[Mb]?.[a]??null}function Rb(i,a){let c=TC(i,a)??[],m=0;for(let b of c)m+=b[z_]*(b[xC]??1);return m}function g3(i){if(typeof i.disconnectedNodes>"u"){let a=i.data[bC];i.disconnectedNodes=a?new Set(a):null}return i.disconnectedNodes}function wp(i,a){if(typeof i.disconnectedNodes>"u"){let c=i.data[bC];i.disconnectedNodes=c?new Set(c):null}return!!g3(i)?.has(a)}var p_=new yn(""),IC=!1,SC=new yn("",{providedIn:"root",factory:()=>IC});var _3=/^>|^->|<!--|-->|--!>|<!-$/g,y3=/(<|>)/g,v3="\u200B$1\u200B";function x3(i){return i.replace(_3,a=>a.replace(y3,v3))}function b3(i){return i.ownerDocument.body}function DC(i){return i instanceof Function?i():i}function m_(i){return(i??Et(fa)).get(Oo)==="browser"}var Xc=function(i){return i[i.Important=1]="Important",i[i.DashCase=2]="DashCase",i}(Xc||{}),w3;function Pb(i,a){return w3(i,a)}function Ah(i,a,c,m,b){if(m!=null){let n,P=!1;ks(m)?n=m:Rs(m)&&(P=!0,m=m[lo]);let U=cs(m);i===0&&c!==null?b==null?OC(a,c,U):B_(a,c,U,b||null,!0):i===1&&c!==null?B_(a,c,U,b||null,!0):i===2?Fb(a,U,P):i===3&&a.destroyNode(U),n!=null&&N3(a,i,n,c,b)}}function CC(i,a){return i.createText(a)}function E3(i,a,c){i.setValue(a,c)}function MC(i,a){return i.createComment(x3(a))}function Ob(i,a,c){return i.createElement(a,c)}function T3(i,a){AC(i,a),a[lo]=null,a[us]=null}function I3(i,a,c,m,b,n){m[lo]=b,m[us]=a,cy(i,m,c,1,b,n)}function AC(i,a){a[ha].changeDetectionScheduler?.notify(9),cy(i,a,a[Yr],2,null,null)}function S3(i){let a=i[up];if(!a)return bx(i[Gn],i);for(;a;){let c=null;if(Rs(a))c=a[up];else{let m=a[ao];m&&(c=m)}if(!c){for(;a&&!a[ls]&&a!==i;)Rs(a)&&bx(a[Gn],a),a=a[_i];a===null&&(a=i),Rs(a)&&bx(a[Gn],a),c=a&&a[ls]}a=c}}function D3(i,a,c,m){let b=ao+m,n=c.length;m>0&&(c[b-1][ls]=a),m<n-ao?(a[ls]=c[b],uD(c,ao+m,a)):(c.push(a),a[ls]=null),a[_i]=c;let P=a[kh];P!==null&&c!==P&&RC(P,a);let U=a[Fh];U!==null&&U.insertView(i),Ox(a),a[_n]|=128}function RC(i,a){let c=i[M_],m=a[_i];if(Rs(m))i[_n]|=A_.HasTransplantedViews;else{let b=m[_i][Ro];a[Ro]!==b&&(i[_n]|=A_.HasTransplantedViews)}c===null?i[M_]=[a]:c.push(a)}function Lb(i,a){let c=i[M_],m=c.indexOf(a);c.splice(m,1)}function qx(i,a){if(i.length<=ao)return;let c=ao+a,m=i[c];if(m){let b=m[kh];b!==null&&b!==i&&Lb(b,m),a>0&&(i[c-1][ls]=m[ls]);let n=I_(i,ao+a);T3(m[Gn],m);let P=n[Fh];P!==null&&P.detachView(n[Gn]),m[_i]=null,m[ls]=null,m[_n]&=-129}return m}function PC(i,a){if(!(a[_n]&256)){let c=a[Yr];c.destroyNode&&cy(i,a,c,3,null,null),S3(a)}}function bx(i,a){if(a[_n]&256)return;let c=or(null);try{a[_n]&=-129,a[_n]|=256,a[Mo]&&Z0(a[Mo]),M3(i,a),C3(i,a),a[Gn].type===1&&a[Yr].destroy();let m=a[kh];if(m!==null&&ks(a[_i])){m!==a[_i]&&Lb(m,a);let b=a[Fh];b!==null&&b.detachView(i)}Ux(a)}finally{or(c)}}function C3(i,a){let c=i.cleanup,m=a[D_];if(c!==null)for(let n=0;n<c.length-1;n+=2)if(typeof c[n]=="string"){let P=c[n+3];P>=0?m[P]():m[-P].unsubscribe(),n+=2}else{let P=m[c[n+1]];c[n].call(P)}m!==null&&(a[D_]=null);let b=a[Il];if(b!==null){a[Il]=null;for(let n=0;n<b.length;n++){let P=b[n];P()}}}function M3(i,a){let c;if(i!=null&&(c=i.destroyHooks)!=null)for(let m=0;m<c.length;m+=2){let b=a[c[m]];if(!(b instanceof dp)){let n=c[m+1];if(Array.isArray(n))for(let P=0;P<n.length;P+=2){let U=b[n[P]],$=n[P+1];Ms(4,U,$);try{$.call(U)}finally{Ms(5,U,$)}}else{Ms(4,b,n);try{n.call(b)}finally{Ms(5,b,n)}}}}}function A3(i,a,c){return R3(i,a.parent,c)}function R3(i,a,c){let m=a;for(;m!==null&&m.type&168;)a=m,m=a.parent;if(m===null)return c[lo];{let{componentOffset:b}=m;if(b>-1){let{encapsulation:n}=i.data[m.directiveStart+b];if(n===Ps.None||n===Ps.Emulated)return null}return Po(m,c)}}function B_(i,a,c,m,b){i.insertBefore(a,c,m,b)}function OC(i,a,c){i.appendChild(a,c)}function FS(i,a,c,m,b){m!==null?B_(i,a,c,m,b):OC(i,a,c)}function LC(i,a){return i.parentNode(a)}function P3(i,a){return i.nextSibling(a)}function O3(i,a,c){return k3(i,a,c)}function L3(i,a,c){return i.type&40?Po(i,c):null}var k3=L3,NS;function kb(i,a,c,m){let b=A3(i,m,a),n=a[Yr],P=m.parent||a[us],U=O3(P,m,a);if(b!=null)if(Array.isArray(c))for(let $=0;$<c.length;$++)FS(n,b,c[$],U,!1);else FS(n,b,c,U,!1);NS!==void 0&&NS(n,m,a,c,b)}function ip(i,a){if(a!==null){let c=a.type;if(c&3)return Po(a,i);if(c&4)return Wx(-1,i[a.index]);if(c&8){let m=a.child;if(m!==null)return ip(i,m);{let b=i[a.index];return ks(b)?Wx(-1,b):cs(b)}}else{if(c&128)return ip(i,a.next);if(c&32)return Pb(a,i)()||cs(i[a.index]);{let m=kC(i,a);if(m!==null){if(Array.isArray(m))return m[0];let b=jc(i[Ro]);return ip(b,m)}else return ip(i,a.next)}}}return null}function kC(i,a){if(a!==null){let m=i[Ro][us],b=a.projection;return m.projection[b]}return null}function Wx(i,a){let c=ao+i+1;if(c<a.length){let m=a[c],b=m[Gn].firstChild;if(b!==null)return ip(m,b)}return a[da]}function Fb(i,a,c){i.removeChild(null,a,c)}function FC(i){i.textContent=""}function Nb(i,a,c,m,b,n,P){for(;c!=null;){if(c.type===128){c=c.next;continue}let U=m[c.index],$=c.type;if(P&&a===0&&(U&&$c(cs(U),m),c.flags|=2),(c.flags&32)!==32)if($&8)Nb(i,a,c.child,m,b,n,!1),Ah(a,i,b,U,n);else if($&32){let se=Pb(c,m),Te;for(;Te=se();)Ah(a,i,b,Te,n);Ah(a,i,b,U,n)}else $&16?F3(i,a,m,c,b,n):Ah(a,i,b,U,n);c=P?c.projectionNext:c.next}}function cy(i,a,c,m,b,n){Nb(c,m,i.firstChild,a,b,n,!1)}function F3(i,a,c,m,b,n){let P=c[Ro],$=P[us].projection[m.projection];if(Array.isArray($))for(let se=0;se<$.length;se++){let Te=$[se];Ah(a,i,b,Te,n)}else{let se=$,Te=P[_i];N_(m)&&(se.flags|=128),Nb(i,a,se,Te,b,n,!0)}}function N3(i,a,c,m,b){let n=c[da],P=cs(c);n!==P&&Ah(a,i,m,n,b);for(let U=ao;U<c.length;U++){let $=c[U];cy($[Gn],$,i,a,m,n)}}function z3(i,a,c){i.setAttribute(a,"style",c)}function NC(i,a,c){c===""?i.removeAttribute(a,"class"):i.setAttribute(a,"class",c)}function zC(i,a,c){let{mergedAttrs:m,classes:b,styles:n}=c;m!==null&&Dx(i,a,m),b!==null&&NC(i,a,b),n!==null&&z3(i,a,n)}var uy={};function zb(i=1){BC(Wc(),li(),xb()+i,!1)}function BC(i,a,c,m){if(!m)if((a[_n]&3)===3){let n=i.preOrderCheckHooks;n!==null&&v_(a,n,c)}else{let n=i.preOrderHooks;n!==null&&x_(a,n,0,c)}Uc(c)}function Ml(i,a=Nn.Default){let c=li();if(c===null)return Jn(i,a);let m=hs();return rC(m,c,Co(i),a)}function VC(i,a,c,m,b,n){let P=or(null);try{let U=null;b&Sl.SignalBased&&(U=a[m][FI]),U!==null&&U.transformFn!==void 0&&(n=U.transformFn(n)),b&Sl.HasDecoratorInputTransform&&(n=i.inputTransforms[m].call(a,n)),i.setInput!==null?i.setInput(a,U,n,c,m):DD(a,U,m,n)}finally{or(P)}}function B3(i,a){let c=i.hostBindingOpCodes;if(c!==null)try{for(let m=0;m<c.length;m++){let b=c[m];if(b<0)Uc(~b);else{let n=b,P=c[++m],U=c[++m];vF(P,n);let $=a[n];U(2,$)}}}finally{Uc(-1)}}function hy(i,a,c,m,b,n,P,U,$,se,Te){let Pe=a.blueprint.slice();return Pe[lo]=b,Pe[_n]=m|4|128|8|64,(se!==null||i&&i[_n]&2048)&&(Pe[_n]|=2048),PD(Pe),Pe[_i]=Pe[_p]=i,Pe[ua]=c,Pe[ha]=P||i&&i[ha],Pe[Yr]=U||i&&i[Yr],Pe[Lh]=$||i&&i[Lh]||null,Pe[us]=n,Pe[ey]=QF(),Pe[Os]=Te,Pe[TD]=se,Pe[Ro]=a.type==2?i[Ro]:Pe,Pe}function dy(i,a,c,m,b){let n=i.data[a];if(n===null)n=V3(i,a,c,m,b),yF()&&(n.flags|=32);else if(n.type&64){n.type=c,n.value=m,n.attrs=b;let P=mF();n.injectorIndex=P===null?-1:P.injectorIndex}return bp(n,!0),n}function V3(i,a,c,m,b){let n=ND(),P=zD(),U=P?n:n&&n.parent,$=i.data[a]=q3(i,U,c,a,m,b);return i.firstChild===null&&(i.firstChild=$),n!==null&&(P?n.child==null&&$.parent!==null&&(n.child=$):n.next===null&&(n.next=$,$.prev=n)),$}function jC(i,a,c,m){if(c===0)return-1;let b=a.length;for(let n=0;n<c;n++)a.push(m),i.blueprint.push(m),i.data.push(null);return b}function UC(i,a,c,m,b){let n=xb(),P=m&2;try{Uc(-1),P&&a.length>$i&&BC(i,a,$i,!1),Ms(P?2:0,b),c(m,b)}finally{Uc(n),Ms(P?3:1,b)}}function $C(i,a,c){if(SD(a)){let m=or(null);try{let b=a.directiveStart,n=a.directiveEnd;for(let P=b;P<n;P++){let U=i.data[P];if(U.contentQueries){let $=c[P];U.contentQueries(1,$,P)}}}finally{or(m)}}}function GC(i,a,c){FD()&&(Q3(i,a,c,Po(c,a)),(c.flags&64)===64&&YC(i,a,c))}function HC(i,a,c=Po){let m=a.localNames;if(m!==null){let b=a.index+1;for(let n=0;n<m.length;n+=2){let P=m[n+1],U=P===-1?c(a,i):i[P];i[b++]=U}}}function qC(i){let a=i.tView;return a===null||a.incompleteFirstPass?i.tView=Bb(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts,i.id):a}function Bb(i,a,c,m,b,n,P,U,$,se,Te){let Pe=$i+m,Ye=Pe+b,We=j3(Pe,Ye),pt=typeof se=="function"?se():se;return We[Gn]={type:i,blueprint:We,template:c,queries:null,viewQuery:U,declTNode:a,data:We.slice().fill(null,Pe),bindingStartIndex:Pe,expandoStartIndex:Ye,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof n=="function"?n():n,pipeRegistry:typeof P=="function"?P():P,firstChild:null,schemas:$,consts:pt,incompleteFirstPass:!1,ssrId:Te}}function j3(i,a){let c=[];for(let m=0;m<a;m++)c.push(m<i?null:uy);return c}function U3(i,a,c,m){let n=m.get(SC,IC)||c===Ps.ShadowDom,P=i.selectRootElement(a,n);return $3(P),P}function $3(i){WC(i)}var WC=()=>null;function G3(i){dC(i)?FC(i):p3(i)}function H3(){WC=G3}function q3(i,a,c,m,b,n){let P=a?a.injectorIndex:-1,U=0;return xp()&&(U|=128),{type:c,index:m,insertBeforeIndex:null,injectorIndex:P,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:U,providerIndexes:0,value:b,attrs:n,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:a,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function zS(i,a,c,m,b){for(let n in a){if(!a.hasOwnProperty(n))continue;let P=a[n];if(P===void 0)continue;m??={};let U,$=Sl.None;Array.isArray(P)?(U=P[0],$=P[1]):U=P;let se=n;if(b!==null){if(!b.hasOwnProperty(n))continue;se=b[n]}i===0?BS(m,c,se,U,$):BS(m,c,se,U)}return m}function BS(i,a,c,m,b){let n;i.hasOwnProperty(c)?(n=i[c]).push(a,m):n=i[c]=[a,m],b!==void 0&&n.push(b)}function W3(i,a,c){let m=a.directiveStart,b=a.directiveEnd,n=i.data,P=a.attrs,U=[],$=null,se=null;for(let Te=m;Te<b;Te++){let Pe=n[Te],Ye=c?c.get(Pe):null,We=Ye?Ye.inputs:null,pt=Ye?Ye.outputs:null;$=zS(0,Pe.inputs,Te,$,We),se=zS(1,Pe.outputs,Te,se,pt);let _t=$!==null&&P!==null&&!fb(a)?lN($,Te,P):null;U.push(_t)}$!==null&&($.hasOwnProperty("class")&&(a.flags|=8),$.hasOwnProperty("style")&&(a.flags|=16)),a.initialInputs=U,a.inputs=$,a.outputs=se}function Z3(i){return i==="class"?"className":i==="for"?"htmlFor":i==="formaction"?"formAction":i==="innerHtml"?"innerHTML":i==="readonly"?"readOnly":i==="tabindex"?"tabIndex":i}function X3(i,a,c,m,b,n,P,U){let $=Po(a,c),se=a.inputs,Te;!U&&se!=null&&(Te=se[m])?(Vb(i,c,Te,m,b),yp(a)&&Y3(c,a.index)):a.type&3?(m=Z3(m),b=P!=null?P(b,a.value||"",m):b,n.setProperty($,m,b)):a.type&12}function Y3(i,a){let c=qc(a,i);c[_n]&16||(c[_n]|=64)}function ZC(i,a,c,m){if(FD()){let b=m===null?null:{"":-1},n=tN(i,c),P,U;n===null?P=U=null:[P,U]=n,P!==null&&XC(i,a,c,P,b,U),b&&nN(c,m,b)}c.mergedAttrs=db(c.mergedAttrs,c.attrs)}function XC(i,a,c,m,b,n){for(let se=0;se<m.length;se++)PF(QD(c,a),i,m[se].type);iN(c,i.data.length,m.length);for(let se=0;se<m.length;se++){let Te=m[se];Te.providersResolver&&Te.providersResolver(Te)}let P=!1,U=!1,$=jC(i,a,m.length,null);for(let se=0;se<m.length;se++){let Te=m[se];c.mergedAttrs=db(c.mergedAttrs,Te.hostAttrs),oN(i,c,a,$,Te),rN($,Te,b),Te.contentQueries!==null&&(c.flags|=4),(Te.hostBindings!==null||Te.hostAttrs!==null||Te.hostVars!==0)&&(c.flags|=64);let Pe=Te.type.prototype;!P&&(Pe.ngOnChanges||Pe.ngOnInit||Pe.ngDoCheck)&&((i.preOrderHooks??=[]).push(c.index),P=!0),!U&&(Pe.ngOnChanges||Pe.ngDoCheck)&&((i.preOrderCheckHooks??=[]).push(c.index),U=!0),$++}W3(i,c,n)}function J3(i,a,c,m,b){let n=b.hostBindings;if(n){let P=i.hostBindingOpCodes;P===null&&(P=i.hostBindingOpCodes=[]);let U=~a.index;K3(P)!=U&&P.push(U),P.push(c,m,n)}}function K3(i){let a=i.length;for(;a>0;){let c=i[--a];if(typeof c=="number"&&c<0)return c}return 0}function Q3(i,a,c,m){let b=c.directiveStart,n=c.directiveEnd;yp(c)&&sN(a,c,i.data[b+c.componentOffset]),i.firstCreatePass||QD(c,a),$c(m,a);let P=c.initialInputs;for(let U=b;U<n;U++){let $=i.data[U],se=fp(a,i,U,c);if($c(se,a),P!==null&&aN(a,U-b,se,$,c,P),vp($)){let Te=qc(c.index,a);Te[ua]=fp(a,i,U,c)}}}function YC(i,a,c){let m=c.directiveStart,b=c.directiveEnd,n=c.index,P=xF();try{Uc(n);for(let U=m;U<b;U++){let $=i.data[U],se=a[U];Lx(U),($.hostBindings!==null||$.hostVars!==0||$.hostAttrs!==null)&&eN($,se)}}finally{Uc(-1),Lx(P)}}function eN(i,a){i.hostBindings!==null&&i.hostBindings(1,a)}function tN(i,a){let c=i.directiveRegistry,m=null,b=null;if(c)for(let n=0;n<c.length;n++){let P=c[n];if(Ok(a,P.selectors,!1))if(m||(m=[]),vp(P))if(P.findHostDirectiveDefs!==null){let U=[];b=b||new Map,P.findHostDirectiveDefs(P,U,b),m.unshift(...U,P);let $=U.length;Zx(i,a,$)}else m.unshift(P),Zx(i,a,0);else b=b||new Map,P.findHostDirectiveDefs?.(P,m,b),m.push(P)}return m===null?null:[m,b]}function Zx(i,a,c){a.componentOffset=c,(i.components??=[]).push(a.index)}function nN(i,a,c){if(a){let m=i.localNames=[];for(let b=0;b<a.length;b+=2){let n=c[a[b+1]];if(n==null)throw new rn(-301,!1);m.push(a[b],n)}}}function rN(i,a,c){if(c){if(a.exportAs)for(let m=0;m<a.exportAs.length;m++)c[a.exportAs[m]]=i;vp(a)&&(c[""]=i)}}function iN(i,a,c){i.flags|=1,i.directiveStart=a,i.directiveEnd=a+c,i.providerIndexes=a}function oN(i,a,c,m,b){i.data[m]=b;let n=b.factory||(b.factory=Oh(b.type,!0)),P=new dp(n,vp(b),Ml);i.blueprint[m]=P,c[m]=P,J3(i,a,m,jC(i,c,b.hostVars,uy),b)}function sN(i,a,c){let m=Po(a,i),b=qC(c),n=i[ha].rendererFactory,P=16;c.signals?P=4096:c.onPush&&(P=64);let U=fy(i,hy(i,b,null,P,m,a,null,n.createRenderer(m,c),null,null,null));i[a.index]=U}function aN(i,a,c,m,b,n){let P=n[a];if(P!==null)for(let U=0;U<P.length;){let $=P[U++],se=P[U++],Te=P[U++],Pe=P[U++];VC(m,c,$,se,Te,Pe)}}function lN(i,a,c){let m=null,b=0;for(;b<c.length;){let n=c[b];if(n===0){b+=4;continue}else if(n===5){b+=2;continue}if(typeof n=="number")break;if(i.hasOwnProperty(n)){m===null&&(m=[]);let P=i[n];for(let U=0;U<P.length;U+=3)if(P[U]===a){m.push(n,P[U+1],P[U+2],c[b+1]);break}}b+=2}return m}function JC(i,a,c,m){return[i,!0,0,a,null,m,null,c,null,null]}function KC(i,a){let c=i.contentQueries;if(c!==null){let m=or(null);try{for(let b=0;b<c.length;b+=2){let n=c[b],P=c[b+1];if(P!==-1){let U=i.data[P];jD(n),U.contentQueries(2,a[P],P)}}}finally{or(m)}}}function fy(i,a){return i[up]?i[TS][ls]=a:i[up]=a,i[TS]=a,a}function Xx(i,a,c){jD(0);let m=or(null);try{a(i,c)}finally{or(m)}}function cN(i){return i[D_]??=[]}function uN(i){return i.cleanup??=[]}function QC(i,a){let c=i[Lh],m=c?c.get(pa,null):null;m&&m.handleError(a)}function Vb(i,a,c,m,b){for(let n=0;n<c.length;){let P=c[n++],U=c[n++],$=c[n++],se=a[P],Te=i.data[P];VC(Te,se,m,U,$,b)}}function hN(i,a,c){let m=sF(a,i);E3(i[Yr],m,c)}function dN(i,a){let c=qc(a,i),m=c[Gn];fN(m,c);let b=c[lo];b!==null&&c[Os]===null&&(c[Os]=Ab(b,c[Lh])),jb(m,c,c[ua])}function fN(i,a){for(let c=a.length;c<i.blueprint.length;c++)a.push(i.blueprint[c])}function jb(i,a,c){yb(a);try{let m=i.viewQuery;m!==null&&Xx(1,m,c);let b=i.template;b!==null&&UC(i,a,b,1,c),i.firstCreatePass&&(i.firstCreatePass=!1),a[Fh]?.finishViewCreation(i),i.staticContentQueries&&KC(i,a),i.staticViewQueries&&Xx(2,i.viewQuery,c);let n=i.components;n!==null&&pN(a,n)}catch(m){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),m}finally{a[_n]&=-5,vb()}}function pN(i,a){for(let c=0;c<a.length;c++)dN(i,a[c])}function mN(i,a,c,m){let b=or(null);try{let n=a.tView,U=i[_n]&4096?4096:16,$=hy(i,n,c,U,null,a,null,null,m?.injector??null,m?.embeddedViewInjector??null,m?.dehydratedView??null),se=i[a.index];$[kh]=se;let Te=i[Fh];return Te!==null&&($[Fh]=Te.createEmbeddedView(n)),jb(n,$,c),$}finally{or(b)}}function VS(i,a){return!a||a.firstChild===null||N_(i)}function gN(i,a,c,m=!0){let b=a[Gn];if(D3(b,a,i,c),m){let P=Wx(c,i),U=a[Yr],$=LC(U,i[da]);$!==null&&I3(b,i[us],U,a,$,P)}let n=a[Os];n!==null&&n.firstChild!==null&&(n.firstChild=null)}function V_(i,a,c,m,b=!1){for(;c!==null;){if(c.type===128){c=b?c.projectionNext:c.next;continue}let n=a[c.index];n!==null&&m.push(cs(n)),ks(n)&&_N(n,m);let P=c.type;if(P&8)V_(i,a,c.child,m);else if(P&32){let U=Pb(c,a),$;for(;$=U();)m.push($)}else if(P&16){let U=kC(a,c);if(Array.isArray(U))m.push(...U);else{let $=jc(a[Ro]);V_($[Gn],$,U,m,!0)}}c=b?c.projectionNext:c.next}return m}function _N(i,a){for(let c=ao;c<i.length;c++){let m=i[c],b=m[Gn].firstChild;b!==null&&V_(m[Gn],m,b,a)}i[da]!==i[lo]&&a.push(i[da])}var eM=[];function yN(i){return i[Mo]??vN(i)}function vN(i){let a=eM.pop()??Object.create(bN);return a.lView=i,a}function xN(i){i.lView[Mo]!==i&&(i.lView=null,eM.push(i))}var bN=Sr(kt({},H0),{consumerIsAlwaysLive:!0,consumerMarkedDirty:i=>{ry(i.lView)},consumerOnSignalRead(){this.lView[Mo]=this}});function wN(i){let a=i[Mo]??Object.create(EN);return a.lView=i,a}var EN=Sr(kt({},H0),{consumerIsAlwaysLive:!0,consumerMarkedDirty:i=>{let a=jc(i.lView);for(;a&&!tM(a[Gn]);)a=jc(a);a&&OD(a)},consumerOnSignalRead(){this.lView[Mo]=this}});function tM(i){return i.type!==2}var TN=100;function nM(i,a=!0,c=0){let m=i[ha],b=m.rendererFactory,n=!1;n||b.begin?.();try{IN(i,c)}catch(P){throw a&&QC(i,P),P}finally{n||(b.end?.(),m.inlineEffectRunner?.flush())}}function IN(i,a){let c=BD();try{SS(!0),Yx(i,a);let m=0;for(;ny(i);){if(m===TN)throw new rn(103,!1);m++,Yx(i,1)}}finally{SS(c)}}function SN(i,a,c,m){let b=a[_n];if((b&256)===256)return;let n=!1,P=!1;!n&&a[ha].inlineEffectRunner?.flush(),yb(a);let U=!0,$=null,se=null;n||(tM(i)?(se=yN(a),$=q0(se)):NI()===null?(U=!1,se=wN(a),$=q0(se)):a[Mo]&&(Z0(a[Mo]),a[Mo]=null));try{PD(a),_F(i.bindingStartIndex),c!==null&&UC(i,a,c,2,m);let Te=(b&3)===3;if(!n)if(Te){let We=i.preOrderCheckHooks;We!==null&&v_(a,We,null)}else{let We=i.preOrderHooks;We!==null&&x_(a,We,0,null),gx(a,0)}if(P||DN(a),rM(a,0),i.contentQueries!==null&&KC(i,a),!n)if(Te){let We=i.contentCheckHooks;We!==null&&v_(a,We)}else{let We=i.contentHooks;We!==null&&x_(a,We,1),gx(a,1)}B3(i,a);let Pe=i.components;Pe!==null&&oM(a,Pe,0);let Ye=i.viewQuery;if(Ye!==null&&Xx(2,Ye,m),!n)if(Te){let We=i.viewCheckHooks;We!==null&&v_(a,We)}else{let We=i.viewHooks;We!==null&&x_(a,We,2),gx(a,2)}if(i.firstUpdatePass===!0&&(i.firstUpdatePass=!1),a[mx]){for(let We of a[mx])We();a[mx]=null}n||(a[_n]&=-73)}catch(Te){throw n||ry(a),Te}finally{se!==null&&(zI(se,$),U&&xN(se)),vb()}}function rM(i,a){for(let c=pC(i);c!==null;c=mC(c))for(let m=ao;m<c.length;m++){let b=c[m];iM(b,a)}}function DN(i){for(let a=pC(i);a!==null;a=mC(a)){if(!(a[_n]&A_.HasTransplantedViews))continue;let c=a[M_];for(let m=0;m<c.length;m++){let b=c[m];OD(b)}}}function CN(i,a,c){let m=qc(a,i);iM(m,c)}function iM(i,a){_b(i)&&Yx(i,a)}function Yx(i,a){let m=i[Gn],b=i[_n],n=i[Mo],P=!!(a===0&&b&16);if(P||=!!(b&64&&a===0),P||=!!(b&1024),P||=!!(n?.dirty&&W0(n)),P||=!1,n&&(n.dirty=!1),i[_n]&=-9217,P)SN(m,i,m.template,i[ua]);else if(b&8192){rM(i,1);let U=m.components;U!==null&&oM(i,U,1)}}function oM(i,a,c){for(let m=0;m<a.length;m++)CN(i,a[m],c)}function Ub(i,a){let c=BD()?64:1088;for(i[ha].changeDetectionScheduler?.notify(a);i;){i[_n]|=c;let m=jc(i);if(R_(i)&&!m)return i;i=m}return null}var Gc=class{get rootNodes(){let a=this._lView,c=a[Gn];return V_(c,a,c.firstChild,[])}constructor(a,c,m=!0){this._lView=a,this._cdRefInjectingView=c,this.notifyErrorHandler=m,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ua]}set context(a){this._lView[ua]=a}get destroyed(){return(this._lView[_n]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let a=this._lView[_i];if(ks(a)){let c=a[C_],m=c?c.indexOf(this):-1;m>-1&&(qx(a,m),I_(c,m))}this._attachedToViewContainer=!1}PC(this._lView[Gn],this._lView)}onDestroy(a){LD(this._lView,a)}markForCheck(){Ub(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[_n]&=-129}reattach(){Ox(this._lView),this._lView[_n]|=128}detectChanges(){this._lView[_n]|=1024,nM(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new rn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let a=R_(this._lView),c=this._lView[kh];c!==null&&!a&&Lb(c,this._lView),AC(this._lView[Gn],this._lView)}attachToAppRef(a){if(this._attachedToViewContainer)throw new rn(902,!1);this._appRef=a;let c=R_(this._lView),m=this._lView[kh];m!==null&&!c&&RC(m,this._lView),Ox(this._lView)}},$b=(()=>{class i{static{this.__NG_ELEMENT_ID__=RN}}return i})(),MN=$b,AN=class extends MN{constructor(a,c,m){super(),this._declarationLView=a,this._declarationTContainer=c,this.elementRef=m}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(a,c){return this.createEmbeddedViewImpl(a,c)}createEmbeddedViewImpl(a,c,m){let b=mN(this._declarationLView,this._declarationTContainer,a,{embeddedViewInjector:c,dehydratedView:m});return new Gc(b)}};function RN(){return PN(hs(),li())}function PN(i,a){return i.type&4?new AN(a,i,iy(i,a)):null}var ON=new RegExp(`^(\\d+)*(${vC}|${yC})*(.*)`);function LN(i){let a=i.match(ON),[c,m,b,n]=a,P=m?parseInt(m,10):b,U=[];for(let[$,se,Te]of n.matchAll(/(f|n)(\d*)/g)){let Pe=parseInt(Te,10)||1;U.push(se,Pe)}return[P,...U]}function kN(i){return!i.prev&&i.parent?.type===8}function wx(i){return i.index-$i}function FN(i,a){let c=i.i18nNodes;if(c)return c.get(a)}function py(i,a,c,m){let b=wx(m),n=FN(i,b);if(n===void 0){let P=i.data[a3];if(P?.[b])n=zN(P[b],c);else if(a.firstChild===m)n=i.firstChild;else{let U=m.prev===null,$=m.prev??m.parent;if(kN(m)){let se=wx(m.parent);n=Hx(i,se)}else{let se=Po($,c);if(U)n=se.firstChild;else{let Te=wx($),Pe=Hx(i,Te);if($.type===2&&Pe){let We=Rb(i,Te)+1;n=my(We,Pe)}else n=se.nextSibling}}}}return n}function my(i,a){let c=a;for(let m=0;m<i;m++)c=c.nextSibling;return c}function NN(i,a){let c=i;for(let m=0;m<a.length;m+=2){let b=a[m],n=a[m+1];for(let P=0;P<n;P++)switch(b){case Gx.FirstChild:c=c.firstChild;break;case Gx.NextSibling:c=c.nextSibling;break}}return c}function zN(i,a){let[c,...m]=LN(i),b;if(c===yC)b=a[Ro][lo];else if(c===vC)b=b3(a[Ro][lo]);else{let n=Number(c);b=cs(a[n+$i])}return NN(b,m)}var BN=!1;function VN(i){BN=i}function jN(i){let a=i[Os];if(a){let{i18nNodes:c,dehydratedIcuData:m}=a;if(c&&m){let b=i[Yr];for(let n of m.values())UN(b,c,n)}a.i18nNodes=void 0,a.dehydratedIcuData=void 0}}function UN(i,a,c){for(let m of c.node.cases[c.case]){let b=a.get(m.index-$i);b&&Fb(i,b,!1)}}function sM(i){let a=i[hp]??[],m=i[_i][Yr];for(let b of a)$N(b,m);i[hp]=as}function $N(i,a){let c=0,m=i.firstChild;if(m){let b=i.data[z_];for(;c<b;){let n=m.nextSibling;Fb(a,m,!1),m=n,c++}}}function aM(i){sM(i);let a=i[lo];Rs(a)&&j_(a);for(let c=ao;c<i.length;c++)j_(i[c])}function j_(i){jN(i);let a=i[Gn];for(let c=$i;c<a.bindingStartIndex;c++)if(ks(i[c])){let m=i[c];aM(m)}else Rs(i[c])&&j_(i[c])}function GN(i){let a=i._views;for(let c of a){let m=d3(c);m!==null&&m[lo]!==null&&(Rs(m)?j_(m):aM(m))}}function HN(i,a){let c=[];for(let m of a)for(let b=0;b<(m[xC]??1);b++){let n={data:m,firstChild:null};m[z_]>0&&(n.firstChild=i,i=my(m[z_],i)),c.push(n)}return[i,c]}var lM=()=>null;function qN(i,a){let c=i[hp];return!a||c===null||c.length===0?null:c[0].data[s3]===a?c.shift():(sM(i),null)}function WN(){lM=qN}function jS(i,a){return lM(i,a)}var Nh=class{},gy=new yn("",{providedIn:"root",factory:()=>!1});var cM=new yn(""),uM=new yn(""),Jx=class{},U_=class{};function ZN(i){let a=Error(`No component factory found for ${so(i)}.`);return a[XN]=i,a}var XN="ngComponent";var Kx=class{resolveComponentFactory(a){throw ZN(a)}},zh=class{static{this.NULL=new Kx}},Bh=class{};var YN=(()=>{class i{static{this.\u0275prov=vn({token:i,providedIn:"root",factory:()=>null})}}return i})();function Qx(i,a,c){let m=c?i.styles:null,b=c?i.classes:null,n=0;if(a!==null)for(let P=0;P<a.length;P++){let U=a[P];if(typeof U=="number")n=U;else if(n==1)b=pS(b,U);else if(n==2){let $=U,se=a[++P];m=pS(m,$+": "+se+";")}}c?i.styles=m:i.stylesWithoutHost=m,c?i.classes=b:i.classesWithoutHost=b}var $_=class extends zh{constructor(a){super(),this.ngModule=a}resolveComponentFactory(a){let c=Vc(a);return new pp(c,this.ngModule)}};function US(i,a){let c=[];for(let m in i){if(!i.hasOwnProperty(m))continue;let b=i[m];if(b===void 0)continue;let n=Array.isArray(b),P=n?b[0]:b,U=n?b[1]:Sl.None;a?c.push({propName:P,templateName:m,isSignal:(U&Sl.SignalBased)!==0}):c.push({propName:P,templateName:m})}return c}function JN(i){let a=i.toLowerCase();return a==="svg"?iF:a==="math"?oF:null}var pp=class extends U_{get inputs(){let a=this.componentDef,c=a.inputTransforms,m=US(a.inputs,!0);if(c!==null)for(let b of m)c.hasOwnProperty(b.propName)&&(b.transform=c[b.propName]);return m}get outputs(){return US(this.componentDef.outputs,!1)}constructor(a,c){super(),this.componentDef=a,this.ngModule=c,this.componentType=a.type,this.selector=Nk(a.selectors),this.ngContentSelectors=a.ngContentSelectors?a.ngContentSelectors:[],this.isBoundToModule=!!c}create(a,c,m,b){let n=or(null);try{b=b||this.ngModule;let P=b instanceof Ao?b:b?.injector;P&&this.componentDef.getStandaloneInjector!==null&&(P=this.componentDef.getStandaloneInjector(P)||P);let U=P?new kx(a,P):a,$=U.get(Bh,null);if($===null)throw new rn(407,!1);let se=U.get(YN,null),Te=U.get(Nh,null),Pe={rendererFactory:$,sanitizer:se,inlineEffectRunner:null,changeDetectionScheduler:Te},Ye=$.createRenderer(null,this.componentDef),We=this.componentDef.selectors[0][0]||"div",pt=m?U3(Ye,m,this.componentDef.encapsulation,U):Ob(Ye,We,JN(We)),_t=512;this.componentDef.signals?_t|=4096:this.componentDef.onPush||(_t|=16);let on=null;pt!==null&&(on=Ab(pt,U,!0));let an=Bb(0,null,null,1,0,null,null,null,null,null,null),Ft=hy(null,an,null,_t,null,null,Pe,Ye,U,null,on);yb(Ft);let mr,Dn,St=null;try{let xn=this.componentDef,xr,Ct=null;xn.findHostDirectiveDefs?(xr=[],Ct=new Map,xn.findHostDirectiveDefs(xn,xr,Ct),xr.push(xn)):xr=[xn];let Rt=KN(Ft,pt);St=QN(Rt,pt,xn,xr,Ft,Pe,Ye),Dn=RD(an,$i),pt&&nz(Ye,xn,pt,m),c!==void 0&&rz(Dn,this.ngContentSelectors,c),mr=tz(St,xn,xr,Ct,Ft,[iz]),jb(an,Ft,null)}catch(xn){throw St!==null&&Ux(St),Ux(Ft),xn}finally{vb()}return new eb(this.componentType,mr,iy(Dn,Ft),Ft,Dn)}finally{or(n)}}},eb=class extends Jx{constructor(a,c,m,b,n){super(),this.location=m,this._rootLView=b,this._tNode=n,this.previousInputValues=null,this.instance=c,this.hostView=this.changeDetectorRef=new Gc(b,void 0,!1),this.componentType=a}setInput(a,c){let m=this._tNode.inputs,b;if(m!==null&&(b=m[a])){if(this.previousInputValues??=new Map,this.previousInputValues.has(a)&&Object.is(this.previousInputValues.get(a),c))return;let n=this._rootLView;Vb(n[Gn],n,b,a,c),this.previousInputValues.set(a,c);let P=qc(this._tNode.index,n);Ub(P,1)}}get injector(){return new zc(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(a){this.hostView.onDestroy(a)}};function KN(i,a){let c=i[Gn],m=$i;return i[m]=a,dy(c,m,2,"#host",null)}function QN(i,a,c,m,b,n,P){let U=b[Gn];ez(m,i,a,P);let $=null;a!==null&&($=Ab(a,b[Lh]));let se=n.rendererFactory.createRenderer(a,c),Te=16;c.signals?Te=4096:c.onPush&&(Te=64);let Pe=hy(b,qC(c),null,Te,b[i.index],i,n,se,null,null,$);return U.firstCreatePass&&Zx(U,i,m.length-1),fy(b,Pe),b[i.index]=Pe}function ez(i,a,c,m){for(let b of i)a.mergedAttrs=db(a.mergedAttrs,b.hostAttrs);a.mergedAttrs!==null&&(Qx(a,a.mergedAttrs,!0),c!==null&&zC(m,c,a))}function tz(i,a,c,m,b,n){let P=hs(),U=b[Gn],$=Po(P,b);XC(U,b,P,c,null,m);for(let Te=0;Te<c.length;Te++){let Pe=P.directiveStart+Te,Ye=fp(b,U,Pe,P);$c(Ye,b)}YC(U,b,P),$&&$c($,b);let se=fp(b,U,P.directiveStart+P.componentOffset,P);if(i[ua]=b[ua]=se,n!==null)for(let Te of n)Te(se,a);return $C(U,P,b),se}function nz(i,a,c,m){if(m)Dx(i,c,["ng-version","18.2.9"]);else{let{attrs:b,classes:n}=zk(a.selectors[0]);b&&Dx(i,c,b),n&&n.length>0&&NC(i,c,n.join(" "))}}function rz(i,a,c){let m=i.projection=[];for(let b=0;b<a.length;b++){let n=c[b];m.push(n!=null?Array.from(n):null)}}function iz(){let i=hs();wb(li()[Gn],i)}var Ep=(()=>{class i{static{this.__NG_ELEMENT_ID__=oz}}return i})();function oz(){let i=hs();return az(i,li())}var sz=Ep,hM=class extends sz{constructor(a,c,m){super(),this._lContainer=a,this._hostTNode=c,this._hostLView=m}get element(){return iy(this._hostTNode,this._hostLView)}get injector(){return new zc(this._hostTNode,this._hostLView)}get parentInjector(){let a=Eb(this._hostTNode,this._hostLView);if(YD(a)){let c=L_(a,this._hostLView),m=O_(a),b=c[Gn].data[m+8];return new zc(b,c)}else return new zc(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(a){let c=$S(this._lContainer);return c!==null&&c[a]||null}get length(){return this._lContainer.length-ao}createEmbeddedView(a,c,m){let b,n;typeof m=="number"?b=m:m!=null&&(b=m.index,n=m.injector);let P=jS(this._lContainer,a.ssrId),U=a.createEmbeddedViewImpl(c||{},n,P);return this.insertImpl(U,b,VS(this._hostTNode,P)),U}createComponent(a,c,m,b,n){let P=a&&!eF(a),U;if(P)U=c;else{let pt=c||{};U=pt.index,m=pt.injector,b=pt.projectableNodes,n=pt.environmentInjector||pt.ngModuleRef}let $=P?a:new pp(Vc(a)),se=m||this.parentInjector;if(!n&&$.ngModule==null){let _t=(P?se:this.parentInjector).get(Ao,null);_t&&(n=_t)}let Te=Vc($.componentType??{}),Pe=jS(this._lContainer,Te?.id??null),Ye=Pe?.firstChild??null,We=$.create(se,b,Ye,n);return this.insertImpl(We.hostView,U,VS(this._hostTNode,Pe)),We}insert(a,c){return this.insertImpl(a,c,!0)}insertImpl(a,c,m){let b=a._lView;if(aF(b)){let U=this.indexOf(a);if(U!==-1)this.detach(U);else{let $=b[_i],se=new hM($,$[us],$[_i]);se.detach(se.indexOf(a))}}let n=this._adjustIndex(c),P=this._lContainer;return gN(P,b,n,m),a.attachToViewContainerRef(),uD(Ex(P),n,a),a}move(a,c){return this.insert(a,c)}indexOf(a){let c=$S(this._lContainer);return c!==null?c.indexOf(a):-1}remove(a){let c=this._adjustIndex(a,-1),m=qx(this._lContainer,c);m&&(I_(Ex(this._lContainer),c),PC(m[Gn],m))}detach(a){let c=this._adjustIndex(a,-1),m=qx(this._lContainer,c);return m&&I_(Ex(this._lContainer),c)!=null?new Gc(m):null}_adjustIndex(a,c=0){return a??this.length+c}};function $S(i){return i[C_]}function Ex(i){return i[C_]||(i[C_]=[])}function az(i,a){let c,m=a[i.index];return ks(m)?c=m:(c=JC(m,a,null,i),a[i.index]=c,fy(a,c)),dM(c,a,i,m),new hM(c,i,a)}function lz(i,a){let c=i[Yr],m=c.createComment(""),b=Po(a,i),n=LC(c,b);return B_(c,n,m,P3(c,b),!1),m}var dM=fM,Gb=()=>!1;function cz(i,a,c){return Gb(i,a,c)}function fM(i,a,c,m){if(i[da])return;let b;c.type&8?b=cs(m):b=lz(a,c),i[da]=b}function uz(i,a,c){if(i[da]&&i[hp])return!0;let m=c[Os],b=a.index-$i;if(!m||JF(a)||wp(m,b))return!1;let P=Hx(m,b),U=m.data[Mb]?.[b],[$,se]=HN(P,U);return i[da]=$,i[hp]=se,!0}function hz(i,a,c,m){Gb(i,c,a)||fM(i,a,c,m)}function dz(){dM=hz,Gb=uz}var GS=new Set;function Uh(i){GS.has(i)||(GS.add(i),performance?.mark?.("mark_feature_usage",{detail:{feature:i}}))}var Dl=class{},mp=class{};var tb=class extends Dl{constructor(a,c,m,b=!0){super(),this.ngModuleType=a,this._parent=c,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new $_(this);let n=yD(a);this._bootstrapComponents=DC(n.bootstrap),this._r3Injector=sC(a,c,[{provide:Dl,useValue:this},{provide:zh,useValue:this.componentFactoryResolver},...m],so(a),new Set(["environment"])),b&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let a=this._r3Injector;!a.destroyed&&a.destroy(),this.destroyCbs.forEach(c=>c()),this.destroyCbs=null}onDestroy(a){this.destroyCbs.push(a)}},nb=class extends mp{constructor(a){super(),this.moduleType=a}create(a){return new tb(this.moduleType,a,[])}};var G_=class extends Dl{constructor(a){super(),this.componentFactoryResolver=new $_(this),this.instance=null;let c=new cp([...a.providers,{provide:Dl,useValue:this},{provide:zh,useValue:this.componentFactoryResolver}],a.parent||mb(),a.debugName,new Set(["environment"]));this.injector=c,a.runEnvironmentInitializers&&c.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(a){this.injector.onDestroy(a)}};function Hb(i,a,c=null){return new G_({providers:i,parent:a,debugName:c,runEnvironmentInitializers:!0}).injector}function pM(i){return pz(i)?Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i:!1}function fz(i,a){if(Array.isArray(i))for(let c=0;c<i.length;c++)a(i[c]);else{let c=i[Symbol.iterator](),m;for(;!(m=c.next()).done;)a(m.value)}}function pz(i){return i!==null&&(typeof i=="function"||typeof i=="object")}function mM(i,a,c){let m=i[a];return Object.is(m,c)?!1:(i[a]=c,!0)}function Tp(i){return(i.flags&32)===32}function mz(i,a,c,m,b,n,P,U,$){let se=a.consts,Te=dy(a,i,4,P||null,U||null);ZC(a,c,Te,P_(se,$)),wb(a,Te);let Pe=Te.tView=Bb(2,Te,m,b,n,a.directiveRegistry,a.pipeRegistry,null,a.schemas,se,null);return a.queries!==null&&(a.queries.template(a,Te),Pe.queries=a.queries.embeddedTView(Te)),Te}function gz(i,a,c,m,b,n,P,U,$,se){let Te=c+$i,Pe=a.firstCreatePass?mz(Te,a,i,m,b,n,P,U,$):a.data[Te];bp(Pe,!1);let Ye=gM(a,i,Pe,c);bb()&&kb(a,i,Ye,Pe),$c(Ye,i);let We=JC(Ye,i,Ye,Pe);return i[Te]=We,fy(i,We),cz(We,Pe,i),gb(Pe)&&GC(a,i,Pe),$!=null&&HC(i,Pe,se),Pe}function qb(i,a,c,m,b,n,P,U){let $=li(),se=Wc(),Te=P_(se.consts,n);return gz($,se,i,a,c,m,b,Te,P,U),qb}var gM=_M;function _M(i,a,c,m){return Cl(!0),a[Yr].createComment("")}function _z(i,a,c,m){let b=a[Os],n=!b||xp()||Tp(c)||wp(b,m);if(Cl(n),n)return _M(i,a,c,m);let P=b.data[o3]?.[m]??null;P!==null&&c.tView!==null&&c.tView.ssrId===null&&(c.tView.ssrId=P);let U=py(b,i,a,c);ly(b,m,U);let $=Rb(b,m);return my($,U)}function yz(){gM=_z}var op=function(i){return i[i.EarlyRead=0]="EarlyRead",i[i.Write=1]="Write",i[i.MixedReadWrite=2]="MixedReadWrite",i[i.Read=3]="Read",i}(op||{}),vz=(()=>{class i{constructor(){this.impl=null}execute(){this.impl?.execute()}static{this.\u0275prov=vn({token:i,providedIn:"root",factory:()=>new i})}}return i})(),HS=class i{constructor(){this.ngZone=Et(Nr),this.scheduler=Et(Nh),this.errorHandler=Et(pa,{optional:!0}),this.sequences=new Set,this.deferredRegistrations=new Set,this.executing=!1}static{this.PHASES=[op.EarlyRead,op.Write,op.MixedReadWrite,op.Read]}execute(){this.executing=!0;for(let a of i.PHASES)for(let c of this.sequences)if(!(c.erroredOrDestroyed||!c.hooks[a]))try{c.pipelinedValue=this.ngZone.runOutsideAngular(()=>c.hooks[a](c.pipelinedValue))}catch(m){c.erroredOrDestroyed=!0,this.errorHandler?.handleError(m)}this.executing=!1;for(let a of this.sequences)a.afterRun(),a.once&&(this.sequences.delete(a),a.destroy());for(let a of this.deferredRegistrations)this.sequences.add(a);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear()}register(a){this.executing?this.deferredRegistrations.add(a):(this.sequences.add(a),this.scheduler.notify(6))}unregister(a){this.executing&&this.sequences.has(a)?(a.erroredOrDestroyed=!0,a.pipelinedValue=void 0,a.once=!0):(this.sequences.delete(a),this.deferredRegistrations.delete(a))}static{this.\u0275prov=vn({token:i,providedIn:"root",factory:()=>new i})}};function xz(i,a,c,m){return mM(i,VD(),c)?a+oD(c)+m:uy}function _y(i,a,c){let m=li(),b=VD();if(mM(m,b,a)){let n=Wc(),P=wF();X3(n,P,m,i,a,m[Yr],c,!1)}return _y}function qS(i,a,c,m,b){let n=a.inputs,P=b?"class":"style";Vb(i,c,n[P],P,m)}function bz(i,a,c,m,b,n){let P=a.consts,U=P_(P,b),$=dy(a,i,2,m,U);return ZC(a,c,$,P_(P,n)),$.attrs!==null&&Qx($,$.attrs,!1),$.mergedAttrs!==null&&Qx($,$.mergedAttrs,!0),a.queries!==null&&a.queries.elementStart(a,$),$}function Yc(i,a,c,m){let b=li(),n=Wc(),P=$i+i,U=b[Yr],$=n.firstCreatePass?bz(P,n,b,a,c,m):n.data[P],se=yM(n,b,$,U,a,i);b[P]=se;let Te=gb($);return bp($,!0),zC(U,se,$),!Tp($)&&bb()&&kb(n,b,se,$),cF()===0&&$c(se,b),uF(),Te&&(GC(n,b,$),$C(n,$,b)),m!==null&&HC(b,$),Yc}function Al(){let i=hs();zD()?gF():(i=i.parent,bp(i,!1));let a=i;dF(a)&&pF(),hF();let c=Wc();return c.firstCreatePass&&(wb(c,i),SD(i)&&c.queries.elementEnd(i)),a.classesWithoutHost!=null&&SF(a)&&qS(c,a,li(),a.classesWithoutHost,!0),a.stylesWithoutHost!=null&&DF(a)&&qS(c,a,li(),a.stylesWithoutHost,!1),Al}function Rl(i,a,c,m){return Yc(i,a,c,m),Al(),Rl}var yM=(i,a,c,m,b,n)=>(Cl(!0),Ob(m,b,WD()));function wz(i,a,c,m,b,n){let P=a[Os],U=!P||xp()||Tp(c)||wp(P,n);if(Cl(U),U)return Ob(m,b,WD());let $=py(P,i,a,c);return TC(P,n)&&ly(P,n,$.nextSibling),P&&(hC(c)||dC($))&&yp(c)&&(fF(c),FC($)),$}function Ez(){yM=wz}var Tz=(i,a,c,m)=>(Cl(!0),MC(a[Yr],""));function Iz(i,a,c,m){let b,n=a[Os],P=!n||xp()||wp(n,m)||Tp(c);if(Cl(P),P)return MC(a[Yr],"");let U=py(n,i,a,c),$=m3(n,m);return ly(n,m,U),b=my($,U),b}function Sz(){Tz=Iz}var H_="en-US";var Dz=H_;function Cz(i){typeof i=="string"&&(Dz=i.toLowerCase().replace(/_/g,"-"))}var Mz=(i,a,c)=>{};function Ip(i,a,c,m){let b=li(),n=Wc(),P=hs();return Rz(n,b,b[Yr],P,i,a,m),Ip}function Az(i,a,c,m){let b=i.cleanup;if(b!=null)for(let n=0;n<b.length-1;n+=2){let P=b[n];if(P===c&&b[n+1]===m){let U=a[D_],$=b[n+2];return U.length>$?U[$]:null}typeof P=="string"&&(n+=2)}return null}function Rz(i,a,c,m,b,n,P){let U=gb(m),se=i.firstCreatePass&&uN(i),Te=a[ua],Pe=cN(a),Ye=!0;if(m.type&3||P){let _t=Po(m,a),on=P?P(_t):_t,an=Pe.length,Ft=P?Dn=>P(cs(Dn[m.index])):m.index,mr=null;if(!P&&U&&(mr=Az(i,a,b,m.index)),mr!==null){let Dn=mr.__ngLastListenerFn__||mr;Dn.__ngNextListenerFn__=n,mr.__ngLastListenerFn__=n,Ye=!1}else{n=ZS(m,a,Te,n),Mz(_t,b,n);let Dn=c.listen(on,b,n);Pe.push(n,Dn),se&&se.push(b,Ft,an,an+1)}}else n=ZS(m,a,Te,n);let We=m.outputs,pt;if(Ye&&We!==null&&(pt=We[b])){let _t=pt.length;if(_t)for(let on=0;on<_t;on+=2){let an=pt[on],Ft=pt[on+1],St=a[an][Ft].subscribe(n),xn=Pe.length;Pe.push(n,St),se&&se.push(b,m.index,xn,-(xn+1))}}}function WS(i,a,c,m){let b=or(null);try{return Ms(6,a,c),c(m)!==!1}catch(n){return QC(i,n),!1}finally{Ms(7,a,c),or(b)}}function ZS(i,a,c,m){return function b(n){if(n===Function)return m;let P=i.componentOffset>-1?qc(i.index,a):a;Ub(P,5);let U=WS(a,c,m,n),$=b.__ngNextListenerFn__;for(;$;)U=WS(a,c,$,n)&&U,$=$.__ngNextListenerFn__;return U}}function yy(i,a=""){let c=li(),m=Wc(),b=i+$i,n=m.firstCreatePass?dy(m,b,1,a,null):m.data[b],P=vM(m,c,n,a,i);c[b]=P,bb()&&kb(m,c,P,n),bp(n,!1)}var vM=(i,a,c,m,b)=>(Cl(!0),CC(a[Yr],m));function Pz(i,a,c,m,b){let n=a[Os],P=!n||xp()||Tp(c)||wp(n,b);return Cl(P),P?CC(a[Yr],m):py(n,i,a,c)}function Oz(){vM=Pz}function Wb(i,a,c){let m=li(),b=xz(m,i,a,c);return b!==uy&&hN(m,xb(),b),Wb}var Lz=(()=>{class i{constructor(c){this._injector=c,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(c){if(!c.standalone)return null;if(!this.cachedInjectors.has(c)){let m=bD(!1,c.type),b=m.length>0?Hb([m],this._injector,`Standalone[${c.type.name}]`):null;this.cachedInjectors.set(c,b)}return this.cachedInjectors.get(c)}ngOnDestroy(){try{for(let c of this.cachedInjectors.values())c!==null&&c.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=vn({token:i,providedIn:"environment",factory:()=>new i(Jn(Ao))})}}return i})();function $h(i){Uh("NgStandalone"),i.getStandaloneInjector=a=>a.get(Lz).getOrCreateStandaloneInjector(i)}var vy=(()=>{class i{log(c){console.log(c)}warn(c){console.warn(c)}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"platform"})}}return i})();var xM=new yn("");function Sp(i){return!!i&&typeof i.then=="function"}function bM(i){return!!i&&typeof i.subscribe=="function"}var wM=new yn(""),EM=(()=>{class i{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((c,m)=>{this.resolve=c,this.reject=m}),this.appInits=Et(wM,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let c=[];for(let b of this.appInits){let n=b();if(Sp(n))c.push(n);else if(bM(n)){let P=new Promise((U,$)=>{n.subscribe({complete:U,error:$})});c.push(P)}}let m=()=>{this.done=!0,this.resolve()};Promise.all(c).then(()=>{m()}).catch(b=>{this.reject(b)}),c.length===0&&m(),this.initialized=!0}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Gh=new yn("");function kz(){BI(()=>{throw new rn(600,!1)})}function Fz(i){return i.isBoundToModule}var Nz=10;function zz(i,a,c){try{let m=c();return Sp(m)?m.catch(b=>{throw a.runOutsideAngular(()=>i.handleError(b)),b}):m}catch(m){throw a.runOutsideAngular(()=>i.handleError(m)),m}}var Fs=(()=>{class i{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Et(WF),this.afterRenderManager=Et(vz),this.zonelessEnabled=Et(gy),this.dirtyFlags=0,this.deferredDirtyFlags=0,this.externalTestViews=new Set,this.beforeRender=new Ri,this.afterTick=new Ri,this.componentTypes=[],this.components=[],this.isStable=Et(Zc).hasPendingTasks.pipe(Wn(c=>!c)),this._injector=Et(Ao)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}whenStable(){let c;return new Promise(m=>{c=this.isStable.subscribe({next:b=>{b&&m()}})}).finally(()=>{c.unsubscribe()})}get injector(){return this._injector}bootstrap(c,m){let b=c instanceof U_;if(!this._injector.get(EM).done){let Ye=!b&&_D(c),We=!1;throw new rn(405,We)}let P;b?P=c:P=this._injector.get(zh).resolveComponentFactory(c),this.componentTypes.push(P.componentType);let U=Fz(P)?void 0:this._injector.get(Dl),$=m||P.selector,se=P.create(fa.NULL,[],$,U),Te=se.location.nativeElement,Pe=se.injector.get(xM,null);return Pe?.registerApplication(Te),se.onDestroy(()=>{this.detachView(se.hostView),b_(this.components,se),Pe?.unregisterApplication(Te)}),this._loadComponent(se),se}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){if(this._runningTick)throw new rn(101,!1);let c=or(null);try{this._runningTick=!0,this.synchronize()}catch(m){this.internalErrorHandler(m)}finally{this._runningTick=!1,or(c),this.afterTick.next()}}synchronize(){let c=null;this._injector.destroyed||(c=this._injector.get(Bh,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let m=0;for(;this.dirtyFlags!==0&&m++<Nz;)this.synchronizeOnce(c)}synchronizeOnce(c){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&7){let m=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8,this.beforeRender.next(m);for(let{_lView:b,notifyErrorHandler:n}of this._views)Bz(b,n,m,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&7)return}else c?.begin?.(),c?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:c})=>ny(c))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(c){let m=c;this._views.push(m),m.attachToAppRef(this)}detachView(c){let m=c;b_(this._views,m),m.detachFromAppRef()}_loadComponent(c){this.attachView(c.hostView),this.tick(),this.components.push(c);let m=this._injector.get(Gh,[]);[...this._bootstrapListeners,...m].forEach(b=>b(c))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(c=>c()),this._views.slice().forEach(c=>c.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(c){return this._destroyListeners.push(c),()=>b_(this._destroyListeners,c)}destroy(){if(this._destroyed)throw new rn(406,!1);let c=this._injector;c.destroy&&!c.destroyed&&c.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function b_(i,a){let c=i.indexOf(a);c>-1&&i.splice(c,1)}var g_;function xy(i){g_??=new WeakMap;let a=g_.get(i);if(a)return a;let c=i.isStable.pipe(os(m=>m)).toPromise().then(()=>{});return g_.set(i,c),i.onDestroy(()=>g_?.delete(i)),c}function Bz(i,a,c,m){if(!c&&!ny(i))return;nM(i,a,c&&!m?0:1)}var rb=class{constructor(a,c){this.ngModuleFactory=a,this.componentFactories=c}},Zb=(()=>{class i{compileModuleSync(c){return new nb(c)}compileModuleAsync(c){return Promise.resolve(this.compileModuleSync(c))}compileModuleAndAllComponentsSync(c){let m=this.compileModuleSync(c),b=yD(c),n=DC(b.declarations).reduce((P,U)=>{let $=Vc(U);return $&&P.push(new pp($)),P},[]);return new rb(m,n)}compileModuleAndAllComponentsAsync(c){return Promise.resolve(this.compileModuleAndAllComponentsSync(c))}clearCache(){}clearCacheFor(c){}getModuleId(c){}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Vz=(()=>{class i{constructor(){this.zone=Et(Nr),this.changeDetectionScheduler=Et(Nh),this.applicationRef=Et(Fs)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),jz=new yn("",{factory:()=>!1});function TM({ngZoneFactory:i,ignoreChangesOutsideZone:a,scheduleInRootZone:c}){return i??=()=>new Nr(Sr(kt({},SM()),{scheduleInRootZone:c})),[{provide:Nr,useFactory:i},{provide:Bc,multi:!0,useFactory:()=>{let m=Et(Vz,{optional:!0});return()=>m.initialize()}},{provide:Bc,multi:!0,useFactory:()=>{let m=Et(Uz);return()=>{m.initialize()}}},a===!0?{provide:cM,useValue:!0}:[],{provide:uM,useValue:c??aC}]}function IM(i){let a=i?.ignoreChangesOutsideZone,c=i?.scheduleInRootZone,m=TM({ngZoneFactory:()=>{let b=SM(i);return b.scheduleInRootZone=c,b.shouldCoalesceEventChangeDetection&&Uh("NgZone_CoalesceEvent"),new Nr(b)},ignoreChangesOutsideZone:a,scheduleInRootZone:c});return Hc([{provide:jz,useValue:!0},{provide:gy,useValue:!1},m])}function SM(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:i?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:i?.runCoalescing??!1}}var Uz=(()=>{class i{constructor(){this.subscription=new jr,this.initialized=!1,this.zone=Et(Nr),this.pendingTasks=Et(Zc)}initialize(){if(this.initialized)return;this.initialized=!0;let c=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(c=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Nr.assertNotInAngularZone(),queueMicrotask(()=>{c!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(c),c=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Nr.assertInAngularZone(),c??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var $z=(()=>{class i{constructor(){this.appRef=Et(Fs),this.taskService=Et(Zc),this.ngZone=Et(Nr),this.zonelessEnabled=Et(gy),this.disableScheduling=Et(cM,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new jr,this.angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(F_):null,this.scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Et(uM,{optional:!0})??!1),this.cancelScheduledCallback=null,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof jx||!this.zoneIsDefined)}notify(c){if(!this.zonelessEnabled&&c===5)return;switch(c){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 7:{this.appRef.deferredDirtyFlags|=8;break}case 9:case 8:case 6:case 10:default:this.appRef.dirtyFlags|=8}if(!this.shouldScheduleTick())return;let m=this.useMicrotaskScheduler?PS:cC;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>m(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>m(()=>this.tick()))}shouldScheduleTick(){return!(this.disableScheduling||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(F_+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let c=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(m){throw this.taskService.remove(c),m}finally{this.cleanup()}this.useMicrotaskScheduler=!0,PS(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(c)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let c=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(c)}}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function Gz(){return typeof $localize<"u"&&$localize.locale||H_}var Xb=new yn("",{providedIn:"root",factory:()=>Et(Xb,Nn.Optional|Nn.SkipSelf)||Gz()});var ib=new yn("");function __(i){return!i.moduleRef}function Hz(i){let a=__(i)?i.r3Injector:i.moduleRef.injector,c=a.get(Nr);return c.run(()=>{__(i)?i.r3Injector.resolveInjectorInitializers():i.moduleRef.resolveInjectorInitializers();let m=a.get(pa,null),b;if(c.runOutsideAngular(()=>{b=c.onError.subscribe({next:n=>{m.handleError(n)}})}),__(i)){let n=()=>a.destroy(),P=i.platformInjector.get(ib);P.add(n),a.onDestroy(()=>{b.unsubscribe(),P.delete(n)})}else{let n=()=>i.moduleRef.destroy(),P=i.platformInjector.get(ib);P.add(n),i.moduleRef.onDestroy(()=>{b_(i.allPlatformModules,i.moduleRef),b.unsubscribe(),P.delete(n)})}return zz(m,c,()=>{let n=a.get(EM);return n.runInitializers(),n.donePromise.then(()=>{let P=a.get(Xb,H_);if(Cz(P||H_),__(i)){let U=a.get(Fs);return i.rootComponent!==void 0&&U.bootstrap(i.rootComponent),U}else return qz(i.moduleRef,i.allPlatformModules),i.moduleRef})})})}function qz(i,a){let c=i.injector.get(Fs);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(m=>c.bootstrap(m));else if(i.instance.ngDoBootstrap)i.instance.ngDoBootstrap(c);else throw new rn(-403,!1);a.push(i)}var w_=null;function Wz(i=[],a){return fa.create({name:a,providers:[{provide:Q_,useValue:"platform"},{provide:ib,useValue:new Set([()=>w_=null])},...i]})}function Zz(i=[]){if(w_)return w_;let a=Wz(i);return w_=a,kz(),Xz(a),a}function Xz(i){i.get(Db,null)?.forEach(c=>c())}var Dp=(()=>{class i{static{this.__NG_ELEMENT_ID__=Yz}}return i})();function Yz(i){return Jz(hs(),li(),(i&16)===16)}function Jz(i,a,c){if(yp(i)&&!c){let m=qc(i.index,a);return new Gc(m,m)}else if(i.type&175){let m=a[Ro];return new Gc(m,a)}return null}var ob=class{constructor(){}supports(a){return pM(a)}create(a){return new sb(a)}},Kz=(i,a)=>a,sb=class{constructor(a){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=a||Kz}forEachItem(a){let c;for(c=this._itHead;c!==null;c=c._next)a(c)}forEachOperation(a){let c=this._itHead,m=this._removalsHead,b=0,n=null;for(;c||m;){let P=!m||c&&c.currentIndex<XS(m,b,n)?c:m,U=XS(P,b,n),$=P.currentIndex;if(P===m)b--,m=m._nextRemoved;else if(c=c._next,P.previousIndex==null)b++;else{n||(n=[]);let se=U-b,Te=$-b;if(se!=Te){for(let Ye=0;Ye<se;Ye++){let We=Ye<n.length?n[Ye]:n[Ye]=0,pt=We+Ye;Te<=pt&&pt<se&&(n[Ye]=We+1)}let Pe=P.previousIndex;n[Pe]=Te-se}}U!==$&&a(P,U,$)}}forEachPreviousItem(a){let c;for(c=this._previousItHead;c!==null;c=c._nextPrevious)a(c)}forEachAddedItem(a){let c;for(c=this._additionsHead;c!==null;c=c._nextAdded)a(c)}forEachMovedItem(a){let c;for(c=this._movesHead;c!==null;c=c._nextMoved)a(c)}forEachRemovedItem(a){let c;for(c=this._removalsHead;c!==null;c=c._nextRemoved)a(c)}forEachIdentityChange(a){let c;for(c=this._identityChangesHead;c!==null;c=c._nextIdentityChange)a(c)}diff(a){if(a==null&&(a=[]),!pM(a))throw new rn(900,!1);return this.check(a)?this:null}onDestroy(){}check(a){this._reset();let c=this._itHead,m=!1,b,n,P;if(Array.isArray(a)){this.length=a.length;for(let U=0;U<this.length;U++)n=a[U],P=this._trackByFn(U,n),c===null||!Object.is(c.trackById,P)?(c=this._mismatch(c,n,P,U),m=!0):(m&&(c=this._verifyReinsertion(c,n,P,U)),Object.is(c.item,n)||this._addIdentityChange(c,n)),c=c._next}else b=0,fz(a,U=>{P=this._trackByFn(b,U),c===null||!Object.is(c.trackById,P)?(c=this._mismatch(c,U,P,b),m=!0):(m&&(c=this._verifyReinsertion(c,U,P,b)),Object.is(c.item,U)||this._addIdentityChange(c,U)),c=c._next,b++}),this.length=b;return this._truncate(c),this.collection=a,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let a;for(a=this._previousItHead=this._itHead;a!==null;a=a._next)a._nextPrevious=a._next;for(a=this._additionsHead;a!==null;a=a._nextAdded)a.previousIndex=a.currentIndex;for(this._additionsHead=this._additionsTail=null,a=this._movesHead;a!==null;a=a._nextMoved)a.previousIndex=a.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(a,c,m,b){let n;return a===null?n=this._itTail:(n=a._prev,this._remove(a)),a=this._unlinkedRecords===null?null:this._unlinkedRecords.get(m,null),a!==null?(Object.is(a.item,c)||this._addIdentityChange(a,c),this._reinsertAfter(a,n,b)):(a=this._linkedRecords===null?null:this._linkedRecords.get(m,b),a!==null?(Object.is(a.item,c)||this._addIdentityChange(a,c),this._moveAfter(a,n,b)):a=this._addAfter(new ab(c,m),n,b)),a}_verifyReinsertion(a,c,m,b){let n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(m,null);return n!==null?a=this._reinsertAfter(n,a._prev,b):a.currentIndex!=b&&(a.currentIndex=b,this._addToMoves(a,b)),a}_truncate(a){for(;a!==null;){let c=a._next;this._addToRemovals(this._unlink(a)),a=c}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(a,c,m){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(a);let b=a._prevRemoved,n=a._nextRemoved;return b===null?this._removalsHead=n:b._nextRemoved=n,n===null?this._removalsTail=b:n._prevRemoved=b,this._insertAfter(a,c,m),this._addToMoves(a,m),a}_moveAfter(a,c,m){return this._unlink(a),this._insertAfter(a,c,m),this._addToMoves(a,m),a}_addAfter(a,c,m){return this._insertAfter(a,c,m),this._additionsTail===null?this._additionsTail=this._additionsHead=a:this._additionsTail=this._additionsTail._nextAdded=a,a}_insertAfter(a,c,m){let b=c===null?this._itHead:c._next;return a._next=b,a._prev=c,b===null?this._itTail=a:b._prev=a,c===null?this._itHead=a:c._next=a,this._linkedRecords===null&&(this._linkedRecords=new q_),this._linkedRecords.put(a),a.currentIndex=m,a}_remove(a){return this._addToRemovals(this._unlink(a))}_unlink(a){this._linkedRecords!==null&&this._linkedRecords.remove(a);let c=a._prev,m=a._next;return c===null?this._itHead=m:c._next=m,m===null?this._itTail=c:m._prev=c,a}_addToMoves(a,c){return a.previousIndex===c||(this._movesTail===null?this._movesTail=this._movesHead=a:this._movesTail=this._movesTail._nextMoved=a),a}_addToRemovals(a){return this._unlinkedRecords===null&&(this._unlinkedRecords=new q_),this._unlinkedRecords.put(a),a.currentIndex=null,a._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=a,a._prevRemoved=null):(a._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=a),a}_addIdentityChange(a,c){return a.item=c,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=a:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=a,a}},ab=class{constructor(a,c){this.item=a,this.trackById=c,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},lb=class{constructor(){this._head=null,this._tail=null}add(a){this._head===null?(this._head=this._tail=a,a._nextDup=null,a._prevDup=null):(this._tail._nextDup=a,a._prevDup=this._tail,a._nextDup=null,this._tail=a)}get(a,c){let m;for(m=this._head;m!==null;m=m._nextDup)if((c===null||c<=m.currentIndex)&&Object.is(m.trackById,a))return m;return null}remove(a){let c=a._prevDup,m=a._nextDup;return c===null?this._head=m:c._nextDup=m,m===null?this._tail=c:m._prevDup=c,this._head===null}},q_=class{constructor(){this.map=new Map}put(a){let c=a.trackById,m=this.map.get(c);m||(m=new lb,this.map.set(c,m)),m.add(a)}get(a,c){let m=a,b=this.map.get(m);return b?b.get(a,c):null}remove(a){let c=a.trackById;return this.map.get(c).remove(a)&&this.map.delete(c),a}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function XS(i,a,c){let m=i.previousIndex;if(m===null)return m;let b=0;return c&&m<c.length&&(b=c[m]),m+a+b}function YS(){return new Yb([new ob])}var Yb=(()=>{class i{static{this.\u0275prov=vn({token:i,providedIn:"root",factory:YS})}constructor(c){this.factories=c}static create(c,m){if(m!=null){let b=m.factories.slice();c=c.concat(b)}return new i(c)}static extend(c){return{provide:i,useFactory:m=>i.create(c,m||YS()),deps:[[i,new cD,new ub]]}}find(c){let m=this.factories.find(b=>b.supports(c));if(m!=null)return m;throw new rn(901,!1)}}return i})();function DM(i){try{let{rootComponent:a,appProviders:c,platformProviders:m}=i,b=Zz(m),n=[TM({}),{provide:Nh,useExisting:$z},...c||[]],P=new G_({providers:n,parent:b,debugName:"",runEnvironmentInitializers:!1});return Hz({r3Injector:P.injector,platformInjector:b,rootComponent:a})}catch(a){return Promise.reject(a)}}var JS=!1;function Qz(){JS||(JS=!0,h3(),Ez(),Oz(),Sz(),yz(),dz(),WN(),H3())}function eB(i,a){return xy(i)}function CM(){return Hc([{provide:p_,useFactory:()=>{let i=!0;return m_()&&(i=!!Et(jh,{optional:!0})?.get(wC,null)),i&&Uh("NgHydration"),i}},{provide:Bc,useValue:()=>{VN(!1),m_()&&Et(p_)&&(tB(),Qz())},multi:!0},{provide:SC,useFactory:()=>m_()&&Et(p_)},{provide:Gh,useFactory:()=>{if(m_()&&Et(p_)){let i=Et(Fs),a=Et(fa);return()=>{eB(i,a).then(()=>{GN(i)})}}return()=>{}},multi:!0}])}function tB(){let i=sy(),a;for(let c of i.body.childNodes)if(c.nodeType===Node.COMMENT_NODE&&c.textContent?.trim()===c3){a=c;break}if(!a)throw new rn(-507,!1)}var LM=null;function Hh(){return LM}function kM(i){LM??=i}var by=class{};var co=new yn(""),FM=(()=>{class i{historyGo(c){throw new Error("")}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:()=>Et(aB),providedIn:"platform"})}}return i})();var aB=(()=>{class i extends FM{constructor(){super(),this._doc=Et(co),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Hh().getBaseHref(this._doc)}onPopState(c){let m=Hh().getGlobalEventTarget(this._doc,"window");return m.addEventListener("popstate",c,!1),()=>m.removeEventListener("popstate",c)}onHashChange(c){let m=Hh().getGlobalEventTarget(this._doc,"window");return m.addEventListener("hashchange",c,!1),()=>m.removeEventListener("hashchange",c)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(c){this._location.pathname=c}pushState(c,m,b){this._history.pushState(c,m,b)}replaceState(c,m,b){this._history.replaceState(c,m,b)}forward(){this._history.forward()}back(){this._history.back()}historyGo(c=0){this._history.go(c)}getState(){return this._history.state}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:()=>new i,providedIn:"platform"})}}return i})();function NM(i,a){if(i.length==0)return a;if(a.length==0)return i;let c=0;return i.endsWith("/")&&c++,a.startsWith("/")&&c++,c==2?i+a.substring(1):c==1?i+a:i+"/"+a}function MM(i){let a=i.match(/#|\?|$/),c=a&&a.index||i.length,m=c-(i[c-1]==="/"?1:0);return i.slice(0,m)+i.slice(c)}function Jc(i){return i&&i[0]!=="?"?"?"+i:i}var Ey=(()=>{class i{historyGo(c){throw new Error("")}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:()=>Et(zM),providedIn:"root"})}}return i})(),lB=new yn(""),zM=(()=>{class i extends Ey{constructor(c,m){super(),this._platformLocation=c,this._removeListenerFns=[],this._baseHref=m??this._platformLocation.getBaseHrefFromDOM()??Et(co).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(c){this._removeListenerFns.push(this._platformLocation.onPopState(c),this._platformLocation.onHashChange(c))}getBaseHref(){return this._baseHref}prepareExternalUrl(c){return NM(this._baseHref,c)}path(c=!1){let m=this._platformLocation.pathname+Jc(this._platformLocation.search),b=this._platformLocation.hash;return b&&c?`${m}${b}`:m}pushState(c,m,b,n){let P=this.prepareExternalUrl(b+Jc(n));this._platformLocation.pushState(c,m,P)}replaceState(c,m,b,n){let P=this.prepareExternalUrl(b+Jc(n));this._platformLocation.replaceState(c,m,P)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(c=0){this._platformLocation.historyGo?.(c)}static{this.\u0275fac=function(m){return new(m||i)(Jn(FM),Jn(lB,8))}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Mp=(()=>{class i{constructor(c){this._subject=new Pi,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=c;let m=this._locationStrategy.getBaseHref();this._basePath=hB(MM(AM(m))),this._locationStrategy.onPopState(b=>{this._subject.emit({url:this.path(!0),pop:!0,state:b.state,type:b.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(c=!1){return this.normalize(this._locationStrategy.path(c))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(c,m=""){return this.path()==this.normalize(c+Jc(m))}normalize(c){return i.stripTrailingSlash(uB(this._basePath,AM(c)))}prepareExternalUrl(c){return c&&c[0]!=="/"&&(c="/"+c),this._locationStrategy.prepareExternalUrl(c)}go(c,m="",b=null){this._locationStrategy.pushState(b,"",c,m),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+Jc(m)),b)}replaceState(c,m="",b=null){this._locationStrategy.replaceState(b,"",c,m),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+Jc(m)),b)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(c=0){this._locationStrategy.historyGo?.(c)}onUrlChange(c){return this._urlChangeListeners.push(c),this._urlChangeSubscription??=this.subscribe(m=>{this._notifyUrlChangeListeners(m.url,m.state)}),()=>{let m=this._urlChangeListeners.indexOf(c);this._urlChangeListeners.splice(m,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(c="",m){this._urlChangeListeners.forEach(b=>b(c,m))}subscribe(c,m,b){return this._subject.subscribe({next:c,error:m,complete:b})}static{this.normalizeQueryParams=Jc}static{this.joinWithSlash=NM}static{this.stripTrailingSlash=MM}static{this.\u0275fac=function(m){return new(m||i)(Jn(Ey))}}static{this.\u0275prov=vn({token:i,factory:()=>cB(),providedIn:"root"})}}return i})();function cB(){return new Mp(Jn(Ey))}function uB(i,a){if(!i||!a.startsWith(i))return a;let c=a.substring(i.length);return c===""||["/",";","?","#"].includes(c[0])?c:a}function AM(i){return i.replace(/\/index.html$/,"")}function hB(i){if(new RegExp("^(https?:)?//").test(i)){let[,c]=i.split(/\/\/[^\/]+/);return c}return i}function Kb(i,a){a=encodeURIComponent(a);for(let c of i.split(";")){let m=c.indexOf("="),[b,n]=m==-1?[c,""]:[c.slice(0,m),c.slice(m+1)];if(b.trim()===a)return decodeURIComponent(n)}return null}var Jb=class{constructor(a,c,m,b){this.$implicit=a,this.ngForOf=c,this.index=m,this.count=b}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},BM=(()=>{class i{set ngForOf(c){this._ngForOf=c,this._ngForOfDirty=!0}set ngForTrackBy(c){this._trackByFn=c}get ngForTrackBy(){return this._trackByFn}constructor(c,m,b){this._viewContainer=c,this._template=m,this._differs=b,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(c){c&&(this._template=c)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let c=this._ngForOf;if(!this._differ&&c)if(0)try{}catch{}else this._differ=this._differs.find(c).create(this.ngForTrackBy)}if(this._differ){let c=this._differ.diff(this._ngForOf);c&&this._applyChanges(c)}}_applyChanges(c){let m=this._viewContainer;c.forEachOperation((b,n,P)=>{if(b.previousIndex==null)m.createEmbeddedView(this._template,new Jb(b.item,this._ngForOf,-1,-1),P===null?void 0:P);else if(P==null)m.remove(n===null?void 0:n);else if(n!==null){let U=m.get(n);m.move(U,P),RM(U,b)}});for(let b=0,n=m.length;b<n;b++){let U=m.get(b).context;U.index=b,U.count=n,U.ngForOf=this._ngForOf}c.forEachIdentityChange(b=>{let n=m.get(b.currentIndex);RM(n,b)})}static ngTemplateContextGuard(c,m){return!0}static{this.\u0275fac=function(m){return new(m||i)(Ml(Ep),Ml($b),Ml(Yb))}}static{this.\u0275dir=K_({type:i,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return i})();function RM(i,a){i.context.$implicit=a.item}var Qb=(()=>{class i{static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275mod=J_({type:i})}static{this.\u0275inj=Z_({})}}return i})(),e1="browser",dB="server";function VM(i){return i===e1}function Ap(i){return i===dB}var wy=class{};var Iy=class i{constructor(a){this.normalizedNames=new Map,this.lazyUpdate=null,a?typeof a=="string"?this.lazyInit=()=>{this.headers=new Map,a.split(`
`).forEach(c=>{let m=c.indexOf(":");if(m>0){let b=c.slice(0,m),n=b.toLowerCase(),P=c.slice(m+1).trim();this.maybeSetNormalizedName(b,n),this.headers.has(n)?this.headers.get(n).push(P):this.headers.set(n,[P])}})}:typeof Headers<"u"&&a instanceof Headers?(this.headers=new Map,a.forEach((c,m)=>{this.setHeaderEntries(m,c)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(a).forEach(([c,m])=>{this.setHeaderEntries(c,m)})}:this.headers=new Map}has(a){return this.init(),this.headers.has(a.toLowerCase())}get(a){this.init();let c=this.headers.get(a.toLowerCase());return c&&c.length>0?c[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(a){return this.init(),this.headers.get(a.toLowerCase())||null}append(a,c){return this.clone({name:a,value:c,op:"a"})}set(a,c){return this.clone({name:a,value:c,op:"s"})}delete(a,c){return this.clone({name:a,value:c,op:"d"})}maybeSetNormalizedName(a,c){this.normalizedNames.has(c)||this.normalizedNames.set(c,a)}init(){this.lazyInit&&(this.lazyInit instanceof i?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(a=>this.applyUpdate(a)),this.lazyUpdate=null))}copyFrom(a){a.init(),Array.from(a.headers.keys()).forEach(c=>{this.headers.set(c,a.headers.get(c)),this.normalizedNames.set(c,a.normalizedNames.get(c))})}clone(a){let c=new i;return c.lazyInit=this.lazyInit&&this.lazyInit instanceof i?this.lazyInit:this,c.lazyUpdate=(this.lazyUpdate||[]).concat([a]),c}applyUpdate(a){let c=a.name.toLowerCase();switch(a.op){case"a":case"s":let m=a.value;if(typeof m=="string"&&(m=[m]),m.length===0)return;this.maybeSetNormalizedName(a.name,c);let b=(a.op==="a"?this.headers.get(c):void 0)||[];b.push(...m),this.headers.set(c,b);break;case"d":let n=a.value;if(!n)this.headers.delete(c),this.normalizedNames.delete(c);else{let P=this.headers.get(c);if(!P)return;P=P.filter(U=>n.indexOf(U)===-1),P.length===0?(this.headers.delete(c),this.normalizedNames.delete(c)):this.headers.set(c,P)}break}}setHeaderEntries(a,c){let m=(Array.isArray(c)?c:[c]).map(n=>n.toString()),b=a.toLowerCase();this.headers.set(b,m),this.maybeSetNormalizedName(a,b)}forEach(a){this.init(),Array.from(this.normalizedNames.keys()).forEach(c=>a(this.normalizedNames.get(c),this.headers.get(c)))}};var ZM=function(i){return i[i.Sent=0]="Sent",i[i.UploadProgress=1]="UploadProgress",i[i.ResponseHeader=2]="ResponseHeader",i[i.DownloadProgress=3]="DownloadProgress",i[i.Response=4]="Response",i[i.User=5]="User",i}(ZM||{}),t1=class{constructor(a,c=200,m="OK"){this.headers=a.headers||new Iy,this.status=a.status!==void 0?a.status:c,this.statusText=a.statusText||m,this.url=a.url||null,this.ok=this.status>=200&&this.status<300}};var Sy=class i extends t1{constructor(a={}){super(a),this.type=ZM.Response,this.body=a.body!==void 0?a.body:null}clone(a={}){return new i({body:a.body!==void 0?a.body:this.body,headers:a.headers||this.headers,status:a.status!==void 0?a.status:this.status,statusText:a.statusText||this.statusText,url:a.url||this.url||void 0})}};var pB=new yn("");var mB=new yn(""),jM="b",UM="h",$M="s",GM="st",HM="u",qM="rt",Ty=new yn(""),gB=["GET","HEAD"];function _B(i,a){let We=Et(Ty),{isCacheActive:c}=We,m=tp(We,["isCacheActive"]),{transferCache:b,method:n}=i;if(!c||b===!1||n==="POST"&&!m.includePostRequests&&!b||n!=="POST"&&!gB.includes(n)||!m.includeRequestsWithAuthHeaders&&yB(i)||m.filter?.(i)===!1)return a(i);let P=Et(jh),U=Et(mB,{optional:!0}),$=Ap(Et(Oo));if(U&&!$)throw new rn(2803,!1);let se=$&&U?wB(i.url,U):i.url,Te=xB(i,se),Pe=P.get(Te,null),Ye=m.includeHeaders;if(typeof b=="object"&&b.includeHeaders&&(Ye=b.includeHeaders),Pe){let{[jM]:pt,[qM]:_t,[UM]:on,[$M]:an,[GM]:Ft,[HM]:mr}=Pe,Dn=pt;switch(_t){case"arraybuffer":Dn=new TextEncoder().encode(pt).buffer;break;case"blob":Dn=new Blob([pt]);break}let St=new Iy(on);return En(new Sy({body:Dn,headers:St,status:an,statusText:Ft,url:mr}))}return a(i).pipe(Xr(pt=>{pt instanceof Sy&&$&&P.set(Te,{[jM]:pt.body,[UM]:vB(pt.headers,Ye),[$M]:pt.status,[GM]:pt.statusText,[HM]:se,[qM]:i.responseType})}))}function yB(i){return i.headers.has("authorization")||i.headers.has("proxy-authorization")}function vB(i,a){if(!a)return{};let c={};for(let m of a){let b=i.getAll(m);b!==null&&(c[m]=b)}return c}function WM(i){return[...i.keys()].sort().map(a=>`${a}=${i.getAll(a)}`).join("&")}function xB(i,a){let{params:c,method:m,responseType:b}=i,n=WM(c),P=i.serializeBody();P instanceof URLSearchParams?P=WM(P):typeof P!="string"&&(P="");let U=[m,b,a,P,n].join("|"),$=bB(U);return $}function bB(i){let a=0;for(let c of i)a=Math.imul(31,a)+c.charCodeAt(0)<<0;return a+=2147483648,a.toString()}function XM(i){return[{provide:Ty,useFactory:()=>(Uh("NgHttpTransferCache"),kt({isCacheActive:!0},i))},{provide:pB,useValue:_B,multi:!0,deps:[jh,Ty]},{provide:Gh,multi:!0,useFactory:()=>{let a=Et(Fs),c=Et(Ty);return()=>{xy(a).then(()=>{c.isCacheActive=!1})}}}]}function wB(i,a){let c=new URL(i,"resolve://").origin,m=a[c];return m?i.replace(c,m):i}var i1=class extends by{constructor(){super(...arguments),this.supportsDOMEvents=!0}},o1=class i extends i1{static makeCurrent(){kM(new i)}onAndCancel(a,c,m){return a.addEventListener(c,m),()=>{a.removeEventListener(c,m)}}dispatchEvent(a,c){a.dispatchEvent(c)}remove(a){a.remove()}createElement(a,c){return c=c||this.getDefaultDocument(),c.createElement(a)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(a){return a.nodeType===Node.ELEMENT_NODE}isShadowRoot(a){return a instanceof DocumentFragment}getGlobalEventTarget(a,c){return c==="window"?window:c==="document"?a:c==="body"?a.body:null}getBaseHref(a){let c=EB();return c==null?null:TB(c)}resetBaseElement(){Rp=null}getUserAgent(){return window.navigator.userAgent}getCookie(a){return Kb(document.cookie,a)}},Rp=null;function EB(){return Rp=Rp||document.querySelector("base"),Rp?Rp.getAttribute("href"):null}function TB(i){return new URL(i,document.baseURI).pathname}var IB=(()=>{class i{build(){return new XMLHttpRequest}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac})}}return i})(),s1=new yn(""),QM=(()=>{class i{constructor(c,m){this._zone=m,this._eventNameToPlugin=new Map,c.forEach(b=>{b.manager=this}),this._plugins=c.slice().reverse()}addEventListener(c,m,b){return this._findPluginFor(m).addEventListener(c,m,b)}getZone(){return this._zone}_findPluginFor(c){let m=this._eventNameToPlugin.get(c);if(m)return m;if(m=this._plugins.find(n=>n.supports(c)),!m)throw new rn(5101,!1);return this._eventNameToPlugin.set(c,m),m}static{this.\u0275fac=function(m){return new(m||i)(Jn(s1),Jn(Nr))}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac})}}return i})(),Dy=class{constructor(a){this._doc=a}},n1="ng-app-id",eA=(()=>{class i{constructor(c,m,b,n={}){this.doc=c,this.appId=m,this.nonce=b,this.platformId=n,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Ap(n),this.resetHostNodes()}addStyles(c){for(let m of c)this.changeUsageCount(m,1)===1&&this.onStyleAdded(m)}removeStyles(c){for(let m of c)this.changeUsageCount(m,-1)<=0&&this.onStyleRemoved(m)}ngOnDestroy(){let c=this.styleNodesInDOM;c&&(c.forEach(m=>m.remove()),c.clear());for(let m of this.getAllStyles())this.onStyleRemoved(m);this.resetHostNodes()}addHost(c){this.hostNodes.add(c);for(let m of this.getAllStyles())this.addStyleToHost(c,m)}removeHost(c){this.hostNodes.delete(c)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(c){for(let m of this.hostNodes)this.addStyleToHost(m,c)}onStyleRemoved(c){let m=this.styleRef;m.get(c)?.elements?.forEach(b=>b.remove()),m.delete(c)}collectServerRenderedStyles(){let c=this.doc.head?.querySelectorAll(`style[${n1}="${this.appId}"]`);if(c?.length){let m=new Map;return c.forEach(b=>{b.textContent!=null&&m.set(b.textContent,b)}),m}return null}changeUsageCount(c,m){let b=this.styleRef;if(b.has(c)){let n=b.get(c);return n.usage+=m,n.usage}return b.set(c,{usage:m,elements:[]}),m}getStyleElement(c,m){let b=this.styleNodesInDOM,n=b?.get(m);if(n?.parentNode===c)return b.delete(m),n.removeAttribute(n1),n;{let P=this.doc.createElement("style");return this.nonce&&P.setAttribute("nonce",this.nonce),P.textContent=m,this.platformIsServer&&P.setAttribute(n1,this.appId),c.appendChild(P),P}}addStyleToHost(c,m){let b=this.getStyleElement(c,m),n=this.styleRef,P=n.get(m)?.elements;P?P.push(b):n.set(m,{elements:[b],usage:1})}resetHostNodes(){let c=this.hostNodes;c.clear(),c.add(this.doc.head)}static{this.\u0275fac=function(m){return new(m||i)(Jn(co),Jn(ay),Jn(Cb,8),Jn(Oo))}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac})}}return i})(),r1={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},c1=/%COMP%/g,tA="%COMP%",SB=`_nghost-${tA}`,DB=`_ngcontent-${tA}`,CB=!0,MB=new yn("",{providedIn:"root",factory:()=>CB});function AB(i){return DB.replace(c1,i)}function RB(i){return SB.replace(c1,i)}function nA(i,a){return a.map(c=>c.replace(c1,i))}var YM=(()=>{class i{constructor(c,m,b,n,P,U,$,se=null){this.eventManager=c,this.sharedStylesHost=m,this.appId=b,this.removeStylesOnCompDestroy=n,this.doc=P,this.platformId=U,this.ngZone=$,this.nonce=se,this.rendererByCompId=new Map,this.platformIsServer=Ap(U),this.defaultRenderer=new Pp(c,P,$,this.platformIsServer)}createRenderer(c,m){if(!c||!m)return this.defaultRenderer;this.platformIsServer&&m.encapsulation===Ps.ShadowDom&&(m=Sr(kt({},m),{encapsulation:Ps.Emulated}));let b=this.getOrCreateRenderer(c,m);return b instanceof Cy?b.applyToHost(c):b instanceof Op&&b.applyStyles(),b}getOrCreateRenderer(c,m){let b=this.rendererByCompId,n=b.get(m.id);if(!n){let P=this.doc,U=this.ngZone,$=this.eventManager,se=this.sharedStylesHost,Te=this.removeStylesOnCompDestroy,Pe=this.platformIsServer;switch(m.encapsulation){case Ps.Emulated:n=new Cy($,se,m,this.appId,Te,P,U,Pe);break;case Ps.ShadowDom:return new a1($,se,c,m,P,U,this.nonce,Pe);default:n=new Op($,se,m,Te,P,U,Pe);break}b.set(m.id,n)}return n}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(m){return new(m||i)(Jn(QM),Jn(eA),Jn(ay),Jn(MB),Jn(co),Jn(Oo),Jn(Nr),Jn(Cb))}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac})}}return i})(),Pp=class{constructor(a,c,m,b){this.eventManager=a,this.doc=c,this.ngZone=m,this.platformIsServer=b,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(a,c){return c?this.doc.createElementNS(r1[c]||c,a):this.doc.createElement(a)}createComment(a){return this.doc.createComment(a)}createText(a){return this.doc.createTextNode(a)}appendChild(a,c){(JM(a)?a.content:a).appendChild(c)}insertBefore(a,c,m){a&&(JM(a)?a.content:a).insertBefore(c,m)}removeChild(a,c){c.remove()}selectRootElement(a,c){let m=typeof a=="string"?this.doc.querySelector(a):a;if(!m)throw new rn(-5104,!1);return c||(m.textContent=""),m}parentNode(a){return a.parentNode}nextSibling(a){return a.nextSibling}setAttribute(a,c,m,b){if(b){c=b+":"+c;let n=r1[b];n?a.setAttributeNS(n,c,m):a.setAttribute(c,m)}else a.setAttribute(c,m)}removeAttribute(a,c,m){if(m){let b=r1[m];b?a.removeAttributeNS(b,c):a.removeAttribute(`${m}:${c}`)}else a.removeAttribute(c)}addClass(a,c){a.classList.add(c)}removeClass(a,c){a.classList.remove(c)}setStyle(a,c,m,b){b&(Xc.DashCase|Xc.Important)?a.style.setProperty(c,m,b&Xc.Important?"important":""):a.style[c]=m}removeStyle(a,c,m){m&Xc.DashCase?a.style.removeProperty(c):a.style[c]=""}setProperty(a,c,m){a!=null&&(a[c]=m)}setValue(a,c){a.nodeValue=c}listen(a,c,m){if(typeof a=="string"&&(a=Hh().getGlobalEventTarget(this.doc,a),!a))throw new Error(`Unsupported event target ${a} for event ${c}`);return this.eventManager.addEventListener(a,c,this.decoratePreventDefault(m))}decoratePreventDefault(a){return c=>{if(c==="__ngUnwrap__")return a;(this.platformIsServer?this.ngZone.runGuarded(()=>a(c)):a(c))===!1&&c.preventDefault()}}};function JM(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var a1=class extends Pp{constructor(a,c,m,b,n,P,U,$){super(a,n,P,$),this.sharedStylesHost=c,this.hostEl=m,this.shadowRoot=m.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let se=nA(b.id,b.styles);for(let Te of se){let Pe=document.createElement("style");U&&Pe.setAttribute("nonce",U),Pe.textContent=Te,this.shadowRoot.appendChild(Pe)}}nodeOrShadowRoot(a){return a===this.hostEl?this.shadowRoot:a}appendChild(a,c){return super.appendChild(this.nodeOrShadowRoot(a),c)}insertBefore(a,c,m){return super.insertBefore(this.nodeOrShadowRoot(a),c,m)}removeChild(a,c){return super.removeChild(null,c)}parentNode(a){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(a)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Op=class extends Pp{constructor(a,c,m,b,n,P,U,$){super(a,n,P,U),this.sharedStylesHost=c,this.removeStylesOnCompDestroy=b,this.styles=$?nA($,m.styles):m.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Cy=class extends Op{constructor(a,c,m,b,n,P,U,$){let se=b+"-"+m.id;super(a,c,m,n,P,U,$,se),this.contentAttr=AB(se),this.hostAttr=RB(se)}applyToHost(a){this.applyStyles(),this.setAttribute(a,this.hostAttr,"")}createElement(a,c){let m=super.createElement(a,c);return super.setAttribute(m,this.contentAttr,""),m}},PB=(()=>{class i extends Dy{constructor(c){super(c)}supports(c){return!0}addEventListener(c,m,b){return c.addEventListener(m,b,!1),()=>this.removeEventListener(c,m,b)}removeEventListener(c,m,b){return c.removeEventListener(m,b)}static{this.\u0275fac=function(m){return new(m||i)(Jn(co))}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac})}}return i})(),KM=["alt","control","meta","shift"],OB={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},LB={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},kB=(()=>{class i extends Dy{constructor(c){super(c)}supports(c){return i.parseEventName(c)!=null}addEventListener(c,m,b){let n=i.parseEventName(m),P=i.eventCallback(n.fullKey,b,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Hh().onAndCancel(c,n.domEventName,P))}static parseEventName(c){let m=c.toLowerCase().split("."),b=m.shift();if(m.length===0||!(b==="keydown"||b==="keyup"))return null;let n=i._normalizeKey(m.pop()),P="",U=m.indexOf("code");if(U>-1&&(m.splice(U,1),P="code."),KM.forEach(se=>{let Te=m.indexOf(se);Te>-1&&(m.splice(Te,1),P+=se+".")}),P+=n,m.length!=0||n.length===0)return null;let $={};return $.domEventName=b,$.fullKey=P,$}static matchEventFullKeyCode(c,m){let b=OB[c.key]||c.key,n="";return m.indexOf("code.")>-1&&(b=c.code,n="code."),b==null||!b?!1:(b=b.toLowerCase(),b===" "?b="space":b==="."&&(b="dot"),KM.forEach(P=>{if(P!==b){let U=LB[P];U(c)&&(n+=P+".")}}),n+=b,n===m)}static eventCallback(c,m,b){return n=>{i.matchEventFullKeyCode(n,c)&&b.runGuarded(()=>m(n))}}static _normalizeKey(c){return c==="esc"?"escape":c}static{this.\u0275fac=function(m){return new(m||i)(Jn(co))}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac})}}return i})();function rA(i,a){return DM(kt({rootComponent:i},FB(a)))}function FB(i){return{appProviders:[...jB,...i?.providers??[]],platformProviders:VB}}function NB(){o1.makeCurrent()}function zB(){return new pa}function BB(){return _C(document),document}var VB=[{provide:Oo,useValue:e1},{provide:Db,useValue:NB,multi:!0},{provide:co,useFactory:BB,deps:[]}];var jB=[{provide:Q_,useValue:"root"},{provide:pa,useFactory:zB,deps:[]},{provide:s1,useClass:PB,multi:!0,deps:[co,Nr,Oo]},{provide:s1,useClass:kB,multi:!0,deps:[co]},YM,eA,QM,{provide:Bh,useExisting:YM},{provide:wy,useClass:IB,deps:[]},[]];var iA=(()=>{class i{constructor(c){this._doc=c}getTitle(){return this._doc.title}setTitle(c){this._doc.title=c||""}static{this.\u0275fac=function(m){return new(m||i)(Jn(co))}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var l1=function(i){return i[i.NoHttpTransferCache=0]="NoHttpTransferCache",i[i.HttpTransferCacheOptions=1]="HttpTransferCacheOptions",i[i.I18nSupport=2]="I18nSupport",i[i.EventReplay=3]="EventReplay",i}(l1||{});function oA(...i){let a=[],c=new Set,m=c.has(l1.HttpTransferCacheOptions);for(let{\u0275providers:b,\u0275kind:n}of i)c.add(n),b.length&&a.push(b);return Hc([[],CM(),c.has(l1.NoHttpTransferCache)||m?[]:XM({}),a])}var Pn="primary",Yp=Symbol("RouteTitle"),p1=class{constructor(a){this.params=a||{}}has(a){return Object.prototype.hasOwnProperty.call(this.params,a)}get(a){if(this.has(a)){let c=this.params[a];return Array.isArray(c)?c[0]:c}return null}getAll(a){if(this.has(a)){let c=this.params[a];return Array.isArray(c)?c:[c]}return[]}get keys(){return Object.keys(this.params)}};function Jh(i){return new p1(i)}function $B(i,a,c){let m=c.path.split("/");if(m.length>i.length||c.pathMatch==="full"&&(a.hasChildren()||m.length<i.length))return null;let b={};for(let n=0;n<m.length;n++){let P=m[n],U=i[n];if(P[0]===":")b[P.substring(1)]=U;else if(P!==U.path)return null}return{consumed:i.slice(0,m.length),posParams:b}}function GB(i,a){if(i.length!==a.length)return!1;for(let c=0;c<i.length;++c)if(!Ns(i[c],a[c]))return!1;return!0}function Ns(i,a){let c=i?m1(i):void 0,m=a?m1(a):void 0;if(!c||!m||c.length!=m.length)return!1;let b;for(let n=0;n<c.length;n++)if(b=c[n],!fA(i[b],a[b]))return!1;return!0}function m1(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}function fA(i,a){if(Array.isArray(i)&&Array.isArray(a)){if(i.length!==a.length)return!1;let c=[...i].sort(),m=[...a].sort();return c.every((b,n)=>m[n]===b)}else return i===a}function pA(i){return i.length>0?i[i.length-1]:null}function Pl(i){return ax(i)?i:Sp(i)?Ur(Promise.resolve(i)):En(i)}var HB={exact:gA,subset:_A},mA={exact:qB,subset:WB,ignored:()=>!0};function sA(i,a,c){return HB[c.paths](i.root,a.root,c.matrixParams)&&mA[c.queryParams](i.queryParams,a.queryParams)&&!(c.fragment==="exact"&&i.fragment!==a.fragment)}function qB(i,a){return Ns(i,a)}function gA(i,a,c){if(!Qc(i.segments,a.segments)||!Ry(i.segments,a.segments,c)||i.numberOfChildren!==a.numberOfChildren)return!1;for(let m in a.children)if(!i.children[m]||!gA(i.children[m],a.children[m],c))return!1;return!0}function WB(i,a){return Object.keys(a).length<=Object.keys(i).length&&Object.keys(a).every(c=>fA(i[c],a[c]))}function _A(i,a,c){return yA(i,a,a.segments,c)}function yA(i,a,c,m){if(i.segments.length>c.length){let b=i.segments.slice(0,c.length);return!(!Qc(b,c)||a.hasChildren()||!Ry(b,c,m))}else if(i.segments.length===c.length){if(!Qc(i.segments,c)||!Ry(i.segments,c,m))return!1;for(let b in a.children)if(!i.children[b]||!_A(i.children[b],a.children[b],m))return!1;return!0}else{let b=c.slice(0,i.segments.length),n=c.slice(i.segments.length);return!Qc(i.segments,b)||!Ry(i.segments,b,m)||!i.children[Pn]?!1:yA(i.children[Pn],a,n,m)}}function Ry(i,a,c){return a.every((m,b)=>mA[c](i[b].parameters,m.parameters))}var ga=class{constructor(a=new lr([],{}),c={},m=null){this.root=a,this.queryParams=c,this.fragment=m}get queryParamMap(){return this._queryParamMap??=Jh(this.queryParams),this._queryParamMap}toString(){return YB.serialize(this)}},lr=class{constructor(a,c){this.segments=a,this.children=c,this.parent=null,Object.values(c).forEach(m=>m.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Py(this)}},Kc=class{constructor(a,c){this.path=a,this.parameters=c}get parameterMap(){return this._parameterMap??=Jh(this.parameters),this._parameterMap}toString(){return xA(this)}};function ZB(i,a){return Qc(i,a)&&i.every((c,m)=>Ns(c.parameters,a[m].parameters))}function Qc(i,a){return i.length!==a.length?!1:i.every((c,m)=>c.path===a[m].path)}function XB(i,a){let c=[];return Object.entries(i.children).forEach(([m,b])=>{m===Pn&&(c=c.concat(a(b,m)))}),Object.entries(i.children).forEach(([m,b])=>{m!==Pn&&(c=c.concat(a(b,m)))}),c}var j1=(()=>{class i{static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:()=>new Vp,providedIn:"root"})}}return i})(),Vp=class{parse(a){let c=new _1(a);return new ga(c.parseRootSegment(),c.parseQueryParams(),c.parseFragment())}serialize(a){let c=`/${Lp(a.root,!0)}`,m=QB(a.queryParams),b=typeof a.fragment=="string"?`#${JB(a.fragment)}`:"";return`${c}${m}${b}`}},YB=new Vp;function Py(i){return i.segments.map(a=>xA(a)).join("/")}function Lp(i,a){if(!i.hasChildren())return Py(i);if(a){let c=i.children[Pn]?Lp(i.children[Pn],!1):"",m=[];return Object.entries(i.children).forEach(([b,n])=>{b!==Pn&&m.push(`${b}:${Lp(n,!1)}`)}),m.length>0?`${c}(${m.join("//")})`:c}else{let c=XB(i,(m,b)=>b===Pn?[Lp(i.children[Pn],!1)]:[`${b}:${Lp(m,!1)}`]);return Object.keys(i.children).length===1&&i.children[Pn]!=null?`${Py(i)}/${c[0]}`:`${Py(i)}/(${c.join("//")})`}}function vA(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function My(i){return vA(i).replace(/%3B/gi,";")}function JB(i){return encodeURI(i)}function g1(i){return vA(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Oy(i){return decodeURIComponent(i)}function aA(i){return Oy(i.replace(/\+/g,"%20"))}function xA(i){return`${g1(i.path)}${KB(i.parameters)}`}function KB(i){return Object.entries(i).map(([a,c])=>`;${g1(a)}=${g1(c)}`).join("")}function QB(i){let a=Object.entries(i).map(([c,m])=>Array.isArray(m)?m.map(b=>`${My(c)}=${My(b)}`).join("&"):`${My(c)}=${My(m)}`).filter(c=>c);return a.length?`?${a.join("&")}`:""}var e4=/^[^\/()?;#]+/;function u1(i){let a=i.match(e4);return a?a[0]:""}var t4=/^[^\/()?;=#]+/;function n4(i){let a=i.match(t4);return a?a[0]:""}var r4=/^[^=?&#]+/;function i4(i){let a=i.match(r4);return a?a[0]:""}var o4=/^[^&#]+/;function s4(i){let a=i.match(o4);return a?a[0]:""}var _1=class{constructor(a){this.url=a,this.remaining=a}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new lr([],{}):new lr([],this.parseChildren())}parseQueryParams(){let a={};if(this.consumeOptional("?"))do this.parseQueryParam(a);while(this.consumeOptional("&"));return a}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let a=[];for(this.peekStartsWith("(")||a.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),a.push(this.parseSegment());let c={};this.peekStartsWith("/(")&&(this.capture("/"),c=this.parseParens(!0));let m={};return this.peekStartsWith("(")&&(m=this.parseParens(!1)),(a.length>0||Object.keys(c).length>0)&&(m[Pn]=new lr(a,c)),m}parseSegment(){let a=u1(this.remaining);if(a===""&&this.peekStartsWith(";"))throw new rn(4009,!1);return this.capture(a),new Kc(Oy(a),this.parseMatrixParams())}parseMatrixParams(){let a={};for(;this.consumeOptional(";");)this.parseParam(a);return a}parseParam(a){let c=n4(this.remaining);if(!c)return;this.capture(c);let m="";if(this.consumeOptional("=")){let b=u1(this.remaining);b&&(m=b,this.capture(m))}a[Oy(c)]=Oy(m)}parseQueryParam(a){let c=i4(this.remaining);if(!c)return;this.capture(c);let m="";if(this.consumeOptional("=")){let P=s4(this.remaining);P&&(m=P,this.capture(m))}let b=aA(c),n=aA(m);if(a.hasOwnProperty(b)){let P=a[b];Array.isArray(P)||(P=[P],a[b]=P),P.push(n)}else a[b]=n}parseParens(a){let c={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let m=u1(this.remaining),b=this.remaining[m.length];if(b!=="/"&&b!==")"&&b!==";")throw new rn(4010,!1);let n;m.indexOf(":")>-1?(n=m.slice(0,m.indexOf(":")),this.capture(n),this.capture(":")):a&&(n=Pn);let P=this.parseChildren();c[n]=Object.keys(P).length===1?P[Pn]:new lr([],P),this.consumeOptional("//")}return c}peekStartsWith(a){return this.remaining.startsWith(a)}consumeOptional(a){return this.peekStartsWith(a)?(this.remaining=this.remaining.substring(a.length),!0):!1}capture(a){if(!this.consumeOptional(a))throw new rn(4011,!1)}};function bA(i){return i.segments.length>0?new lr([],{[Pn]:i}):i}function wA(i){let a={};for(let[m,b]of Object.entries(i.children)){let n=wA(b);if(m===Pn&&n.segments.length===0&&n.hasChildren())for(let[P,U]of Object.entries(n.children))a[P]=U;else(n.segments.length>0||n.hasChildren())&&(a[m]=n)}let c=new lr(i.segments,a);return a4(c)}function a4(i){if(i.numberOfChildren===1&&i.children[Pn]){let a=i.children[Pn];return new lr(i.segments.concat(a.segments),a.children)}return i}function jp(i){return i instanceof ga}function l4(i,a,c=null,m=null){let b=EA(i);return TA(b,a,c,m)}function EA(i){let a;function c(n){let P={};for(let $ of n.children){let se=c($);P[$.outlet]=se}let U=new lr(n.url,P);return n===i&&(a=U),U}let m=c(i.root),b=bA(m);return a??b}function TA(i,a,c,m){let b=i;for(;b.parent;)b=b.parent;if(a.length===0)return h1(b,b,b,c,m);let n=c4(a);if(n.toRoot())return h1(b,b,new lr([],{}),c,m);let P=u4(n,b,i),U=P.processChildren?Np(P.segmentGroup,P.index,n.commands):SA(P.segmentGroup,P.index,n.commands);return h1(b,P.segmentGroup,U,c,m)}function Ly(i){return typeof i=="object"&&i!=null&&!i.outlets&&!i.segmentPath}function Up(i){return typeof i=="object"&&i!=null&&i.outlets}function h1(i,a,c,m,b){let n={};m&&Object.entries(m).forEach(([$,se])=>{n[$]=Array.isArray(se)?se.map(Te=>`${Te}`):`${se}`});let P;i===a?P=c:P=IA(i,a,c);let U=bA(wA(P));return new ga(U,n,b)}function IA(i,a,c){let m={};return Object.entries(i.children).forEach(([b,n])=>{n===a?m[b]=c:m[b]=IA(n,a,c)}),new lr(i.segments,m)}var ky=class{constructor(a,c,m){if(this.isAbsolute=a,this.numberOfDoubleDots=c,this.commands=m,a&&m.length>0&&Ly(m[0]))throw new rn(4003,!1);let b=m.find(Up);if(b&&b!==pA(m))throw new rn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function c4(i){if(typeof i[0]=="string"&&i.length===1&&i[0]==="/")return new ky(!0,0,i);let a=0,c=!1,m=i.reduce((b,n,P)=>{if(typeof n=="object"&&n!=null){if(n.outlets){let U={};return Object.entries(n.outlets).forEach(([$,se])=>{U[$]=typeof se=="string"?se.split("/"):se}),[...b,{outlets:U}]}if(n.segmentPath)return[...b,n.segmentPath]}return typeof n!="string"?[...b,n]:P===0?(n.split("/").forEach((U,$)=>{$==0&&U==="."||($==0&&U===""?c=!0:U===".."?a++:U!=""&&b.push(U))}),b):[...b,n]},[]);return new ky(c,a,m)}var Zh=class{constructor(a,c,m){this.segmentGroup=a,this.processChildren=c,this.index=m}};function u4(i,a,c){if(i.isAbsolute)return new Zh(a,!0,0);if(!c)return new Zh(a,!1,NaN);if(c.parent===null)return new Zh(c,!0,0);let m=Ly(i.commands[0])?0:1,b=c.segments.length-1+m;return h4(c,b,i.numberOfDoubleDots)}function h4(i,a,c){let m=i,b=a,n=c;for(;n>b;){if(n-=b,m=m.parent,!m)throw new rn(4005,!1);b=m.segments.length}return new Zh(m,!1,b-n)}function d4(i){return Up(i[0])?i[0].outlets:{[Pn]:i}}function SA(i,a,c){if(i??=new lr([],{}),i.segments.length===0&&i.hasChildren())return Np(i,a,c);let m=f4(i,a,c),b=c.slice(m.commandIndex);if(m.match&&m.pathIndex<i.segments.length){let n=new lr(i.segments.slice(0,m.pathIndex),{});return n.children[Pn]=new lr(i.segments.slice(m.pathIndex),i.children),Np(n,0,b)}else return m.match&&b.length===0?new lr(i.segments,{}):m.match&&!i.hasChildren()?y1(i,a,c):m.match?Np(i,0,b):y1(i,a,c)}function Np(i,a,c){if(c.length===0)return new lr(i.segments,{});{let m=d4(c),b={};if(Object.keys(m).some(n=>n!==Pn)&&i.children[Pn]&&i.numberOfChildren===1&&i.children[Pn].segments.length===0){let n=Np(i.children[Pn],a,c);return new lr(i.segments,n.children)}return Object.entries(m).forEach(([n,P])=>{typeof P=="string"&&(P=[P]),P!==null&&(b[n]=SA(i.children[n],a,P))}),Object.entries(i.children).forEach(([n,P])=>{m[n]===void 0&&(b[n]=P)}),new lr(i.segments,b)}}function f4(i,a,c){let m=0,b=a,n={match:!1,pathIndex:0,commandIndex:0};for(;b<i.segments.length;){if(m>=c.length)return n;let P=i.segments[b],U=c[m];if(Up(U))break;let $=`${U}`,se=m<c.length-1?c[m+1]:null;if(b>0&&$===void 0)break;if($&&se&&typeof se=="object"&&se.outlets===void 0){if(!cA($,se,P))return n;m+=2}else{if(!cA($,{},P))return n;m++}b++}return{match:!0,pathIndex:b,commandIndex:m}}function y1(i,a,c){let m=i.segments.slice(0,a),b=0;for(;b<c.length;){let n=c[b];if(Up(n)){let $=p4(n.outlets);return new lr(m,$)}if(b===0&&Ly(c[0])){let $=i.segments[a];m.push(new Kc($.path,lA(c[0]))),b++;continue}let P=Up(n)?n.outlets[Pn]:`${n}`,U=b<c.length-1?c[b+1]:null;P&&U&&Ly(U)?(m.push(new Kc(P,lA(U))),b+=2):(m.push(new Kc(P,{})),b++)}return new lr(m,{})}function p4(i){let a={};return Object.entries(i).forEach(([c,m])=>{typeof m=="string"&&(m=[m]),m!==null&&(a[c]=y1(new lr([],{}),0,m))}),a}function lA(i){let a={};return Object.entries(i).forEach(([c,m])=>a[c]=`${m}`),a}function cA(i,a,c){return i==c.path&&Ns(a,c.parameters)}var zp="imperative",ci=function(i){return i[i.NavigationStart=0]="NavigationStart",i[i.NavigationEnd=1]="NavigationEnd",i[i.NavigationCancel=2]="NavigationCancel",i[i.NavigationError=3]="NavigationError",i[i.RoutesRecognized=4]="RoutesRecognized",i[i.ResolveStart=5]="ResolveStart",i[i.ResolveEnd=6]="ResolveEnd",i[i.GuardsCheckStart=7]="GuardsCheckStart",i[i.GuardsCheckEnd=8]="GuardsCheckEnd",i[i.RouteConfigLoadStart=9]="RouteConfigLoadStart",i[i.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",i[i.ChildActivationStart=11]="ChildActivationStart",i[i.ChildActivationEnd=12]="ChildActivationEnd",i[i.ActivationStart=13]="ActivationStart",i[i.ActivationEnd=14]="ActivationEnd",i[i.Scroll=15]="Scroll",i[i.NavigationSkipped=16]="NavigationSkipped",i}(ci||{}),Lo=class{constructor(a,c){this.id=a,this.url=c}},$p=class extends Lo{constructor(a,c,m="imperative",b=null){super(a,c),this.type=ci.NavigationStart,this.navigationTrigger=m,this.restoredState=b}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},eu=class extends Lo{constructor(a,c,m){super(a,c),this.urlAfterRedirects=m,this.type=ci.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ho=function(i){return i[i.Redirect=0]="Redirect",i[i.SupersededByNewNavigation=1]="SupersededByNewNavigation",i[i.NoDataFromResolver=2]="NoDataFromResolver",i[i.GuardRejected=3]="GuardRejected",i}(ho||{}),v1=function(i){return i[i.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",i[i.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",i}(v1||{}),ma=class extends Lo{constructor(a,c,m,b){super(a,c),this.reason=m,this.code=b,this.type=ci.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},tu=class extends Lo{constructor(a,c,m,b){super(a,c),this.reason=m,this.code=b,this.type=ci.NavigationSkipped}},Gp=class extends Lo{constructor(a,c,m,b){super(a,c),this.error=m,this.target=b,this.type=ci.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Fy=class extends Lo{constructor(a,c,m,b){super(a,c),this.urlAfterRedirects=m,this.state=b,this.type=ci.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},x1=class extends Lo{constructor(a,c,m,b){super(a,c),this.urlAfterRedirects=m,this.state=b,this.type=ci.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},b1=class extends Lo{constructor(a,c,m,b,n){super(a,c),this.urlAfterRedirects=m,this.state=b,this.shouldActivate=n,this.type=ci.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},w1=class extends Lo{constructor(a,c,m,b){super(a,c),this.urlAfterRedirects=m,this.state=b,this.type=ci.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},E1=class extends Lo{constructor(a,c,m,b){super(a,c),this.urlAfterRedirects=m,this.state=b,this.type=ci.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},T1=class{constructor(a){this.route=a,this.type=ci.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},I1=class{constructor(a){this.route=a,this.type=ci.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},S1=class{constructor(a){this.snapshot=a,this.type=ci.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},D1=class{constructor(a){this.snapshot=a,this.type=ci.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},C1=class{constructor(a){this.snapshot=a,this.type=ci.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},M1=class{constructor(a){this.snapshot=a,this.type=ci.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Hp=class{},Kh=class{constructor(a,c){this.url=a,this.navigationBehaviorOptions=c}};function m4(i,a){return i.providers&&!i._injector&&(i._injector=Hb(i.providers,a,`Route: ${i.path}`)),i._injector??a}function ds(i){return i.outlet||Pn}function g4(i,a){let c=i.filter(m=>ds(m)===a);return c.push(...i.filter(m=>ds(m)!==a)),c}function Jp(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let a=i.parent;a;a=a.parent){let c=a.routeConfig;if(c?._loadedInjector)return c._loadedInjector;if(c?._injector)return c._injector}return null}var A1=class{get injector(){return Jp(this.route?.snapshot)??this.rootInjector}set injector(a){}constructor(a){this.rootInjector=a,this.outlet=null,this.route=null,this.children=new $y(this.rootInjector),this.attachRef=null}},$y=(()=>{class i{constructor(c){this.rootInjector=c,this.contexts=new Map}onChildOutletCreated(c,m){let b=this.getOrCreateContext(c);b.outlet=m,this.contexts.set(c,b)}onChildOutletDestroyed(c){let m=this.getContext(c);m&&(m.outlet=null,m.attachRef=null)}onOutletDeactivated(){let c=this.contexts;return this.contexts=new Map,c}onOutletReAttached(c){this.contexts=c}getOrCreateContext(c){let m=this.getContext(c);return m||(m=new A1(this.rootInjector),this.contexts.set(c,m)),m}getContext(c){return this.contexts.get(c)||null}static{this.\u0275fac=function(m){return new(m||i)(Jn(Ao))}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Ny=class{constructor(a){this._root=a}get root(){return this._root.value}parent(a){let c=this.pathFromRoot(a);return c.length>1?c[c.length-2]:null}children(a){let c=R1(a,this._root);return c?c.children.map(m=>m.value):[]}firstChild(a){let c=R1(a,this._root);return c&&c.children.length>0?c.children[0].value:null}siblings(a){let c=P1(a,this._root);return c.length<2?[]:c[c.length-2].children.map(b=>b.value).filter(b=>b!==a)}pathFromRoot(a){return P1(a,this._root).map(c=>c.value)}};function R1(i,a){if(i===a.value)return a;for(let c of a.children){let m=R1(i,c);if(m)return m}return null}function P1(i,a){if(i===a.value)return[a];for(let c of a.children){let m=P1(i,c);if(m.length)return m.unshift(a),m}return[]}var uo=class{constructor(a,c){this.value=a,this.children=c}toString(){return`TreeNode(${this.value})`}};function Wh(i){let a={};return i&&i.children.forEach(c=>a[c.value.outlet]=c),a}var zy=class extends Ny{constructor(a,c){super(a),this.snapshot=c,U1(this,a)}toString(){return this.snapshot.toString()}};function DA(i){let a=_4(i),c=new ai([new Kc("",{})]),m=new ai({}),b=new ai({}),n=new ai({}),P=new ai(""),U=new Qh(c,m,n,P,b,Pn,i,a.root);return U.snapshot=a.root,new zy(new uo(U,[]),a)}function _4(i){let a={},c={},m={},b="",n=new Xh([],a,m,b,c,Pn,i,null,{});return new Vy("",new uo(n,[]))}var Qh=class{constructor(a,c,m,b,n,P,U,$){this.urlSubject=a,this.paramsSubject=c,this.queryParamsSubject=m,this.fragmentSubject=b,this.dataSubject=n,this.outlet=P,this.component=U,this._futureSnapshot=$,this.title=this.dataSubject?.pipe(Wn(se=>se[Yp]))??En(void 0),this.url=a,this.params=c,this.queryParams=m,this.fragment=b,this.data=n}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Wn(a=>Jh(a))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Wn(a=>Jh(a))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function By(i,a,c="emptyOnly"){let m,{routeConfig:b}=i;return a!==null&&(c==="always"||b?.path===""||!a.component&&!a.routeConfig?.loadComponent)?m={params:kt(kt({},a.params),i.params),data:kt(kt({},a.data),i.data),resolve:kt(kt(kt(kt({},i.data),a.data),b?.data),i._resolvedData)}:m={params:kt({},i.params),data:kt({},i.data),resolve:kt(kt({},i.data),i._resolvedData??{})},b&&MA(b)&&(m.resolve[Yp]=b.title),m}var Xh=class{get title(){return this.data?.[Yp]}constructor(a,c,m,b,n,P,U,$,se){this.url=a,this.params=c,this.queryParams=m,this.fragment=b,this.data=n,this.outlet=P,this.component=U,this.routeConfig=$,this._resolve=se}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Jh(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Jh(this.queryParams),this._queryParamMap}toString(){let a=this.url.map(m=>m.toString()).join("/"),c=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${a}', path:'${c}')`}},Vy=class extends Ny{constructor(a,c){super(c),this.url=a,U1(this,c)}toString(){return CA(this._root)}};function U1(i,a){a.value._routerState=i,a.children.forEach(c=>U1(i,c))}function CA(i){let a=i.children.length>0?` { ${i.children.map(CA).join(", ")} } `:"";return`${i.value}${a}`}function d1(i){if(i.snapshot){let a=i.snapshot,c=i._futureSnapshot;i.snapshot=c,Ns(a.queryParams,c.queryParams)||i.queryParamsSubject.next(c.queryParams),a.fragment!==c.fragment&&i.fragmentSubject.next(c.fragment),Ns(a.params,c.params)||i.paramsSubject.next(c.params),GB(a.url,c.url)||i.urlSubject.next(c.url),Ns(a.data,c.data)||i.dataSubject.next(c.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function O1(i,a){let c=Ns(i.params,a.params)&&ZB(i.url,a.url),m=!i.parent!=!a.parent;return c&&!m&&(!i.parent||O1(i.parent,a.parent))}function MA(i){return typeof i.title=="string"||i.title===null}var y4=(()=>{class i{constructor(){this.activated=null,this._activatedRoute=null,this.name=Pn,this.activateEvents=new Pi,this.deactivateEvents=new Pi,this.attachEvents=new Pi,this.detachEvents=new Pi,this.parentContexts=Et($y),this.location=Et(Ep),this.changeDetector=Et(Dp),this.inputBinder=Et($1,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(c){if(c.name){let{firstChange:m,previousValue:b}=c.name;if(m)return;this.isTrackedInParentContexts(b)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(b)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(c){return this.parentContexts.getContext(c)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let c=this.parentContexts.getContext(this.name);c?.route&&(c.attachRef?this.attach(c.attachRef,c.route):this.activateWith(c.route,c.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new rn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new rn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new rn(4012,!1);this.location.detach();let c=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(c.instance),c}attach(c,m){this.activated=c,this._activatedRoute=m,this.location.insert(c.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(c.instance)}deactivate(){if(this.activated){let c=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(c)}}activateWith(c,m){if(this.isActivated)throw new rn(4013,!1);this._activatedRoute=c;let b=this.location,P=c.snapshot.component,U=this.parentContexts.getOrCreateContext(this.name).children,$=new L1(c,U,b.injector);this.activated=b.createComponent(P,{index:b.length,injector:$,environmentInjector:m}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275dir=K_({type:i,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[ty]})}}return i})(),L1=class i{__ngOutletInjector(a){return new i(this.route,this.childContexts,a)}constructor(a,c,m){this.route=a,this.childContexts=c,this.parent=m}get(a,c){return a===Qh?this.route:a===$y?this.childContexts:this.parent.get(a,c)}},$1=new yn("");function v4(i,a,c){let m=qp(i,a._root,c?c._root:void 0);return new zy(m,a)}function qp(i,a,c){if(c&&i.shouldReuseRoute(a.value,c.value.snapshot)){let m=c.value;m._futureSnapshot=a.value;let b=x4(i,a,c);return new uo(m,b)}else{if(i.shouldAttach(a.value)){let n=i.retrieve(a.value);if(n!==null){let P=n.route;return P.value._futureSnapshot=a.value,P.children=a.children.map(U=>qp(i,U)),P}}let m=b4(a.value),b=a.children.map(n=>qp(i,n));return new uo(m,b)}}function x4(i,a,c){return a.children.map(m=>{for(let b of c.children)if(i.shouldReuseRoute(m.value,b.value.snapshot))return qp(i,m,b);return qp(i,m)})}function b4(i){return new Qh(new ai(i.url),new ai(i.params),new ai(i.queryParams),new ai(i.fragment),new ai(i.data),i.outlet,i.component,i)}var Wp=class{constructor(a,c){this.redirectTo=a,this.navigationBehaviorOptions=c}},AA="ngNavigationCancelingError";function jy(i,a){let{redirectTo:c,navigationBehaviorOptions:m}=jp(a)?{redirectTo:a,navigationBehaviorOptions:void 0}:a,b=RA(!1,ho.Redirect);return b.url=c,b.navigationBehaviorOptions=m,b}function RA(i,a){let c=new Error(`NavigationCancelingError: ${i||""}`);return c[AA]=!0,c.cancellationCode=a,c}function w4(i){return PA(i)&&jp(i.url)}function PA(i){return!!i&&i[AA]}var E4=(i,a,c,m)=>Wn(b=>(new k1(a,b.targetRouterState,b.currentRouterState,c,m).activate(i),b)),k1=class{constructor(a,c,m,b,n){this.routeReuseStrategy=a,this.futureState=c,this.currState=m,this.forwardEvent=b,this.inputBindingEnabled=n}activate(a){let c=this.futureState._root,m=this.currState?this.currState._root:null;this.deactivateChildRoutes(c,m,a),d1(this.futureState.root),this.activateChildRoutes(c,m,a)}deactivateChildRoutes(a,c,m){let b=Wh(c);a.children.forEach(n=>{let P=n.value.outlet;this.deactivateRoutes(n,b[P],m),delete b[P]}),Object.values(b).forEach(n=>{this.deactivateRouteAndItsChildren(n,m)})}deactivateRoutes(a,c,m){let b=a.value,n=c?c.value:null;if(b===n)if(b.component){let P=m.getContext(b.outlet);P&&this.deactivateChildRoutes(a,c,P.children)}else this.deactivateChildRoutes(a,c,m);else n&&this.deactivateRouteAndItsChildren(c,m)}deactivateRouteAndItsChildren(a,c){a.value.component&&this.routeReuseStrategy.shouldDetach(a.value.snapshot)?this.detachAndStoreRouteSubtree(a,c):this.deactivateRouteAndOutlet(a,c)}detachAndStoreRouteSubtree(a,c){let m=c.getContext(a.value.outlet),b=m&&a.value.component?m.children:c,n=Wh(a);for(let P of Object.values(n))this.deactivateRouteAndItsChildren(P,b);if(m&&m.outlet){let P=m.outlet.detach(),U=m.children.onOutletDeactivated();this.routeReuseStrategy.store(a.value.snapshot,{componentRef:P,route:a,contexts:U})}}deactivateRouteAndOutlet(a,c){let m=c.getContext(a.value.outlet),b=m&&a.value.component?m.children:c,n=Wh(a);for(let P of Object.values(n))this.deactivateRouteAndItsChildren(P,b);m&&(m.outlet&&(m.outlet.deactivate(),m.children.onOutletDeactivated()),m.attachRef=null,m.route=null)}activateChildRoutes(a,c,m){let b=Wh(c);a.children.forEach(n=>{this.activateRoutes(n,b[n.value.outlet],m),this.forwardEvent(new M1(n.value.snapshot))}),a.children.length&&this.forwardEvent(new D1(a.value.snapshot))}activateRoutes(a,c,m){let b=a.value,n=c?c.value:null;if(d1(b),b===n)if(b.component){let P=m.getOrCreateContext(b.outlet);this.activateChildRoutes(a,c,P.children)}else this.activateChildRoutes(a,c,m);else if(b.component){let P=m.getOrCreateContext(b.outlet);if(this.routeReuseStrategy.shouldAttach(b.snapshot)){let U=this.routeReuseStrategy.retrieve(b.snapshot);this.routeReuseStrategy.store(b.snapshot,null),P.children.onOutletReAttached(U.contexts),P.attachRef=U.componentRef,P.route=U.route.value,P.outlet&&P.outlet.attach(U.componentRef,U.route.value),d1(U.route.value),this.activateChildRoutes(a,null,P.children)}else P.attachRef=null,P.route=b,P.outlet&&P.outlet.activateWith(b,P.injector),this.activateChildRoutes(a,null,P.children)}else this.activateChildRoutes(a,null,m)}},Uy=class{constructor(a){this.path=a,this.route=this.path[this.path.length-1]}},Yh=class{constructor(a,c){this.component=a,this.route=c}};function T4(i,a,c){let m=i._root,b=a?a._root:null;return kp(m,b,c,[m.value])}function I4(i){let a=i.routeConfig?i.routeConfig.canActivateChild:null;return!a||a.length===0?null:{node:i,guards:a}}function td(i,a){let c=Symbol(),m=a.get(i,c);return m===c?typeof i=="function"&&!tD(i)?i:a.get(i):m}function kp(i,a,c,m,b={canDeactivateChecks:[],canActivateChecks:[]}){let n=Wh(a);return i.children.forEach(P=>{S4(P,n[P.value.outlet],c,m.concat([P.value]),b),delete n[P.value.outlet]}),Object.entries(n).forEach(([P,U])=>Bp(U,c.getContext(P),b)),b}function S4(i,a,c,m,b={canDeactivateChecks:[],canActivateChecks:[]}){let n=i.value,P=a?a.value:null,U=c?c.getContext(i.value.outlet):null;if(P&&n.routeConfig===P.routeConfig){let $=D4(P,n,n.routeConfig.runGuardsAndResolvers);$?b.canActivateChecks.push(new Uy(m)):(n.data=P.data,n._resolvedData=P._resolvedData),n.component?kp(i,a,U?U.children:null,m,b):kp(i,a,c,m,b),$&&U&&U.outlet&&U.outlet.isActivated&&b.canDeactivateChecks.push(new Yh(U.outlet.component,P))}else P&&Bp(a,U,b),b.canActivateChecks.push(new Uy(m)),n.component?kp(i,null,U?U.children:null,m,b):kp(i,null,c,m,b);return b}function D4(i,a,c){if(typeof c=="function")return c(i,a);switch(c){case"pathParamsChange":return!Qc(i.url,a.url);case"pathParamsOrQueryParamsChange":return!Qc(i.url,a.url)||!Ns(i.queryParams,a.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!O1(i,a)||!Ns(i.queryParams,a.queryParams);case"paramsChange":default:return!O1(i,a)}}function Bp(i,a,c){let m=Wh(i),b=i.value;Object.entries(m).forEach(([n,P])=>{b.component?a?Bp(P,a.children.getContext(n),c):Bp(P,null,c):Bp(P,a,c)}),b.component?a&&a.outlet&&a.outlet.isActivated?c.canDeactivateChecks.push(new Yh(a.outlet.component,b)):c.canDeactivateChecks.push(new Yh(null,b)):c.canDeactivateChecks.push(new Yh(null,b))}function Kp(i){return typeof i=="function"}function C4(i){return typeof i=="boolean"}function M4(i){return i&&Kp(i.canLoad)}function A4(i){return i&&Kp(i.canActivate)}function R4(i){return i&&Kp(i.canActivateChild)}function P4(i){return i&&Kp(i.canDeactivate)}function O4(i){return i&&Kp(i.canMatch)}function OA(i){return i instanceof la||i?.name==="EmptyError"}var Ay=Symbol("INITIAL_VALUE");function ed(){return So(i=>u_(i.map(a=>a.pipe(ca(1),dx(Ay)))).pipe(Wn(a=>{for(let c of a)if(c!==!0){if(c===Ay)return Ay;if(c===!1||L4(c))return c}return!0}),Io(a=>a!==Ay),ca(1)))}function L4(i){return jp(i)||i instanceof Wp}function k4(i,a){return Zr(c=>{let{targetSnapshot:m,currentSnapshot:b,guards:{canActivateChecks:n,canDeactivateChecks:P}}=c;return P.length===0&&n.length===0?En(Sr(kt({},c),{guardsResult:!0})):F4(P,m,b,i).pipe(Zr(U=>U&&C4(U)?N4(m,n,i,a):En(U)),Wn(U=>Sr(kt({},c),{guardsResult:U})))})}function F4(i,a,c,m){return Ur(i).pipe(Zr(b=>U4(b.component,b.route,c,a,m)),os(b=>b!==!0,!0))}function N4(i,a,c,m){return Ur(a).pipe(Nc(b=>Ih(B4(b.route.parent,m),z4(b.route,m),j4(i,b.path,c),V4(i,b.route,c))),os(b=>b!==!0,!0))}function z4(i,a){return i!==null&&a&&a(new C1(i)),En(!0)}function B4(i,a){return i!==null&&a&&a(new S1(i)),En(!0)}function V4(i,a,c){let m=a.routeConfig?a.routeConfig.canActivate:null;if(!m||m.length===0)return En(!0);let b=m.map(n=>h_(()=>{let P=Jp(a)??c,U=td(n,P),$=A4(U)?U.canActivate(a,i):Ls(P,()=>U(a,i));return Pl($).pipe(os())}));return En(b).pipe(ed())}function j4(i,a,c){let m=a[a.length-1],n=a.slice(0,a.length-1).reverse().map(P=>I4(P)).filter(P=>P!==null).map(P=>h_(()=>{let U=P.guards.map($=>{let se=Jp(P.node)??c,Te=td($,se),Pe=R4(Te)?Te.canActivateChild(m,i):Ls(se,()=>Te(m,i));return Pl(Pe).pipe(os())});return En(U).pipe(ed())}));return En(n).pipe(ed())}function U4(i,a,c,m,b){let n=a&&a.routeConfig?a.routeConfig.canDeactivate:null;if(!n||n.length===0)return En(!0);let P=n.map(U=>{let $=Jp(a)??b,se=td(U,$),Te=P4(se)?se.canDeactivate(i,a,c,m):Ls($,()=>se(i,a,c,m));return Pl(Te).pipe(os())});return En(P).pipe(ed())}function $4(i,a,c,m){let b=a.canLoad;if(b===void 0||b.length===0)return En(!0);let n=b.map(P=>{let U=td(P,i),$=M4(U)?U.canLoad(a,c):Ls(i,()=>U(a,c));return Pl($)});return En(n).pipe(ed(),LA(m))}function LA(i){return rx(Xr(a=>{if(typeof a!="boolean")throw jy(i,a)}),Wn(a=>a===!0))}function G4(i,a,c,m){let b=a.canMatch;if(!b||b.length===0)return En(!0);let n=b.map(P=>{let U=td(P,i),$=O4(U)?U.canMatch(a,c):Ls(i,()=>U(a,c));return Pl($)});return En(n).pipe(ed(),LA(m))}var Zp=class{constructor(a){this.segmentGroup=a||null}},Xp=class extends Error{constructor(a){super(),this.urlTree=a}};function qh(i){return Th(new Zp(i))}function H4(i){return Th(new rn(4e3,!1))}function q4(i){return Th(RA(!1,ho.GuardRejected))}var F1=class{constructor(a,c){this.urlSerializer=a,this.urlTree=c}lineralizeSegments(a,c){let m=[],b=c.root;for(;;){if(m=m.concat(b.segments),b.numberOfChildren===0)return En(m);if(b.numberOfChildren>1||!b.children[Pn])return H4(`${a.redirectTo}`);b=b.children[Pn]}}applyRedirectCommands(a,c,m,b,n){if(typeof c!="string"){let U=c,{queryParams:$,fragment:se,routeConfig:Te,url:Pe,outlet:Ye,params:We,data:pt,title:_t}=b,on=Ls(n,()=>U({params:We,data:pt,queryParams:$,fragment:se,routeConfig:Te,url:Pe,outlet:Ye,title:_t}));if(on instanceof ga)throw new Xp(on);c=on}let P=this.applyRedirectCreateUrlTree(c,this.urlSerializer.parse(c),a,m);if(c[0]==="/")throw new Xp(P);return P}applyRedirectCreateUrlTree(a,c,m,b){let n=this.createSegmentGroup(a,c.root,m,b);return new ga(n,this.createQueryParams(c.queryParams,this.urlTree.queryParams),c.fragment)}createQueryParams(a,c){let m={};return Object.entries(a).forEach(([b,n])=>{if(typeof n=="string"&&n[0]===":"){let U=n.substring(1);m[b]=c[U]}else m[b]=n}),m}createSegmentGroup(a,c,m,b){let n=this.createSegments(a,c.segments,m,b),P={};return Object.entries(c.children).forEach(([U,$])=>{P[U]=this.createSegmentGroup(a,$,m,b)}),new lr(n,P)}createSegments(a,c,m,b){return c.map(n=>n.path[0]===":"?this.findPosParam(a,n,b):this.findOrReturn(n,m))}findPosParam(a,c,m){let b=m[c.path.substring(1)];if(!b)throw new rn(4001,!1);return b}findOrReturn(a,c){let m=0;for(let b of c){if(b.path===a.path)return c.splice(m),b;m++}return a}},N1={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function W4(i,a,c,m,b){let n=kA(i,a,c);return n.matched?(m=m4(a,m),G4(m,a,c,b).pipe(Wn(P=>P===!0?n:kt({},N1)))):En(n)}function kA(i,a,c){if(a.path==="**")return Z4(c);if(a.path==="")return a.pathMatch==="full"&&(i.hasChildren()||c.length>0)?kt({},N1):{matched:!0,consumedSegments:[],remainingSegments:c,parameters:{},positionalParamSegments:{}};let b=(a.matcher||$B)(c,i,a);if(!b)return kt({},N1);let n={};Object.entries(b.posParams??{}).forEach(([U,$])=>{n[U]=$.path});let P=b.consumed.length>0?kt(kt({},n),b.consumed[b.consumed.length-1].parameters):n;return{matched:!0,consumedSegments:b.consumed,remainingSegments:c.slice(b.consumed.length),parameters:P,positionalParamSegments:b.posParams??{}}}function Z4(i){return{matched:!0,parameters:i.length>0?pA(i).parameters:{},consumedSegments:i,remainingSegments:[],positionalParamSegments:{}}}function uA(i,a,c,m){return c.length>0&&J4(i,c,m)?{segmentGroup:new lr(a,Y4(m,new lr(c,i.children))),slicedSegments:[]}:c.length===0&&K4(i,c,m)?{segmentGroup:new lr(i.segments,X4(i,c,m,i.children)),slicedSegments:c}:{segmentGroup:new lr(i.segments,i.children),slicedSegments:c}}function X4(i,a,c,m){let b={};for(let n of c)if(Gy(i,a,n)&&!m[ds(n)]){let P=new lr([],{});b[ds(n)]=P}return kt(kt({},m),b)}function Y4(i,a){let c={};c[Pn]=a;for(let m of i)if(m.path===""&&ds(m)!==Pn){let b=new lr([],{});c[ds(m)]=b}return c}function J4(i,a,c){return c.some(m=>Gy(i,a,m)&&ds(m)!==Pn)}function K4(i,a,c){return c.some(m=>Gy(i,a,m))}function Gy(i,a,c){return(i.hasChildren()||a.length>0)&&c.pathMatch==="full"?!1:c.path===""}function Q4(i,a,c){return a.length===0&&!i.children[c]}var z1=class{};function e5(i,a,c,m,b,n,P="emptyOnly"){return new B1(i,a,c,m,b,P,n).recognize()}var t5=31,B1=class{constructor(a,c,m,b,n,P,U){this.injector=a,this.configLoader=c,this.rootComponentType=m,this.config=b,this.urlTree=n,this.paramsInheritanceStrategy=P,this.urlSerializer=U,this.applyRedirects=new F1(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(a){return new rn(4002,`'${a.segmentGroup}'`)}recognize(){let a=uA(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(a).pipe(Wn(({children:c,rootSnapshot:m})=>{let b=new uo(m,c),n=new Vy("",b),P=l4(m,[],this.urlTree.queryParams,this.urlTree.fragment);return P.queryParams=this.urlTree.queryParams,n.url=this.urlSerializer.serialize(P),{state:n,tree:P}}))}match(a){let c=new Xh([],Object.freeze({}),Object.freeze(kt({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Pn,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,a,Pn,c).pipe(Wn(m=>({children:m,rootSnapshot:c})),wl(m=>{if(m instanceof Xp)return this.urlTree=m.urlTree,this.match(m.urlTree.root);throw m instanceof Zp?this.noMatchError(m):m}))}processSegmentGroup(a,c,m,b,n){return m.segments.length===0&&m.hasChildren()?this.processChildren(a,c,m,n):this.processSegment(a,c,m,m.segments,b,!0,n).pipe(Wn(P=>P instanceof uo?[P]:[]))}processChildren(a,c,m,b){let n=[];for(let P of Object.keys(m.children))P==="primary"?n.unshift(P):n.push(P);return Ur(n).pipe(Nc(P=>{let U=m.children[P],$=g4(c,P);return this.processSegmentGroup(a,$,U,P,b)}),hx((P,U)=>(P.push(...U),P)),El(null),ux(),Zr(P=>{if(P===null)return qh(m);let U=FA(P);return n5(U),En(U)}))}processSegment(a,c,m,b,n,P,U){return Ur(c).pipe(Nc($=>this.processSegmentAgainstRoute($._injector??a,c,$,m,b,n,P,U).pipe(wl(se=>{if(se instanceof Zp)return En(null);throw se}))),os($=>!!$),wl($=>{if(OA($))return Q4(m,b,n)?En(new z1):qh(m);throw $}))}processSegmentAgainstRoute(a,c,m,b,n,P,U,$){return ds(m)!==P&&(P===Pn||!Gy(b,n,m))?qh(b):m.redirectTo===void 0?this.matchSegmentAgainstRoute(a,b,m,n,P,$):this.allowRedirects&&U?this.expandSegmentAgainstRouteUsingRedirect(a,b,c,m,n,P,$):qh(b)}expandSegmentAgainstRouteUsingRedirect(a,c,m,b,n,P,U){let{matched:$,parameters:se,consumedSegments:Te,positionalParamSegments:Pe,remainingSegments:Ye}=kA(c,b,n);if(!$)return qh(c);typeof b.redirectTo=="string"&&b.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>t5&&(this.allowRedirects=!1));let We=new Xh(n,se,Object.freeze(kt({},this.urlTree.queryParams)),this.urlTree.fragment,hA(b),ds(b),b.component??b._loadedComponent??null,b,dA(b)),pt=By(We,U,this.paramsInheritanceStrategy);We.params=Object.freeze(pt.params),We.data=Object.freeze(pt.data);let _t=this.applyRedirects.applyRedirectCommands(Te,b.redirectTo,Pe,We,a);return this.applyRedirects.lineralizeSegments(b,_t).pipe(Zr(on=>this.processSegment(a,m,c,on.concat(Ye),P,!1,U)))}matchSegmentAgainstRoute(a,c,m,b,n,P){let U=W4(c,m,b,a,this.urlSerializer);return m.path==="**"&&(c.children={}),U.pipe(So($=>$.matched?(a=m._injector??a,this.getChildConfig(a,m,b).pipe(So(({routes:se})=>{let Te=m._loadedInjector??a,{parameters:Pe,consumedSegments:Ye,remainingSegments:We}=$,pt=new Xh(Ye,Pe,Object.freeze(kt({},this.urlTree.queryParams)),this.urlTree.fragment,hA(m),ds(m),m.component??m._loadedComponent??null,m,dA(m)),_t=By(pt,P,this.paramsInheritanceStrategy);pt.params=Object.freeze(_t.params),pt.data=Object.freeze(_t.data);let{segmentGroup:on,slicedSegments:an}=uA(c,Ye,We,se);if(an.length===0&&on.hasChildren())return this.processChildren(Te,se,on,pt).pipe(Wn(mr=>new uo(pt,mr)));if(se.length===0&&an.length===0)return En(new uo(pt,[]));let Ft=ds(m)===n;return this.processSegment(Te,se,on,an,Ft?Pn:n,!0,pt).pipe(Wn(mr=>new uo(pt,mr instanceof uo?[mr]:[])))}))):qh(c)))}getChildConfig(a,c,m){return c.children?En({routes:c.children,injector:a}):c.loadChildren?c._loadedRoutes!==void 0?En({routes:c._loadedRoutes,injector:c._loadedInjector}):$4(a,c,m,this.urlSerializer).pipe(Zr(b=>b?this.configLoader.loadChildren(a,c).pipe(Xr(n=>{c._loadedRoutes=n.routes,c._loadedInjector=n.injector})):q4(c))):En({routes:[],injector:a})}};function n5(i){i.sort((a,c)=>a.value.outlet===Pn?-1:c.value.outlet===Pn?1:a.value.outlet.localeCompare(c.value.outlet))}function r5(i){let a=i.value.routeConfig;return a&&a.path===""}function FA(i){let a=[],c=new Set;for(let m of i){if(!r5(m)){a.push(m);continue}let b=a.find(n=>m.value.routeConfig===n.value.routeConfig);b!==void 0?(b.children.push(...m.children),c.add(b)):a.push(m)}for(let m of c){let b=FA(m.children);a.push(new uo(m.value,b))}return a.filter(m=>!c.has(m))}function hA(i){return i.data||{}}function dA(i){return i.resolve||{}}function i5(i,a,c,m,b,n){return Zr(P=>e5(i,a,c,m,P.extractedUrl,b,n).pipe(Wn(({state:U,tree:$})=>Sr(kt({},P),{targetSnapshot:U,urlAfterRedirects:$}))))}function o5(i,a){return Zr(c=>{let{targetSnapshot:m,guards:{canActivateChecks:b}}=c;if(!b.length)return En(c);let n=new Set(b.map($=>$.route)),P=new Set;for(let $ of n)if(!P.has($))for(let se of NA($))P.add(se);let U=0;return Ur(P).pipe(Nc($=>n.has($)?s5($,m,i,a):($.data=By($,$.parent,i).resolve,En(void 0))),Xr(()=>U++),Dh(1),Zr($=>U===P.size?En(c):oo))})}function NA(i){let a=i.children.map(c=>NA(c)).flat();return[i,...a]}function s5(i,a,c,m){let b=i.routeConfig,n=i._resolve;return b?.title!==void 0&&!MA(b)&&(n[Yp]=b.title),a5(n,i,a,m).pipe(Wn(P=>(i._resolvedData=P,i.data=By(i,i.parent,c).resolve,null)))}function a5(i,a,c,m){let b=m1(i);if(b.length===0)return En({});let n={};return Ur(b).pipe(Zr(P=>l5(i[P],a,c,m).pipe(os(),Xr(U=>{if(U instanceof Wp)throw jy(new Vp,U);n[P]=U}))),Dh(1),cx(n),wl(P=>OA(P)?oo:Th(P)))}function l5(i,a,c,m){let b=Jp(a)??m,n=td(i,b),P=n.resolve?n.resolve(a,c):Ls(b,()=>n(a,c));return Pl(P)}function f1(i){return So(a=>{let c=i(a);return c?Ur(c).pipe(Wn(()=>a)):En(a)})}var zA=(()=>{class i{buildTitle(c){let m,b=c.root;for(;b!==void 0;)m=this.getResolvedTitleForRoute(b)??m,b=b.children.find(n=>n.outlet===Pn);return m}getResolvedTitleForRoute(c){return c.data[Yp]}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:()=>Et(c5),providedIn:"root"})}}return i})(),c5=(()=>{class i extends zA{constructor(c){super(),this.title=c}updateTitle(c){let m=this.buildTitle(c);m!==void 0&&this.title.setTitle(m)}static{this.\u0275fac=function(m){return new(m||i)(Jn(iA))}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),G1=new yn("",{providedIn:"root",factory:()=>({})}),u5=(()=>{class i{static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275cmp=Vh({type:i,selectors:[["ng-component"]],standalone:!0,features:[$h],decls:1,vars:0,template:function(m,b){m&1&&Rl(0,"router-outlet")},dependencies:[y4],encapsulation:2})}}return i})();function H1(i){let a=i.children&&i.children.map(H1),c=a?Sr(kt({},i),{children:a}):kt({},i);return!c.component&&!c.loadComponent&&(a||c.loadChildren)&&c.outlet&&c.outlet!==Pn&&(c.component=u5),c}var q1=new yn(""),h5=(()=>{class i{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Et(Zb)}loadComponent(c){if(this.componentLoaders.get(c))return this.componentLoaders.get(c);if(c._loadedComponent)return En(c._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(c);let m=Pl(c.loadComponent()).pipe(Wn(BA),Xr(n=>{this.onLoadEndListener&&this.onLoadEndListener(c),c._loadedComponent=n}),Sh(()=>{this.componentLoaders.delete(c)})),b=new Eh(m,()=>new Ri).pipe(wh());return this.componentLoaders.set(c,b),b}loadChildren(c,m){if(this.childrenLoaders.get(m))return this.childrenLoaders.get(m);if(m._loadedRoutes)return En({routes:m._loadedRoutes,injector:m._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(m);let n=d5(m,this.compiler,c,this.onLoadEndListener).pipe(Sh(()=>{this.childrenLoaders.delete(m)})),P=new Eh(n,()=>new Ri).pipe(wh());return this.childrenLoaders.set(m,P),P}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function d5(i,a,c,m){return Pl(i.loadChildren()).pipe(Wn(BA),Zr(b=>b instanceof mp||Array.isArray(b)?En(b):Ur(a.compileModuleAsync(b))),Wn(b=>{m&&m(i);let n,P,U=!1;return Array.isArray(b)?(P=b,U=!0):(n=b.create(c).injector,P=n.get(q1,[],{optional:!0,self:!0}).flat()),{routes:P.map(H1),injector:n}}))}function f5(i){return i&&typeof i=="object"&&"default"in i}function BA(i){return f5(i)?i.default:i}var W1=(()=>{class i{static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:()=>Et(p5),providedIn:"root"})}}return i})(),p5=(()=>{class i{shouldProcessUrl(c){return!0}extract(c){return c}merge(c,m){return c}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),m5=new yn("");var g5=new yn(""),_5=(()=>{class i{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ri,this.transitionAbortSubject=new Ri,this.configLoader=Et(h5),this.environmentInjector=Et(Ao),this.urlSerializer=Et(j1),this.rootContexts=Et($y),this.location=Et(Mp),this.inputBindingEnabled=Et($1,{optional:!0})!==null,this.titleStrategy=Et(zA),this.options=Et(G1,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Et(W1),this.createViewTransition=Et(m5,{optional:!0}),this.navigationErrorHandler=Et(g5,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>En(void 0),this.rootComponentType=null;let c=b=>this.events.next(new T1(b)),m=b=>this.events.next(new I1(b));this.configLoader.onLoadEndListener=m,this.configLoader.onLoadStartListener=c}complete(){this.transitions?.complete()}handleNavigationRequest(c){let m=++this.navigationId;this.transitions?.next(Sr(kt(kt({},this.transitions.value),c),{id:m}))}setupNavigations(c,m,b){return this.transitions=new ai({id:0,currentUrlTree:m,currentRawUrl:m,extractedUrl:this.urlHandlingStrategy.extract(m),urlAfterRedirects:this.urlHandlingStrategy.extract(m),rawUrl:m,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:zp,restoredState:null,currentSnapshot:b.snapshot,targetSnapshot:null,currentRouterState:b,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Io(n=>n.id!==0),Wn(n=>Sr(kt({},n),{extractedUrl:this.urlHandlingStrategy.extract(n.rawUrl)})),So(n=>{let P=!1,U=!1;return En(n).pipe(So($=>{if(this.navigationId>n.id)return this.cancelNavigationTransition(n,"",ho.SupersededByNewNavigation),oo;this.currentTransition=n,this.currentNavigation={id:$.id,initialUrl:$.rawUrl,extractedUrl:$.extractedUrl,targetBrowserUrl:typeof $.extras.browserUrl=="string"?this.urlSerializer.parse($.extras.browserUrl):$.extras.browserUrl,trigger:$.source,extras:$.extras,previousNavigation:this.lastSuccessfulNavigation?Sr(kt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let se=!c.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Te=$.extras.onSameUrlNavigation??c.onSameUrlNavigation;if(!se&&Te!=="reload"){let Pe="";return this.events.next(new tu($.id,this.urlSerializer.serialize($.rawUrl),Pe,v1.IgnoredSameUrlNavigation)),$.resolve(!1),oo}if(this.urlHandlingStrategy.shouldProcessUrl($.rawUrl))return En($).pipe(So(Pe=>{let Ye=this.transitions?.getValue();return this.events.next(new $p(Pe.id,this.urlSerializer.serialize(Pe.extractedUrl),Pe.source,Pe.restoredState)),Ye!==this.transitions?.getValue()?oo:Promise.resolve(Pe)}),i5(this.environmentInjector,this.configLoader,this.rootComponentType,c.config,this.urlSerializer,this.paramsInheritanceStrategy),Xr(Pe=>{n.targetSnapshot=Pe.targetSnapshot,n.urlAfterRedirects=Pe.urlAfterRedirects,this.currentNavigation=Sr(kt({},this.currentNavigation),{finalUrl:Pe.urlAfterRedirects});let Ye=new Fy(Pe.id,this.urlSerializer.serialize(Pe.extractedUrl),this.urlSerializer.serialize(Pe.urlAfterRedirects),Pe.targetSnapshot);this.events.next(Ye)}));if(se&&this.urlHandlingStrategy.shouldProcessUrl($.currentRawUrl)){let{id:Pe,extractedUrl:Ye,source:We,restoredState:pt,extras:_t}=$,on=new $p(Pe,this.urlSerializer.serialize(Ye),We,pt);this.events.next(on);let an=DA(this.rootComponentType).snapshot;return this.currentTransition=n=Sr(kt({},$),{targetSnapshot:an,urlAfterRedirects:Ye,extras:Sr(kt({},_t),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=Ye,En(n)}else{let Pe="";return this.events.next(new tu($.id,this.urlSerializer.serialize($.extractedUrl),Pe,v1.IgnoredByUrlHandlingStrategy)),$.resolve(!1),oo}}),Xr($=>{let se=new x1($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(se)}),Wn($=>(this.currentTransition=n=Sr(kt({},$),{guards:T4($.targetSnapshot,$.currentSnapshot,this.rootContexts)}),n)),k4(this.environmentInjector,$=>this.events.next($)),Xr($=>{if(n.guardsResult=$.guardsResult,$.guardsResult&&typeof $.guardsResult!="boolean")throw jy(this.urlSerializer,$.guardsResult);let se=new b1($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot,!!$.guardsResult);this.events.next(se)}),Io($=>$.guardsResult?!0:(this.cancelNavigationTransition($,"",ho.GuardRejected),!1)),f1($=>{if($.guards.canActivateChecks.length)return En($).pipe(Xr(se=>{let Te=new w1(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(Te)}),So(se=>{let Te=!1;return En(se).pipe(o5(this.paramsInheritanceStrategy,this.environmentInjector),Xr({next:()=>Te=!0,complete:()=>{Te||this.cancelNavigationTransition(se,"",ho.NoDataFromResolver)}}))}),Xr(se=>{let Te=new E1(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(Te)}))}),f1($=>{let se=Te=>{let Pe=[];Te.routeConfig?.loadComponent&&!Te.routeConfig._loadedComponent&&Pe.push(this.configLoader.loadComponent(Te.routeConfig).pipe(Xr(Ye=>{Te.component=Ye}),Wn(()=>{})));for(let Ye of Te.children)Pe.push(...se(Ye));return Pe};return u_(se($.targetSnapshot.root)).pipe(El(null),ca(1))}),f1(()=>this.afterPreactivation()),So(()=>{let{currentSnapshot:$,targetSnapshot:se}=n,Te=this.createViewTransition?.(this.environmentInjector,$.root,se.root);return Te?Ur(Te).pipe(Wn(()=>n)):En(n)}),Wn($=>{let se=v4(c.routeReuseStrategy,$.targetSnapshot,$.currentRouterState);return this.currentTransition=n=Sr(kt({},$),{targetRouterState:se}),this.currentNavigation.targetRouterState=se,n}),Xr(()=>{this.events.next(new Hp)}),E4(this.rootContexts,c.routeReuseStrategy,$=>this.events.next($),this.inputBindingEnabled),ca(1),Xr({next:$=>{P=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new eu($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects))),this.titleStrategy?.updateTitle($.targetRouterState.snapshot),$.resolve(!0)},complete:()=>{P=!0}}),fx(this.transitionAbortSubject.pipe(Xr($=>{throw $}))),Sh(()=>{!P&&!U&&this.cancelNavigationTransition(n,"",ho.SupersededByNewNavigation),this.currentTransition?.id===n.id&&(this.currentNavigation=null,this.currentTransition=null)}),wl($=>{if(U=!0,PA($))this.events.next(new ma(n.id,this.urlSerializer.serialize(n.extractedUrl),$.message,$.cancellationCode)),w4($)?this.events.next(new Kh($.url,$.navigationBehaviorOptions)):n.resolve(!1);else{let se=new Gp(n.id,this.urlSerializer.serialize(n.extractedUrl),$,n.targetSnapshot??void 0);try{let Te=Ls(this.environmentInjector,()=>this.navigationErrorHandler?.(se));if(Te instanceof Wp){let{message:Pe,cancellationCode:Ye}=jy(this.urlSerializer,Te);this.events.next(new ma(n.id,this.urlSerializer.serialize(n.extractedUrl),Pe,Ye)),this.events.next(new Kh(Te.redirectTo,Te.navigationBehaviorOptions))}else{this.events.next(se);let Pe=c.errorHandler($);n.resolve(!!Pe)}}catch(Te){this.options.resolveNavigationPromiseOnError?n.resolve(!1):n.reject(Te)}}return oo}))}))}cancelNavigationTransition(c,m,b){let n=new ma(c.id,this.urlSerializer.serialize(c.extractedUrl),m,b);this.events.next(n),c.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let c=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),m=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return c.toString()!==m?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function y5(i){return i!==zp}var v5=(()=>{class i{static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:()=>Et(x5),providedIn:"root"})}}return i})(),V1=class{shouldDetach(a){return!1}store(a,c){}shouldAttach(a){return!1}retrieve(a){return null}shouldReuseRoute(a,c){return a.routeConfig===c.routeConfig}},x5=(()=>{class i extends V1{static{this.\u0275fac=(()=>{let c;return function(b){return(c||(c=Tb(i)))(b||i)}})()}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),VA=(()=>{class i{static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:()=>Et(b5),providedIn:"root"})}}return i})(),b5=(()=>{class i extends VA{constructor(){super(...arguments),this.location=Et(Mp),this.urlSerializer=Et(j1),this.options=Et(G1,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Et(W1),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new ga,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=DA(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(c){return this.location.subscribe(m=>{m.type==="popstate"&&c(m.url,m.state)})}handleRouterEvent(c,m){if(c instanceof $p)this.stateMemento=this.createStateMemento();else if(c instanceof tu)this.rawUrlTree=m.initialUrl;else if(c instanceof Fy){if(this.urlUpdateStrategy==="eager"&&!m.extras.skipLocationChange){let b=this.urlHandlingStrategy.merge(m.finalUrl,m.initialUrl);this.setBrowserUrl(m.targetBrowserUrl??b,m)}}else c instanceof Hp?(this.currentUrlTree=m.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(m.finalUrl,m.initialUrl),this.routerState=m.targetRouterState,this.urlUpdateStrategy==="deferred"&&!m.extras.skipLocationChange&&this.setBrowserUrl(m.targetBrowserUrl??this.rawUrlTree,m)):c instanceof ma&&(c.code===ho.GuardRejected||c.code===ho.NoDataFromResolver)?this.restoreHistory(m):c instanceof Gp?this.restoreHistory(m,!0):c instanceof eu&&(this.lastSuccessfulId=c.id,this.currentPageId=this.browserPageId)}setBrowserUrl(c,m){let b=c instanceof ga?this.urlSerializer.serialize(c):c;if(this.location.isCurrentPathEqualTo(b)||m.extras.replaceUrl){let n=this.browserPageId,P=kt(kt({},m.extras.state),this.generateNgRouterState(m.id,n));this.location.replaceState(b,"",P)}else{let n=kt(kt({},m.extras.state),this.generateNgRouterState(m.id,this.browserPageId+1));this.location.go(b,"",n)}}restoreHistory(c,m=!1){if(this.canceledNavigationResolution==="computed"){let b=this.browserPageId,n=this.currentPageId-b;n!==0?this.location.historyGo(n):this.currentUrlTree===c.finalUrl&&n===0&&(this.resetState(c),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(m&&this.resetState(c),this.resetUrlToCurrentUrlTree())}resetState(c){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,c.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(c,m){return this.canceledNavigationResolution==="computed"?{navigationId:c,\u0275routerPageId:m}:{navigationId:c}}static{this.\u0275fac=(()=>{let c;return function(b){return(c||(c=Tb(i)))(b||i)}})()}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Fp=function(i){return i[i.COMPLETE=0]="COMPLETE",i[i.FAILED=1]="FAILED",i[i.REDIRECTING=2]="REDIRECTING",i}(Fp||{});function w5(i,a){i.events.pipe(Io(c=>c instanceof eu||c instanceof ma||c instanceof Gp||c instanceof tu),Wn(c=>c instanceof eu||c instanceof tu?Fp.COMPLETE:(c instanceof ma?c.code===ho.Redirect||c.code===ho.SupersededByNewNavigation:!1)?Fp.REDIRECTING:Fp.FAILED),Io(c=>c!==Fp.REDIRECTING),ca(1)).subscribe(()=>{a()})}function E5(i){throw i}var T5={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},I5={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},jA=(()=>{class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=Et(vy),this.stateManager=Et(VA),this.options=Et(G1,{optional:!0})||{},this.pendingTasks=Et(Zc),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Et(_5),this.urlSerializer=Et(j1),this.location=Et(Mp),this.urlHandlingStrategy=Et(W1),this._events=new Ri,this.errorHandler=this.options.errorHandler||E5,this.navigated=!1,this.routeReuseStrategy=Et(v5),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Et(q1,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Et($1,{optional:!0}),this.eventsSubscription=new jr,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:c=>{this.console.warn(c)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let c=this.navigationTransitions.events.subscribe(m=>{try{let b=this.navigationTransitions.currentTransition,n=this.navigationTransitions.currentNavigation;if(b!==null&&n!==null){if(this.stateManager.handleRouterEvent(m,n),m instanceof ma&&m.code!==ho.Redirect&&m.code!==ho.SupersededByNewNavigation)this.navigated=!0;else if(m instanceof eu)this.navigated=!0;else if(m instanceof Kh){let P=m.navigationBehaviorOptions,U=this.urlHandlingStrategy.merge(m.url,b.currentRawUrl),$=kt({browserUrl:b.extras.browserUrl,info:b.extras.info,skipLocationChange:b.extras.skipLocationChange,replaceUrl:b.extras.replaceUrl||this.urlUpdateStrategy==="eager"||y5(b.source)},P);this.scheduleNavigation(U,zp,null,$,{resolve:b.resolve,reject:b.reject,promise:b.promise})}}D5(m)&&this._events.next(m)}catch(b){this.navigationTransitions.transitionAbortSubject.next(b)}});this.eventsSubscription.add(c)}resetRootComponentType(c){this.routerState.root.component=c,this.navigationTransitions.rootComponentType=c}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),zp,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((c,m)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(c,"popstate",m)},0)})}navigateToSyncWithBrowser(c,m,b){let n={replaceUrl:!0},P=b?.navigationId?b:null;if(b){let $=kt({},b);delete $.navigationId,delete $.\u0275routerPageId,Object.keys($).length!==0&&(n.state=$)}let U=this.parseUrl(c);this.scheduleNavigation(U,m,P,n)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(c){this.config=c.map(H1),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(c,m={}){let{relativeTo:b,queryParams:n,fragment:P,queryParamsHandling:U,preserveFragment:$}=m,se=$?this.currentUrlTree.fragment:P,Te=null;switch(U??this.options.defaultQueryParamsHandling){case"merge":Te=kt(kt({},this.currentUrlTree.queryParams),n);break;case"preserve":Te=this.currentUrlTree.queryParams;break;default:Te=n||null}Te!==null&&(Te=this.removeEmptyProps(Te));let Pe;try{let Ye=b?b.snapshot:this.routerState.snapshot.root;Pe=EA(Ye)}catch{(typeof c[0]!="string"||c[0][0]!=="/")&&(c=[]),Pe=this.currentUrlTree.root}return TA(Pe,c,Te,se??null)}navigateByUrl(c,m={skipLocationChange:!1}){let b=jp(c)?c:this.parseUrl(c),n=this.urlHandlingStrategy.merge(b,this.rawUrlTree);return this.scheduleNavigation(n,zp,null,m)}navigate(c,m={skipLocationChange:!1}){return S5(c),this.navigateByUrl(this.createUrlTree(c,m),m)}serializeUrl(c){return this.urlSerializer.serialize(c)}parseUrl(c){try{return this.urlSerializer.parse(c)}catch{return this.urlSerializer.parse("/")}}isActive(c,m){let b;if(m===!0?b=kt({},T5):m===!1?b=kt({},I5):b=m,jp(c))return sA(this.currentUrlTree,c,b);let n=this.parseUrl(c);return sA(this.currentUrlTree,n,b)}removeEmptyProps(c){return Object.entries(c).reduce((m,[b,n])=>(n!=null&&(m[b]=n),m),{})}scheduleNavigation(c,m,b,n,P){if(this.disposed)return Promise.resolve(!1);let U,$,se;P?(U=P.resolve,$=P.reject,se=P.promise):se=new Promise((Pe,Ye)=>{U=Pe,$=Ye});let Te=this.pendingTasks.add();return w5(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Te))}),this.navigationTransitions.handleNavigationRequest({source:m,restoredState:b,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:c,extras:n,resolve:U,reject:$,promise:se,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),se.catch(Pe=>Promise.reject(Pe))}static{this.\u0275fac=function(m){return new(m||i)}}static{this.\u0275prov=vn({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function S5(i){for(let a=0;a<i.length;a++)if(i[a]==null)throw new rn(4008,!1)}function D5(i){return!(i instanceof Hp)&&!(i instanceof Kh)}var C5=new yn("");function UA(i,...a){return Hc([{provide:q1,multi:!0,useValue:i},[],{provide:Qh,useFactory:M5,deps:[jA]},{provide:Gh,multi:!0,useFactory:A5},a.map(c=>c.\u0275providers)])}function M5(i){return i.routerState.root}function A5(){let i=Et(fa);return a=>{let c=i.get(Fs);if(a!==c.components[0])return;let m=i.get(jA),b=i.get(R5);i.get(P5)===1&&m.initialNavigation(),i.get(O5,null,Nn.Optional)?.setUpPreloading(),i.get(C5,null,Nn.Optional)?.init(),m.resetRootComponentType(c.componentTypes[0]),b.closed||(b.next(),b.complete(),b.unsubscribe())}}var R5=new yn("",{factory:()=>new Ri}),P5=new yn("",{providedIn:"root",factory:()=>1});var O5=new yn("");var $A=[];var GA={providers:[IM({eventCoalescing:!0}),UA($A),oA()]};var Z1={production:!0,mapboxSecretKey:"sk.eyJ1IjoicXVhY2tkdWNrMDEwMSIsImEiOiJjbTN0c2k0bjQwYjd3MmxzYzZxd25kOWpjIn0.ZtscE962-1L0f8CZvTLzbA",mapboxApiKey:"pk.eyJ1IjoicXVhY2tkdWNrMDEwMSIsImEiOiJjbTNzZ3Q0dzkwNnIzMnJwdnltcHMxem0wIn0.xo2vkel4QJccMWvBX8Ydgw"};var _a=kI(qA()),ZR=kI(WR());function yj(i,a){if(i&1&&(Yc(0,"option",9),yy(1),Al()),i&2){let c=a.$implicit;_y("value",c.style),zb(),Wb(" ",c.name," ")}}var Qy=class i{constructor(a){this.platformId=a}map;latitude=null;longitude=null;mapStyles=[{name:"Standard",style:"mapbox://styles/mapbox/standard"},{name:"New Satellite",style:"mapbox://styles/mapbox/standard-satellite"},{name:"Streets",style:"mapbox://styles/mapbox/streets-v12"},{name:"Outdoors",style:"mapbox://styles/mapbox/outdoors-v12"},{name:"Satellite",style:"mapbox://styles/mapbox/satellite-v9"},{name:"Satellite Streets",style:"mapbox://styles/mapbox/satellite-streets-v12"},{name:"Nav Day",style:"mapbox://styles/mapbox/navigation-day-v1"},{name:"Nav Night",style:"mapbox://styles/mapbox/navigation-night-v1"},{name:"Dark",style:"mapbox://styles/mapbox/dark-v11"},{name:"Light",style:"mapbox://styles/mapbox/light-v11"}];ngAfterViewInit(){VM(this.platformId)&&(this.initMap(),this.getUserLocation(),this.addSearchBar())}initMap(){let a=Z1.mapboxApiKey;this.map=new _a.Map({accessToken:a,container:"map",style:this.mapStyles[0].style,center:[0,0],zoom:2}),this.map.addControl(new _a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),this.map.on("load",()=>{this.latitude&&this.longitude&&this.addMarker(this.latitude,this.longitude)})}addMarker(a,c){new _a.Marker().setLngLat([c,a]).setPopup(new _a.Popup().setHTML("<p>You are here</p>")).addTo(this.map),this.map.setCenter([c,a]),this.map.setZoom(18)}getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{this.latitude=a.coords.latitude,this.longitude=a.coords.longitude,this.map&&this.addMarker(this.latitude,this.longitude)},a=>{console.error("Error getting location: ",a)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):console.error("Geolocation is not supported by this browser.")}centerToUserLocation(){this.latitude!==null&&this.longitude!==null&&this.map?this.addMarker(this.latitude,this.longitude):console.warn("User location is not available.")}changeMapStyle(a){let m=a.target.value;this.map&&this.map.setStyle(m)}addSearchBar(){let a=new ZR.default({accessToken:Z1.mapboxApiKey,mapboxgl:_a,placeholder:"Search for places",proximity:{longitude:0,latitude:0},limit:5});this.map.addControl(a,"top"),a.on("result",c=>{let m=c.result.center;m&&(this.map.setCenter(m),this.map.setZoom(15))})}static \u0275fac=function(c){return new(c||i)(Ml(Oo))};static \u0275cmp=Vh({type:i,selectors:[["app-map"]],standalone:!0,features:[$h],decls:12,vars:1,consts:[["id","map",2,"height","100vh","width","100%","margin","0 !important"],[1,"app-header"],[1,"logo"],[2,"color","rgb(144, 6, 6)"],["id","locate-button",2,"position","absolute","bottom","20px","right","20px","z-index","1000","border","0","background","transparent",3,"click"],[1,"fa-solid","fa-location-crosshairs",2,"font-size","2.5rem"],[1,"map-style-container"],[1,"map-style-selector",3,"change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(c,m){c&1&&(Rl(0,"div",0),Yc(1,"header",1)(2,"div",2)(3,"h1")(4,"span",3),yy(5,"Go"),Al(),yy(6,"-Out"),Al()()(),Yc(7,"button",4),Ip("click",function(){return m.centerToUserLocation()}),Rl(8,"i",5),Al(),Yc(9,"div",6)(10,"select",7),Ip("change",function(n){return m.changeMapStyle(n)}),qb(11,yj,2,2,"option",8),Al()()),c&2&&(zb(11),_y("ngForOf",m.mapStyles))},dependencies:[Qb,BM],styles:['@font-face{font-family:Roboto;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu72xKOzY.woff2) format("woff2");unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Roboto;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu5mxKOzY.woff2) format("woff2");unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:Roboto;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu7mxKOzY.woff2) format("woff2");unicode-range:U+1F00-1FFF}@font-face{font-family:Roboto;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu4WxKOzY.woff2) format("woff2");unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:Roboto;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu7WxKOzY.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:Roboto;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu7GxKOzY.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Roboto;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu4mxK.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Roboto;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfCRc4EsA.woff2) format("woff2");unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Roboto;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfABc4EsA.woff2) format("woff2");unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:Roboto;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfCBc4EsA.woff2) format("woff2");unicode-range:U+1F00-1FFF}@font-face{font-family:Roboto;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfBxc4EsA.woff2) format("woff2");unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:Roboto;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfCxc4EsA.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:Roboto;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfChc4EsA.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Roboto;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfBBc4.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}.mapboxgl-ctrl-geocoder[_ngcontent-%COMP%], .mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], .mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:after, .mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:before{box-sizing:border-box}.mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]{font-size:18px;line-height:24px;font-family:Open Sans,-apple-system,BlinkMacSystemFont,Helvetica Neue,Arial,Helvetica,sans-serif;position:relative;background-color:#fff;width:100%;min-width:240px;z-index:1;border-radius:4px;transition:width .25s,min-width .25s}.mapboxgl-ctrl-geocoder--input[_ngcontent-%COMP%]{font:inherit;width:100%;border:0;background-color:transparent;margin:0;height:50px;color:#404040;color:#000000bf;padding:6px 45px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.mapboxgl-ctrl-geocoder--input[_ngcontent-%COMP%]::-ms-clear{display:none}.mapboxgl-ctrl-geocoder--input[_ngcontent-%COMP%]:focus{color:#404040;color:#000000bf;outline:0;box-shadow:none;outline:thin dotted}.mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]   .mapboxgl-ctrl-geocoder--pin-right[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{z-index:2;position:absolute;right:8px;top:7px;display:none}.mapboxgl-ctrl-geocoder[_ngcontent-%COMP%], .mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]{box-shadow:0 0 10px 2px #0000001a}.mapboxgl-ctrl-geocoder.mapboxgl-ctrl-geocoder--collapsed[_ngcontent-%COMP%]{width:50px;min-width:50px;transition:width .25s,min-width .25s}.mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]{background-color:#fff;border-radius:4px;left:0;list-style:none;margin:0;padding:0;position:absolute;width:100%;top:110%;top:calc(100% + 6px);z-index:1000;overflow:hidden;font-size:15px}.mapboxgl-ctrl-bottom-left[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%], .mapboxgl-ctrl-bottom-right[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]{top:auto;bottom:100%}.mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{cursor:default;display:block;padding:6px 12px;color:#404040}.mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%] > .active[_ngcontent-%COMP%] > a[_ngcontent-%COMP%], .mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{color:#404040;background-color:#f3f3f3;text-decoration:none;cursor:pointer}.mapboxgl-ctrl-geocoder--suggestion-title[_ngcontent-%COMP%]{font-weight:700}.mapboxgl-ctrl-geocoder--suggestion-title[_ngcontent-%COMP%], .mapboxgl-ctrl-geocoder--suggestion-address[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mapboxgl-ctrl-geocoder--icon[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;speak:none;fill:#757575;top:15px}.mapboxgl-ctrl-geocoder--icon-search[_ngcontent-%COMP%]{position:absolute;top:13px;left:12px;width:23px;height:23px}.mapboxgl-ctrl-geocoder--button[_ngcontent-%COMP%]{padding:0;margin:0;border:none;cursor:pointer;background:#fff;line-height:1}.mapboxgl-ctrl-geocoder--icon-close[_ngcontent-%COMP%]{width:20px;height:20px;margin-top:8px;margin-right:3px}.mapboxgl-ctrl-geocoder--button[_ngcontent-%COMP%]:hover   .mapboxgl-ctrl-geocoder--icon-close[_ngcontent-%COMP%]{fill:#909090}.mapboxgl-ctrl-geocoder--icon-geolocate[_ngcontent-%COMP%]{width:22px;height:22px;margin-top:6px;margin-right:3px}.mapboxgl-ctrl-geocoder--icon-loading[_ngcontent-%COMP%]{width:26px;height:26px;margin-top:5px;margin-right:0;-moz-animation:rotate .8s infinite cubic-bezier(.45,.05,.55,.95);-webkit-animation:_ngcontent-%COMP%_rotate .8s infinite cubic-bezier(.45,.05,.55,.95);animation:_ngcontent-%COMP%_rotate .8s infinite cubic-bezier(.45,.05,.55,.95)}.mapboxgl-ctrl-geocoder--powered-by[_ngcontent-%COMP%]{display:block;float:left;padding:6px 12px 9px;font-size:13px}.mapboxgl-ctrl-geocoder--powered-by[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#909090}.mapboxgl-ctrl-geocoder--powered-by[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:not(:hover){text-decoration:none}@-webkit-keyframes _ngcontent-%COMP%_rotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_rotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@media screen and (min-width: 640px){.mapboxgl-ctrl-geocoder.mapboxgl-ctrl-geocoder--collapsed[_ngcontent-%COMP%]{width:36px;min-width:36px}.mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]{width:33.3333%;font-size:15px;line-height:20px;max-width:360px}.mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]{font-size:13px}.mapboxgl-ctrl-geocoder--icon[_ngcontent-%COMP%]{top:8px}.mapboxgl-ctrl-geocoder--icon-close[_ngcontent-%COMP%]{width:16px;height:16px;margin-top:3px;margin-right:0}.mapboxgl-ctrl-geocoder--icon-geolocate[_ngcontent-%COMP%]{width:18px;height:18px;margin-top:2px;margin-right:0}.mapboxgl-ctrl-geocoder--icon-search[_ngcontent-%COMP%]{left:7px;width:20px;height:20px}.mapboxgl-ctrl-geocoder--input[_ngcontent-%COMP%]{height:36px;padding:6px 35px}.mapboxgl-ctrl-geocoder--icon-loading[_ngcontent-%COMP%]{width:26px;height:26px;margin-top:-2px;margin-right:-5px}.mapbox-gl-geocoder--error[_ngcontent-%COMP%]{color:#909090;padding:6px 12px;font-size:16px;text-align:center}.mapboxgl-ctrl-geocoder--powered-by[_ngcontent-%COMP%]{font-size:11px!important}}body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;margin:0;padding:0;box-sizing:border-box}.app-header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;background-color:#fffffe33;width:10%;color:#333;padding:.8rem 20px;z-index:1000;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 4px #0000001a}.app-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:900;margin:0}.map-style-container[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px;z-index:1000;background:#ffffffe6;border-radius:10%;box-shadow:0 4px 6px #0000001a}.map-style-selector[_ngcontent-%COMP%]{appearance:none;padding:8px 12px;font-size:1rem;border:1px solid #ccc;border-radius:10%;background:#f9f9f9;box-shadow:0 2px 4px #0000001a;cursor:pointer;outline:none;transition:box-shadow .2s ease,border-color .2s ease}.map-style-selector[_ngcontent-%COMP%]:focus{border-color:#007bff;box-shadow:0 0 8px #007bff80}.map-style-selector[_ngcontent-%COMP%]:hover{border-color:#007bff}']})};var ev=class i{title="go-out";static \u0275fac=function(c){return new(c||i)};static \u0275cmp=Vh({type:i,selectors:[["app-root"]],standalone:!0,features:[$h],decls:1,vars:0,template:function(c,m){c&1&&Rl(0,"app-map")},dependencies:[Qy]})};rA(ev,GA).catch(i=>console.error(i));
